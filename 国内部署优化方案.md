# 国内部署优化方案

## 🌏 国际平台在国内的访问速度

### Vercel（⚠️ 较慢）
```
访问速度：⭐⭐（慢）
原因：
- 主要节点在美国/欧洲/新加坡
- 国内没有 CDN 节点
- 可能被墙或限速

实际体验：
- 首次加载：5-15 秒
- 静态资源：较慢
- API 请求：取决于 Supabase 位置
```

### Netlify（⚠️ 较慢）
```
访问速度：⭐⭐（慢）
原因：
- 国内无直连节点
- CDN 在国外

实际体验：
- 首次加载：5-10 秒
- 不稳定，时快时慢
```

### Cloudflare Pages（⭐⭐⭐ 相对较好）
```
访问速度：⭐⭐⭐（可接受）
原因：
- Cloudflare 在国内有合作节点
- CDN 覆盖更好
- 但仍不如国内平台

实际体验：
- 首次加载：2-5 秒
- 相对最稳定
```

---

## 🇨🇳 国内推荐方案

### 方案 1：Vercel 国际版 + 国内 CDN（推荐⭐⭐⭐⭐⭐）

**架构**：
```
用户 → 阿里云/腾讯云 CDN → Vercel
```

**优势**：
- ✅ 保留 Vercel 的易用性
- ✅ 国内访问速度快
- ✅ 自动缓存静态资源

**步骤**：
1. 部署到 Vercel
2. 在阿里云/腾讯云配置 CDN
3. 将 CDN 回源到 Vercel 域名

**成本**：
- Vercel：免费
- CDN：~50-200元/月（看流量）

**访问速度**：⭐⭐⭐⭐⭐

---

### 方案 2：腾讯云 Webify（强烈推荐⭐⭐⭐⭐⭐）

**官网**：https://webify.cloudbase.net/

**优势**：
- ✅ 类似 Vercel 的体验
- ✅ 国内访问极快
- ✅ 自动 CI/CD
- ✅ 免费额度
- ✅ 支持 Git 集成

**免费额度**：
- 5GB 存储
- 5GB 流量/月
- 5 个网站

**部署步骤**：
```bash
# 1. 安装 CLI
npm install -g @cloudbase/cli

# 2. 登录
tcb login

# 3. 初始化
tcb init

# 4. 部署
tcb hosting deploy dist -e your-env-id
```

**访问速度**：⭐⭐⭐⭐⭐

---

### 方案 3：阿里云 OSS + CDN（推荐⭐⭐⭐⭐）

**优势**：
- ✅ 国内访问极快
- ✅ 稳定可靠
- ✅ 成本可控
- ✅ 灵活配置

**架构**：
```
用户 → 阿里云 CDN → OSS 存储
```

**部署步骤**：

#### 1. 构建项目
```bash
npm run build
# 生成 dist/ 目录
```

#### 2. 上传到 OSS
```bash
# 安装 ossutil
wget http://gosspublic.alicdn.com/ossutil/1.7.14/ossutil64
chmod 755 ossutil64

# 配置
./ossutil64 config

# 上传
./ossutil64 cp -r dist/ oss://your-bucket/
```

#### 3. 配置 CDN
- 进入阿里云 CDN 控制台
- 添加域名
- 配置源站为 OSS
- 配置缓存规则

**成本**：
- OSS 存储：~0.1元/GB/月
- CDN 流量：~0.2元/GB
- 预计：50-150元/月

**访问速度**：⭐⭐⭐⭐⭐

---

### 方案 4：腾讯云静态网站托管（推荐⭐⭐⭐⭐）

**优势**：
- ✅ 简单易用
- ✅ 国内访问快
- ✅ 集成 CI/CD
- ✅ 价格实惠

**部署步骤**：
1. 进入腾讯云静态网站托管
2. 创建新站点
3. 连接 Git 仓库
4. 配置构建命令
5. 部署

**成本**：
- 免费额度：5GB 流量/月
- 超出：~0.18元/GB

**访问速度**：⭐⭐⭐⭐⭐

---

### 方案 5：自建服务器（完全掌控⭐⭐⭐）

**适合**：
- 企业内部系统
- 需要完全控制
- 预算充足

**推荐服务器**：
- 阿里云 ECS
- 腾讯云 CVM
- 华为云 ECS

**配置建议**：
```
基础配置（小型项目）：
- CPU: 2核
- 内存: 2GB
- 带宽: 3Mbps
- 系统: Ubuntu 20.04
成本: ~60元/月
```

**部署栈**：
```
Nginx + Node.js + PM2
或
Docker + Nginx
```

---

## 🎯 我的推荐（按场景）

### 场景 1：个人项目 + 快速上线
**推荐**：腾讯云 Webify
```
✅ 免费
✅ 5 分钟部署
✅ 国内访问快
✅ 类似 Vercel 体验
```

### 场景 2：商业项目 + 中等流量
**推荐**：阿里云 OSS + CDN
```
✅ 稳定可靠
✅ 访问速度快
✅ 成本可控（~100元/月）
✅ 企业级支持
```

### 场景 3：企业内部系统
**推荐**：自建服务器
```
✅ 完全控制
✅ 数据安全
✅ 可定制
✅ 局域网访问
```

### 场景 4：国际+国内用户
**推荐**：Vercel + 国内 CDN
```
✅ 国际访问快（Vercel）
✅ 国内访问快（CDN）
✅ 双重优势
✅ 成本适中
```

---

## 📋 腾讯云 Webify 详细部署（推荐）

### 为什么选择 Webify？
- ✅ 国内版 Vercel
- ✅ 完全免费（免费额度）
- ✅ 一键部署
- ✅ 国内访问极快

### 详细步骤

#### 1. 注册腾讯云
访问：https://cloud.tencent.com/

#### 2. 开通云开发
- 进入云开发控制台
- 创建环境（选择按量付费或免费版）
- 记录环境 ID

#### 3. 通过控制台部署

##### 方式 A：网页部署（最简单）
1. 进入云开发控制台
2. 选择"静态网站托管"
3. 点击"上传文件"
4. 选择 `dist` 目录下的所有文件
5. 上传完成

##### 方式 B：Git 自动部署（推荐）
1. 安装 CLI
   ```bash
   npm install -g @cloudbase/cli
   ```

2. 登录
   ```bash
   cloudbase login
   ```

3. 初始化配置
   在项目根目录创建 `cloudbaserc.json`：
   ```json
   {
     "envId": "你的环境ID",
     "framework": {
       "name": "vite",
       "plugins": {
         "client": {
           "inputs": {
             "buildCommand": "npm run build",
             "outputPath": "dist"
           }
         }
       }
     }
   }
   ```

4. 部署
   ```bash
   cloudbase framework deploy
   ```

#### 4. 配置环境变量
在云开发控制台 → 环境 → 环境变量：
```
VITE_SUPABASE_URL=你的Supabase URL
VITE_SUPABASE_ANON_KEY=你的密钥
```

#### 5. 绑定自定义域名（可选）
- 在静态网站托管中添加域名
- 配置 DNS CNAME

---

## 🚀 阿里云 OSS + CDN 详细部署

### 步骤 1：创建 OSS 存储桶

1. 登录阿里云 OSS 控制台
2. 创建 Bucket
   - 名称：your-app-name
   - 区域：选择离你近的
   - 读写权限：公共读
   - 其他默认

### 步骤 2：配置静态网站

1. 进入 Bucket 设置
2. 基础设置 → 静态页面
   - 默认首页：index.html
   - 默认 404 页：index.html（SPA 必须）

### 步骤 3：上传构建文件

#### 方式 A：使用 ossutil（推荐）
```bash
# 1. 下载 ossutil
wget http://gosspublic.alicdn.com/ossutil/1.7.14/ossutil64
chmod 755 ossutil64

# 2. 配置
./ossutil64 config
# 输入 AccessKey ID
# 输入 AccessKey Secret  
# 输入 Endpoint（如：oss-cn-hangzhou.aliyuncs.com）

# 3. 构建项目
npm run build

# 4. 上传
./ossutil64 cp -r dist/ oss://your-bucket-name/ --update

# 5. 设置文件权限
./ossutil64 set-acl oss://your-bucket-name/ public-read -r -f
```

#### 方式 B：使用阿里云 CLI
```bash
# 安装
npm install @alicloud/oss-client -g

# 上传脚本 deploy.js
const OSS = require('ali-oss');

const client = new OSS({
  region: 'oss-cn-hangzhou',
  accessKeyId: 'your-key-id',
  accessKeySecret: 'your-key-secret',
  bucket: 'your-bucket-name'
});

// 上传 dist 目录
// ... 代码略
```

### 步骤 4：配置 CDN

1. 进入阿里云 CDN 控制台
2. 添加域名
   - 域名：www.your-domain.com
   - 业务类型：图片小文件
   - 源站类型：OSS 域名
   - 端口：80

3. 配置缓存规则
   ```
   /index.html - 不缓存
   /*.js - 缓存 7 天
   /*.css - 缓存 7 天
   /assets/* - 缓存 30 天
   ```

4. 配置 HTTPS（推荐）
   - 上传 SSL 证书
   - 或使用免费证书

### 步骤 5：配置域名 DNS

在域名注册商处添加 CNAME：
```
记录类型: CNAME
主机记录: www
记录值: your-cdn-domain.w.kunlunsl.com
```

---

## 💰 成本对比

| 方案 | 月成本 | 流量包 | 适合场景 |
|------|--------|--------|----------|
| **腾讯云 Webify** | ¥0 | 5GB | 个人项目 |
| **阿里云 OSS+CDN** | ¥50-200 | 按实际 | 商业项目 |
| **腾讯云静态托管** | ¥0-100 | 5GB+超出 | 中小项目 |
| **自建服务器** | ¥60-300 | 3-10Mbps | 企业系统 |
| **Vercel+国内CDN** | ¥50-150 | 看CDN | 国际+国内 |

---

## ⚡ 访问速度对比

| 方案 | 北京 | 上海 | 广州 | 深圳 |
|------|------|------|------|------|
| **Vercel** | 5-15s | 5-15s | 5-15s | 5-15s |
| **Netlify** | 5-10s | 5-10s | 5-10s | 5-10s |
| **Cloudflare** | 2-5s | 2-5s | 2-5s | 2-5s |
| **腾讯云 Webify** | <1s | <1s | <1s | <1s |
| **阿里云 OSS+CDN** | <1s | <1s | <1s | <1s |
| **自建(北京)** | <0.5s | 1-2s | 2-3s | 2-3s |

---

## 🎯 最终推荐（国内用户）

### 🥇 第一推荐：腾讯云 Webify
```
理由：
✅ 完全免费
✅ 5 分钟部署
✅ 国内访问极快（<1秒）
✅ 类似 Vercel 的体验
✅ 自动 CI/CD

适合：
- 个人项目
- 快速原型
- 小型商业项目
```

### 🥈 第二推荐：阿里云 OSS + CDN
```
理由：
✅ 企业级稳定性
✅ 访问速度极快
✅ 灵活可控
✅ 成本可预测

适合：
- 商业项目
- 中大型应用
- 需要 SLA 保障
```

### 🥉 第三推荐：Cloudflare Pages
```
理由：
✅ 完全免费
✅ 无限带宽
✅ 国内访问可接受（2-5秒）
✅ 全球部署

适合：
- 国际+国内用户
- 对速度要求不极致
- 预算有限
```

---

## 🔧 优化建议

### 1. 使用 CDN（必须）
无论哪个平台，都建议配置国内 CDN

### 2. 图片优化
```javascript
// 使用 WebP 格式
// 使用图片 CDN（如阿里云 OSS 图片处理）
// 懒加载
```

### 3. 代码分割
```javascript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'react-vendor': ['react', 'react-dom'],
          'ui-vendor': ['@radix-ui/react-*'],
          // ...
        }
      }
    }
  }
});
```

### 4. 压缩优化
```javascript
// vite.config.ts
export default defineConfig({
  build: {
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true, // 移除 console
      }
    }
  }
});
```

---

## 📞 需要帮助？

如果你需要我帮你：
1. 设置腾讯云 Webify
2. 配置阿里云 OSS + CDN
3. 优化访问速度
4. 解决部署问题

请告诉我！😊

---

**总结**：对于国内用户，强烈推荐使用腾讯云 Webify 或阿里云 OSS + CDN，访问速度比 Vercel 快 5-10 倍！🚀

