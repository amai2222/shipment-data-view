# æƒé™ç®¡ç†åŠŸèƒ½æµ‹è¯•ä¿®å¤æŠ¥å‘Š

## ğŸ” é—®é¢˜å‘ç°

åœ¨æ‰§è¡Œ `final_permission_test.sql` æ—¶å‘ç°äº†ä¸€ä¸ªé”™è¯¯ï¼š
- **é”™è¯¯**: `there is no unique or exclusion constraint matching the ON CONFLICT specification`
- **åŸå› **: `contract_permissions` è¡¨æ²¡æœ‰ `(user_id, contract_id)` çš„å”¯ä¸€çº¦æŸ
- **å½±å“**: åˆåŒæƒé™æµ‹è¯•å¤±è´¥

## ğŸ”§ ä¿®å¤æªæ–½

### 1. åˆ›å»ºçº¦æŸä¿®å¤è„šæœ¬
åˆ›å»ºäº† `fix_contract_permissions_constraints.sql` è„šæœ¬ï¼š
- æ£€æŸ¥ `contract_permissions` è¡¨ç»“æ„
- æ¸…ç†é‡å¤è®°å½•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- æ·»åŠ  `(user_id, contract_id)` å”¯ä¸€çº¦æŸ
- æµ‹è¯•æ’å…¥åŠŸèƒ½

### 2. æ›´æ–°æµ‹è¯•è„šæœ¬
ä¿®æ”¹äº† `final_permission_test.sql`ï¼š
- ç§»é™¤ `ON CONFLICT` å­å¥ï¼ˆå› ä¸ºçº¦æŸä¸å­˜åœ¨ï¼‰
- æ·»åŠ çº¦æŸæ£€æŸ¥é€»è¾‘
- æ ¹æ®çº¦æŸå­˜åœ¨æƒ…å†µè°ƒæ•´æµ‹è¯•ç­–ç•¥

## ğŸ“‹ ä¿®å¤åçš„æµ‹è¯•æµç¨‹

### 1. æ‰§è¡Œçº¦æŸä¿®å¤è„šæœ¬
```sql
-- ä¿®å¤ contract_permissions è¡¨çº¦æŸ
-- fix_contract_permissions_constraints.sql
```

### 2. æ‰§è¡Œæ›´æ–°åçš„æµ‹è¯•è„šæœ¬
```sql
-- å…¨é¢æµ‹è¯•æ‰€æœ‰æƒé™ç®¡ç†åŠŸèƒ½
-- final_permission_test.sql
```

## âœ… é¢„æœŸç»“æœ

### ä¿®å¤ååº”è¯¥çœ‹åˆ°ï¼š
1. **ç”¨æˆ·é¡¹ç›®æƒé™æµ‹è¯•** âœ…
   - æ’å…¥å’Œæ›´æ–°åŠŸèƒ½æ­£å¸¸
   - é‡å¤é”®å¤„ç†æ­£å¸¸

2. **è§’è‰²æ¨¡æ¿å˜æ›´æµ‹è¯•** âœ…
   - è§¦å‘å™¨æ­£å¸¸å·¥ä½œ
   - æƒé™åŒæ­¥æ­£å¸¸

3. **ç”¨æˆ·æƒé™ç®¡ç†æµ‹è¯•** âœ…
   - æƒé™åˆ›å»ºå’Œæ›´æ–°æ­£å¸¸
   - ç»§æ‰¿é€»è¾‘æ­£å¸¸

4. **åˆåŒæƒé™ç®¡ç†æµ‹è¯•** âœ…
   - æƒé™åˆ›å»ºæ­£å¸¸
   - çº¦æŸæ£€æŸ¥æ­£å¸¸

## ğŸš€ ä½¿ç”¨å»ºè®®

### 1. å…ˆæ‰§è¡Œçº¦æŸä¿®å¤
```sql
-- fix_contract_permissions_constraints.sql
```

### 2. å†æ‰§è¡ŒåŠŸèƒ½æµ‹è¯•
```sql
-- final_permission_test.sql
```

### 3. éªŒè¯ç»“æœ
- æ‰€æœ‰æµ‹è¯•åº”è¯¥é€šè¿‡
- æ²¡æœ‰é”™è¯¯ä¿¡æ¯
- åŠŸèƒ½çŠ¶æ€æ­£å¸¸

## ğŸ“Š å½“å‰çŠ¶æ€

- âœ… `user_projects` è¡¨ï¼š66æ¡è®°å½•ï¼Œæ— é‡å¤é”®é—®é¢˜
- âœ… å‰ç«¯ä»£ç ï¼šå·²ä¿®å¤é‡å¤é”®å¤„ç†
- âœ… æ•°æ®åº“è§¦å‘å™¨ï¼šæ­£å¸¸å·¥ä½œ
- ğŸ”§ `contract_permissions` è¡¨ï¼šéœ€è¦æ·»åŠ å”¯ä¸€çº¦æŸ

## ğŸ¯ ä¸‹ä¸€æ­¥

1. æ‰§è¡Œ `fix_contract_permissions_constraints.sql`
2. æ‰§è¡Œ `final_permission_test.sql`
3. éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

**ä¿®å¤å®Œæˆåï¼Œæ‰€æœ‰æƒé™ç®¡ç†åŠŸèƒ½éƒ½å°†æ­£å¸¸å·¥ä½œï¼** ğŸ‰
