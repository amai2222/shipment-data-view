# 文档整理脚本
# 用途：将根目录下的MD文档移动到对应的分类目录

Write-Host "========================================" -ForegroundColor Cyan
Write-Host "开始整理项目文档..." -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan
Write-Host ""

# 创建目录结构
$directories = @(
    "docs\approval-features",
    "docs\invoice-management",
    "docs\payment-management",
    "docs\mobile",
    "docs\components",
    "docs\permissions",
    "docs\project-management",
    "docs\performance",
    "docs\bug-fixes",
    "docs\daily-summary",
    "docs\database",
    "docs\driver-management",
    "docs\partner-management",
    "docs\waybill-management",
    "docs\shipper-dashboard",
    "docs\archive"
)

Write-Host "创建目录结构..." -ForegroundColor Yellow
foreach ($dir in $directories) {
    if (-not (Test-Path $dir)) {
        New-Item -ItemType Directory -Path $dir -Force | Out-Null
        Write-Host "  ✓ 创建: $dir" -ForegroundColor Green
    }
}
Write-Host ""

# 定义文件移动映射
$fileMappings = @{
    # 审批功能
    "approval-features" = @(
        "审批功能全面优化和企业微信兼容性修复总结.md",
        "审批功能全面优化总结.md",
        "批量取消审批功能优化完成.md",
        "移动端审批功能优化完成.md",
        "企业微信环境兼容性修复完成.md",
        "开票审核页面完整复制完成.md",
        "开票审核功能对比表.md",
        "开票审核页面-快速使用指南.md",
        "开票审核页面函数检查报告.md",
        "开票审核页面函数修复完成.md",
        "付款审核页面完全复制完成.md",
        "付款审核页面完全同步完成.md",
        "付款审核页面功能调整完成.md",
        "付款审核页面全按钮确认对话框完成.md",
        "付款审核页面确认对话框提示优化完成.md",
        "付款审核页面项目筛选功能完成.md",
        "付款审核页面布局优化完成.md",
        "付款审核页面最终布局调整完成.md",
        "付款审核筛选器手动搜索模式完成.md",
        "付款审核筛选器按钮布局优化完成.md",
        "付款审核界面简化完成.md",
        "付款审核分页组件样式统一完成.md",
        "付款审核筛选按钮移至页面标题完成.md",
        "付款审核页面布局同步完成.md",
        "审核管理菜单添加完成报告.md",
        "审核管理菜单显示问题解决方案.md",
        "审核管理菜单显示修复完成.md",
        "审核管理页面错误修复完成.md",
        "审核管理菜单顺序调整完成.md",
        "移动端审核管理菜单同步更新完成.md",
        "审批人员验证配置指南.md",
        "付款申请多级审批流程设计方案.md",
        "付款申请审批流程实施指南.md"
    )
    
    # 开票管理
    "invoice-management" = @(
        "开票申请作废运单状态回滚修复说明.md",
        "开票申请单查看功能实现说明.md",
        "开票申请表区域划分说明.md",
        "开票申请表动态备注总结功能说明.md",
        "一键开票申请自动切分功能说明.md",
        "一键开票申请自动切分功能完成说明.md",
        "开票申请和审核页面运单详情查询修复说明.md",
        "开票申请单管理筛选器升级完成.md",
        "开票申请筛选器优化完成说明.md",
        "开票申请筛选器导入路径说明.md",
        "开票申请筛选器Calendar图标错误修复说明.md",
        "开票申请日期选择器叠加问题修复说明.md",
        "开票申请装货日期筛选器修改说明.md",
        "开票申请装货日期筛选器移除完成说明.md",
        "开票申请选择逻辑优化完成说明.md",
        "开票申请状态检查功能实现总结.md",
        "开票申请高级筛选修复说明.md",
        "开票申请高级筛选后端优化完成说明.md",
        "开票申请页面问题修复总结.md",
        "开票申请函数重载冲突修复说明.md",
        "开票申请功能备份清单.md",
        "开票申请功能说明.md",
        "最终总结_开票申请单管理升级.md",
        "财务开票页面复选框和操作优化完成说明.md",
        "财务开票页面操作按钮优化完成说明.md",
        "财务开票页面错误修复总结.md",
        "财务开票分页功能完成说明.md",
        "本次完成工作总结_财务开票优化_20251027.md"
    )
    
    # 付款管理
    "payment-management" = @(
        "付款申请页面筛选器升级完成.md",
        "付款申请页面筛选器升级方案.md",
        "付款申请筛选器批量搜索功能说明.md",
        "付款申请页面动态显示合作方层级完成.md",
        "付款申请编辑完整状态保护说明.md",
        "付款申请编辑状态保护说明.md",
        "付款申请通知触发器修复说明.md",
        "付款申请合作链路功能说明.md",
        "付款开票申请统一逻辑修复总结.md",
        "付款开票申请逻辑对比分析.md",
        "付款按钮修复说明.md",
        "付款按钮逻辑修复说明.md",
        "付款申请单管理标题修改完成.md",
        "付款申请单管理筛选器和分页同步完成.md",
        "申请单列表增加申请金额列完成.md",
        "申请金额列功能验证报告.md",
        "申请单批量操作功能完成报告.md",
        "申请单分页功能代码审核报告.md",
        "批量搜索功能完成报告.md",
        "批量选择功能优化总结.md",
        "一键作废按钮位置调整说明.md",
        "按钮样式修改说明.md",
        "现代按钮设计说明.md",
        "财务付款页面筛选器始终显示完成.md",
        "财务付款页面布局调整完成.md",
        "财务付款页面上下间隔调整完成.md",
        "财务付款页面审批按钮隐藏完成.md",
        "财务付款页面按钮修改完成.md"
    )
    
    # 移动端
    "mobile" = @(
        "移动端优化完成总结.md",
        "移动端优化指南.md",
        "移动端优化清单.md",
        "移动端功能补充完成总结.md",
        "移动端功能补充-立即查看.md",
        "移动端快速入门.md",
        "移动端通知系统修复说明.md",
        "移动端项目看板修复说明.md",
        "移动端项目看板状态筛选功能更新总结.md",
        "平板端使用移动端界面说明.md"
    )
    
    # 组件重构
    "components" = @(
        "组件库完整说明文档.md",
        "组件重构完成总结.md",
        "组件重构使用指南.md",
        "组件重构计划.md",
        "页面组件化重构完成.md",
        "PaymentRequest组件化重构方案.md",
        "确认对话框添加完成说明.md",
        "批量输入功能说明.md",
        "批量输入对话框修复说明.md"
    )
    
    # 权限管理
    "permissions" = @(
        "审核权限批量更新指南.md",
        "审核管理权限问题修复指南.md",
        "审核管理权限配置指南.md",
        "用户管理安全升级完整指南.md",
        "用户管理安全修复-文件清单.md",
        "用户管理安全修复-快速开始.md",
        "用户管理功能完整修复清单.md",
        "用户创建功能修复说明.md",
        "用户创建功能-快速修复指南.md",
        "用户创建ID冲突问题修复说明.md",
        "用户编辑角色选项不全问题修复说明.md",
        "为什么之前可以创建用户-问题分析.md",
        "操作员财务管理权限完善报告.md"
    )
    
    # 项目管理
    "project-management" = @(
        "项目管理合作方选择优化完成说明.md",
        "项目管理合作方选择优化-快速指南.md",
        "项目管理合作链路effective_quantity_type错误修复说明.md",
        "项目管理合作链路修改同步分析报告.md",
        "项目管理合作链路配置成本重算分析报告.md",
        "项目管理状态更新修复-新函数方案.md",
        "项目管理状态更新问题修复报告.md",
        "项目管理筛选和排序功能说明.md",
        "项目编辑触发不必要重算问题-临时修复.md",
        "项目保存逻辑问题分析.md",
        "项目链路增量更新功能完成.md",
        "项目链路增量更新-部署指南.md",
        "项目合作链路增量更新实现方案.md",
        "项目合作方自动重算功能说明.md",
        "项目合作方自动重算_快速开始.md",
        "项目合作方自动重算_实施总结.md",
        "项目合作方修改后如何更新运费对账数据.md",
        "项目看板RPC函数优化报告.md",
        "项目看板SQL错误修复.md",
        "项目看板性能修复报告.md",
        "项目看板状态筛选功能实施总结.md",
        "项目看板问题完整修复报告.md",
        "修复项目编辑错误-快速指南.md"
    )
    
    # 性能优化
    "performance" = @(
        "性能优化完整执行指南.md",
        "性能问题快速诊断指南.md",
        "所有性能问题修复汇总.md",
        "数据库优化完成清单.md",
        "数据库优化快速指南.md",
        "数据库查询优化指南.md",
        "桌面端项目管理性能修复报告.md"
    )
    
    # Bug修复
    "bug-fixes" = @(
        "浏览器安全和兼容性修复完成.md",
        "Linter错误修复完成.md",
        "TypeScript错误修复指南.md",
        "TypeScript和JSX语法错误修复完成.md",
        "RPC函数类型定义修复完成.md",
        "RPC函数完整修改说明.md",
        "RPC函数修改对比说明.md",
        "Search组件命名冲突修复说明.md",
        "图标导入错误修复说明.md",
        "依赖版本问题修复说明.md",
        "修复货主看板linter错误.md",
        "RLS策略字段修复说明.md",
        "视图RLS策略修复说明.md",
        "array_trim函数错误修复说明.md",
        "函数名冲突修复说明.md",
        "列名错误修复说明.md",
        "SQL字段错误完整修复清单.md",
        "SQL聚合函数嵌套错误完整修复.md",
        "SQL语法错误修复说明.md",
        "SQL语法错误最终修复说明.md",
        "最终SQL修复汇总.md",
        "安全视图修复最终方案.md",
        "日期选择器布局问题修复总结.md",
        "日期选择器问题修复总结.md",
        "紧急修复_页面打不开.md"
    )
    
    # 司机管理
    "driver-management" = @(
        "司机列表加载失败修复指南.md",
        "司机和地点筛选器功能说明.md",
        "司机搜索和自定义输入功能说明.md",
        "司机照片上传功能使用指南.md",
        "司机照片上传功能实施总结.md",
        "司机管理页面分页功能升级完成.md",
        "司机自动关联项目功能使用说明.md",
        "司机项目关联_使用说明.md",
        "司机项目关联修复-回滚指南.md",
        "Excel导入司机项目关联修复说明.md"
    )
    
    # 合作方管理
    "partner-management" = @(
        "合作方full_name字段使用分析报告.md",
        "合作方付款申请功能增强完成说明.md",
        "合作方付款申请增量更新实现说明.md",
        "合作方名称修改同步问题分析.md",
        "合作方名称双向同步使用指南.md",
        "合作方层级管理-使用说明.md",
        "合作方添加后不即时显示问题修复说明.md",
        "合作方管理界面优化说明.md",
        "合作方类型字段添加说明.md",
        "合作方类型更新_增加资方和本公司.md",
        "合作方类型说明_完整版.md",
        "合作方类型输入功能添加说明.md",
        "合作链路is_default修复完成.md",
        "合作链路is_default被重置问题修复说明.md",
        "合作链路功能完整审核报告.md",
        "合作链路成本重算验证说明.md",
        "修改合作链路交互优化完成说明.md",
        "修改合作链路查询projectId错误修复.md",
        "修改合作链路project_id问题修复说明.md",
        "货主层级管理界面优化完成.md",
        "货主层级管理_三个问题修复说明.md",
        "货主层级管理功能优化说明.md",
        "货主层级管理功能更新说明.md"
    )
    
    # 运单管理
    "waybill-management" = @(
        "运单管理批量搜索功能升级完成.md",
        "运单编号搜索修复说明.md",
        "运单编号格式统一说明.md",
        "运单编号统一格式执行指南.md",
        "运单chain_id修复说明.md",
        "运单修改是否自动重算合作方成本_问题分析.md",
        "运单维护增强功能README.md",
        "运单维护增强功能使用指南.md",
        "运单维护增强功能完成总结.md",
        "运单维护增强功能文件清单.md",
        "运单维护增强功能测试清单.md",
        "运单维护功能对比表.md",
        "运单维护功能借鉴完成报告.md",
        "运单维护双版本说明.md",
        "运输单据PDF生成功能使用说明.md",
        "运输单据PDF生成功能更新总结.md",
        "运输单据轨迹地图配置指南.md",
        "批量PDF生成功能实现总结.md",
        "装货重量显示为0的问题分析.md"
    )
    
    # 货主看板
    "shipper-dashboard" = @(
        "货主看板使用指南.md",
        "货主看板开发完成报告.md",
        "货主看板权限优化说明.md",
        "货主看板权限已更新说明.md",
        "货主看板权限问题修复说明.md",
        "货主看板权限问题排查指南.md",
        "货主看板权限集成完成报告.md",
        "货主看板设计方案.md",
        "货主看板部署说明.md"
    )
    
    # 数据库
    "database" = @(
        "成本重算函数分析报告.md",
        "成本重算函数代码重复问题分析.md",
        "成本重算跳过手动修改方案.md",
        "成本重算跳过逻辑完整分析.md",
        "手动修改保护功能_实施完成.md",
        "手动成本保护逻辑说明.md",
        "自动重算功能修复说明_处理NULL链路.md",
        "chain_id填充使用指南.md",
        "完整修复方案_chain_id和自动重算.md",
        "数据库迁移执行顺序说明.md",
        "数据库结构查询错误修复说明.md",
        "Supabase安全问题修复指南.md",
        "安全配置-立即启用.md",
        "解决Token泄露和CSP警告问题.md",
        "隐藏敏感信息配置完成说明.md"
    )
    
    # 工作总结
    "daily-summary" = @(
        "今日完成工作-立即部署清单.md",
        "今日完成工作总结_20250122.md",
        "今日完成工作总结_20251025.md",
        "本次完成工作总结_20251027.md",
        "本次修改总结_20251025.md",
        "升级完成总结_适配11参数函数.md",
        "最终执行清单_3个SQL文件.md",
        "代码审核报告.md",
        "代码审核报告_20250116.md",
        "代码审核报告_20251025.md",
        "代码审核报告_布局调整.md",
        "代码审核自动化流程.md",
        "代码审核通过-可立即部署.md",
        "自动化审核报告_20250116.md"
    )
}

# 移动文件
$movedCount = 0
$skippedCount = 0

foreach ($category in $fileMappings.Keys) {
    $targetDir = "docs\$category"
    $files = $fileMappings[$category]
    
    Write-Host "处理 $category 分类..." -ForegroundColor Yellow
    
    foreach ($file in $files) {
        if (Test-Path $file) {
            try {
                Move-Item $file $targetDir -Force
                Write-Host "  ✓ 移动: $file" -ForegroundColor Green
                $movedCount++
            } catch {
                Write-Host "  ✗ 失败: $file - $($_.Exception.Message)" -ForegroundColor Red
                $skippedCount++
            }
        } else {
            # 文件不存在，可能已经移动过了
            $skippedCount++
        }
    }
}

Write-Host ""
Write-Host "========================================" -ForegroundColor Cyan
Write-Host "文档整理完成！" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan
Write-Host "  已移动: $movedCount 个文件" -ForegroundColor Green
Write-Host "  已跳过: $skippedCount 个文件" -ForegroundColor Yellow
Write-Host ""
Write-Host "建议：" -ForegroundColor Cyan
Write-Host "1. 查看 docs\文档整理索引.md 了解目录结构" -ForegroundColor White
Write-Host "2. 根目录保留的SQL文件建议移至 scripts\sql\" -ForegroundColor White
Write-Host "3. 定期更新文档索引" -ForegroundColor White

