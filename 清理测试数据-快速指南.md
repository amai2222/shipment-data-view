# 清理测试数据 - 快速指南 ⚡

## 🎯 一键清理

### 在 Supabase 控制台执行（推荐）

1. **打开 Supabase Dashboard**
   - 访问：https://supabase.com/dashboard
   - 选择你的项目

2. **打开 SQL Editor**
   - 点击左侧 "SQL Editor"
   - 点击 "New query"

3. **执行清理**
   - 打开文件：`执行清理测试数据.sql`
   - 复制全部内容
   - 粘贴到编辑器
   - 点击 **Run** 按钮

4. **完成！**
   - 查看执行日志
   - 刷新付款申请单页面
   - 验证测试数据已清除

## 📋 清理内容

脚本会自动清理：

- ✅ 测试合作方：`测试名称_测试_xxxxx`
- ✅ 测试合作方的成本记录（5条运单）
- ✅ 测试合作方的银行详情
- ✅ 验证清理结果

## ⚠️ 重要提示

- ✅ **脚本已修复**：解决了 `lr.partner_id` 不存在的错误
- ✅ **脚本已修复**：解决了 `user_id` NOT NULL 约束错误
- ✅ **会话级触发器禁用**：使用 `session_replication_role = replica` 彻底禁用所有触发器
- ✅ **安全执行**：只删除测试数据，不影响真实数据，触发器自动恢复
- ✅ **自动验证**：执行后自动验证清理结果

## 📊 预期结果

执行成功后，你会看到：

```
============================
发现测试数据统计：
- 测试合作方数量：1
- 测试合作方成本记录数量：5
- 测试银行详情数量：1
============================

开始清理测试数据...
✓ 已禁用所有触发器
✓ 已删除 X 条测试合作方的项目配置
✓ 已删除 5 条测试合作方成本记录
✓ 已删除 1 条测试银行详情
✓ 已删除 1 条测试合作方
✓ 已重新启用所有触发器

============================
测试数据清理完成！
============================
```

## 🔍 验证清理

清理后，脚本会自动验证：

| 表名 | 剩余测试记录 |
|------|-------------|
| partners | 0 |
| partner_bank_details | 0 |
| logistics_partner_costs | 0 |

全部为 0 表示清理成功！✅

## 💡 提示

- 付款申请单页面不会再显示测试合作方
- 申请单金额会自动更新
- 运单本身不会被删除（只删除测试合作方的成本记录）

---

**准备好了吗？** 立即前往 Supabase Dashboard 执行清理！🚀

