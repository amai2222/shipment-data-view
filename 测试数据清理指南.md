# 测试数据清理指南

## 🎯 问题说明

系统中发现测试数据：**测试名称_测试_17613555386.624714**

这些测试数据来源于**合作方名称双向同步测试脚本**，需要立即清理。

## 📋 清理方法

### 方法1：在Supabase控制台执行（推荐）⭐

这是**最简单、最安全**的方法：

1. **登录 Supabase Dashboard**
   - 访问：https://supabase.com/dashboard
   - 选择你的项目

2. **打开 SQL Editor**
   - 点击左侧菜单的 "SQL Editor"
   - 点击 "New query"

3. **复制并执行清理脚本**
   - 打开文件：`执行清理测试数据.sql`
   - 复制全部内容
   - 粘贴到 SQL Editor
   - 点击 "Run" 执行

4. **查看执行结果**
   - 检查输出日志
   - 确认测试数据已清理
   - 验证剩余记录数为 0

### 方法2：使用PowerShell脚本

如果你已配置好Supabase环境变量：

```powershell
# 执行清理脚本
.\清理测试数据.ps1
```

**前提条件**：
- 已安装 PostgreSQL 客户端 (psql)
- 已设置环境变量：
  - `SUPABASE_PROJECT_ID`
  - `SUPABASE_DB_PASSWORD`

## 🔍 清理内容

脚本将清理以下测试数据：

- ✅ **测试合作方**：包含"测试"或"测试名称"字样的合作方
- ✅ **测试运单**：关联到测试合作方的运单记录
- ✅ **测试银行详情**：测试合作方的银行信息
- ✅ **空申请单检查**：检查是否有空的付款申请单

## ⚠️ 注意事项

### 执行前
- ✅ 确认要清理的数据确实是测试数据
- ✅ 了解清理后申请单金额会发生变化
- ✅ 在生产环境执行前，建议先在开发环境测试

### 执行后
- ✅ 刷新付款申请单页面
- ✅ 验证测试数据已完全清除
- ✅ 检查申请单金额是否正确
- ✅ 确认业务数据未受影响

## 📊 验证清理结果

清理完成后，脚本会自动验证：

1. **测试数据统计**
   - partners 表剩余测试记录：0
   - partner_bank_details 表剩余测试记录：0
   - logistics_records 表剩余测试记录：0

2. **受影响的申请单**
   - 显示空的付款申请单（如果有）
   - 这些申请单可能需要手动处理

## 🚀 快速执行

**推荐步骤**：

1. 打开 Supabase Dashboard
2. 进入 SQL Editor
3. 复制 `执行清理测试数据.sql` 的内容
4. 粘贴并执行
5. 查看执行日志确认清理成功

## 📝 执行日志示例

成功执行后，你会看到类似输出：

```
============================
发现测试数据统计：
- 测试合作方数量：1
- 测试运单数量：5
- 测试银行详情数量：1
============================

开始清理测试数据...
✓ 已删除 5 条测试运单记录
✓ 已删除 1 条测试银行详情
✓ 已删除 1 条测试合作方

============================
测试数据清理完成！
============================

验证清理结果：
- partners: 0
- partner_bank_details: 0
- logistics_records: 0

✓ 测试数据清理完成！
```

## 🔧 问题排查

### 如果清理失败

1. **检查权限**
   - 确保你有数据库删除权限
   - 确认是数据库管理员或项目所有者

2. **检查外键约束**
   - 如果有外键约束错误
   - 脚本会按正确顺序删除（运单 → 银行详情 → 合作方）

3. **手动清理**
   - 如果自动清理失败
   - 可以在SQL Editor中逐步执行删除语句

## 📞 需要帮助？

如果遇到问题：
1. 检查执行日志中的错误信息
2. 确认数据库连接正常
3. 验证权限配置正确

---

**创建时间**：2025-10-25  
**目的**：清理系统中的测试数据，保持数据库整洁

