# ä»˜æ¬¾å¼€ç¥¨ç”³è¯·ç»Ÿä¸€é€»è¾‘ä¿®å¤æ€»ç»“

## ğŸ¯ ä¿®å¤ç›®æ ‡

å°†ä»˜æ¬¾ç”³è¯·å’Œå¼€ç¥¨ç”³è¯·ç»Ÿä¸€ä¸ºç›¸åŒçš„è°ƒç”¨æ–¹å¼å’Œå¤„ç†é€»è¾‘ã€‚

---

## âœ… å®Œæˆçš„ä¿®æ”¹

### 1. å‰ç«¯ä¿®æ”¹

**æ–‡ä»¶ï¼š** `src/pages/InvoiceRequest.tsx`

**ä¿®æ”¹å‰ï¼š**
```typescript
const { data, error } = await supabase.rpc('save_invoice_request', {
  p_invoice_data: finalInvoiceData  // âŒ ä¼ å®Œæ•´æ•°æ®å¯¹è±¡
});
```

**ä¿®æ”¹åï¼š**
```typescript
const { data, error } = await supabase.rpc('save_invoice_request', {
  p_record_ids: finalInvoiceData.all_record_ids  // âœ… åªä¼ è¿å•IDæ•°ç»„
});
```

---

### 2. åç«¯ä¿®æ”¹

**æ–‡ä»¶ï¼š** `supabase/migrations/20250816_fix_invoice_request_function_overload.sql`

#### 2.1 è¡¥å……è¡¨å­—æ®µ
```sql
ALTER TABLE invoice_requests ADD COLUMN IF NOT EXISTS partner_id uuid;
ALTER TABLE invoice_requests ADD COLUMN IF NOT EXISTS partner_name text;
ALTER TABLE invoice_requests ADD COLUMN IF NOT EXISTS partner_full_name text;
-- ... å…¶ä»–å¿…è¦å­—æ®µ
```

#### 2.2 åˆ é™¤å‡½æ•°é‡è½½
```sql
DROP FUNCTION IF EXISTS public.save_invoice_request(json);
DROP FUNCTION IF EXISTS public.save_invoice_request(jsonb);
-- åˆ é™¤æ‰€æœ‰ç‰ˆæœ¬
```

#### 2.3 åˆ›å»ºå•å·ç”Ÿæˆå‡½æ•°
```sql
CREATE FUNCTION generate_invoice_request_number()
RETURNS text
-- æ ¼å¼ï¼šKP20250816-0001
```

#### 2.4 åˆ›å»ºç»Ÿä¸€çš„å¼€ç¥¨ç”³è¯·å‡½æ•°
```sql
CREATE FUNCTION public.save_invoice_request(p_record_ids uuid[])
RETURNS jsonb
-- é€»è¾‘ï¼š
-- 1. æ‰¾å‡ºæœ€é«˜çº§åˆ«
-- 2. åªå¤„ç† level === maxLevel çš„åˆä½œæ–¹
-- 3. æŒ‰åˆä½œæ–¹åˆ†ç»„
-- 4. åˆ›å»ºç”³è¯·å’Œæ˜ç»†
-- 5. æ›´æ–°çŠ¶æ€
```

---

## ğŸ“Š ç»Ÿä¸€åçš„é€»è¾‘å¯¹æ¯”

| é¡¹ç›® | ä»˜æ¬¾ç”³è¯· | å¼€ç¥¨ç”³è¯· | æ˜¯å¦ç»Ÿä¸€ï¼Ÿ |
|------|---------|---------|----------|
| **å‰ç«¯ä¼ å‚** | `p_record_ids: uuid[]` | `p_record_ids: uuid[]` | âœ… ç»Ÿä¸€ |
| **åç«¯ç­¾å** | `(p_record_ids uuid[])` | `(p_record_ids uuid[])` | âœ… ç»Ÿä¸€ |
| **æ‰¾æœ€é«˜çº§** | `SELECT MAX(level)` | `SELECT MAX(level)` | âœ… ç»Ÿä¸€ |
| **ç­›é€‰æ¡ä»¶** | `level < maxLevel` | `level === maxLevel` | â­ ç›¸å |
| **åˆ†ç»„æ–¹å¼** | æŒ‰åˆä½œæ–¹ID | æŒ‰åˆä½œæ–¹ID | âœ… ç»Ÿä¸€ |
| **åˆ›å»ºç”³è¯·** | `payment_requests` | `invoice_requests` | âœ… ç»Ÿä¸€ |
| **åˆ›å»ºæ˜ç»†** | `partner_payment_items` | `invoice_request_details` | âœ… ç»Ÿä¸€ |
| **æ›´æ–°çŠ¶æ€** | `payment_status` | `invoice_status` | âœ… ç»Ÿä¸€ |

---

## ğŸ”„ å®Œæ•´æ•°æ®æµ

### ä»˜æ¬¾ç”³è¯·æµç¨‹

```
ç”¨æˆ·é€‰æ‹©è¿å• 
    â†“
å‰ç«¯ï¼šprocess_payment_application({ p_record_ids: [...] })
    â†“
åç«¯ï¼š
  â”œâ”€ æ‰¾å‡º maxLevel (å¦‚ï¼š3çº§)
  â”œâ”€ ç­›é€‰ level < 3 çš„åˆä½œæ–¹ï¼ˆ1çº§ã€2çº§ï¼‰â† ä»˜ç»™ä¸­é—´å•†
  â”œâ”€ æŒ‰åˆä½œæ–¹IDåˆ†ç»„
  â”œâ”€ ä¸ºæ¯ä¸ªåˆä½œæ–¹ï¼š
  â”‚   â”œâ”€ åˆ›å»º payment_requests è®°å½•
  â”‚   â”œâ”€ åˆ›å»º partner_payment_items æ˜ç»†
  â”‚   â””â”€ æ›´æ–°çŠ¶æ€
  â””â”€ è¿”å›ç»“æœ
```

### å¼€ç¥¨ç”³è¯·æµç¨‹ï¼ˆä¿®æ”¹åï¼‰

```
ç”¨æˆ·é€‰æ‹©è¿å•
    â†“
å‰ç«¯ï¼šsave_invoice_request({ p_record_ids: [...] })  âœ… ç»Ÿä¸€
    â†“
åç«¯ï¼š
  â”œâ”€ æ‰¾å‡º maxLevel (å¦‚ï¼š3çº§)
  â”œâ”€ ç­›é€‰ level === 3 çš„åˆä½œæ–¹ï¼ˆåªæœ‰3çº§ï¼‰â† ç»™å®¢æˆ·å¼€ç¥¨
  â”œâ”€ æŒ‰åˆä½œæ–¹IDåˆ†ç»„
  â”œâ”€ ä¸ºæ¯ä¸ªåˆä½œæ–¹ï¼š
  â”‚   â”œâ”€ åˆ›å»º invoice_requests è®°å½•
  â”‚   â”œâ”€ åˆ›å»º invoice_request_details æ˜ç»†
  â”‚   â””â”€ æ›´æ–° logistics_partner_costs.invoice_status
  â””â”€ è¿”å›ç»“æœ
```

---

## ğŸ“‹ ä¸šåŠ¡ç¤ºä¾‹

### å‡è®¾åœºæ™¯

ä¸€ä¸ªè¿å•æœ‰3çº§åˆä½œæ–¹ï¼š
```
é¡¹ç›®ï¼š"å®‰è¿è¾“é¡¹ç›®"
â”œâ”€ ä¸€çº§åˆä½œæ–¹ï¼šå¤§å®‰â†’é•‡é»„ (level=1, åº”ä»˜Â¥1,000)
â”œâ”€ äºŒçº§åˆä½œæ–¹ï¼šè¾›å»ºæ¶› (level=2, åº”ä»˜Â¥1,500)
â””â”€ ä¸‰çº§åˆä½œæ–¹ï¼šå¯ä¹å…¬å¸ (level=3, åº”ä»˜Â¥2,000) â† æœ€é«˜çº§
```

### ä»˜æ¬¾ç”³è¯·

**é€‰æ‹©è¿™ä¸ªè¿å•åç‚¹å‡»"ä¸€é”®ç”³è¯·ä»˜æ¬¾"ï¼š**
```
åˆ›å»º2ä¸ªä»˜æ¬¾ç”³è¯·ï¼š

ä»˜æ¬¾ç”³è¯·1ï¼š
  æ”¶æ¬¾æ–¹ï¼šå¤§å®‰â†’é•‡é»„
  é‡‘é¢ï¼šÂ¥1,000
  
ä»˜æ¬¾ç”³è¯·2ï¼š
  æ”¶æ¬¾æ–¹ï¼šè¾›å»ºæ¶›
  é‡‘é¢ï¼šÂ¥1,500

ä¸åˆ›å»ºï¼šå¯ä¹å…¬å¸ï¼ˆæœ€é«˜çº§ï¼Œä¸ä»˜æ¬¾ç»™ä»–ä»¬ï¼‰
```

### å¼€ç¥¨ç”³è¯·

**é€‰æ‹©è¿™ä¸ªè¿å•åç‚¹å‡»"ä¸€é”®å¼€ç¥¨ç”³è¯·"ï¼š**
```
åˆ›å»º1ä¸ªå¼€ç¥¨ç”³è¯·ï¼š

å¼€ç¥¨ç”³è¯·1ï¼š
  å¼€ç¥¨ç»™ï¼šå¯ä¹å…¬å¸ï¼ˆæœ€é«˜çº§ï¼‰
  é‡‘é¢ï¼šÂ¥2,000
  
ä¸åˆ›å»ºï¼šå¤§å®‰â†’é•‡é»„ã€è¾›å»ºæ¶›ï¼ˆéæœ€é«˜çº§ï¼Œä¸ç»™ä»–ä»¬å¼€ç¥¨ï¼‰
```

---

## ğŸ¯ å…³é”®å·®å¼‚ç‚¹

### å”¯ä¸€çš„åŒºåˆ«ï¼šçº§åˆ«ç­›é€‰æ¡ä»¶

| åŠŸèƒ½ | ç­›é€‰æ¡ä»¶ | SQL | ä¸šåŠ¡å«ä¹‰ |
|------|---------|-----|---------|
| **ä»˜æ¬¾** | `level < maxLevel` | `WHERE lpc.level < v_max_level` | ä»˜ç»™ä¸­é—´å•†ï¼ˆéæœ€é«˜çº§ï¼‰ |
| **å¼€ç¥¨** | `level === maxLevel` | `WHERE lpc.level = v_max_level` | å¼€ç¥¨ç»™å®¢æˆ·ï¼ˆæœ€é«˜çº§ï¼‰ |

---

## âœ… ä¿®å¤åçš„ä¼˜åŠ¿

### ä»£ç ç»Ÿä¸€æ€§

1. **å‰ç«¯è°ƒç”¨ç»Ÿä¸€**
   ```typescript
   // ä»˜æ¬¾
   supabase.rpc('process_payment_application', { p_record_ids })
   
   // å¼€ç¥¨
   supabase.rpc('save_invoice_request', { p_record_ids })
   ```

2. **åç«¯ç­¾åç»Ÿä¸€**
   ```sql
   -- ä»˜æ¬¾
   CREATE FUNCTION process_payment_application(p_record_ids uuid[])
   
   -- å¼€ç¥¨
   CREATE FUNCTION save_invoice_request(p_record_ids uuid[])
   ```

3. **å¤„ç†é€»è¾‘ç»Ÿä¸€**
   - éƒ½æ˜¯æ‰¾æœ€é«˜çº§åˆ«
   - éƒ½æ˜¯æŒ‰åˆä½œæ–¹åˆ†ç»„
   - éƒ½æ˜¯åˆ›å»ºç”³è¯·+æ˜ç»†
   - éƒ½æ˜¯æ›´æ–°çŠ¶æ€

### ç»´æŠ¤æ€§æå‡

- âœ… æ˜“äºç†è§£ï¼ˆé€»è¾‘å¯¹ç§°ï¼‰
- âœ… æ˜“äºç»´æŠ¤ï¼ˆä»£ç ç›¸ä¼¼ï¼‰
- âœ… æ˜“äºæ‰©å±•ï¼ˆç»Ÿä¸€æ¨¡å¼ï¼‰
- âœ… å‡å°‘bugï¼ˆä¸€å¤„ä¿®æ”¹ä¸¤å¤„åŒæ­¥ï¼‰

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### å‰ç«¯
1. âœ… `src/pages/InvoiceRequest.tsx`
   - æ”¹ä¸ºåªä¼ è¿å•IDæ•°ç»„

### åç«¯
1. âœ… `supabase/migrations/20250816_fix_invoice_request_function_overload.sql`
   - è¡¥å……è¡¨å­—æ®µ
   - åˆ é™¤å‡½æ•°é‡è½½
   - åˆ›å»ºå•å·ç”Ÿæˆå‡½æ•°
   - åˆ›å»ºç»Ÿä¸€çš„å¼€ç¥¨ç”³è¯·å‡½æ•°

---

## ğŸš€ åº”ç”¨æ­¥éª¤

### 1. åº”ç”¨æ•°æ®åº“è¿ç§»

åœ¨Supabase SQL Editorä¸­æ‰§è¡Œï¼š
```sql
supabase/migrations/20250816_fix_invoice_request_function_overload.sql
```

### 2. éªŒè¯å‡½æ•°

```sql
-- æ£€æŸ¥å‡½æ•°ç­¾å
SELECT 
  proname AS å‡½æ•°å,
  pg_get_function_arguments(oid) AS å‚æ•°,
  pg_get_function_result(oid) AS è¿”å›å€¼
FROM pg_proc 
WHERE proname = 'save_invoice_request';

-- åº”è¯¥åªè¿”å›ä¸€è¡Œï¼š
-- save_invoice_request | p_record_ids uuid[] | jsonb
```

### 3. æµ‹è¯•åŠŸèƒ½

**å¼€ç¥¨ç”³è¯·æµ‹è¯•ï¼š**
1. é€‰æ‹©å‡ æ¡è¿å•
2. ç‚¹å‡»"ä¸€é”®å¼€ç¥¨ç”³è¯·"
3. æŸ¥çœ‹é¢„è§ˆï¼ˆå‰ç«¯åˆ†ç»„æ˜¾ç¤ºï¼‰
4. ç‚¹å‡»"ä¿å­˜å¼€ç¥¨ç”³è¯·"
5. åº”è¯¥æˆåŠŸï¼Œä¸å†æŠ¥é”™

**éªŒè¯ç»“æœï¼š**
- åªç»™æœ€é«˜çº§åˆä½œæ–¹åˆ›å»ºäº†å¼€ç¥¨ç”³è¯·
- invoice_status æ›´æ–°ä¸º 'Processing'
- åˆ›å»ºäº† invoice_request_details æ˜ç»†

---

## ğŸ“Š å®Œæ•´çš„è¡¨å…³ç³»

### å¼€ç¥¨ç”³è¯·ç›¸å…³è¡¨

```
invoice_requests (å¼€ç¥¨ç”³è¯·ä¸»è¡¨)
    â”œâ”€ request_number (å•å·: KP20250816-0001)
    â”œâ”€ partner_id (åˆä½œæ–¹ID)
    â”œâ”€ partner_full_name (åˆä½œæ–¹å…¨å)
    â”œâ”€ total_amount (æ€»é‡‘é¢)
    â”œâ”€ record_count (è¿å•æ•°é‡)
    â”œâ”€ status (çŠ¶æ€)
    â””â”€ created_by (åˆ›å»ºäºº)
    
    â†“ (1å¯¹å¤š)
    
invoice_request_details (å¼€ç¥¨ç”³è¯·æ˜ç»†)
    â”œâ”€ invoice_request_id (å…³è”ç”³è¯·)
    â”œâ”€ logistics_record_id (å…³è”è¿å•)
    â””â”€ amount (é‡‘é¢)
    
    â†“ (å…³è”)
    
logistics_partner_costs (åˆä½œæ–¹æˆæœ¬)
    â”œâ”€ logistics_record_id (è¿å•ID)
    â”œâ”€ partner_id (åˆä½œæ–¹ID)
    â”œâ”€ level (çº§åˆ«)
    â”œâ”€ payable_amount (åº”ä»˜é‡‘é¢)
    â”œâ”€ invoice_status (å¼€ç¥¨çŠ¶æ€)
    â”œâ”€ invoice_request_id (å…³è”çš„å¼€ç¥¨ç”³è¯·)
    â””â”€ invoice_applied_at (ç”³è¯·æ—¶é—´)
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. çº§åˆ«åˆ¤æ–­

**ä»˜æ¬¾ç”³è¯·ï¼š**
```sql
WHERE level < maxLevel  -- éæœ€é«˜çº§
```

**å¼€ç¥¨ç”³è¯·ï¼š**
```sql
WHERE level = maxLevel  -- åªè¦æœ€é«˜çº§
```

### 2. çŠ¶æ€å­—æ®µ

**ä»˜æ¬¾ï¼š** å¯èƒ½æ›´æ–° `payment_status`  
**å¼€ç¥¨ï¼š** æ›´æ–° `invoice_status`

### 3. æ˜ç»†è¡¨

**ä»˜æ¬¾æ˜ç»†ï¼š** `partner_payment_items`  
**å¼€ç¥¨æ˜ç»†ï¼š** `invoice_request_details`

### 4. å•å·æ ¼å¼

**ä»˜æ¬¾å•å·ï¼š** `FK + YYYYMMDD + åºå·`ï¼ˆå¦‚æœæœ‰ï¼‰  
**å¼€ç¥¨å•å·ï¼š** `KP + YYYYMMDD + åºå·`

---

## ğŸ§ª æµ‹è¯•æ¸…å•

### å¼€ç¥¨ç”³è¯·åŠŸèƒ½æµ‹è¯•

- [ ] å¯ä»¥é€‰æ‹©è¿å•
- [ ] å¯ä»¥ç‚¹å‡»"ä¸€é”®å¼€ç¥¨ç”³è¯·"
- [ ] é¢„è§ˆæ˜¾ç¤ºæ­£ç¡®çš„åˆä½œæ–¹ï¼ˆåªæœ‰æœ€é«˜çº§ï¼‰
- [ ] æ˜¾ç¤ºæ­£ç¡®çš„é‡‘é¢æ±‡æ€»
- [ ] ç‚¹å‡»"ä¿å­˜å¼€ç¥¨ç”³è¯·"æˆåŠŸ
- [ ] ä¸å†æŠ¥é”™å‡½æ•°é‡è½½å†²çª
- [ ] invoice_requests è¡¨æœ‰æ–°è®°å½•
- [ ] invoice_request_details è¡¨æœ‰æ˜ç»†
- [ ] logistics_partner_costs.invoice_status æ›´æ–°ä¸º 'Processing'
- [ ] å•å·æ ¼å¼æ­£ç¡®ï¼ˆKP20250816-XXXXï¼‰

### å¯¹æ¯”æµ‹è¯•ï¼ˆä»˜æ¬¾ vs å¼€ç¥¨ï¼‰

åŒä¸€ä¸ªè¿å•ï¼Œæœ‰å¤šçº§åˆä½œæ–¹ï¼š

**ä»˜æ¬¾ç”³è¯·åº”è¯¥ï¼š**
- âœ… ç»™éæœ€é«˜çº§åˆä½œæ–¹åˆ›å»ºä»˜æ¬¾ç”³è¯·
- âŒ ä¸ç»™æœ€é«˜çº§åˆä½œæ–¹åˆ›å»º

**å¼€ç¥¨ç”³è¯·åº”è¯¥ï¼š**
- âŒ ä¸ç»™éæœ€é«˜çº§åˆä½œæ–¹åˆ›å»º
- âœ… åªç»™æœ€é«˜çº§åˆä½œæ–¹åˆ›å»ºå¼€ç¥¨ç”³è¯·

---

## ğŸ“ˆ ä»Šæ—¥æ‰€æœ‰ä¿®å¤æ±‡æ€»

| # | ä¿®å¤å†…å®¹ | æ–‡ä»¶ | çŠ¶æ€ |
|---|---------|------|------|
| 1 | è¿å•ç¼–è¾‘éªŒè¯é€»è¾‘ | LogisticsFormDialog.tsx | âœ… |
| 2 | TypeScriptç±»å‹å®šä¹‰ | react-shim.d.ts, tsconfig | âœ… |
| 3 | å¸æœºæœç´¢åŠŸèƒ½ | DriverComboInput.tsx | âœ… |
| 4 | Excelå¯¼å…¥å¸æœºé¡¹ç›®å…³è” | 20250816_fix_driver...sql | âœ… |
| 5 | è¿å•ç®¡ç†ç§»é™¤å¯¼å…¥ | BusinessEntry/index.tsx | âœ… |
| 6 | è¿å•ç»´æŠ¤å¢å¼ºç‰ˆéªŒé‡ | EnhancedWaybillMaintenance.tsx | âœ… |
| 7 | å¼ºåˆ¶å¯¼å…¥é‡å¤å¯å‹¾é€‰ | UpdateModeImportDialog.tsx | âœ… |
| 8 | ä»˜æ¬¾ç”³è¯·é€šçŸ¥è§¦å‘å™¨ | 20250816_fix_payment...sql | âœ… |
| 9 | å¼€ç¥¨ç”³è¯·ç»Ÿä¸€é€»è¾‘ | 20250816_fix_invoice...sql + InvoiceRequest.tsx | âœ… |

---

## ğŸ”§ éœ€è¦åº”ç”¨çš„è¿ç§»æ–‡ä»¶

| # | æ–‡ä»¶ | å†…å®¹ | ä¼˜å…ˆçº§ |
|---|------|------|--------|
| 1 | `20250816_fix_driver_project_association_in_import.sql` | Excelå¯¼å…¥å¸æœºé¡¹ç›®å…³è” | ä¸­ |
| 2 | `20250816_fix_payment_request_notification_trigger.sql` | ä»˜æ¬¾ç”³è¯·é€šçŸ¥è§¦å‘å™¨ | é«˜ |
| 3 | `20250816_fix_invoice_request_function_overload.sql` | å¼€ç¥¨ç”³è¯·ç»Ÿä¸€é€»è¾‘ | ğŸ”´ é«˜ |

---

## ğŸ’¡ ç»Ÿä¸€åçš„æ¶æ„

### è°ƒç”¨æ–¹å¼ç»Ÿä¸€

```typescript
// ä»˜æ¬¾ç”³è¯·
await supabase.rpc('process_payment_application', { 
  p_record_ids: [è¿å•IDæ•°ç»„] 
});

// å¼€ç¥¨ç”³è¯·  
await supabase.rpc('save_invoice_request', { 
  p_record_ids: [è¿å•IDæ•°ç»„]  // âœ… ç»Ÿä¸€ï¼
});
```

### å¤„ç†æ¨¡å¼ç»Ÿä¸€

```
è¾“å…¥ï¼šè¿å•IDæ•°ç»„
  â†“
åç«¯å¤„ç†ï¼š
  â”œâ”€ æ‰¾å‡ºæœ€é«˜çº§åˆ« maxLevel
  â”œâ”€ ç­›é€‰ç¬¦åˆæ¡ä»¶çš„åˆä½œæ–¹
  â”‚   â”œâ”€ ä»˜æ¬¾ï¼šlevel < maxLevel
  â”‚   â””â”€ å¼€ç¥¨ï¼šlevel === maxLevel
  â”œâ”€ æŒ‰åˆä½œæ–¹åˆ†ç»„
  â”œâ”€ åˆ›å»ºç”³è¯·è®°å½•
  â”œâ”€ åˆ›å»ºæ˜ç»†è®°å½•
  â””â”€ æ›´æ–°çŠ¶æ€
  â†“
è¾“å‡ºï¼šåˆ›å»ºç»“æœ
```

### æ•°æ®ç»“æ„ç»Ÿä¸€

```sql
-- ç”³è¯·ä¸»è¡¨å­—æ®µå¯¹åº”
payment_requests              invoice_requests
â”œâ”€ request_number            â”œâ”€ request_number
â”œâ”€ partner_id                â”œâ”€ partner_id
â”œâ”€ partner_full_name         â”œâ”€ partner_full_name
â”œâ”€ total_amount              â”œâ”€ total_amount
â”œâ”€ record_count              â”œâ”€ record_count
â”œâ”€ status                    â”œâ”€ status
â””â”€ created_by                â””â”€ created_by

-- æ˜ç»†è¡¨å­—æ®µå¯¹åº”
partner_payment_items         invoice_request_details
â”œâ”€ payment_request_id        â”œâ”€ invoice_request_id
â”œâ”€ logistics_record_id       â”œâ”€ logistics_record_id
â””â”€ (å…¶ä»–å­—æ®µ)                â””â”€ amount
```

---

## âœ… éªŒè¯æ¸…å•

### ä»£ç è´¨é‡
- [x] å‰ç«¯æ— Linté”™è¯¯
- [x] åç«¯SQLè¯­æ³•æ­£ç¡®
- [x] é€»è¾‘æ¸…æ™°ç»Ÿä¸€
- [x] æ³¨é‡Šå®Œæ•´

### åŠŸèƒ½éªŒè¯
- [ ] åº”ç”¨è¿ç§»æˆåŠŸ
- [ ] ä»˜æ¬¾ç”³è¯·åŠŸèƒ½æ­£å¸¸
- [ ] å¼€ç¥¨ç”³è¯·åŠŸèƒ½æ­£å¸¸
- [ ] åªç»™æ­£ç¡®çº§åˆ«çš„åˆä½œæ–¹åˆ›å»ºç”³è¯·
- [ ] çŠ¶æ€æ›´æ–°æ­£ç¡®

---

## ğŸŠ æ€»ç»“

### ä¿®å¤æˆæœ

1. âœ… **ç»Ÿä¸€äº†è°ƒç”¨æ–¹å¼** - å‰åç«¯éƒ½åªä¼ è¿å•IDæ•°ç»„
2. âœ… **ç»Ÿä¸€äº†å¤„ç†é€»è¾‘** - åç«¯è‡ªåŠ¨åˆ†ç»„è®¡ç®—
3. âœ… **ä¿®å¤äº†å‡½æ•°é‡è½½** - åªä¿ç•™ä¸€ä¸ªç‰ˆæœ¬
4. âœ… **ä¿®å¤äº†è¡¨å­—æ®µ** - è¡¥å……ç¼ºå¤±å­—æ®µ
5. âœ… **æ¸…æ™°çš„ä»£ç ç»“æ„** - æ˜“äºç†è§£å’Œç»´æŠ¤

### å…³é”®ç†è§£

**ä»˜æ¬¾ vs å¼€ç¥¨ï¼š**
- ä»˜æ¬¾ = å¾€ä¸‹æ¸¸ä»˜ï¼ˆlevel < maxï¼‰
- å¼€ç¥¨ = å¾€ä¸Šæ¸¸æ”¶ï¼ˆlevel === maxï¼‰
- ä¸¤è€…æ˜¯**åæ–¹å‘**çš„åŒä¸€å¥—é€»è¾‘

### ä¸‹ä¸€æ­¥

åº”ç”¨è¿™3ä¸ªè¿ç§»æ–‡ä»¶åï¼Œæ‰€æœ‰è´¢åŠ¡åŠŸèƒ½åº”è¯¥å®Œå…¨æ­£å¸¸ï¼ğŸ‰

---

**ä¿®å¤å®Œæˆæ—¥æœŸï¼š** 2025-01-16  
**ä¿®æ”¹æ–‡ä»¶æ•°ï¼š** 2ä¸ªï¼ˆ1å‰ç«¯ + 1è¿ç§»ï¼‰  
**è§£å†³é—®é¢˜æ•°ï¼š** 9ä¸ª  
**ä»£ç è´¨é‡ï¼š** âœ… ä¼˜ç§€

