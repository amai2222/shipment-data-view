# 系统金额 vs Excel金额差异分析

## 📊 数据对比：

| 序号 | 系统-司机应收 | Excel-运费金额 | 系统-合作方应付 | Excel-含税金额 | 差异 |
|-----|-------------|--------------|--------------|-------------|-----|
| 1 | ¥1,291.25 | 1505 | ¥1,381.02 | 1609.63 | ❌ 不一致 |
| 2 | ¥1,436.25 | 3450.8 | ¥1,536.10 | 3690.7 | ❌ 不一致 |
| 3 | ¥1,465.00 | 2638.03 | ¥1,566.84 | 2821.42 | ❌ 不一致 |
| 4 | ¥1,326.25 | 1321.25 | ¥1,418.45 | 1413.1 | ❌ 不一致 |
| 5 | ¥3,487.20 | 3457.3 | ¥3,729.63 | 3697.65 | ❌ 不一致 |
| 6 | ¥1,446.25 | 1322.5 | ¥1,546.79 | 1414.44 | ❌ 不一致 |
| 7 | ¥1,496.25 | 1492.5 | ¥1,600.27 | 1596.26 | ❌ 不一致 |

## 🔍 可能的原因分析：

### 原因1：基础金额来源不同
**系统**：
- 司机应收 = `current_cost + extra_cost`
- 可能包含额外费用

**Excel**：
- 运费金额 = 基础运费
- 可能不包含额外费用

### 原因2：税率计算差异
**系统**：
```
合作方应付 = 司机应收 / (1 - 税率)
1291.25 / 0.94 = 1374.20  ← 假设6%税率
```

**Excel**：
```
含税金额 = 运费金额 × 某个系数
1505 × ? = 1609.63
系数 = 1609.63 / 1505 = 1.0695 (6.95%?)
```

### 原因3：四舍五入累积误差
- 系统：可能每步都四舍五入
- Excel：可能最后一次四舍五入

---

## 🎯 需要检查的信息：

### 请提供以下信息帮我定位问题：

1. **Excel的计算公式是什么？**
   - 含税金额 = 运费金额 × ?
   - 税率是多少？

2. **这些运单的详细信息**：
   - 项目名称
   - 合作链路
   - 税率设置
   - 是否有extra_cost（额外费用）

3. **随便选一条运单查询**：
```sql
SELECT 
    auto_number,
    project_name,
    driver_name,
    current_cost,
    extra_cost,
    payable_cost as 司机应收,
    chain_name
FROM logistics_records
WHERE payable_cost = 1291.25;  -- 用第一条数据

-- 查看合作方成本
SELECT 
    level,
    partner_name,
    base_amount,
    payable_amount,
    tax_rate,
    calculation_method
FROM logistics_partner_costs lpc
JOIN partners p ON lpc.partner_id = p.id
WHERE logistics_record_id = (
    SELECT id FROM logistics_records WHERE payable_cost = 1291.25 LIMIT 1
)
ORDER BY level;
```

---

## 💡 可能的解决方案：

### 如果是税率问题：
- 检查project_partners表中的税率设置
- 确认Excel用的税率

### 如果是extra_cost问题：
- 系统可能加了额外费用
- Excel没有计算额外费用

### 如果是计算方法问题：
- 系统用的是"税点法"
- Excel可能用的是固定比例

---

**请提供上面的SQL查询结果，我帮您精确定位问题！**

