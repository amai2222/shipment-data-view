# ä¸­ç§‘ç‰©æµè·Ÿè¸ªç³»ç»Ÿ - å®Œæ•´æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
4. [åç«¯å‡½æ•°æ¸…å•](#åç«¯å‡½æ•°æ¸…å•)
5. [å‰ç«¯æ¶æ„](#å‰ç«¯æ¶æ„)
6. [æƒé™ç®¡ç†ç³»ç»Ÿ](#æƒé™ç®¡ç†ç³»ç»Ÿ)
7. [ç§»åŠ¨ç«¯è®¾è®¡](#ç§»åŠ¨ç«¯è®¾è®¡)
8. [APIæ¥å£æ–‡æ¡£](#APIæ¥å£æ–‡æ¡£)
9. [éƒ¨ç½²å’Œç»´æŠ¤](#éƒ¨ç½²å’Œç»´æŠ¤)
10. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ç³»ç»Ÿæ¦‚è¿°

### ğŸ¯ é¡¹ç›®ç®€ä»‹
ä¸­ç§‘ç‰©æµè·Ÿè¸ªç³»ç»Ÿæ˜¯ä¸€ä¸ªå…¨æ ˆç‰©æµç®¡ç†å¹³å°ï¼Œæ”¯æŒè¿å•ç®¡ç†ã€é¡¹ç›®çœ‹æ¿ã€è´¢åŠ¡ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚ç³»ç»Ÿé‡‡ç”¨ç°ä»£åŒ–æŠ€æœ¯æ ˆï¼Œæä¾›æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯åŒé‡ä½“éªŒã€‚

### ğŸ—ï¸ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
- **è¿å•ç®¡ç†**: è¿å•å½•å…¥ã€ç¼–è¾‘ã€æŸ¥è¯¢ã€æ‰¹é‡å¯¼å…¥
- **é¡¹ç›®çœ‹æ¿**: é¡¹ç›®æ¦‚è§ˆã€æ•°æ®ç»Ÿè®¡ã€è¶‹åŠ¿åˆ†æ
- **è´¢åŠ¡ç®¡ç†**: ä»˜æ¬¾ç”³è¯·ã€è´¢åŠ¡å¯¹è´¦ã€å‘ç¥¨ç®¡ç†
- **æƒé™ç®¡ç†**: ç”¨æˆ·ç®¡ç†ã€è§’è‰²é…ç½®ã€æƒé™åˆ†é…
- **æ•°æ®ç»´æŠ¤**: æ•°æ®å¯¼å…¥å¯¼å‡ºã€æ‰¹é‡æ“ä½œ
- **ç§»åŠ¨ç«¯**: å“åº”å¼è®¾è®¡ã€è§¦æ§ä¼˜åŒ–

### ğŸ“Š ç³»ç»Ÿç‰¹æ€§
- **å®æ—¶æ•°æ®**: WebSocketå®æ—¶æ›´æ–°
- **æƒé™æ§åˆ¶**: ç»†ç²’åº¦æƒé™ç®¡ç†
- **å“åº”å¼è®¾è®¡**: æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯é€‚é…
- **æ•°æ®å®‰å…¨**: RLS (Row Level Security) ä¿æŠ¤
- **é«˜æ€§èƒ½**: React Queryç¼“å­˜ä¼˜åŒ–
- **ç°ä»£åŒ–UI**: Tailwind CSS + shadcn/ui

---

## æŠ€æœ¯æ¶æ„

### ğŸ”§ å‰ç«¯æŠ€æœ¯æ ˆ
```
React 18.2.0           - å‰ç«¯æ¡†æ¶
TypeScript 5.2.2       - ç±»å‹å®‰å…¨
Vite 5.0.8             - æ„å»ºå·¥å…·
React Router 6.20.1    - è·¯ç”±ç®¡ç†
React Query 4.36.1     - æ•°æ®çŠ¶æ€ç®¡ç†
Tailwind CSS 3.3.6     - CSSæ¡†æ¶
shadcn/ui              - UIç»„ä»¶åº“
Recharts 2.12.7        - å›¾è¡¨åº“
Lucide React           - å›¾æ ‡åº“
```

### ğŸ—„ï¸ åç«¯æŠ€æœ¯æ ˆ
```
Supabase               - åç«¯å³æœåŠ¡
PostgreSQL 15          - æ•°æ®åº“
PostgREST              - APIè‡ªåŠ¨ç”Ÿæˆ
Supabase Auth          - èº«ä»½è®¤è¯
Supabase Storage       - æ–‡ä»¶å­˜å‚¨
Row Level Security     - æ•°æ®å®‰å…¨
```

### ğŸ›ï¸ ç³»ç»Ÿæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯åº”ç”¨å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ¡Œé¢ç«¯åº”ç”¨      â”‚    ç§»åŠ¨ç«¯åº”ç”¨     â”‚      ç®¡ç†åå°           â”‚
â”‚   React SPA     â”‚   Responsive    â”‚   Permission Mgmt      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     APIç½‘å…³å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   PostgREST     â”‚   Supabase Auth â”‚   Supabase Storage     â”‚
â”‚   RESTful API   â”‚   JWT Token     â”‚   File Upload          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®åº“å±‚                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   PostgreSQL    â”‚   RLS Policies  â”‚   Database Functions   â”‚
â”‚   Core Tables   â”‚   Security      â”‚   Business Logic       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®åº“è®¾è®¡

### ğŸ“Š æ ¸å¿ƒæ•°æ®è¡¨

#### 1. é¡¹ç›®ç®¡ç†
```sql
-- é¡¹ç›®è¡¨
CREATE TABLE projects (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT NOT NULL,
    manager TEXT,
    finance_manager TEXT,
    start_date DATE,
    end_date DATE,
    project_status TEXT DEFAULT 'è¿›è¡Œä¸­',
    loading_address TEXT,
    unloading_address TEXT,
    planned_total_tons DECIMAL(10,2),
    billing_type_id INTEGER DEFAULT 1,
    auto_code TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### 2. ç‰©æµè®°å½•
```sql
-- ç‰©æµè®°å½•è¡¨
CREATE TABLE logistics_records (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    auto_number TEXT UNIQUE,
    project_id UUID REFERENCES projects(id),
    project_name TEXT,
    driver_name TEXT NOT NULL,
    license_plate TEXT,
    driver_phone TEXT,
    loading_date TIMESTAMP WITH TIME ZONE,
    unloading_date TIMESTAMP WITH TIME ZONE,
    loading_location TEXT,
    unloading_location TEXT,
    loading_weight DECIMAL(10,2),
    unloading_weight DECIMAL(10,2),
    transport_type TEXT DEFAULT 'å®é™…è¿è¾“',
    billing_type_id INTEGER DEFAULT 1,
    driver_payable_cost DECIMAL(10,2),
    current_cost DECIMAL(10,2),
    extra_cost DECIMAL(10,2) DEFAULT 0,
    cargo_type TEXT,
    remarks TEXT,
    external_tracking_numbers JSONB DEFAULT '[]'::jsonb,
    other_platform_names TEXT[] DEFAULT ARRAY[]::TEXT[],
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    user_id UUID REFERENCES auth.users(id)
);
```

#### 3. ç”¨æˆ·æƒé™
```sql
-- ç”¨æˆ·é…ç½®è¡¨
CREATE TABLE user_profiles (
    id UUID PRIMARY KEY REFERENCES auth.users(id),
    full_name TEXT,
    role TEXT DEFAULT 'viewer',
    department TEXT,
    phone TEXT,
    status TEXT DEFAULT 'active',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ç”¨æˆ·æƒé™è¡¨
CREATE TABLE user_permissions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id),
    permission_type TEXT NOT NULL,
    permission_name TEXT NOT NULL,
    has_permission BOOLEAN DEFAULT false,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(user_id, permission_type, permission_name)
);
```

#### 4. åˆåŒç®¡ç†
```sql
-- åˆåŒè¡¨
CREATE TABLE contracts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    contract_number TEXT UNIQUE NOT NULL,
    contract_name TEXT NOT NULL,
    contract_type TEXT DEFAULT 'standard',
    party_a TEXT NOT NULL,
    party_b TEXT NOT NULL,
    signing_date DATE,
    effective_date DATE,
    expiry_date DATE,
    contract_amount DECIMAL(15,2),
    status TEXT DEFAULT 'draft',
    file_path TEXT,
    created_by_user_id UUID REFERENCES auth.users(id),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### ğŸ” è¡Œçº§å®‰å…¨ç­–ç•¥ (RLS)

#### åŸºç¡€å®‰å…¨ç­–ç•¥
```sql
-- å¯ç”¨RLS
ALTER TABLE logistics_records ENABLE ROW LEVEL SECURITY;
ALTER TABLE projects ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_profiles ENABLE ROW LEVEL SECURITY;

-- ç‰©æµè®°å½•è®¿é—®ç­–ç•¥
CREATE POLICY "Users can view logistics records based on permissions" 
ON logistics_records FOR SELECT 
USING (
    auth.uid() IN (
        SELECT user_id FROM user_permissions 
        WHERE permission_type = 'menu' 
        AND permission_name = 'business_entry' 
        AND has_permission = true
    )
);

-- é¡¹ç›®è®¿é—®ç­–ç•¥
CREATE POLICY "Users can view projects based on permissions" 
ON projects FOR SELECT 
USING (
    auth.uid() IN (
        SELECT user_id FROM user_permissions 
        WHERE permission_type = 'menu' 
        AND permission_name = 'projects' 
        AND has_permission = true
    )
);
```

---

## åç«¯å‡½æ•°æ¸…å•

### ğŸ“‹ Supabase RPC å‡½æ•°å®Œæ•´åˆ—è¡¨

#### 1. æ•°æ®ç»Ÿè®¡å‡½æ•°
```sql
-- ä»ªè¡¨ç›˜ç»Ÿè®¡æ•°æ®
get_dashboard_stats_with_billing_types(
    p_start_date TEXT,
    p_end_date TEXT, 
    p_project_id UUID
) RETURNS JSON;

-- é¡¹ç›®çœ‹æ¿æ•°æ®
get_project_dashboard_data(
    p_selected_project_id UUID,
    p_report_date TEXT
) RETURNS JSON;

-- æ‰€æœ‰é¡¹ç›®æ¦‚è§ˆæ•°æ®
get_all_projects_overview_data(
    p_selected_project_ids UUID[],
    p_report_date TEXT
) RETURNS JSON;
```

#### 2. ç‰©æµè®°å½•ç®¡ç†
```sql
-- è·å–ç‰©æµè®°å½•æ±‡æ€»
get_logistics_summary_and_records_enhanced(
    p_start_date TEXT,
    p_end_date TEXT,
    p_project_name TEXT,
    p_driver_name TEXT,
    p_license_plate TEXT,
    p_driver_phone TEXT,
    p_other_platform_name TEXT,
    p_waybill_numbers TEXT,
    p_has_scale_record BOOLEAN,
    p_limit INTEGER,
    p_offset INTEGER
) RETURNS JSON;

-- æ·»åŠ ç‰©æµè®°å½•
add_logistics_record_with_costs(
    p_project_id UUID,
    p_project_name TEXT,
    p_driver_name TEXT,
    p_license_plate TEXT,
    p_driver_phone TEXT,
    p_loading_date TEXT,
    p_unloading_date TEXT,
    p_loading_location TEXT,
    p_unloading_location TEXT,
    p_loading_weight DECIMAL,
    p_unloading_weight DECIMAL,
    p_transport_type TEXT,
    p_current_cost DECIMAL,
    p_extra_cost DECIMAL,
    p_chain_id UUID,
    p_remarks TEXT
) RETURNS VOID;

-- æ›´æ–°ç‰©æµè®°å½•
update_logistics_record_via_recalc(
    p_record_id UUID,
    p_project_id UUID,
    p_project_name TEXT,
    p_driver_name TEXT,
    p_license_plate TEXT,
    p_driver_phone TEXT,
    p_loading_date TEXT,
    p_unloading_date TEXT,
    p_loading_location TEXT,
    p_unloading_location TEXT,
    p_loading_weight DECIMAL,
    p_unloading_weight DECIMAL,
    p_transport_type TEXT,
    p_current_cost DECIMAL,
    p_extra_cost DECIMAL,
    p_chain_id UUID,
    p_remarks TEXT
) RETURNS VOID;
```

#### 3. æ‰¹é‡å¯¼å…¥å‡½æ•°
```sql
-- é¢„è§ˆå¯¼å…¥æ•°æ®
preview_import_with_duplicates_check(
    p_records JSON
) RETURNS JSON;

-- å¸¦æ›´æ–°æ¨¡å¼çš„é¢„è§ˆ
preview_import_with_update_mode(
    p_records JSON
) RETURNS JSON;

-- æ‰¹é‡å¯¼å…¥ç‰©æµè®°å½•
batch_import_logistics_records(
    p_records JSON
) RETURNS JSON;

-- å¸¦æ›´æ–°æ¨¡å¼çš„æ‰¹é‡å¯¼å…¥
batch_import_logistics_records_with_update(
    p_records JSON
) RETURNS JSON;
```

#### 4. è´¢åŠ¡ç®¡ç†å‡½æ•°
```sql
-- è·å–ä»˜æ¬¾ç”³è¯·æ•°æ®
get_payment_request_data(
    p_start_date TEXT,
    p_end_date TEXT,
    p_project_name TEXT,
    p_partner_name TEXT,
    p_limit INTEGER,
    p_offset INTEGER
) RETURNS JSON;

-- å¤„ç†ä»˜æ¬¾ç”³è¯·
process_payment_application(
    p_record_ids UUID[],
    p_application_amount DECIMAL,
    p_application_reason TEXT
) RETURNS VOID;

-- è´¢åŠ¡ç»Ÿè®¡
get_total_receivables() RETURNS DECIMAL;
get_monthly_receivables() RETURNS DECIMAL;
get_pending_payments() RETURNS DECIMAL;
get_pending_invoicing() RETURNS DECIMAL;
get_monthly_trends() RETURNS JSON;
get_partner_ranking() RETURNS JSON;
```

#### 5. æƒé™ç®¡ç†å‡½æ•°
```sql
-- æ£€æŸ¥æšä¸¾å€¼
check_enum_value(
    p_enum_name TEXT,
    p_value TEXT
) RETURNS BOOLEAN;

-- æ·»åŠ æšä¸¾å€¼
add_enum_value(
    p_enum_name TEXT,
    p_value TEXT
) RETURNS VOID;

-- åº”ç”¨æ ‡å‡†RLSç­–ç•¥
apply_standard_rls_policies(
    p_table_name TEXT,
    p_user_id_column TEXT
) RETURNS VOID;
```

#### 6. æ•°æ®æŸ¥è¯¢ä¼˜åŒ–å‡½æ•°
```sql
-- è·å–å¸æœºåˆ†é¡µæ•°æ®
get_drivers_paginated(
    p_search_term TEXT,
    p_limit INTEGER,
    p_offset INTEGER
) RETURNS JSON;

-- è·å–ç­›é€‰çš„ç‰©æµè®°å½•
get_filtered_logistics_records_fixed(
    p_start_date TEXT,
    p_end_date TEXT,
    p_project_name TEXT,
    p_driver_name TEXT,
    p_license_plate TEXT,
    p_limit INTEGER,
    p_offset INTEGER
) RETURNS JSON;

-- è·å–æ‰€æœ‰ç­›é€‰è®°å½•ID
get_all_filtered_record_ids(
    p_start_date TEXT,
    p_end_date TEXT,
    p_project_name TEXT,
    p_driver_name TEXT,
    p_license_plate TEXT,
    p_driver_phone TEXT,
    p_other_platform_name TEXT,
    p_waybill_numbers TEXT,
    p_has_scale_record BOOLEAN
) RETURNS JSON;
```

### ğŸ”„ æ•°æ®åº“è§¦å‘å™¨

#### 1. è‡ªåŠ¨ç¼–å·è§¦å‘å™¨
```sql
-- ç‰©æµè®°å½•è‡ªåŠ¨ç¼–å·
CREATE OR REPLACE FUNCTION generate_auto_number()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.auto_number IS NULL THEN
        NEW.auto_number := 'WB' || TO_CHAR(NOW(), 'YYYYMMDD') || 
                          LPAD(nextval('logistics_records_seq')::TEXT, 4, '0');
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_generate_auto_number
    BEFORE INSERT ON logistics_records
    FOR EACH ROW
    EXECUTE FUNCTION generate_auto_number();
```

#### 2. æ›´æ–°æ—¶é—´è§¦å‘å™¨
```sql
-- è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³
CREATE OR REPLACE FUNCTION update_updated_at()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- åº”ç”¨åˆ°æ‰€æœ‰éœ€è¦çš„è¡¨
CREATE TRIGGER trigger_update_logistics_records_updated_at
    BEFORE UPDATE ON logistics_records
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at();
```

#### 3. æƒé™åŒæ­¥è§¦å‘å™¨
```sql
-- ç”¨æˆ·æƒé™å˜æ›´åŒæ­¥
CREATE OR REPLACE FUNCTION sync_user_permissions()
RETURNS TRIGGER AS $$
BEGIN
    -- åŒæ­¥æƒé™å˜æ›´åˆ°ç›¸å…³è¡¨
    IF TG_OP = 'UPDATE' THEN
        -- è®°å½•æƒé™å˜æ›´æ—¥å¿—
        INSERT INTO permission_change_logs (
            user_id, 
            permission_type, 
            permission_name, 
            old_value, 
            new_value, 
            changed_at
        ) VALUES (
            NEW.user_id,
            NEW.permission_type,
            NEW.permission_name,
            OLD.has_permission,
            NEW.has_permission,
            NOW()
        );
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

---

## å‰ç«¯æ¶æ„

### ğŸ—ï¸ ç›®å½•ç»“æ„
```
src/
â”œâ”€â”€ components/           # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ ui/              # åŸºç¡€UIç»„ä»¶
â”‚   â”œâ”€â”€ mobile/          # ç§»åŠ¨ç«¯ä¸“ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ contracts/       # åˆåŒç®¡ç†ç»„ä»¶
â”‚   â””â”€â”€ permissions/     # æƒé™ç®¡ç†ç»„ä»¶
â”œâ”€â”€ pages/               # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ mobile/          # ç§»åŠ¨ç«¯é¡µé¢
â”‚   â”œâ”€â”€ Settings/        # è®¾ç½®é¡µé¢
â”‚   â””â”€â”€ DataMaintenance/ # æ•°æ®ç»´æŠ¤é¡µé¢
â”œâ”€â”€ hooks/               # è‡ªå®šä¹‰Hooks
â”œâ”€â”€ services/            # ä¸šåŠ¡æœåŠ¡å±‚
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”œâ”€â”€ types/               # TypeScriptç±»å‹å®šä¹‰
â”œâ”€â”€ contexts/            # React Context
â””â”€â”€ integrations/        # ç¬¬ä¸‰æ–¹é›†æˆ
    â””â”€â”€ supabase/        # Supabaseé…ç½®
```

### ğŸ¯ æ ¸å¿ƒç»„ä»¶æ¶æ„

#### 1. è·¯ç”±è®¾è®¡
```typescript
// æ¡Œé¢ç«¯è·¯ç”±
/                           -> é¦–é¡µä»ªè¡¨ç›˜
/projects                   -> é¡¹ç›®ç®¡ç†
/business-entry             -> ä¸šåŠ¡å½•å…¥
/scale-records              -> ç£…å•è®°å½•
/data-maintenance           -> æ•°æ®ç»´æŠ¤
/financial-overview         -> è´¢åŠ¡æ¦‚è§ˆ
/payment-requests           -> ä»˜æ¬¾ç”³è¯·
/settings/*                 -> è®¾ç½®é¡µé¢

// ç§»åŠ¨ç«¯è·¯ç”±
/m/                         -> ç§»åŠ¨ç«¯é¦–é¡µ
/m/projects                 -> é¡¹ç›®æ¦‚è§ˆ
/m/projects/detail/:id      -> é¡¹ç›®è¯¦æƒ…
/m/projects/detail/:id/records    -> é¡¹ç›®è¿å•åˆ—è¡¨
/m/projects/detail/:id/dashboard  -> é¡¹ç›®è¯¦ç»†çœ‹æ¿
/m/waybill/:id             -> è¿å•è¯¦æƒ…
/m/business-entry          -> ç§»åŠ¨ç«¯ä¸šåŠ¡å½•å…¥
/m/contracts               -> ç§»åŠ¨ç«¯åˆåŒç®¡ç†
```

#### 2. çŠ¶æ€ç®¡ç†
```typescript
// React Query é…ç½®
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000,      // 5åˆ†é’Ÿç¼“å­˜
      cacheTime: 10 * 60 * 1000,     // 10åˆ†é’Ÿä¿ç•™
      refetchOnWindowFocus: false,    // çª—å£èšç„¦ä¸åˆ·æ–°
      retry: 1,                       // å¤±è´¥é‡è¯•1æ¬¡
    },
  },
});

// è‡ªå®šä¹‰Hookç¤ºä¾‹
export function useProjectDashboard(projectId: string, reportDate: Date) {
  return useQuery({
    queryKey: ['projectDashboard', projectId, format(reportDate, 'yyyy-MM-dd')],
    queryFn: async () => {
      const { data, error } = await supabase.rpc('get_project_dashboard_data', {
        p_selected_project_id: projectId,
        p_report_date: format(reportDate, 'yyyy-MM-dd')
      });
      if (error) throw error;
      return data;
    },
    enabled: !!projectId,
    staleTime: 5 * 60 * 1000,
  });
}
```

#### 3. æƒé™æ§åˆ¶ç»„ä»¶
```typescript
// æƒé™ä¿æŠ¤è·¯ç”±
function ProtectedRoute({ 
  children, 
  requiredRoles = [], 
  requiredPermissions = [] 
}: ProtectedRouteProps) {
  const { user, userProfile, permissions } = useAuth();
  
  if (!user) return <Navigate to="/login" />;
  
  if (requiredRoles.length > 0 && !requiredRoles.includes(userProfile?.role)) {
    return <Navigate to="/unauthorized" />;
  }
  
  if (requiredPermissions.length > 0) {
    const hasPermission = requiredPermissions.every(permission => 
      permissions?.[permission] === true
    );
    if (!hasPermission) return <Navigate to="/unauthorized" />;
  }
  
  return <>{children}</>;
}

// æƒé™æŒ‰é’®ç»„ä»¶
function PermissionButton({ 
  permission, 
  children, 
  ...props 
}: PermissionButtonProps) {
  const { permissions } = usePermissions();
  
  if (!permissions?.[permission]) return null;
  
  return <Button {...props}>{children}</Button>;
}
```

### ğŸ“± ç§»åŠ¨ç«¯ç‰¹æ®Šè®¾è®¡

#### 1. å“åº”å¼å¸ƒå±€
```typescript
// ç§»åŠ¨ç«¯å¸ƒå±€ç»„ä»¶
export function MobileLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="min-h-screen bg-gray-50">
      {/* é¡¶éƒ¨å¯¼èˆªæ  */}
      <header className="sticky top-0 z-50 bg-white border-b border-gray-200">
        <div className="flex items-center justify-between px-4 py-3">
          <h1 className="text-lg font-semibold">ç‰©æµç®¡ç†ç³»ç»Ÿ</h1>
          <UserMenu />
        </div>
      </header>
      
      {/* ä¸»å†…å®¹åŒº */}
      <main className="container mx-auto px-4 py-6">
        {children}
      </main>
      
      {/* åº•éƒ¨å¯¼èˆª */}
      <BottomNavigation />
    </div>
  );
}
```

#### 2. è§¦æ§ä¼˜åŒ–
```css
/* ç§»åŠ¨ç«¯è§¦æ§ä¼˜åŒ– */
.mobile-button {
  min-height: 44px;           /* æœ€å°è§¦æ§åŒºåŸŸ */
  min-width: 44px;
  touch-action: manipulation;  /* ç¦ç”¨åŒå‡»ç¼©æ”¾ */
}

.mobile-card {
  padding: 16px;
  border-radius: 16px;        /* å¤§åœ†è§’æ›´ç°ä»£ */
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.mobile-input {
  font-size: 16px;            /* é˜²æ­¢iOSç¼©æ”¾ */
  padding: 12px 16px;
}
```

---

## æƒé™ç®¡ç†ç³»ç»Ÿ

### ğŸ” æƒé™æ¶æ„è®¾è®¡

#### 1. æƒé™ç±»å‹
```typescript
// æƒé™ç±»å‹å®šä¹‰
interface Permission {
  id: string;
  user_id: string;
  permission_type: 'menu' | 'function' | 'project' | 'data';
  permission_name: string;
  has_permission: boolean;
}

// æƒé™ç±»å‹è¯´æ˜
enum PermissionType {
  MENU = 'menu',           // èœå•è®¿é—®æƒé™
  FUNCTION = 'function',   // åŠŸèƒ½æ“ä½œæƒé™  
  PROJECT = 'project',     // é¡¹ç›®æ•°æ®æƒé™
  DATA = 'data'           // æ•°æ®çº§åˆ«æƒé™
}
```

#### 2. è§’è‰²ç³»ç»Ÿ
```typescript
// é¢„å®šä¹‰è§’è‰²
enum UserRole {
  ADMIN = 'admin',         // ç³»ç»Ÿç®¡ç†å‘˜
  MANAGER = 'manager',     // éƒ¨é—¨ç»ç†
  FINANCE = 'finance',     // è´¢åŠ¡äººå‘˜
  BUSINESS = 'business',   // ä¸šåŠ¡äººå‘˜
  OPERATOR = 'operator',   // æ“ä½œå‘˜
  VIEWER = 'viewer'        // æŸ¥çœ‹è€…
}

// è§’è‰²æƒé™æ˜ å°„
const rolePermissions = {
  admin: {
    menu: ['*'],           // æ‰€æœ‰èœå•
    function: ['*'],       // æ‰€æœ‰åŠŸèƒ½
    project: ['*'],        // æ‰€æœ‰é¡¹ç›®
    data: ['*']           // æ‰€æœ‰æ•°æ®
  },
  manager: {
    menu: ['projects', 'business_entry', 'financial_overview'],
    function: ['create', 'edit', 'approve'],
    project: ['assigned'],  // åˆ†é…çš„é¡¹ç›®
    data: ['department']   // éƒ¨é—¨æ•°æ®
  },
  // ... å…¶ä»–è§’è‰²é…ç½®
};
```

#### 3. æƒé™æ£€æŸ¥Hook
```typescript
export function usePermissions() {
  const { data: permissions, isLoading } = useQuery({
    queryKey: ['userPermissions'],
    queryFn: async () => {
      const { data } = await supabase
        .from('user_permissions')
        .select('*')
        .eq('user_id', user?.id);
      
      // è½¬æ¢ä¸ºæ˜“ç”¨çš„å¯¹è±¡æ ¼å¼
      return data?.reduce((acc, perm) => {
        const key = `${perm.permission_type}_${perm.permission_name}`;
        acc[key] = perm.has_permission;
        return acc;
      }, {} as Record<string, boolean>);
    },
    enabled: !!user,
    staleTime: 10 * 60 * 1000, // 10åˆ†é’Ÿç¼“å­˜
  });

  return {
    permissions,
    isLoading,
    hasPermission: (type: string, name: string) => 
      permissions?.[`${type}_${name}`] === true,
    hasMenuAccess: (menuName: string) => 
      permissions?.[`menu_${menuName}`] === true,
    hasFunctionAccess: (functionName: string) => 
      permissions?.[`function_${functionName}`] === true,
  };
}
```

### ğŸ›¡ï¸ æ•°æ®å®‰å…¨ç­–ç•¥

#### 1. è¡Œçº§å®‰å…¨(RLS)å®ç°
```sql
-- åŸºäºç”¨æˆ·æƒé™çš„RLSç­–ç•¥
CREATE POLICY "logistics_records_select_policy" 
ON logistics_records FOR SELECT 
USING (
  -- ç®¡ç†å‘˜å¯ä»¥çœ‹æ‰€æœ‰æ•°æ®
  EXISTS (
    SELECT 1 FROM user_profiles 
    WHERE id = auth.uid() AND role = 'admin'
  )
  OR
  -- æœ‰èœå•æƒé™çš„ç”¨æˆ·å¯ä»¥çœ‹æ•°æ®
  EXISTS (
    SELECT 1 FROM user_permissions 
    WHERE user_id = auth.uid() 
    AND permission_type = 'menu' 
    AND permission_name = 'business_entry' 
    AND has_permission = true
  )
  OR  
  -- æœ‰é¡¹ç›®æƒé™çš„ç”¨æˆ·å¯ä»¥çœ‹å¯¹åº”é¡¹ç›®æ•°æ®
  EXISTS (
    SELECT 1 FROM user_permissions 
    WHERE user_id = auth.uid() 
    AND permission_type = 'project' 
    AND permission_name = project_id::text 
    AND has_permission = true
  )
);
```

#### 2. APIæƒé™ä¸­é—´ä»¶
```typescript
// æƒé™æ£€æŸ¥ä¸­é—´ä»¶
export function withPermission(
  requiredPermission: string,
  handler: (req: Request, res: Response) => Promise<void>
) {
  return async (req: Request, res: Response) => {
    const user = await getUser(req);
    const hasPermission = await checkUserPermission(user.id, requiredPermission);
    
    if (!hasPermission) {
      return res.status(403).json({ error: 'æƒé™ä¸è¶³' });
    }
    
    return handler(req, res);
  };
}
```

---

## ç§»åŠ¨ç«¯è®¾è®¡

### ğŸ“± è®¾è®¡åŸåˆ™

#### 1. ç§»åŠ¨ä¼˜å…ˆè®¾è®¡
- **è§¦æ§å‹å¥½**: æœ€å°44pxè§¦æ§åŒºåŸŸ
- **ç®€åŒ–å¯¼èˆª**: åº•éƒ¨æ ‡ç­¾é¡µ + ä¾§æ»‘èœå•
- **å†…å®¹ä¼˜å…ˆ**: å‡å°‘è£…é¥°æ€§å…ƒç´ 
- **åŠ è½½ä¼˜åŒ–**: æ‡’åŠ è½½ + éª¨æ¶å±

#### 2. å“åº”å¼æ–­ç‚¹
```css
/* Tailwind CSS æ–­ç‚¹é…ç½® */
sm: '640px',    /* å°å±å¹• */
md: '768px',    /* å¹³æ¿ */
lg: '1024px',   /* å°æ¡Œé¢ */
xl: '1280px',   /* æ¡Œé¢ */
2xl: '1536px'   /* å¤§æ¡Œé¢ */
```

#### 3. ç§»åŠ¨ç«¯ç‰¹æ®Šç»„ä»¶

##### MobileCard ç»„ä»¶
```typescript
interface MobileCardProps {
  children: React.ReactNode;
  onClick?: () => void;
  badge?: { text: string; className?: string };
  onView?: () => void;
  onEdit?: () => void;
  onDelete?: () => void;
}

export function MobileCard({ 
  children, 
  onClick, 
  badge, 
  onView, 
  onEdit, 
  onDelete 
}: MobileCardProps) {
  return (
    <div className="bg-white rounded-2xl shadow-lg p-4 border border-gray-100">
      {badge && (
        <div className="flex justify-end mb-2">
          <span className={`px-2 py-1 rounded-full text-xs font-medium ${badge.className}`}>
            {badge.text}
          </span>
        </div>
      )}
      
      <div onClick={onClick} className="cursor-pointer">
        {children}
      </div>
      
      {(onView || onEdit || onDelete) && (
        <div className="flex justify-end gap-2 mt-4 pt-3 border-t border-gray-100">
          {onView && (
            <Button variant="outline" size="sm" onClick={onView}>
              <Eye className="h-4 w-4" />
            </Button>
          )}
          {onEdit && (
            <Button variant="outline" size="sm" onClick={onEdit}>
              <Edit className="h-4 w-4" />
            </Button>
          )}
          {onDelete && (
            <Button variant="destructive" size="sm" onClick={onDelete}>
              <Trash className="h-4 w-4" />
            </Button>
          )}
        </div>
      )}
    </div>
  );
}
```

##### ç§»åŠ¨ç«¯å¯¼èˆª
```typescript
// åº•éƒ¨å¯¼èˆªç»„ä»¶
const navigationItems = [
  { name: 'é¦–é¡µ', href: '/m/', icon: Home },
  { name: 'é¡¹ç›®', href: '/m/projects', icon: BarChart3 },
  { name: 'å½•å…¥', href: '/m/business-entry', icon: Plus },
  { name: 'åˆåŒ', href: '/m/contracts', icon: FileText },
  { name: 'æˆ‘çš„', href: '/m/profile', icon: User },
];

export function BottomNavigation() {
  const location = useLocation();
  
  return (
    <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50">
      <div className="flex items-center justify-around py-2">
        {navigationItems.map((item) => {
          const isActive = location.pathname === item.href;
          return (
            <Link
              key={item.name}
              to={item.href}
              className={`flex flex-col items-center py-2 px-3 rounded-lg transition-colors ${
                isActive 
                  ? 'text-blue-600 bg-blue-50' 
                  : 'text-gray-600 hover:text-gray-900'
              }`}
            >
              <item.icon className="h-5 w-5 mb-1" />
              <span className="text-xs font-medium">{item.name}</span>
            </Link>
          );
        })}
      </div>
    </nav>
  );
}
```

### ğŸ¨ ç§»åŠ¨ç«¯UIä¼˜åŒ–

#### 1. ç°ä»£åŒ–è§†è§‰è®¾è®¡
```css
/* æ¸å˜è‰²å½©ç³»ç»Ÿ */
.gradient-blue {
  background: linear-gradient(135deg, #3B82F6 0%, #8B5CF6 100%);
}

.gradient-green {
  background: linear-gradient(135deg, #10B981 0%, #059669 100%);
}

.gradient-orange {
  background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
}

/* é˜´å½±å±‚æ¬¡ */
.shadow-soft {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.shadow-medium {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.shadow-strong {
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
}

/* æ¯›ç»ç’ƒæ•ˆæœ */
.backdrop-blur-soft {
  backdrop-filter: blur(8px);
  background: rgba(255, 255, 255, 0.8);
}
```

#### 2. åŠ¨ç”»å’Œäº¤äº’
```css
/* å¹³æ»‘è¿‡æ¸¡ */
.transition-smooth {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ç‚¹å‡»åé¦ˆ */
.tap-highlight {
  -webkit-tap-highlight-color: rgba(59, 130, 246, 0.1);
}

/* åŠ è½½åŠ¨ç”» */
@keyframes pulse-soft {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

.animate-pulse-soft {
  animation: pulse-soft 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}
```

---

## APIæ¥å£æ–‡æ¡£

### ğŸ“¡ RESTful API ç«¯ç‚¹

#### 1. é¡¹ç›®ç®¡ç†API
```typescript
// GET /rest/v1/projects - è·å–é¡¹ç›®åˆ—è¡¨
interface GetProjectsResponse {
  data: Project[];
  count: number;
}

// POST /rest/v1/projects - åˆ›å»ºé¡¹ç›®
interface CreateProjectRequest {
  name: string;
  manager: string;
  start_date: string;
  end_date: string;
  loading_address: string;
  unloading_address: string;
  planned_total_tons: number;
  billing_type_id: number;
}

// PUT /rest/v1/projects/:id - æ›´æ–°é¡¹ç›®
interface UpdateProjectRequest extends Partial<CreateProjectRequest> {}

// DELETE /rest/v1/projects/:id - åˆ é™¤é¡¹ç›®
```

#### 2. ç‰©æµè®°å½•API
```typescript
// GET /rest/v1/logistics_records - è·å–ç‰©æµè®°å½•
interface GetLogisticsRecordsParams {
  project_id?: string;
  driver_name?: string;
  start_date?: string;
  end_date?: string;
  limit?: number;
  offset?: number;
}

// POST /rest/v1/logistics_records - åˆ›å»ºç‰©æµè®°å½•
interface CreateLogisticsRecordRequest {
  project_id: string;
  driver_name: string;
  license_plate: string;
  loading_date: string;
  loading_location: string;
  unloading_location: string;
  loading_weight: number;
  transport_type: string;
  // ... å…¶ä»–å­—æ®µ
}
```

### ğŸ”§ RPCå‡½æ•°è°ƒç”¨

#### 1. ç»Ÿè®¡æ•°æ®RPC
```typescript
// è°ƒç”¨ä»ªè¡¨ç›˜ç»Ÿè®¡
const { data, error } = await supabase.rpc('get_dashboard_stats_with_billing_types', {
  p_start_date: '2024-01-01',
  p_end_date: '2024-12-31',
  p_project_id: null
});

// è¿”å›æ•°æ®ç»“æ„
interface DashboardStats {
  overview: {
    totalRecords: number;
    totalWeight: number;
    totalCost: number;
    actualTransportCount: number;
    returnCount: number;
  };
  dailyTransportStats: Array<{
    date: string;
    actualTransport: number;
    returns: number;
  }>;
  dailyCostStats: Array<{
    date: string;
    totalCost: number;
  }>;
}
```

#### 2. æ‰¹é‡æ“ä½œRPC
```typescript
// æ‰¹é‡å¯¼å…¥ç‰©æµè®°å½•
const { data, error } = await supabase.rpc('batch_import_logistics_records', {
  p_records: [
    {
      project_name: "é¡¹ç›®A",
      driver_name: "å¼ ä¸‰",
      license_plate: "äº¬A12345",
      loading_date: "2024-01-15",
      loading_weight: 45.5,
      // ... å…¶ä»–å­—æ®µ
    }
    // ... æ›´å¤šè®°å½•
  ]
});

// è¿”å›ç»“æœ
interface BatchImportResult {
  success_count: number;
  error_count: number;
  errors: Array<{
    row: number;
    message: string;
  }>;
  created_records: string[]; // åˆ›å»ºçš„è®°å½•IDåˆ—è¡¨
}
```

### ğŸ”’ APIå®‰å…¨

#### 1. JWT TokenéªŒè¯
```typescript
// è¯·æ±‚å¤´è®¾ç½®
const headers = {
  'Authorization': `Bearer ${session.access_token}`,
  'apikey': process.env.SUPABASE_ANON_KEY,
  'Content-Type': 'application/json'
};
```

#### 2. RLSç­–ç•¥åº”ç”¨
```sql
-- APIè¯·æ±‚è‡ªåŠ¨åº”ç”¨RLSç­–ç•¥
-- ç”¨æˆ·åªèƒ½è®¿é—®æœ‰æƒé™çš„æ•°æ®
-- æ— éœ€åœ¨åº”ç”¨å±‚é¢å¤–æ£€æŸ¥æƒé™
```

---

## éƒ¨ç½²å’Œç»´æŠ¤

### ğŸš€ éƒ¨ç½²æ¶æ„

#### 1. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```yaml
# docker-compose.yml
version: '3.8'
services:
  frontend:
    image: shipment-tracker:latest
    ports:
      - "80:80"
      - "443:443"
    environment:
      - VITE_SUPABASE_URL=${SUPABASE_URL}
      - VITE_SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/ssl
    restart: unless-stopped

  # Supabase æ‰˜ç®¡æœåŠ¡
  # æ•°æ®åº“ã€APIã€è®¤è¯ç”± Supabase æä¾›
```

#### 2. CI/CD æµç¨‹
```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Run tests
        run: npm test
        
      - name: Build application
        run: npm run build
        env:
          VITE_SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          VITE_SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
          
      - name: Deploy to server
        run: |
          # éƒ¨ç½²åˆ°æœåŠ¡å™¨çš„è„šæœ¬
          rsync -avz dist/ user@server:/var/www/html/
```

### ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

#### 1. åº”ç”¨ç›‘æ§
```typescript
// æ€§èƒ½ç›‘æ§
export function usePerformanceMonitor() {
  useEffect(() => {
    // é¡µé¢åŠ è½½æ—¶é—´ç›‘æ§
    const navigationEntries = performance.getEntriesByType('navigation');
    if (navigationEntries.length > 0) {
      const loadTime = navigationEntries[0].loadEventEnd - navigationEntries[0].loadEventStart;
      console.log(`Page load time: ${loadTime}ms`);
    }
    
    // é”™è¯¯ç›‘æ§
    window.addEventListener('error', (event) => {
      console.error('Global error:', event.error);
      // å‘é€é”™è¯¯åˆ°ç›‘æ§æœåŠ¡
    });
    
    // æœªå¤„ç†çš„Promiseæ‹’ç»
    window.addEventListener('unhandledrejection', (event) => {
      console.error('Unhandled promise rejection:', event.reason);
    });
  }, []);
}
```

#### 2. æ•°æ®åº“ç›‘æ§
```sql
-- æ…¢æŸ¥è¯¢ç›‘æ§
SELECT query, mean_exec_time, calls, total_exec_time
FROM pg_stat_statements 
WHERE mean_exec_time > 1000 
ORDER BY mean_exec_time DESC;

-- è¿æ¥æ•°ç›‘æ§
SELECT count(*) as connections, state 
FROM pg_stat_activity 
GROUP BY state;

-- è¡¨å¤§å°ç›‘æ§
SELECT 
  schemaname,
  tablename,
  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size
FROM pg_tables 
WHERE schemaname = 'public' 
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

### ğŸ”§ ç»´æŠ¤ä»»åŠ¡

#### 1. å®šæœŸå¤‡ä»½
```bash
#!/bin/bash
# backup.sh - æ•°æ®åº“å¤‡ä»½è„šæœ¬

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backups"
DB_NAME="postgres"

# åˆ›å»ºå¤‡ä»½
pg_dump -h db.supabase.co -U postgres -d $DB_NAME > $BACKUP_DIR/backup_$DATE.sql

# å‹ç¼©å¤‡ä»½æ–‡ä»¶
gzip $BACKUP_DIR/backup_$DATE.sql

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "backup_*.sql.gz" -mtime +7 -delete

echo "Backup completed: backup_$DATE.sql.gz"
```

#### 2. æ•°æ®æ¸…ç†
```sql
-- æ¸…ç†è¿‡æœŸçš„ä¼šè¯æ•°æ®
DELETE FROM auth.sessions 
WHERE expires_at < NOW() - INTERVAL '7 days';

-- æ¸…ç†è¿‡æœŸçš„æ—¥å¿—
DELETE FROM audit_logs 
WHERE created_at < NOW() - INTERVAL '90 days';

-- æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE;

-- é‡å»ºç´¢å¼•
REINDEX DATABASE postgres;
```

#### 3. æ€§èƒ½ä¼˜åŒ–
```sql
-- æ·»åŠ ç¼ºå¤±çš„ç´¢å¼•
CREATE INDEX CONCURRENTLY idx_logistics_records_loading_date 
ON logistics_records(loading_date);

CREATE INDEX CONCURRENTLY idx_logistics_records_project_driver 
ON logistics_records(project_id, driver_name);

-- åˆ†åŒºå¤§è¡¨
CREATE TABLE logistics_records_2024 
PARTITION OF logistics_records 
FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');
```

---

## æ•…éšœæ’é™¤

### ğŸš¨ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### 1. æ•°æ®åº“è¿æ¥é—®é¢˜
```typescript
// è¿æ¥æ± é…ç½®
const supabase = createClient(supabaseUrl, supabaseKey, {
  db: {
    schema: 'public',
  },
  auth: {
    autoRefreshToken: true,
    persistSession: true,
    detectSessionInUrl: true
  },
  realtime: {
    params: {
      eventsPerSecond: 10
    }
  }
});

// è¿æ¥é”™è¯¯å¤„ç†
supabase.auth.onAuthStateChange((event, session) => {
  if (event === 'SIGNED_OUT' || event === 'TOKEN_REFRESHED') {
    // é‡æ–°åˆå§‹åŒ–è¿æ¥
    window.location.reload();
  }
});
```

#### 2. æƒé™é—®é¢˜æ’æŸ¥
```sql
-- æ£€æŸ¥ç”¨æˆ·æƒé™
SELECT 
  up.full_name,
  up.role,
  perm.permission_type,
  perm.permission_name,
  perm.has_permission
FROM user_profiles up
LEFT JOIN user_permissions perm ON up.id = perm.user_id
WHERE up.id = 'user-uuid-here'
ORDER BY perm.permission_type, perm.permission_name;

-- æ£€æŸ¥RLSç­–ç•¥
SELECT schemaname, tablename, policyname, cmd, qual
FROM pg_policies 
WHERE schemaname = 'public';
```

#### 3. æ€§èƒ½é—®é¢˜è¯Šæ–­
```sql
-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT 
  query,
  calls,
  total_exec_time,
  mean_exec_time,
  stddev_exec_time,
  rows
FROM pg_stat_statements 
WHERE mean_exec_time > 100
ORDER BY mean_exec_time DESC
LIMIT 10;

-- æŸ¥çœ‹è¡¨ç»Ÿè®¡ä¿¡æ¯
SELECT 
  schemaname,
  tablename,
  n_tup_ins as inserts,
  n_tup_upd as updates,
  n_tup_del as deletes,
  n_live_tup as live_rows,
  n_dead_tup as dead_rows
FROM pg_stat_user_tables 
ORDER BY n_live_tup DESC;
```

#### 4. å‰ç«¯é”™è¯¯å¤„ç†
```typescript
// å…¨å±€é”™è¯¯è¾¹ç•Œ
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  componentDidCatch(error, errorInfo) {
    console.error('Error caught by boundary:', error, errorInfo);
    // å‘é€é”™è¯¯åˆ°ç›‘æ§æœåŠ¡
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="min-h-screen flex items-center justify-center">
          <div className="text-center">
            <h2 className="text-2xl font-bold text-red-600 mb-4">å‡ºç°é”™è¯¯</h2>
            <p className="text-gray-600 mb-4">åº”ç”¨ç¨‹åºé‡åˆ°äº†ä¸€ä¸ªé”™è¯¯</p>
            <Button onClick={() => window.location.reload()}>
              åˆ·æ–°é¡µé¢
            </Button>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}
```

### ğŸ” è°ƒè¯•å·¥å…·

#### 1. å¼€å‘ç¯å¢ƒè°ƒè¯•
```typescript
// React Query Devtools
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';

function App() {
  return (
    <>
      <Router>
        {/* åº”ç”¨å†…å®¹ */}
      </Router>
      {process.env.NODE_ENV === 'development' && <ReactQueryDevtools />}
    </>
  );
}

// Supabase è°ƒè¯•
if (process.env.NODE_ENV === 'development') {
  supabase.auth.onAuthStateChange((event, session) => {
    console.log('Auth event:', event, session);
  });
}
```

#### 2. ç”Ÿäº§ç¯å¢ƒç›‘æ§
```typescript
// é”™è¯¯æ”¶é›†
function setupErrorTracking() {
  // æ•è·æœªå¤„ç†çš„é”™è¯¯
  window.addEventListener('error', (event) => {
    sendErrorToService({
      message: event.message,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
      stack: event.error?.stack,
      timestamp: new Date().toISOString(),
      userAgent: navigator.userAgent,
      url: window.location.href
    });
  });

  // æ•è·Promiseæ‹’ç»
  window.addEventListener('unhandledrejection', (event) => {
    sendErrorToService({
      message: 'Unhandled Promise Rejection',
      reason: event.reason,
      timestamp: new Date().toISOString(),
      url: window.location.href
    });
  });
}
```

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### Version 2.0.0 (2024-01-15)
- âœ… é‡æ–°è®¾è®¡ç§»åŠ¨ç«¯é¦–é¡µå’Œé¡¹ç›®çœ‹æ¿
- âœ… ç»Ÿä¸€è·¯ç”±æ ¼å¼ä¸º `/m/projects/detail/:id`
- âœ… ä¿®å¤ `toLocaleString` ç©ºå€¼å¤„ç†é—®é¢˜
- âœ… ç§»æ¤æ¡Œé¢ç«¯å›¾è¡¨é€»è¾‘åˆ°ç§»åŠ¨ç«¯
- âœ… å®Œå–„åˆåŒç®¡ç†åŠŸèƒ½æ¨¡å—
- âœ… ä¼˜åŒ–æƒé™ç®¡ç†ç³»ç»Ÿ

### Version 1.9.0 (2024-01-10)
- âœ… å®ç°Excelå¯¼å…¥é€‰æ‹©æ€§æ›´æ–°åŠŸèƒ½
- âœ… ä¿®å¤è¿å•ç»´æŠ¤é¡µé¢é”™è¯¯
- âœ… ä¼˜åŒ–æ•°æ®åº“å‡½æ•°å’Œè§¦å‘å™¨
- âœ… å®Œå–„ç§»åŠ¨ç«¯ç”¨æˆ·ä½“éªŒ

### Version 1.8.0 (2024-01-05)
- âœ… æ·»åŠ åˆåŒç®¡ç†æ¨¡å—
- âœ… å®ç°å·¥ä½œæµç®¡ç†åŸºç¡€æ¶æ„
- âœ… ä¼˜åŒ–ç§»åŠ¨ç«¯å“åº”å¼è®¾è®¡
- âœ… å¢å¼ºæ•°æ®å®‰å…¨ç­–ç•¥

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è”ç³»ä¿¡æ¯
- æŠ€æœ¯è´Ÿè´£äºº: [æŠ€æœ¯å›¢é˜Ÿ]
- é‚®ç®±: tech@company.com
- æ–‡æ¡£æ›´æ–°: 2024å¹´1æœˆ15æ—¥

### ç›¸å…³èµ„æº
- [Supabase å®˜æ–¹æ–‡æ¡£](https://supabase.io/docs)
- [React å®˜æ–¹æ–‡æ¡£](https://react.dev)
- [Tailwind CSS æ–‡æ¡£](https://tailwindcss.com/docs)
- [shadcn/ui ç»„ä»¶åº“](https://ui.shadcn.com)

---

*æœ¬æ–‡æ¡£ç”±ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼ŒåŒ…å«äº†æˆªè‡³2024å¹´1æœˆ15æ—¥çš„å®Œæ•´ç³»ç»Ÿä¿¡æ¯ã€‚*
