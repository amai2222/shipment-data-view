# 司机自动关联项目功能使用说明

## 功能概述

在司机与车辆管理页面新增了**批量自动关联项目**功能，可以根据司机在运单记录中的参与情况，自动将司机与相关项目进行关联。此功能与现有的单个司机编辑功能完全兼容。

## 功能特点

### 1. 智能匹配逻辑
系统通过以下方式查找司机对应的项目：
- **司机姓名匹配**：运单记录中的司机姓名与司机档案中的姓名匹配
- **车牌号匹配**：运单记录中的车牌号与司机档案中的车牌号匹配  
- **司机电话匹配**：运单记录中的司机电话与司机档案中的电话匹配

### 2. 批量操作支持
- **单个选择**：点击每行前面的复选框选择单个司机
- **全选功能**：点击表头复选框选择当前页所有司机
- **跨页选择**：支持在不同页面间选择司机
- **选择当前页**：一键选择当前页面显示的所有司机

### 3. 预览功能
在执行关联前，系统会显示详细的预览信息：
- **关联汇总**：总司机数、找到项目的司机数、未找到项目的司机数、总运单记录数
- **司机详情**：每个司机的姓名、车牌号、运单记录数、找到的项目列表

### 4. 与现有功能兼容
- 使用相同的`driver_projects`关联表
- 与单个司机编辑功能完全兼容
- 支持现有的项目筛选功能

## 使用步骤

### 步骤1：选择司机
1. 进入**司机与车辆管理**页面
2. 使用以下方式选择要关联的司机：
   - 点击单个司机行的复选框
   - 点击表头复选框选择当前页所有司机
   - 使用"选择当前页"按钮

### 步骤2：预览关联
1. 选择司机后，页面底部会显示批量操作区域
2. 点击**"预览自动关联项目"**按钮
3. 系统会显示预览对话框，包含：
   - 关联汇总统计
   - 每个司机的详细信息和找到的项目

### 步骤3：确认执行
1. 在预览对话框中查看关联结果
2. 确认无误后点击**"确认关联"**按钮
3. 系统会执行自动关联操作
4. 完成后显示成功消息并刷新数据

## 界面说明

### 批量操作区域
当选择了司机后，页面底部会显示批量操作区域：
- **已选择数量**：显示当前选择的司机数量
- **选择当前页**：一键选择当前页所有司机
- **取消选择**：清空所有选择
- **预览自动关联项目**：执行预览操作

### 预览对话框
- **关联汇总**：显示统计信息
- **司机详情**：列出每个司机的匹配结果
- **操作按钮**：取消或确认关联

## 注意事项

### 1. 匹配规则
- 系统会查找运单记录中与司机档案匹配的所有记录
- 匹配条件包括姓名、车牌号、电话（任一匹配即可）
- 只有找到运单记录的司机才会被关联到项目

### 2. 数据安全
- 预览功能确保在关联前可以查看结果
- 关联操作会更新司机的项目关联信息
- 不会删除或修改运单记录

### 3. 性能考虑
- 大量司机关联时可能需要较长时间
- 建议分批处理大量数据
- 系统会显示处理进度

### 4. 兼容性
- 与现有单个司机编辑功能完全兼容
- 使用相同的数据存储方式
- 支持现有的项目筛选和显示功能

## 技术实现

### 数据库函数
- `find_driver_projects()`: 查找司机对应的项目
- `preview_driver_project_association()`: 预览关联结果
- `batch_associate_driver_projects()`: 批量执行关联
- `get_drivers_paginated()`: 司机分页查询（包含项目关联）

### 前端功能
- 批量选择界面
- 预览对话框
- 进度提示和错误处理

### 数据存储
- 使用`driver_projects`关联表存储司机与项目的关系
- 与现有单个司机编辑功能使用相同的数据结构

## 使用场景

1. **新司机导入**：批量导入司机后，自动关联其参与的项目
2. **数据整理**：定期整理司机项目关联关系
3. **项目变更**：项目调整后重新关联相关司机
4. **数据修复**：修复司机项目关联缺失的问题

## 故障排除

### 常见问题
1. **找不到项目**：检查运单记录中是否有该司机的记录
2. **匹配失败**：确认司机档案与运单记录中的信息一致
3. **关联失败**：检查数据库连接和权限设置

### 联系支持
如遇到问题，请联系系统管理员或技术支持团队。
