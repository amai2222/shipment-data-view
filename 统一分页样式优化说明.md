# 统一分页样式优化说明

## 优化目标

将付款申请、开票申请、财务开票三个页面的分页样式统一为开票审核页面的样式。

## 当前状态分析

### 1. 财务开票页面（InvoiceRequestManagement.tsx）
**状态**: ✅ 已完成
- 已添加与开票审核相同的分页样式
- 使用统一的分页组件
- 样式：每页显示 20 条 上一页 第 1 页,共1页 下一页

### 2. 开票审核页面（InvoiceAudit.tsx）
**状态**: ✅ 参考标准
- 标准分页样式
- 包含：每页条数选择器 + 上一页/下一页按钮 + 页码输入框

### 3. 付款申请页面（PaymentRequest.tsx）
**状态**: ⚠️ 需要修改
- 当前使用 Pagination 组件（数字页码按钮）
- 需要改为统一的分页样式

### 4. 开票申请页面（InvoiceRequest.tsx）
**状态**: ⚠️ 需要修改
- 当前使用 Pagination 组件（数字页码按钮）
- 需要改为统一的分页样式

---

## 标准分页样式

### UI布局

```
┌──────────────────────────────────────────────────────────────┐
│ 每页显示 [20▼] 条  [上一页]  第 [1] 页,共3页  [下一页]     │
└──────────────────────────────────────────────────────────────┘
```

### HTML结构

```html
<div className="flex items-center justify-center gap-4 py-2">
  <!-- 每页显示下拉框 -->
  <div className="flex items-center gap-2">
    <span className="text-sm text-muted-foreground">每页显示</span>
    <select
      value={pageSize}
      onChange={(e) => handlePageSizeChange(parseInt(e.target.value))}
      className="px-2 py-1 border border-gray-300 rounded text-sm bg-white"
    >
      <option value={10}>10</option>
      <option value={20}>20</option>
      <option value={50}>50</option>
      <option value={100}>100</option>
    </select>
    <span className="text-sm text-muted-foreground">条</span>
  </div>

  <!-- 上一页按钮 -->
  <Button
    variant="outline"
    size="sm"
    onClick={() => handlePageChange(currentPage - 1)}
    disabled={currentPage <= 1}
    className="h-8 px-3"
  >
    上一页
  </Button>

  <!-- 页码输入框 -->
  <div className="flex items-center gap-2">
    <span className="text-sm text-muted-foreground">第</span>
    <Input
      type="number"
      value={currentPage}
      onChange={(e) => {
        const page = parseInt(e.target.value);
        if (page >= 1 && page <= totalPages) {
          handlePageChange(page);
        }
      }}
      className="w-12 h-8 text-center"
      min={1}
      max={totalPages}
    />
    <span className="text-sm text-muted-foreground">页,共{totalPages}页</span>
  </div>

  <!-- 下一页按钮 -->
  <Button
    variant="outline"
    size="sm"
    onClick={() => handlePageChange(currentPage + 1)}
    disabled={currentPage >= totalPages}
    className="h-8 px-3"
  >
    下一页
  </Button>
</div>
```

---

## 修改清单

### ✅ 已完成

1. **财务开票页面** (`src/pages/InvoiceRequestManagement.tsx`)
   - 添加分页状态管理
   - 实现分页组件
   - 连接后端分页参数

### ⏳ 待完成

2. **付款申请页面** (`src/pages/PaymentRequest.tsx`)
   - 替换 Pagination 组件为统一分页样式
   - 修改行号：868-900

3. **开票申请页面** (`src/pages/InvoiceRequest.tsx`)
   - 替换 Pagination 组件为统一分页样式
   - 位置：类似付款申请页面

---

## 修改方案

### 步骤1：删除旧的Pagination导入

**付款申请页面**:
```typescript
// 删除
import { Pagination, PaginationContent, PaginationItem, PaginationLink, PaginationNext, PaginationPrevious } from "@/components/ui/pagination";
```

### 步骤2：替换分页组件

**修改前（旧样式）**:
```tsx
<Pagination>
  <PaginationContent>
    <PaginationItem>
      <PaginationPrevious onClick={...} />
    </PaginationItem>
    <PaginationItem>
      <PaginationLink isActive>{currentPage}</PaginationLink>
    </PaginationItem>
    <PaginationItem>
      <span>/ {totalPages}</span>
    </PaginationItem>
    <PaginationItem>
      <PaginationNext onClick={...} />
    </PaginationItem>
  </PaginationContent>
</Pagination>
```

**修改后（新样式）**:
```tsx
{totalPages > 0 && (
  <div className="flex items-center justify-center gap-4 py-2">
    {/* 每页显示下拉框 */}
    <div className="flex items-center gap-2">
      <span className="text-sm text-muted-foreground">每页显示</span>
      <select
        value={pageSize}
        onChange={(e) => handlePageSizeChange(parseInt(e.target.value))}
        className="px-2 py-1 border border-gray-300 rounded text-sm bg-white"
      >
        <option value={10}>10</option>
        <option value={20}>20</option>
        <option value={50}>50</option>
        <option value={100}>100</option>
      </select>
      <span className="text-sm text-muted-foreground">条</span>
    </div>

    {/* 上一页按钮 */}
    <Button
      variant="outline"
      size="sm"
      onClick={() => handlePageChange(currentPage - 1)}
      disabled={currentPage <= 1}
      className="h-8 px-3"
    >
      上一页
    </Button>

    {/* 页码输入框 */}
    <div className="flex items-center gap-2">
      <span className="text-sm text-muted-foreground">第</span>
      <Input
        type="number"
        value={currentPage}
        onChange={(e) => {
          const page = parseInt(e.target.value);
          if (page >= 1 && page <= totalPages) {
            handlePageChange(page);
          }
        }}
        className="w-12 h-8 text-center"
        min={1}
        max={totalPages}
      />
      <span className="text-sm text-muted-foreground">页,共{totalPages}页</span>
    </div>

    {/* 下一页按钮 */}
    <Button
      variant="outline"
      size="sm"
      onClick={() => handlePageChange(currentPage + 1)}
      disabled={currentPage >= totalPages}
      className="h-8 px-3"
    >
      下一页
    </Button>
  </div>
)}
```

### 步骤3：添加必要的状态和函数

```typescript
// 分页状态
const [currentPage, setCurrentPage] = useState(1);
const [pageSize, setPageSize] = useState(50); // 或 20
const [totalPages, setTotalPages] = useState(0);

// 分页处理函数
const handlePageChange = (page: number) => {
  if (page >= 1 && page <= totalPages) {
    setCurrentPage(page);
  }
};

const handlePageSizeChange = (newSize: number) => {
  setPageSize(newSize);
  setCurrentPage(1);
};
```

---

## 样式对比

### 旧样式（Pagination组件）

```
┌────────────────────────────────────┐
│  [<] [1] [2] [3] ... [10] [>]     │
└────────────────────────────────────┘
```

**特点**:
- 显示多个页码按钮
- 占用空间较大
- 适合页数少的场景

### 新样式（统一分页）

```
┌──────────────────────────────────────────────────────────┐
│ 每页显示 [20▼] 条  [上一页]  第 [1] 页,共10页  [下一页] │
└──────────────────────────────────────────────────────────┘
```

**特点**:
- ✅ 更紧凑
- ✅ 可直接输入页码跳转
- ✅ 可调整每页显示数量
- ✅ 适合大数据量分页

---

## 优势分析

### 1. 一致性
- ✅ 所有财务相关页面使用相同的分页样式
- ✅ 用户体验统一
- ✅ 减少学习成本

### 2. 功能性
- ✅ 支持每页条数选择（10/20/50/100）
- ✅ 支持直接输入页码跳转
- ✅ 上一页/下一页快速导航
- ✅ 显示总页数和当前页码

### 3. 空间利用
- ✅ 占用空间更小
- ✅ 在大屏和小屏都显示良好
- ✅ 不会随着页数增加而变宽

---

## 页面对照表

| 页面 | 当前状态 | 分页样式 | 需要修改 |
|------|---------|---------|---------|
| 开票审核 | ✅ | 统一样式 | 否（参考标准） |
| 财务开票 | ✅ | 统一样式 | 否（已完成） |
| 付款申请 | ⚠️ | Pagination | 是 |
| 开票申请 | ⚠️ | Pagination | 是 |

---

## 实施步骤

### Phase 1: 财务开票页面 ✅
- [x] 添加分页状态
- [x] 添加分页处理函数
- [x] 实现统一分页组件
- [x] 连接后端分页参数
- [x] 测试分页功能

### Phase 2: 付款申请页面 ⏳
- [ ] 删除 Pagination 组件导入
- [ ] 添加 pageSize 状态管理
- [ ] 实现 handlePageSizeChange 函数
- [ ] 替换分页组件为统一样式
- [ ] 测试分页功能

### Phase 3: 开票申请页面 ⏳
- [ ] 删除 Pagination 组件导入
- [ ] 添加 pageSize 状态管理
- [ ] 实现 handlePageSizeChange 函数
- [ ] 替换分页组件为统一样式
- [ ] 测试分页功能

---

## 配置参数

### 每页显示选项

```typescript
<option value={10}>10</option>   // 少量数据查看
<option value={20}>20</option>   // 默认推荐
<option value={50}>50</option>   // 中等数据量
<option value={100}>100</option> // 大数据量浏览
```

### 建议默认值

| 页面 | 建议默认值 | 理由 |
|------|-----------|------|
| 财务开票 | 20 | 申请单数量中等 |
| 开票审核 | 20 | 申请单数量中等 |
| 付款申请 | 50 | 运单数量较多 |
| 开票申请 | 50 | 运单数量较多 |

---

## 技术要点

### 1. 状态管理
```typescript
const [currentPage, setCurrentPage] = useState(1);
const [pageSize, setPageSize] = useState(20);
const [totalPages, setTotalPages] = useState(0);
```

### 2. 页码计算
```typescript
// 后端分页参数
p_limit: pageSize,
p_offset: (currentPage - 1) * pageSize

// 计算总页数
setTotalPages(Math.ceil(totalCount / pageSize));
```

### 3. 页面切换
```typescript
const handlePageChange = (page: number) => {
  if (page >= 1 && page <= totalPages) {
    setCurrentPage(page);
  }
};
```

### 4. 每页条数切换
```typescript
const handlePageSizeChange = (newSize: number) => {
  setPageSize(newSize);
  setCurrentPage(1); // 重置到第一页
};
```

---

## 测试清单

### 财务开票页面（已完成）
- [x] 默认显示第1页，每页20条
- [x] 可以切换每页显示条数（10/20/50/100）
- [x] 切换每页条数后重置到第1页
- [x] 上一页按钮在第1页时禁用
- [x] 下一页按钮在最后一页时禁用
- [x] 可以在输入框直接输入页码跳转
- [x] 显示正确的总页数

### 付款申请页面（待测试）
- [ ] 分页组件显示正常
- [ ] 页码跳转功能正常
- [ ] 每页条数切换功能正常
- [ ] 数据加载正确

### 开票申请页面（待测试）
- [ ] 分页组件显示正常
- [ ] 页码跳转功能正常
- [ ] 每页条数切换功能正常
- [ ] 数据加载正确

---

## 注意事项

### 1. 后端分页支持
确保后端RPC函数支持 `p_limit` 和 `p_offset` 参数：
```sql
CREATE FUNCTION get_xxx_filtered(
  ...
  p_limit integer,
  p_offset integer
)
```

### 2. 总数返回
后端需要返回 `total_count` 字段：
```sql
SELECT 
  *,
  COUNT(*) OVER() as total_count
FROM xxx
```

### 3. 状态重置
筛选条件改变时，重置到第1页：
```typescript
useEffect(() => {
  setCurrentPage(1);
}, [filters]);
```

---

## 优化效果

### 用户体验
- ✅ 统一的交互方式
- ✅ 减少学习成本
- ✅ 更快的页面跳转
- ✅ 灵活的数据量控制

### 性能优化
- ✅ 后端分页减少数据传输
- ✅ 前端渲染更快
- ✅ 大数据量下性能更好

### 界面美观
- ✅ 简洁统一的设计
- ✅ 适配不同屏幕尺寸
- ✅ 与整体UI风格一致

---

**完成状态**:
- ✅ 财务开票: 已完成
- ⏳ 付款申请: 待实施
- ⏳ 开票申请: 待实施

**优化日期**: 2025-10-27  
**优先级**: 高

