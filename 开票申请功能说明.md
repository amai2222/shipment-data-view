# å¼€ç¥¨ç”³è¯·ç®¡ç†åŠŸèƒ½

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æ–°å¢å¼€ç¥¨ç”³è¯·ç®¡ç†åŠŸèƒ½ï¼Œå®ç°åŸºäºåˆä½œæ–¹æˆæœ¬è®°å½•çš„å¼€ç¥¨ç”³è¯·æµç¨‹ï¼Œä¸ç°æœ‰ `invoice_records` è¡¨å®Œç¾æ•´åˆã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹ç‚¹

- âœ… **æ“ä½œå¯¹è±¡**: åˆä½œæ–¹æˆæœ¬è®°å½• (`logistics_partner_costs`)
- âœ… **ç”³è¯·æµç¨‹**: ç”³è¯· â†’ å®¡æ‰¹ â†’ å®Œæˆå¼€ç¥¨
- âœ… **çŠ¶æ€ç®¡ç†**: åˆä½œæ–¹çº§åˆ«çš„ç²¾ç¡®çŠ¶æ€æ§åˆ¶
- âœ… **å‘åå…¼å®¹**: ä¿æŒç°æœ‰å¼€ç¥¨åŠŸèƒ½ä¸å˜
- âœ… **è‡ªåŠ¨æ•´åˆ**: å®Œæˆå¼€ç¥¨æ—¶è‡ªåŠ¨åˆ›å»º `invoice_records` è®°å½•

## ğŸš€ éƒ¨ç½²æ–¹å¼

### æ–¹å¼1ï¼šSupabase SQLç¼–è¾‘å™¨ï¼ˆæ¨èï¼‰
1. æ‰“å¼€ Supabase æ§åˆ¶å° â†’ SQL ç¼–è¾‘å™¨
2. å¤åˆ¶ `supabase_sql_commands.sql` æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹
3. ç²˜è´´åˆ° SQL ç¼–è¾‘å™¨ä¸­æ‰§è¡Œ

### æ–¹å¼2ï¼šSupabase CLI
```bash
supabase db push
```

## ğŸ—ƒï¸ æ•°æ®åº“å˜æ›´

### æ–°å¢è¡¨
- `invoice_requests` - å¼€ç¥¨ç”³è¯·è¡¨
- `invoice_request_details` - å¼€ç¥¨ç”³è¯·æ˜ç»†è¡¨

### æ–°å¢å­—æ®µ
- `logistics_partner_costs.invoice_status` - å¼€ç¥¨çŠ¶æ€
- `logistics_partner_costs.payment_status` - ä»˜æ¬¾çŠ¶æ€
- `logistics_partner_costs.invoice_request_id` - å…³è”ç”³è¯·ID
- ç›¸å…³æ—¶é—´æˆ³å­—æ®µ

### æ–°å¢å‡½æ•°
- `get_invoice_request_data()` - è·å–å¼€ç¥¨ç”³è¯·æ•°æ®
- `save_invoice_request()` - ä¿å­˜å¼€ç¥¨ç”³è¯·
- `approve_invoice_request()` - å®¡æ‰¹å¼€ç¥¨ç”³è¯·
- `complete_invoice_request()` - å®Œæˆå¼€ç¥¨
- `delete_invoice_request()` - åˆ é™¤å¼€ç¥¨ç”³è¯·

## ğŸ”„ ä¸šåŠ¡æµç¨‹

```
1. é€‰æ‹©åˆä½œæ–¹æˆæœ¬è®°å½• â†’ åˆ›å»ºå¼€ç¥¨ç”³è¯·
2. ç®¡ç†å‘˜å®¡æ‰¹ç”³è¯· â†’ æ‰¹å‡†/æ‹’ç»
3. è´¢åŠ¡å®Œæˆå¼€ç¥¨ â†’ è‡ªåŠ¨åˆ›å»º invoice_records è®°å½•
4. çŠ¶æ€åŒæ­¥æ›´æ–° â†’ å®Œæ•´çš„å®¡è®¡è½¨è¿¹
```

## ğŸ“± å‰ç«¯åŠŸèƒ½

- **é¡µé¢è·¯å¾„**: `/invoice-request`
- **æƒé™è¦æ±‚**: `admin`, `finance` è§’è‰²
- **ä¸»è¦åŠŸèƒ½**: 
  - åˆä½œæ–¹æˆæœ¬è®°å½•åˆ—è¡¨
  - æ‰¹é‡å¼€ç¥¨ç”³è¯·åˆ›å»º
  - å¼€ç¥¨ç”³è¯·é¢„è§ˆç¡®è®¤
  - è¯¦ç»†ä¿¡æ¯æŸ¥çœ‹

## ğŸ§ª éªŒè¯éƒ¨ç½²

æ‰§è¡Œä»¥ä¸‹SQLéªŒè¯éƒ¨ç½²ç»“æœï¼š

```sql
-- æ£€æŸ¥æ–°å­—æ®µ
SELECT column_name FROM information_schema.columns 
WHERE table_name = 'logistics_partner_costs' 
AND column_name IN ('invoice_status', 'payment_status');

-- æ£€æŸ¥æ–°è¡¨
SELECT table_name FROM information_schema.tables 
WHERE table_name IN ('invoice_requests', 'invoice_request_details');

-- æµ‹è¯•å‡½æ•°
SELECT generate_invoice_request_number();
```

## ğŸ‰ éƒ¨ç½²å®Œæˆ

éƒ¨ç½²æˆåŠŸåï¼Œå¼€ç¥¨ç”³è¯·ç®¡ç†åŠŸèƒ½å°†å®Œå…¨å¯ç”¨ï¼Œä¸ç°æœ‰ç³»ç»Ÿæ— ç¼æ•´åˆï¼
