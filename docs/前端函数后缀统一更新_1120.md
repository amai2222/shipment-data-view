# å‰ç«¯å‡½æ•°åç¼€ç»Ÿä¸€æ›´æ–° - _1120 ç‰ˆæœ¬

## ğŸ“‹ æ›´æ–°æ€»ç»“

æ‰€æœ‰ RPC å‡½æ•°è°ƒç”¨å·²ç»Ÿä¸€æ›´æ–°ä¸º `_1120` åç¼€ï¼ˆæˆ–ä» `_11xx` æ›´æ–°ä¸º `_1120`ï¼‰ã€‚

**æ›´æ–°æ—¥æœŸ**ï¼š2025-11-20  
**æ¶‰åŠæ–‡ä»¶æ•°é‡**ï¼š21 ä¸ªå‰ç«¯æ–‡ä»¶  
**æ¶‰åŠå‡½æ•°æ•°é‡**ï¼š15+ ä¸ª RPC å‡½æ•°

---

## âœ… å·²æ›´æ–°çš„å‰ç«¯æ–‡ä»¶åˆ—è¡¨

### 1. ä¸šåŠ¡å½•å…¥æ¨¡å—ï¼ˆ3 ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶è·¯å¾„ | æ›´æ–°çš„å‡½æ•° |
|---------|-----------|
| `src/pages/BusinessEntry/index.tsx` | `get_logistics_summary_and_records_enhanced_1115` â†’ `_1120` |
| `src/pages/BusinessEntry/hooks/useLogisticsData.ts` | `get_logistics_summary_and_records_enhanced_1116` â†’ `_1120` |
| `src/pages/BusinessEntry/hooks/useAllFilteredRecords.ts` | `get_all_filtered_record_ids_1116` â†’ `_1120` |

### 2. è´¢åŠ¡å¯¹è´¦æ¨¡å—ï¼ˆ1 ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶è·¯å¾„ | æ›´æ–°çš„å‡½æ•° |
|---------|-----------|
| `src/pages/FinanceReconciliation.tsx` | `get_finance_reconciliation_by_partner_1116` â†’ `_1120`<br>`auto_reconcile_by_waybill_1116` â†’ `_1120`<br>`batch_recalculate_by_filter_1116` â†’ `_1120`<br>`batch_recalculate_partner_costs` â†’ `_1120` |

### 3. ä»˜æ¬¾ç®¡ç†æ¨¡å—ï¼ˆ3 ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶è·¯å¾„ | æ›´æ–°çš„å‡½æ•° |
|---------|-----------|
| `src/pages/PaymentRequest.tsx` | `get_payment_request_data_1116` â†’ `_1120`<br>`get_filtered_unpaid_ids_1116` â†’ `_1120` |
| `src/pages/PaymentAudit.tsx` | `get_payment_requests_filtered_1116` â†’ `_1120` |
| `src/pages/PaymentRequestsList.tsx` | `get_payment_requests_filtered_1116` â†’ `_1120` |

### 4. å¼€ç¥¨ç®¡ç†æ¨¡å—ï¼ˆ3 ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶è·¯å¾„ | æ›´æ–°çš„å‡½æ•° |
|---------|-----------|
| `src/pages/InvoiceAudit.tsx` | `get_invoice_requests_filtered_1116` â†’ `_1120` |
| `src/pages/InvoiceRequestManagement.tsx` | `get_invoice_requests_filtered_1116` â†’ `_1120` |
| `src/pages/PaymentInvoice.tsx` | `get_invoice_requests_filtered_1116` â†’ `_1120`<br>`receive_invoice_payment_1114` â†’ `_1120`<br>`refund_invoice_receipt_1114` â†’ `_1120`<br>`reconcile_invoice_receipt_1114` â†’ `_1120`<br>`get_receipt_records_1114` â†’ `_1120` |

### 5. æ”¶æ¬¾æŠ¥è¡¨æ¨¡å—ï¼ˆ1 ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶è·¯å¾„ | æ›´æ–°çš„å‡½æ•° |
|---------|-----------|
| `src/pages/ReceiptReport.tsx` | `get_receipt_statistics_1114` â†’ `_1120`<br>`get_receipt_details_report_1114` â†’ `_1120` |

### 6. è´§ä¸»ä»ªè¡¨æ¿æ¨¡å—ï¼ˆ2 ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶è·¯å¾„ | æ›´æ–°çš„å‡½æ•° |
|---------|-----------|
| `src/pages/ShipperDashboard.tsx` | `get_shipper_dashboard_stats_1115` â†’ `_1120`<br>`get_subordinate_shippers_stats_1115` â†’ `_1120` |
| `src/pages/mobile/MobileShipperDashboard.tsx` | `get_shipper_dashboard_stats_1115` â†’ `_1120`<br>`get_subordinate_shippers_stats_1115` â†’ `_1120` |

### 7. ç§»åŠ¨ç«¯æ¨¡å—ï¼ˆ6 ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶è·¯å¾„ | æ›´æ–°çš„å‡½æ•° |
|---------|-----------|
| `src/pages/mobile/MobilePaymentRequestsList.tsx` | `get_payment_requests_filtered_1116` â†’ `_1120` |
| `src/pages/mobile/shipper/MobileShipperPendingPayments.tsx` | `get_invoice_requests_filtered_1114` â†’ `_1120` |
| `src/pages/mobile/shipper/MobileShipperWaybills.tsx` | `get_invoice_requests_filtered_1114` â†’ `_1120` |
| `src/pages/mobile/shipper/MobileShipperHome.tsx` | `get_invoice_requests_filtered_1114` â†’ `_1120` |
| `src/pages/mobile/shipper/MobileShipperSubmitReceipt.tsx` | `get_invoice_requests_filtered_1114` â†’ `_1120`<br>`receive_invoice_payment_1114` â†’ `_1120` |
| `src/components/mobile/ShipperMobileLayout.tsx` | `get_invoice_requests_filtered_1114` â†’ `_1120` |

---

## ğŸ“Š å‡½æ•°åç¼€æ›´æ–°å¯¹ç…§è¡¨

| æ—§å‡½æ•°å | æ–°å‡½æ•°å | è°ƒç”¨æ–‡ä»¶æ•° |
|---------|---------|-----------|
| `batch_recalculate_partner_costs` | `batch_recalculate_partner_costs_1120` | 1 |
| `batch_recalculate_by_filter_1116` | `batch_recalculate_by_filter_1120` | 1 |
| `get_finance_reconciliation_by_partner_1116` | `get_finance_reconciliation_by_partner_1120` | 1 |
| `auto_reconcile_by_waybill_1116` | `auto_reconcile_by_waybill_1120` | 1 |
| `get_payment_request_data_1116` | `get_payment_request_data_1120` | 1 |
| `get_filtered_unpaid_ids_1116` | `get_filtered_unpaid_ids_1120` | 1 |
| `get_logistics_summary_and_records_enhanced_1115` | `get_logistics_summary_and_records_enhanced_1120` | 1 |
| `get_logistics_summary_and_records_enhanced_1116` | `get_logistics_summary_and_records_enhanced_1120` | 1 |
| `get_all_filtered_record_ids_1116` | `get_all_filtered_record_ids_1120` | 1 |
| `get_payment_requests_filtered_1116` | `get_payment_requests_filtered_1120` | 3 |
| `get_invoice_requests_filtered_1116` | `get_invoice_requests_filtered_1120` | 3 |
| `get_invoice_requests_filtered_1114` | `get_invoice_requests_filtered_1120` | 6 |
| `receive_invoice_payment_1114` | `receive_invoice_payment_1120` | 2 |
| `refund_invoice_receipt_1114` | `refund_invoice_receipt_1120` | 1 |
| `reconcile_invoice_receipt_1114` | `reconcile_invoice_receipt_1120` | 1 |
| `get_receipt_records_1114` | `get_receipt_records_1120` | 1 |
| `get_receipt_statistics_1114` | `get_receipt_statistics_1120` | 1 |
| `get_receipt_details_report_1114` | `get_receipt_details_report_1120` | 1 |
| `get_shipper_dashboard_stats_1115` | `get_shipper_dashboard_stats_1120` | 2 |
| `get_subordinate_shippers_stats_1115` | `get_subordinate_shippers_stats_1120` | 2 |

---

## âš ï¸ é‡è¦æç¤º

### 1. æ•°æ®åº“å‡½æ•°å¿…é¡»å…ˆæ›´æ–°

**åœ¨å‰ç«¯ç”Ÿæ•ˆå‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œæ•°æ®åº“è¿ç§»æ–‡ä»¶ï¼**

å‰ç«¯è°ƒç”¨çš„æ‰€æœ‰ `_1120` å‡½æ•°éœ€è¦åœ¨æ•°æ®åº“ä¸­å­˜åœ¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š`function does not exist`

### 2. æ‰§è¡Œé¡ºåº

1. **å…ˆæ‰§è¡Œ**ï¼šæ‰€æœ‰ SQL è¿ç§»æ–‡ä»¶ï¼ˆå…± 5 ä¸ªï¼‰
2. **åæ›´æ–°**ï¼šå‰ç«¯ä»£ç ï¼ˆå·²å®Œæˆï¼‰

### 3. å‘åå…¼å®¹

- æ—§ç‰ˆæœ¬å‡½æ•°ï¼ˆ`_1115`, `_1116`, `_1114`ï¼‰ä»ç„¶å­˜åœ¨äºæ•°æ®åº“ä¸­
- å¯ä»¥é€æ­¥è¿ç§»ï¼Œä¸ä¼šå½±å“ç°æœ‰åŠŸèƒ½
- å»ºè®®æ‰€æœ‰ SQL æ–‡ä»¶æ‰§è¡Œå®Œæˆåå†éƒ¨ç½²å‰ç«¯

---

## âœ… éªŒè¯æ¸…å•

### æ•°æ®åº“éªŒè¯

```sql
-- æ£€æŸ¥æ‰€æœ‰ _1120 å‡½æ•°æ˜¯å¦å­˜åœ¨ï¼ˆåº”è¿”å› 20+ è¡Œï¼‰
SELECT proname 
FROM pg_proc 
WHERE proname LIKE '%1120%'
OR proname IN (
    'batch_recalculate_partner_costs_1120',
    'auto_recalc_on_payable_cost_change_1120'
)
ORDER BY proname;
```

### å‰ç«¯éªŒè¯

1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
2. è¿›å…¥å„ä¸ªæ¨¡å—é¡µé¢
3. æ£€æŸ¥æ˜¯å¦æœ‰ `function does not exist` é”™è¯¯
4. æµ‹è¯•é‡ç®—åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ

---

## ğŸ“ é‡åˆ°é—®é¢˜ï¼Ÿ

### å¸¸è§é”™è¯¯

**"function xxx_1120 does not exist"**
- è¯´æ˜æ•°æ®åº“å‡½æ•°æœªåˆ›å»º
- è¯·å…ˆæ‰§è¡Œæ‰€æœ‰ SQL è¿ç§»æ–‡ä»¶

**"function xxx_1116 does not exist"**
- è¯´æ˜å‰ç«¯æœªæ›´æ–°
- è¯·ç¡®ä¿å‰ç«¯ä»£ç å·²æ›´æ–°ä¸º `_1120` ç‰ˆæœ¬

---

**åˆ›å»ºæ—¥æœŸ**ï¼š2025-11-20  
**æœ€åæ›´æ–°**ï¼š2025-11-20  
**çŠ¶æ€**ï¼šâœ… å‰ç«¯æ›´æ–°å·²å®Œæˆ

