# 代码审核与检查规范

## 📋 审核检查清单

在提交代码前，必须完成以下检查：

### 1. 语法检查 ✅

#### 1.1 JavaScript/TypeScript 语法
- [ ] 所有括号正确匹配（`()`, `[]`, `{}`）
- [ ] 所有引号正确闭合（单引号或双引号）
- [ ] 所有语句以分号结尾（如需要）
- [ ] 没有未定义的变量
- [ ] 没有重复声明的变量

#### 1.2 JSX 语法
- [ ] 所有 JSX 标签正确闭合
- [ ] 所有属性值正确引号包裹
- [ ] 自闭合标签正确使用 `/`
- [ ] `className` 正确使用（不是 `class`）
- [ ] 条件渲染正确使用三元运算符或逻辑与

**示例：**
```tsx
// ✅ 正确
<div className="container">
  {isLoading ? <Loader /> : <Content />}
</div>

// ❌ 错误
<div class="container">  // 应该用 className
  {isLoading && <Loader />}  // 如果 Loader 可能返回 false，应该用三元运算符
</div>
```

---

### 2. TypeScript 类型检查 ⚠️

#### 2.1 导入导出类型
- [ ] 所有导入的模块存在
- [ ] 导入的成员确实从该模块导出
- [ ] 类型导入使用 `import type`
- [ ] 默认导出和命名导出正确使用

**常见错误：**

1. **React Hooks 导入**
```tsx
// ✅ 正确（现代 React，支持自动 JSX）
import { useState, useEffect, useCallback } from 'react';

// ⚠️ 旧写法（仍可使用，但不推荐）
import React, { useState, useEffect } from 'react';
```

2. **第三方库导入**
```tsx
// ✅ 正确 - 检查库的导出方式
import { Button } from '@/components/ui/button';
import { BarChart, Bar, XAxis, YAxis } from 'recharts';
import { DollarSign, TrendingUp } from 'lucide-react';

// ❌ 错误 - 如果库不支持命名导出
import Button from '@/components/ui/button'; // 如果组件是默认导出
```

3. **日期处理库**
```tsx
// ✅ 正确
import { format, subDays, startOfMonth } from 'date-fns';

// ❌ 错误 - 检查 date-fns 版本和方法名
import { formatDate } from 'date-fns'; // 方法可能不存在
```

#### 2.2 组件 Props 类型
- [ ] 所有组件 Props 有类型定义
- [ ] 必需和可选属性正确标记
- [ ] 使用扩展运算符时类型兼容

**示例：**
```tsx
// ✅ 正确
interface BadgeProps extends React.HTMLAttributes<HTMLDivElement> {
  variant?: 'default' | 'secondary' | 'outline';
  children?: React.ReactNode;
}

// ✅ 正确使用
<Badge variant="outline" className="custom-class">
  {content}
</Badge>
```

**重要：** `Badge` 组件继承自 `React.HTMLAttributes<HTMLDivElement>`，因此**支持所有标准 HTML div 属性，包括 `className`**。

#### 2.3 Recharts 组件类型
- [ ] Recharts 组件类型定义可能显示错误，但实际运行正常
- [ ] 这是 TypeScript 类型定义的已知问题
- [ ] 如果编译通过，可以忽略这些警告

**说明：**
```tsx
// ⚠️ TypeScript 可能显示类型错误，但代码实际可用
<BarChart data={data}>
  <XAxis dataKey="name" />  {/* 可能显示类型错误 */}
  <YAxis />
  <Bar dataKey="value" />
</BarChart>
```

**解决方案：**
- 确保 `@types/recharts` 已安装
- 如果类型定义过时，可以考虑添加类型断言
- 在实际项目中，这些组件都能正常工作

---

### 3. 导入导出检查 📦

#### 3.1 导入路径
- [ ] 使用正确的路径别名（`@/` 表示 `src/`）
- [ ] 相对路径正确（`../`, `./`）
- [ ] 第三方库路径正确（如 `lucide-react`）

**规范：**
```tsx
// ✅ 正确 - 使用路径别名
import { Button } from '@/components/ui/button';
import { useAuth } from '@/contexts/AuthContext';

// ✅ 正确 - 相对路径
import { ComponentA } from './ComponentA';
import { ComponentB } from '../common/ComponentB';

// ✅ 正确 - 第三方库
import { useState } from 'react';
import { DollarSign } from 'lucide-react';
```

#### 3.2 导出规范
- [ ] 默认导出：`export default function ComponentName() {}`
- [ ] 命名导出：`export function FunctionName() {}`
- [ ] 类型导出：`export interface InterfaceName {}` 或 `export type TypeName = {}`

**规范：**
```tsx
// ✅ 正确 - 页面组件使用默认导出
export default function ShipperDashboard() {
  return <div>...</div>;
}

// ✅ 正确 - 工具函数使用命名导出
export function formatCurrency(amount: number) {
  return `¥${amount.toLocaleString()}`;
}

// ✅ 正确 - 类型定义
export interface User {
  id: string;
  name: string;
}
```

#### 3.3 重复导入检查
- [ ] 同一个模块不重复导入
- [ ] 合并来自同一模块的导入

**示例：**
```tsx
// ❌ 错误 - 重复导入
import { useState } from 'react';
import { useEffect } from 'react';

// ✅ 正确 - 合并导入
import { useState, useEffect, useCallback } from 'react';
```

---

### 4. JSX 结构检查 🎨

#### 4.1 标签闭合
- [ ] 所有标签正确闭合
- [ ] 自闭合标签使用 `<Component />` 格式
- [ ] 嵌套结构正确

#### 4.2 属性使用
- [ ] 使用 `className` 而不是 `class`
- [ ] 使用 `htmlFor` 而不是 `for`
- [ ] 布尔属性正确使用（`disabled={true}` 或 `disabled`）
- [ ] 事件处理器正确绑定（`onClick={handleClick}`）

**示例：**
```tsx
// ✅ 正确
<button 
  className="btn" 
  disabled={isLoading}
  onClick={handleClick}
>
  提交
</button>

// ❌ 错误
<button class="btn" onClick={handleClick()}>提交</button>
```

#### 4.3 条件渲染
- [ ] 三元运算符正确使用
- [ ] 逻辑与（`&&`）仅用于简单条件
- [ ] 复杂条件使用完整的 if-else

**示例：**
```tsx
// ✅ 正确 - 简单条件
{isLoading && <Loader />}

// ✅ 正确 - 需要 else 分支
{isLoading ? <Loader /> : <Content />}

// ✅ 正确 - 复杂条件
{isLoading ? (
  <Loader />
) : hasError ? (
  <Error />
) : (
  <Content />
)}
```

---

### 5. 组件使用检查 🔧

#### 5.1 Badge 组件
- [ ] `Badge` 组件支持 `className` 属性
- [ ] 使用 `variant` 属性设置样式变体
- [ ] 可以在内部嵌套图标和文本

**正确用法：**
```tsx
// ✅ 正确 - className 是支持的
<Badge variant="outline" className="bg-blue-50 text-blue-700">
  <CheckCircle className="h-3 w-3 mr-1" />
  状态
</Badge>

// ✅ 正确 - 只使用 variant
<Badge variant="secondary">标签</Badge>

// ✅ 正确 - 组合使用
<Badge 
  variant="outline" 
  className="mt-2 bg-purple-50 text-purple-700 border-purple-200"
>
  <FileText className="h-3 w-3 mr-1" />
  待开票
</Badge>
```

**注意：** 虽然 TypeScript 可能显示 `className` 不支持的错误，但这是误报。`Badge` 组件继承自 `React.HTMLAttributes<HTMLDivElement>`，因此支持所有标准 HTML 属性。

#### 5.2 图标组件（lucide-react）
- [ ] 图标名称正确（检查 lucide-react 文档）
- [ ] 图标大小和颜色通过 className 设置
- [ ] 图标可以作为 Badge 的子元素

**常见图标：**
```tsx
// ✅ 正确
import { 
  DollarSign,      // 美元符号
  TrendingUp,      // 上升趋势
  AlertCircle,     // 警告圆圈
  CheckCircle,     // 对勾圆圈
  Clock,           // 时钟
  FileText,        // 文件文本
  Building2,       // 建筑物
  TreePine,        // 松树
  Package,         // 包裹
  Weight,          // 重量
  Briefcase,       // 公文包
  Users,           // 用户组
  Loader2,         // 加载器
  Download,        // 下载
  RefreshCw        // 刷新
} from 'lucide-react';
```

#### 5.3 Recharts 图表组件
- [ ] 图表数据格式正确
- [ ] 必需属性已设置（如 `dataKey`, `data`）
- [ ] 响应式容器正确包裹

**正确用法：**
```tsx
// ✅ 正确
<ResponsiveContainer width="100%" height="100%">
  <BarChart data={chartData}>
    <CartesianGrid strokeDasharray="3 3" />
    <XAxis dataKey="name" />
    <YAxis />
    <Tooltip />
    <Legend />
    <Bar dataKey="value" fill="#3b82f6" />
  </BarChart>
</ResponsiveContainer>
```

---

### 6. 常见错误与解决方案 🔍

#### 6.1 TypeScript 类型错误（误报）

**问题：** Lint 显示某些类型错误，但代码实际可用。

**常见情况：**
1. Recharts 组件类型定义问题
2. Badge className 类型检查误报
3. React Hooks 导入类型检查

**解决方案：**
1. 检查实际运行是否正常
2. 如果运行正常，可能是类型定义过时
3. 考虑更新 `@types/*` 包
4. 如果确认是误报，可以添加类型断言或忽略注释

#### 6.2 导入错误

**问题：** 模块找不到或成员不存在。

**检查步骤：**
1. 确认包已安装：`npm list <package-name>`
2. 检查包的正确导入方式（查看文档）
3. 检查路径是否正确
4. 检查是否有拼写错误

**示例：**
```tsx
// 错误：找不到模块
import { subDays } from 'date-fns';  // 检查 date-fns 版本和方法名

// 解决：查看 date-fns 文档，确认方法名和版本兼容性
```

#### 6.3 JSX 语法错误

**问题：** JSX 标签未闭合或属性错误。

**检查步骤：**
1. 检查所有标签是否闭合
2. 检查属性值是否正确引号包裹
3. 检查是否使用了 `className` 而不是 `class`
4. 检查条件渲染语法

---

### 7. 代码审核流程 📝

#### 7.1 提交前检查
1. ✅ 运行 `npm run lint` 检查语法
2. ✅ 运行 TypeScript 编译检查（如果有）
3. ✅ 手动检查导入导出
4. ✅ 检查 JSX 结构
5. ✅ 检查组件使用是否正确

#### 7.2 审核要点
1. **功能正确性**：代码是否实现了预期功能
2. **类型安全**：是否所有类型定义正确
3. **代码规范**：是否符合项目编码规范
4. **性能考虑**：是否有性能问题
5. **可维护性**：代码是否易于理解和维护

#### 7.3 审核清单模板

```markdown
## 代码审核清单

### 语法检查
- [ ] JavaScript/TypeScript 语法正确
- [ ] JSX 结构正确
- [ ] 所有标签正确闭合

### 类型检查
- [ ] 所有导入正确
- [ ] 所有类型定义正确
- [ ] Props 类型正确

### 导入导出
- [ ] 导入路径正确
- [ ] 导出方式正确
- [ ] 无重复导入

### 组件使用
- [ ] Badge 组件使用正确（支持 className）
- [ ] 图标组件名称正确
- [ ] 图表组件配置正确

### 功能检查
- [ ] 功能实现正确
- [ ] 边界情况处理
- [ ] 错误处理完善
```

---

### 8. 工具推荐 🛠️

#### 8.1 检查工具
- **ESLint**：JavaScript/TypeScript 代码检查
- **TypeScript Compiler**：类型检查
- **Prettier**：代码格式化（可选）

#### 8.2 使用方式
```bash
# 检查语法
npm run lint

# TypeScript 类型检查
npx tsc --noEmit

# 格式化代码（如果配置了 Prettier）
npm run format
```

---

## 📌 总结

1. **语法错误**必须修复
2. **类型错误**需要区分真错误和误报
3. **导入导出**必须正确
4. **JSX 结构**必须正确
5. **组件使用**需符合组件 API

记住：**Lint 错误 ≠ 运行错误**。某些 TypeScript 类型检查可能是误报，需要结合实际情况判断。

---

**最后更新：** 2025-01-XX  
**维护者：** 开发团队

