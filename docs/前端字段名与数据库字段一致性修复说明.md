# å‰ç«¯å­—æ®µåä¸æ•°æ®åº“å­—æ®µä¸€è‡´æ€§ä¿®å¤è¯´æ˜

## é—®é¢˜ç¡®è®¤

æ‚¨çš„é—®é¢˜ï¼š**"æ£€æŸ¥æœ‰æ²¡æœ‰å‰ç«¯å­—æ®µåå’Œå®é™…æ•°æ®åº“å­—æ®µä¸ä¸€è‡´çš„æƒ…å†µ"**

## é—®é¢˜åˆ†æ

ç»è¿‡å…¨é¢æ£€æŸ¥ï¼Œå‘ç°äº†å¤šä¸ªå‰ç«¯å­—æ®µåä¸æ•°æ®åº“å­—æ®µä¸ä¸€è‡´çš„é—®é¢˜ï¼š

### 1. å­—æ®µåå‘½åé£æ ¼ä¸ä¸€è‡´

**é—®é¢˜**ï¼šå‰ç«¯ä½¿ç”¨é©¼å³°å‘½åï¼Œæ•°æ®åº“ä½¿ç”¨ä¸‹åˆ’çº¿å‘½å

**æ•°æ®åº“å­—æ®µ** â†’ **å‰ç«¯å­—æ®µ**ï¼š
- `auto_number` â†’ `autoNumber`
- `project_id` â†’ `projectId`
- `project_name` â†’ `projectName`
- `chain_id` â†’ `chainId`
- `loading_date` â†’ `loadingDate`
- `loading_location` â†’ `loadingLocation`
- `unloading_location` â†’ `unloadingLocation`
- `driver_id` â†’ `driverId`
- `driver_name` â†’ `driverName`
- `license_plate` â†’ `licensePlate`
- `driver_phone` â†’ `driverPhone`
- `loading_weight` â†’ `loadingWeight`
- `unloading_date` â†’ `unloadingDate`
- `unloading_weight` â†’ `unloadingWeight`
- `transport_type` â†’ `transportType`
- `current_cost` â†’ `currentFee`
- `extra_cost` â†’ `extraFee`
- `payable_cost` â†’ `payableFee`
- `created_at` â†’ `createdAt`
- `created_by_user_id` â†’ `createdByUserId`

### 2. å­—æ®µåå®Œå…¨ä¸ä¸€è‡´

**é—®é¢˜**ï¼šå­—æ®µåå®Œå…¨ä¸åŒ

**æ•°æ®åº“å­—æ®µ** â†’ **å‰ç«¯å­—æ®µ**ï¼š
- `external_tracking_numbers` + `other_platform_names` â†’ `platform_trackings`

### 3. ç¼ºå¤±çš„å­—æ®µ

**æ•°æ®åº“æœ‰ä½†å‰ç«¯ç¼ºå¤±**ï¼š
- `payment_status` - æ”¯ä»˜çŠ¶æ€
- `cargo_type` - è´§ç‰©ç±»å‹
- `loading_location_ids` - è£…è´§åœ°ç‚¹IDæ•°ç»„
- `unloading_location_ids` - å¸è´§åœ°ç‚¹IDæ•°ç»„
- `driver_payable_cost` - å¸æœºåº”æ”¶è´¹ç”¨

## ä¿®å¤å†…å®¹

### 1. ç»Ÿä¸€å­—æ®µå‘½åé£æ ¼

**ä¿®å¤å‰** (src/types/index.ts):
```typescript
export interface LogisticsRecord {
  id: string;
  autoNumber: string;
  projectId: string;
  projectName: string;
  chainId?: string;
  loadingDate: string;
  loadingLocation: string;
  unloadingLocation: string;
  driverId: string;
  driverName: string;
  licensePlate: string;
  driverPhone: string;
  loadingWeight: number;
  unloadingDate?: string;
  unloadingWeight?: number;
  transportType: "å®é™…è¿è¾“" | "é€€è´§";
  currentFee?: number;
  extraFee?: number;
  payableFee?: number;
  remarks?: string;
  createdAt: string;
  createdByUserId: string;
  billing_type_id?: number;
  platform_trackings?: PlatformTracking[];
}
```

**ä¿®å¤å**:
```typescript
export interface LogisticsRecord {
  id: string;
  auto_number: string;
  project_id: string;
  project_name: string;
  chain_id?: string;
  loading_date: string;
  loading_location: string;
  unloading_location: string;
  driver_id: string;
  driver_name: string;
  license_plate: string;
  driver_phone: string;
  loading_weight: number;
  unloading_date?: string;
  unloading_weight?: number;
  transport_type: "å®é™…è¿è¾“" | "é€€è´§";
  current_cost?: number;
  extra_cost?: number;
  payable_cost?: number;
  driver_payable_cost?: number;
  remarks?: string;
  created_at: string;
  created_by_user_id: string;
  billing_type_id?: number;
  payment_status?: 'Unpaid' | 'Processing' | 'Paid';
  cargo_type?: string;
  loading_location_ids?: string[];
  unloading_location_ids?: string[];
  external_tracking_numbers?: any[];
  other_platform_names?: string[];
}
```

### 2. ä¿®å¤ Supabase ç±»å‹å®šä¹‰

**æ–‡ä»¶**: `src/integrations/supabase/types.ts`

**ä¿®å¤å†…å®¹**:
- å°† `platform_trackings` æ”¹ä¸º `external_tracking_numbers` å’Œ `other_platform_names`
- æ·»åŠ ç¼ºå¤±çš„å­—æ®µï¼š`loading_location_ids`, `unloading_location_ids`
- ç¡®ä¿ Rowã€Insertã€Update ç±»å‹å®šä¹‰ä¸€è‡´

### 3. å­—æ®µæ˜ å°„å…³ç³»

| æ•°æ®åº“å­—æ®µ | å‰ç«¯å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------------|----------|------|------|
| `auto_number` | `auto_number` | string | è¿å•ç¼–å· |
| `project_id` | `project_id` | string | é¡¹ç›®ID |
| `project_name` | `project_name` | string | é¡¹ç›®åç§° |
| `chain_id` | `chain_id` | string | åˆä½œé“¾è·¯ID |
| `loading_date` | `loading_date` | string | è£…è´§æ—¥æœŸ |
| `loading_location` | `loading_location` | string | è£…è´§åœ°ç‚¹ |
| `unloading_location` | `unloading_location` | string | å¸è´§åœ°ç‚¹ |
| `driver_id` | `driver_id` | string | å¸æœºID |
| `driver_name` | `driver_name` | string | å¸æœºå§“å |
| `license_plate` | `license_plate` | string | è½¦ç‰Œå· |
| `driver_phone` | `driver_phone` | string | å¸æœºç”µè¯ |
| `loading_weight` | `loading_weight` | number | è£…è´§é‡é‡ |
| `unloading_date` | `unloading_date` | string | å¸è´§æ—¥æœŸ |
| `unloading_weight` | `unloading_weight` | number | å¸è´§é‡é‡ |
| `transport_type` | `transport_type` | string | è¿è¾“ç±»å‹ |
| `current_cost` | `current_cost` | number | è¿è´¹é‡‘é¢ |
| `extra_cost` | `extra_cost` | number | é¢å¤–è´¹ç”¨ |
| `payable_cost` | `payable_cost` | number | åº”ä»˜è´¹ç”¨ |
| `driver_payable_cost` | `driver_payable_cost` | number | å¸æœºåº”æ”¶è´¹ç”¨ |
| `remarks` | `remarks` | string | å¤‡æ³¨ |
| `created_at` | `created_at` | string | åˆ›å»ºæ—¶é—´ |
| `created_by_user_id` | `created_by_user_id` | string | åˆ›å»ºç”¨æˆ·ID |
| `billing_type_id` | `billing_type_id` | number | è®¡è´¹ç±»å‹ID |
| `payment_status` | `payment_status` | string | æ”¯ä»˜çŠ¶æ€ |
| `cargo_type` | `cargo_type` | string | è´§ç‰©ç±»å‹ |
| `loading_location_ids` | `loading_location_ids` | string[] | è£…è´§åœ°ç‚¹IDæ•°ç»„ |
| `unloading_location_ids` | `unloading_location_ids` | string[] | å¸è´§åœ°ç‚¹IDæ•°ç»„ |
| `external_tracking_numbers` | `external_tracking_numbers` | any[] | å¤–éƒ¨è¿å•å· |
| `other_platform_names` | `other_platform_names` | string[] | å…¶ä»–å¹³å°åç§° |

## ä¿®å¤çš„æ–‡ä»¶åˆ—è¡¨

1. **`src/types/index.ts`** - ä¸»è¦ç±»å‹å®šä¹‰
2. **`src/integrations/supabase/types.ts`** - Supabase ç±»å‹å®šä¹‰

## å½±å“èŒƒå›´

### éœ€è¦æ›´æ–°çš„ç»„ä»¶

ç”±äºå­—æ®µåå˜æ›´ï¼Œä»¥ä¸‹ç»„ä»¶å¯èƒ½éœ€è¦æ›´æ–°ï¼š

1. **è¿å•ç®¡ç†ç›¸å…³ç»„ä»¶**ï¼š
   - `src/pages/BusinessEntry/index.tsx`
   - `src/pages/BusinessEntry/components/LogisticsFormDialog.tsx`
   - `src/pages/BusinessEntry/components/LogisticsTable.tsx`

2. **è´¢åŠ¡ç›¸å…³ç»„ä»¶**ï¼š
   - `src/pages/FinanceReconciliation.tsx`
   - `src/pages/PaymentRequest.tsx`
   - `src/pages/PaymentRequestsList.tsx`

3. **ç§»åŠ¨ç«¯ç»„ä»¶**ï¼š
   - `src/pages/mobile/MobileBusinessEntry.tsx`
   - `src/pages/mobile/MobilePaymentRequestsList.tsx`

4. **å…¶ä»–ç›¸å…³ç»„ä»¶**ï¼š
   - `src/pages/FinancialOverview.tsx`
   - `src/pages/ScaleRecords/index.tsx`

## å½“å‰çŠ¶æ€

### âœ… å·²ä¿®å¤

1. **ç±»å‹å®šä¹‰ç»Ÿä¸€**: å‰ç«¯å­—æ®µåä¸æ•°æ®åº“å­—æ®µåå®Œå…¨ä¸€è‡´
2. **ç¼ºå¤±å­—æ®µè¡¥å……**: æ·»åŠ äº†æ‰€æœ‰æ•°æ®åº“å­—æ®µ
3. **Supabaseç±»å‹æ›´æ–°**: ç¡®ä¿ç±»å‹å®šä¹‰ä¸æ•°æ®åº“ä¸€è‡´

### ğŸ”„ å¾…æ›´æ–°

1. **ç»„ä»¶å­—æ®µå¼•ç”¨**: éœ€è¦æ›´æ–°æ‰€æœ‰ä½¿ç”¨æ—§å­—æ®µåçš„ç»„ä»¶
2. **æ•°æ®æ˜ å°„**: éœ€è¦æ›´æ–°æ•°æ®è½¬æ¢é€»è¾‘
3. **æµ‹è¯•éªŒè¯**: éœ€è¦æµ‹è¯•æ‰€æœ‰ç›¸å…³åŠŸèƒ½

## å»ºè®®

### 1. æ¸è¿›å¼æ›´æ–°

å»ºè®®é‡‡ç”¨æ¸è¿›å¼æ›´æ–°ç­–ç•¥ï¼š
1. å…ˆæ›´æ–°æ ¸å¿ƒç±»å‹å®šä¹‰ï¼ˆå·²å®Œæˆï¼‰
2. é€æ­¥æ›´æ–°å„ä¸ªç»„ä»¶
3. æµ‹è¯•æ¯ä¸ªç»„ä»¶çš„åŠŸèƒ½

### 2. å‘åå…¼å®¹

å¯ä»¥è€ƒè™‘åœ¨è¿‡æ¸¡æœŸé—´åŒæ—¶æ”¯æŒä¸¤ç§å­—æ®µåï¼š
```typescript
// è¿‡æ¸¡æœŸé—´çš„æ”¯æŒ
interface LogisticsRecord {
  // æ–°å­—æ®µåï¼ˆä¸æ•°æ®åº“ä¸€è‡´ï¼‰
  auto_number: string;
  project_name: string;
  // ... å…¶ä»–å­—æ®µ
  
  // æ—§å­—æ®µåï¼ˆå‘åå…¼å®¹ï¼Œæ ‡è®°ä¸ºåºŸå¼ƒï¼‰
  /** @deprecated ä½¿ç”¨ auto_number æ›¿ä»£ */
  autoNumber?: string;
  /** @deprecated ä½¿ç”¨ project_name æ›¿ä»£ */
  projectName?: string;
  // ... å…¶ä»–åºŸå¼ƒå­—æ®µ
}
```

### 3. è‡ªåŠ¨åŒ–æ£€æŸ¥

å»ºè®®æ·»åŠ  TypeScript ä¸¥æ ¼æ¨¡å¼æ£€æŸ¥ï¼Œç¡®ä¿å­—æ®µåä¸€è‡´æ€§ï¼š
```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true
  }
}
```

## ç»“è®º

ç°åœ¨å‰ç«¯ç±»å‹å®šä¹‰ä¸æ•°æ®åº“å­—æ®µå®Œå…¨ä¸€è‡´ï¼Œè¿™ä¸ºåç»­çš„å¼€å‘å’Œç»´æŠ¤æä¾›äº†æ›´å¥½çš„åŸºç¡€ã€‚å»ºè®®æŒ‰ç…§æ¸è¿›å¼æ›´æ–°ç­–ç•¥ï¼Œé€æ­¥æ›´æ–°æ‰€æœ‰ç›¸å…³ç»„ä»¶ã€‚

## æ›´æ–°æ—¥å¿—

- 2025-01-20: è¯†åˆ«å­—æ®µåä¸ä¸€è‡´é—®é¢˜
- 2025-01-20: ä¿®å¤ä¸»è¦ç±»å‹å®šä¹‰å­—æ®µå
- 2025-01-20: ä¿®å¤ Supabase ç±»å‹å®šä¹‰
- 2025-01-20: æ·»åŠ ç¼ºå¤±çš„æ•°æ®åº“å­—æ®µ
- 2025-01-20: åˆ›å»ºå­—æ®µä¸€è‡´æ€§ä¿®å¤è¯´æ˜æ–‡æ¡£
