# è½¦è¾†ç…§ç‰‡å­—æ®µè®¾è®¡ - ä¸ƒç‰›äº‘å­˜å‚¨

## ğŸ“‹ å‚è€ƒï¼šdrivers è¡¨çš„ç…§ç‰‡å­—æ®µ

```sql
-- drivers è¡¨çš„ç…§ç‰‡å­—æ®µï¼ˆ5ä¸ª JSONB å­—æ®µï¼‰
id_card_photos jsonb DEFAULT '[]'::jsonb,                    -- èº«ä»½è¯
driver_license_photos jsonb DEFAULT '[]'::jsonb,             -- é©¾é©¶è¯
qualification_certificate_photos jsonb DEFAULT '[]'::jsonb,  -- ä»ä¸šèµ„æ ¼è¯
transport_license_photos jsonb DEFAULT '[]'::jsonb,          -- é“è·¯è¿è¾“è¯
driving_license_photos jsonb DEFAULT '[]'::jsonb,            -- è¡Œé©¶è¯
```

---

## ğŸš— è½¦è¾†ç…§ç‰‡å­—æ®µè®¾è®¡ï¼ˆinternal_vehicles è¡¨ï¼‰

### æ–¹æ¡ˆï¼šå®Œæ•´ç‰ˆï¼ˆæ¨èï¼‰

```sql
-- ========== è½¦è¾†è¯ä»¶ç…§ç‰‡ï¼ˆä¸ƒç‰›äº‘å­˜å‚¨ï¼ŒJSONB æ•°ç»„ï¼‰==========

-- 1. è¡Œé©¶è¯ï¼ˆå¿…éœ€ï¼‰
driving_license_photos JSONB DEFAULT '[]'::jsonb,
-- è¯´æ˜ï¼šè¡Œé©¶è¯æ­£å‰¯é¡µ
-- æœ€å¤§æ•°é‡ï¼š2å¼ 
-- ä¸ƒç‰›äº‘ç›®å½•ï¼šTruck/
-- å‘½åè§„åˆ™ï¼šè¡Œé©¶è¯-{è½¦ç‰Œå·}-{æ—¶é—´æˆ³}-{åºå·}.jpg
-- ç¤ºä¾‹URLï¼š["https://cdn.xxx.com/Truck/è¡Œé©¶è¯-äº‘F97310-1730880000000-1.jpg"]

-- 2. é“è·¯è¿è¾“è¯ï¼ˆå¿…éœ€ï¼‰
transport_license_photos JSONB DEFAULT '[]'::jsonb,
-- è¯´æ˜ï¼šé“è·¯è¿è¾“è¯
-- æœ€å¤§æ•°é‡ï¼š2å¼ 
-- ä¸ƒç‰›äº‘ç›®å½•ï¼šTruck/
-- å‘½åè§„åˆ™ï¼šè¿è¾“è¯-{è½¦ç‰Œå·}-{æ—¶é—´æˆ³}-{åºå·}.jpg

-- 3. è½¦è¾†å¤–è§‚ç…§ç‰‡ï¼ˆæ¨èï¼‰
vehicle_photos JSONB DEFAULT '[]'::jsonb,
-- è¯´æ˜ï¼šè½¦è¾†å¤–è§‚ç…§ç‰‡ï¼ˆå¤šè§’åº¦ï¼šå‰ã€åã€å·¦ã€å³ã€å†…éƒ¨ï¼‰
-- æœ€å¤§æ•°é‡ï¼š10å¼ 
-- ä¸ƒç‰›äº‘ç›®å½•ï¼šTruck/
-- å‘½åè§„åˆ™ï¼šè½¦è¾†-{è½¦ç‰Œå·}-{è§’åº¦}-{æ—¶é—´æˆ³}.jpg
-- è§’åº¦æ ‡è¯†ï¼šfront-å‰, back-å, left-å·¦, right-å³, interior-å†…éƒ¨

-- 4. ä¿é™©å•ç…§ç‰‡ï¼ˆæ¨èï¼‰
insurance_certificate_photos JSONB DEFAULT '[]'::jsonb,
-- è¯´æ˜ï¼šä¿é™©å•æ®ç…§ç‰‡
-- æœ€å¤§æ•°é‡ï¼š5å¼ 
-- ä¸ƒç‰›äº‘ç›®å½•ï¼šTruck/
-- å‘½åè§„åˆ™ï¼šä¿é™©-{è½¦ç‰Œå·}-{æ—¶é—´æˆ³}-{åºå·}.jpg

-- 5. å¹´æ£€æ ‡å¿—ç…§ç‰‡ï¼ˆå¯é€‰ï¼‰
annual_inspection_photos JSONB DEFAULT '[]'::jsonb,
-- è¯´æ˜ï¼šå¹´æ£€åˆæ ¼æ ‡å¿—
-- æœ€å¤§æ•°é‡ï¼š2å¼ 
-- ä¸ƒç‰›äº‘ç›®å½•ï¼šTruck/
-- å‘½åè§„åˆ™ï¼šå¹´æ£€-{è½¦ç‰Œå·}-{æ—¶é—´æˆ³}-{åºå·}.jpg

-- 6. ç»´ä¿®ä¿å…»ç…§ç‰‡ï¼ˆå¯é€‰ï¼‰
maintenance_photos JSONB DEFAULT '[]'::jsonb,
-- è¯´æ˜ï¼šç»´ä¿®ä¿å…»è®°å½•ç…§ç‰‡
-- æœ€å¤§æ•°é‡ï¼š20å¼ ï¼ˆå†å²è®°å½•ï¼‰
-- ä¸ƒç‰›äº‘ç›®å½•ï¼šTruck/
-- å‘½åè§„åˆ™ï¼šç»´ä¿®-{è½¦ç‰Œå·}-{æ—¥æœŸ}-{åºå·}.jpg

-- 7. è´­è½¦å‘ç¥¨ç…§ç‰‡ï¼ˆå¯é€‰ï¼‰
purchase_invoice_photos JSONB DEFAULT '[]'::jsonb,
-- è¯´æ˜ï¼šè´­è½¦å‘ç¥¨ã€åˆåŒç­‰
-- æœ€å¤§æ•°é‡ï¼š5å¼ 
-- ä¸ƒç‰›äº‘ç›®å½•ï¼šTruck/
-- å‘½åè§„åˆ™ï¼šè´­è½¦-{è½¦ç‰Œå·}-{æ—¶é—´æˆ³}-{åºå·}.jpg

-- 8. å…¶ä»–è¯ä»¶ç…§ç‰‡ï¼ˆå¯é€‰ï¼‰
other_certificate_photos JSONB DEFAULT '[]'::jsonb,
-- è¯´æ˜ï¼šå…¶ä»–ç›¸å…³è¯ä»¶ï¼ˆè¥è¿è¯ã€ç¯ä¿æ ‡å¿—ç­‰ï¼‰
-- æœ€å¤§æ•°é‡ï¼š10å¼ 
-- ä¸ƒç‰›äº‘ç›®å½•ï¼šTruck/
-- å‘½åè§„åˆ™ï¼šå…¶ä»–-{è½¦ç‰Œå·}-{è¯´æ˜}-{æ—¶é—´æˆ³}.jpg
```

---

## ğŸ¯ æ¨èå­—æ®µé…ç½®

### æ ¸å¿ƒå­—æ®µï¼ˆå¿…éœ€ï¼Œ4ä¸ªï¼‰

```sql
CREATE TABLE internal_vehicles (
    -- ... å…¶ä»–å­—æ®µ ...
    
    -- æ ¸å¿ƒè¯ä»¶ç…§ç‰‡ï¼ˆå¿…éœ€ï¼‰
    driving_license_photos JSONB DEFAULT '[]'::jsonb,          -- è¡Œé©¶è¯
    transport_license_photos JSONB DEFAULT '[]'::jsonb,        -- é“è·¯è¿è¾“è¯
    vehicle_photos JSONB DEFAULT '[]'::jsonb,                  -- è½¦è¾†å¤–è§‚
    insurance_certificate_photos JSONB DEFAULT '[]'::jsonb,    -- ä¿é™©å•
    
    -- ... å…¶ä»–å­—æ®µ ...
);
```

### æ‰©å±•å­—æ®µï¼ˆæ¨èï¼Œ+3ä¸ªï¼‰

```sql
    -- æ‰©å±•è¯ä»¶ç…§ç‰‡ï¼ˆæ¨èï¼‰
    annual_inspection_photos JSONB DEFAULT '[]'::jsonb,        -- å¹´æ£€æ ‡å¿—
    maintenance_photos JSONB DEFAULT '[]'::jsonb,              -- ç»´ä¿®è®°å½•
    purchase_invoice_photos JSONB DEFAULT '[]'::jsonb,         -- è´­è½¦å‘ç¥¨
```

### å®Œæ•´ç‰ˆï¼ˆå¯é€‰ï¼Œ+1ä¸ªï¼‰

```sql
    -- å…¶ä»–è¯ä»¶ï¼ˆå¯é€‰ï¼‰
    other_certificate_photos JSONB DEFAULT '[]'::jsonb,        -- å…¶ä»–è¯ä»¶
```

---

## ğŸ“¸ ç…§ç‰‡åˆ†ç±»ä¸è§„æ ¼

| è¯ä»¶ç±»å‹ | å­—æ®µå | æœ€å¤§æ•°é‡ | å¿…éœ€æ€§ | ç”¨é€” |
|---------|--------|---------|--------|------|
| è¡Œé©¶è¯ | driving_license_photos | 2å¼  | âœ… å¿…éœ€ | æ³•å®šè¯ä»¶ |
| é“è·¯è¿è¾“è¯ | transport_license_photos | 2å¼  | âœ… å¿…éœ€ | æ³•å®šè¯ä»¶ |
| è½¦è¾†å¤–è§‚ | vehicle_photos | 10å¼  | â­ æ¨è | è½¦è¾†è¯†åˆ« |
| ä¿é™©å• | insurance_certificate_photos | 5å¼  | â­ æ¨è | ä¿é™©å‡­è¯ |
| å¹´æ£€æ ‡å¿— | annual_inspection_photos | 2å¼  | âšª å¯é€‰ | å¹´æ£€è®°å½• |
| ç»´ä¿®è®°å½• | maintenance_photos | 20å¼  | âšª å¯é€‰ | ç»´ä¿å†å² |
| è´­è½¦å‘ç¥¨ | purchase_invoice_photos | 5å¼  | âšª å¯é€‰ | èµ„äº§å‡­è¯ |
| å…¶ä»–è¯ä»¶ | other_certificate_photos | 10å¼  | âšª å¯é€‰ | æ‰©å±•ä½¿ç”¨ |

---

## ğŸ”§ ä¸ƒç‰›äº‘ä¸Šä¼ é…ç½®

### ä¸Šä¼ ç›®å½•è§„åˆ™

```typescript
// å¸æœºè¯ä»¶ â†’ driver/ ç›®å½•
{
  projectName: 'driver',
  customName: `èº«ä»½è¯-${driverName}-${timestamp}-${åºå·}.jpg`
}

// è½¦è¾†è¯ä»¶ â†’ Truck/ ç›®å½•  
{
  projectName: 'Truck',
  customName: `è¡Œé©¶è¯-${licensePlate}-${timestamp}-${åºå·}.jpg`
}
```

### æ–‡ä»¶å‘½åè§„åˆ™

| ç…§ç‰‡ç±»å‹ | å‘½åæ ¼å¼ | ç¤ºä¾‹ |
|---------|---------|------|
| è¡Œé©¶è¯ | `è¡Œé©¶è¯-{è½¦ç‰Œ}-{æ—¶é—´æˆ³}-{åºå·}.jpg` | `è¡Œé©¶è¯-äº‘F97310-1730880000000-1.jpg` |
| è¿è¾“è¯ | `è¿è¾“è¯-{è½¦ç‰Œ}-{æ—¶é—´æˆ³}-{åºå·}.jpg` | `è¿è¾“è¯-äº‘F97310-1730880000000-1.jpg` |
| è½¦è¾†å¤–è§‚ | `è½¦è¾†-{è½¦ç‰Œ}-{è§’åº¦}-{æ—¶é—´æˆ³}.jpg` | `è½¦è¾†-äº‘F97310-å‰-1730880000000.jpg` |
| ä¿é™©å• | `ä¿é™©-{è½¦ç‰Œ}-{æ—¶é—´æˆ³}-{åºå·}.jpg` | `ä¿é™©-äº‘F97310-1730880000000-1.jpg` |
| å¹´æ£€ | `å¹´æ£€-{è½¦ç‰Œ}-{å¹´ä»½}-{åºå·}.jpg` | `å¹´æ£€-äº‘F97310-2025-1.jpg` |
| ç»´ä¿® | `ç»´ä¿®-{è½¦ç‰Œ}-{æ—¥æœŸ}-{åºå·}.jpg` | `ç»´ä¿®-äº‘F97310-20251101-1.jpg` |
| è´­è½¦ | `è´­è½¦-{è½¦ç‰Œ}-{æ—¶é—´æˆ³}-{åºå·}.jpg` | `è´­è½¦-äº‘F97310-1730880000000-1.jpg` |

---

## ğŸ’¾ æ•°æ®å­˜å‚¨ç¤ºä¾‹

```json
{
  "driving_license_photos": [
    "https://cdn.example.com/Truck/è¡Œé©¶è¯-äº‘F97310-1730880000000-1.jpg",
    "https://cdn.example.com/Truck/è¡Œé©¶è¯-äº‘F97310-1730880000000-2.jpg"
  ],
  "transport_license_photos": [
    "https://cdn.example.com/Truck/è¿è¾“è¯-äº‘F97310-1730880000000-1.jpg"
  ],
  "vehicle_photos": [
    "https://cdn.example.com/Truck/è½¦è¾†-äº‘F97310-front-1730880000000.jpg",
    "https://cdn.example.com/Truck/è½¦è¾†-äº‘F97310-back-1730880000000.jpg",
    "https://cdn.example.com/Truck/è½¦è¾†-äº‘F97310-left-1730880000000.jpg",
    "https://cdn.example.com/Truck/è½¦è¾†-äº‘F97310-right-1730880000000.jpg"
  ],
  "insurance_certificate_photos": [
    "https://cdn.example.com/Truck/ä¿é™©-äº‘F97310-1730880000000-1.jpg"
  ]
}
```

---

## ğŸ¨ å‰ç«¯ç»„ä»¶è§„åˆ’

### ç»„ä»¶1ï¼šVehicleCertificatePhotosï¼ˆè½¦è¾†è¯ä»¶ä¸Šä¼ ï¼‰

```typescript
// ç±»ä¼¼ VehiclePhotoUpload.tsx
interface VehicleCertificatePhotosProps {
  licensePlate: string;
  existingPhotos: {
    driving_license_photos: string[];
    transport_license_photos: string[];
    annual_inspection_photos: string[];
  };
  onChange: (photos: any) => void;
}

// è¯ä»¶ç±»å‹é…ç½®
const VEHICLE_CERTIFICATE_TYPES = {
  driving_license: {
    key: 'driving_license_photos',
    label: 'è¡Œé©¶è¯',
    maxCount: 2,
    color: 'blue'
  },
  transport_license: {
    key: 'transport_license_photos',
    label: 'é“è·¯è¿è¾“è¯',
    maxCount: 2,
    color: 'green'
  },
  annual_inspection: {
    key: 'annual_inspection_photos',
    label: 'å¹´æ£€æ ‡å¿—',
    maxCount: 2,
    color: 'purple'
  }
};
```

### ç»„ä»¶2ï¼šVehicleAppearancePhotosï¼ˆè½¦è¾†å¤–è§‚ç…§ç‰‡ï¼‰

```typescript
interface VehicleAppearancePhotosProps {
  licensePlate: string;
  existingPhotos: string[];
  onChange: (photos: string[]) => void;
}

// æ”¯æŒå¤šè§’åº¦æ‹æ‘„
const PHOTO_ANGLES = [
  { key: 'front', label: 'è½¦å¤´æ­£é¢' },
  { key: 'back', label: 'è½¦å°¾æ­£é¢' },
  { key: 'left', label: 'å·¦ä¾§é¢' },
  { key: 'right', label: 'å³ä¾§é¢' },
  { key: 'interior', label: 'è½¦å¢å†…éƒ¨' }
];
```

### ç»„ä»¶3ï¼šVehicleInsurancePhotosï¼ˆä¿é™©å•ç…§ç‰‡ï¼‰

```typescript
interface VehicleInsurancePhotosProps {
  licensePlate: string;
  existingPhotos: string[];
  onChange: (photos: string[]) => void;
}

// æœ€å¤š5å¼ ä¿é™©å•ç…§ç‰‡
```

---

## ğŸ“Š å®Œæ•´çš„ç…§ç‰‡å­—æ®µé…ç½®è¡¨

| å­—æ®µå | JSONBç±»å‹ | é»˜è®¤å€¼ | æœ€å¤§æ•°é‡ | ä¸ƒç‰›äº‘ç›®å½• | å‰ç«¯ç»„ä»¶ |
|--------|----------|--------|---------|-----------|---------|
| **æ ¸å¿ƒè¯ä»¶** ||||||
| `driving_license_photos` | JSONB | `'[]'::jsonb` | 2å¼  | `Truck/` | VehicleCertificatePhotos |
| `transport_license_photos` | JSONB | `'[]'::jsonb` | 2å¼  | `Truck/` | VehicleCertificatePhotos |
| **è½¦è¾†ç…§ç‰‡** ||||||
| `vehicle_photos` | JSONB | `'[]'::jsonb` | 10å¼  | `Truck/` | VehicleAppearancePhotos |
| **ä¿é™©å•æ®** ||||||
| `insurance_certificate_photos` | JSONB | `'[]'::jsonb` | 5å¼  | `Truck/` | VehicleInsurancePhotos |
| **æ‰©å±•è¯ä»¶ï¼ˆå¯é€‰ï¼‰** ||||||
| `annual_inspection_photos` | JSONB | `'[]'::jsonb` | 2å¼  | `Truck/` | VehicleCertificatePhotos |
| `maintenance_photos` | JSONB | `'[]'::jsonb` | 20å¼  | `Truck/` | VehicleMaintenancePhotos |
| `purchase_invoice_photos` | JSONB | `'[]'::jsonb` | 5å¼  | `Truck/` | VehiclePurchasePhotos |

---

## ğŸ”„ ä¸Šä¼ é€»è¾‘ï¼ˆå‚è€ƒ DriverPhotoUpload.tsxï¼‰

### ç¬¬1æ­¥ï¼šæ–‡ä»¶é€‰æ‹©

```typescript
const handleFileSelect = (type: string, event: ChangeEvent<HTMLInputElement>) => {
  const files = Array.from(event.target.files || []);
  
  // éªŒè¯æ–‡ä»¶ç±»å‹
  const imageFiles = files.filter(f => f.type.startsWith('image/'));
  
  // æ£€æŸ¥æ•°é‡é™åˆ¶
  const maxCount = PHOTO_TYPES[type].maxCount;
  const currentCount = existingPhotos[type].length;
  const availableSlots = maxCount - currentCount;
  
  if (imageFiles.length > availableSlots) {
    toast({
      title: "è¶…å‡ºæ•°é‡é™åˆ¶",
      description: `æœ€å¤šåªèƒ½ä¸Šä¼  ${maxCount} å¼ ç…§ç‰‡`,
      variant: "destructive"
    });
    return;
  }
  
  setSelectedFiles(prev => ({
    ...prev,
    [type]: imageFiles
  }));
};
```

### ç¬¬2æ­¥ï¼šä¸Šä¼ åˆ°ä¸ƒç‰›äº‘

```typescript
const uploadToQiniu = async (type: string) => {
  const files = selectedFiles[type];
  if (files.length === 0) return;

  setUploading(type);
  
  try {
    const timestamp = Date.now();
    const filesToUpload = [];
    
    // è¯»å–æ–‡ä»¶ä¸º Base64
    for (let i = 0; i < files.length; i++) {
      const file = files[i];
      const fileExtension = file.name.split('.').pop();
      
      // ç”Ÿæˆè‡ªå®šä¹‰æ–‡ä»¶å
      const customFileName = `${PHOTO_TYPES[type].label}-${licensePlate}-${timestamp}-${i + 1}.${fileExtension}`;
      
      const reader = new FileReader();
      const fileData = await new Promise<string>((resolve) => {
        reader.onload = () => {
          const base64 = reader.result as string;
          resolve(base64.split(',')[1]); // å»æ‰ "data:image/jpeg;base64," å‰ç¼€
        };
        reader.readAsDataURL(file);
      });

      filesToUpload.push({
        fileName: file.name,
        fileData: fileData,
        customName: customFileName
      });
    }

    // è°ƒç”¨ä¸ƒç‰›äº‘ä¸Šä¼ å‡½æ•°
    const { data, error } = await supabase.functions.invoke('qiniu-upload', {
      body: {
        files: filesToUpload.map(f => ({
          fileName: f.fileName,
          fileData: f.fileData
        })),
        namingParams: {
          projectName: 'Truck',  // â­ è½¦è¾†ç…§ç‰‡ä¸Šä¼ åˆ° Truck ç›®å½•
          customName: filesToUpload[0].customName
        }
      }
    });

    if (error) throw error;
    if (!data.success) throw new Error(data.error || 'ä¸Šä¼ å¤±è´¥');

    // 3. æ›´æ–°ç…§ç‰‡åˆ—è¡¨
    const newPhotos = {
      ...photos,
      [PHOTO_TYPES[type].key]: [...photos[PHOTO_TYPES[type].key], ...data.urls]
    };
    
    setPhotos(newPhotos);
    onChange(newPhotos);

    toast({
      title: "ä¸Šä¼ æˆåŠŸ",
      description: `å·²ä¸Šä¼  ${data.urls.length} å¼ ç…§ç‰‡`
    });
    
  } catch (error) {
    console.error('ä¸Šä¼ å¤±è´¥:', error);
    toast({
      title: "ä¸Šä¼ å¤±è´¥",
      description: error.message,
      variant: "destructive"
    });
  } finally {
    setUploading(null);
  }
};
```

### ç¬¬3æ­¥ï¼šä¿å­˜åˆ°æ•°æ®åº“

```typescript
// ä¿å­˜è½¦è¾†ä¿¡æ¯ï¼ˆåŒ…å«ç…§ç‰‡ URLï¼‰
const saveVehicle = async () => {
  const { error } = await supabase
    .from('internal_vehicles')
    .upsert({
      id: vehicleId,
      license_plate: licensePlate,
      // ... å…¶ä»–å­—æ®µ ...
      
      // ç…§ç‰‡å­—æ®µï¼ˆJSONB æ•°ç»„ï¼‰
      driving_license_photos: vehiclePhotos.driving_license_photos,
      transport_license_photos: vehiclePhotos.transport_license_photos,
      vehicle_photos: vehiclePhotos.vehicle_photos,
      insurance_certificate_photos: vehiclePhotos.insurance_certificate_photos,
      
      updated_at: new Date().toISOString()
    });
};
```

---

## ğŸ¨ UI ç»„ä»¶ç»“æ„

### è½¦è¾†ç®¡ç†å¯¹è¯æ¡†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ğŸš—] ç¼–è¾‘è½¦è¾† - äº‘F97310           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [åŸºæœ¬ä¿¡æ¯] [ğŸ“· è¯ä»¶ç…§ç‰‡] [ä¿é™©ç»´ä¿]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  è¯ä»¶ç…§ç‰‡æ ‡ç­¾é¡µï¼š                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ”¹ è¡Œé©¶è¯ï¼ˆ2/2ï¼‰               â”‚â”‚
â”‚  â”‚ [ğŸ“· å›¾1] [ğŸ“· å›¾2]             â”‚â”‚
â”‚  â”‚ [é€‰æ‹©ç…§ç‰‡] [ä¸Šä¼ ]              â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ ğŸ”¹ é“è·¯è¿è¾“è¯ï¼ˆ1/2ï¼‰           â”‚â”‚
â”‚  â”‚ [ğŸ“· å›¾1] [+ æ·»åŠ ]             â”‚â”‚
â”‚  â”‚ [é€‰æ‹©ç…§ç‰‡] [ä¸Šä¼ ]              â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ ğŸ”¹ è½¦è¾†å¤–è§‚ï¼ˆ4/10ï¼‰            â”‚â”‚
â”‚  â”‚ [ğŸ“· å‰] [ğŸ“· å] [ğŸ“· å·¦] [ğŸ“· å³]â”‚â”‚
â”‚  â”‚ [é€‰æ‹©ç…§ç‰‡] [ä¸Šä¼ ]              â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ ğŸ”¹ ä¿é™©å•ï¼ˆ1/5ï¼‰               â”‚â”‚
â”‚  â”‚ [ğŸ“· å›¾1] [+ æ·»åŠ ]             â”‚â”‚
â”‚  â”‚ [é€‰æ‹©ç…§ç‰‡] [ä¸Šä¼ ]              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚  [å–æ¶ˆ]           [ä¿å­˜è½¦è¾†ä¿¡æ¯]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ•°æ®åº“å­—æ®µå®Œæ•´æ¸…å•

### æœ€ç»ˆæ¨èé…ç½®ï¼ˆ7ä¸ªç…§ç‰‡å­—æ®µï¼‰

```sql
ALTER TABLE internal_vehicles ADD COLUMN IF NOT EXISTS 
    -- æ ¸å¿ƒè¯ä»¶ï¼ˆ4ä¸ªï¼Œå¿…éœ€ï¼‰
    driving_license_photos JSONB DEFAULT '[]'::jsonb,
    transport_license_photos JSONB DEFAULT '[]'::jsonb,
    vehicle_photos JSONB DEFAULT '[]'::jsonb,
    insurance_certificate_photos JSONB DEFAULT '[]'::jsonb,
    
    -- æ‰©å±•å­—æ®µï¼ˆ3ä¸ªï¼Œæ¨èï¼‰
    annual_inspection_photos JSONB DEFAULT '[]'::jsonb,
    maintenance_photos JSONB DEFAULT '[]'::jsonb,
    purchase_invoice_photos JSONB DEFAULT '[]'::jsonb;

-- æ·»åŠ æ³¨é‡Š
COMMENT ON COLUMN internal_vehicles.driving_license_photos IS 'è¡Œé©¶è¯ç…§ç‰‡ï¼ˆJSONBæ•°ç»„ï¼Œä¸ƒç‰›äº‘URLï¼Œæœ€å¤š2å¼ ï¼‰';
COMMENT ON COLUMN internal_vehicles.transport_license_photos IS 'é“è·¯è¿è¾“è¯ç…§ç‰‡ï¼ˆJSONBæ•°ç»„ï¼Œä¸ƒç‰›äº‘URLï¼Œæœ€å¤š2å¼ ï¼‰';
COMMENT ON COLUMN internal_vehicles.vehicle_photos IS 'è½¦è¾†å¤–è§‚ç…§ç‰‡ï¼ˆJSONBæ•°ç»„ï¼Œä¸ƒç‰›äº‘URLï¼Œæœ€å¤š10å¼ ï¼‰';
COMMENT ON COLUMN internal_vehicles.insurance_certificate_photos IS 'ä¿é™©å•ç…§ç‰‡ï¼ˆJSONBæ•°ç»„ï¼Œä¸ƒç‰›äº‘URLï¼Œæœ€å¤š5å¼ ï¼‰';
COMMENT ON COLUMN internal_vehicles.annual_inspection_photos IS 'å¹´æ£€æ ‡å¿—ç…§ç‰‡ï¼ˆJSONBæ•°ç»„ï¼Œä¸ƒç‰›äº‘URLï¼Œæœ€å¤š2å¼ ï¼‰';
COMMENT ON COLUMN internal_vehicles.maintenance_photos IS 'ç»´ä¿®è®°å½•ç…§ç‰‡ï¼ˆJSONBæ•°ç»„ï¼Œä¸ƒç‰›äº‘URLï¼Œæœ€å¤š20å¼ ï¼‰';
COMMENT ON COLUMN internal_vehicles.purchase_invoice_photos IS 'è´­è½¦å‘ç¥¨ç…§ç‰‡ï¼ˆJSONBæ•°ç»„ï¼Œä¸ƒç‰›äº‘URLï¼Œæœ€å¤š5å¼ ï¼‰';
```

---

## âœ… ä¸ drivers è¡¨å¯¹æ¯”

| ç‰¹æ€§ | drivers è¡¨ï¼ˆå¤–éƒ¨å¸æœºï¼‰ | internal_vehicles è¡¨ï¼ˆå†…éƒ¨è½¦è¾†ï¼‰ |
|-----|---------------------|---------------------------|
| **ç…§ç‰‡å­—æ®µæ•°é‡** | 5ä¸ª | 4ä¸ªæ ¸å¿ƒ + 3ä¸ªæ‰©å±• = 7ä¸ª |
| **å­˜å‚¨æ ¼å¼** | JSONB æ•°ç»„ | JSONB æ•°ç»„ âœ… ç›¸åŒ |
| **ä¸ƒç‰›äº‘ç›®å½•** | `driver/` | `Truck/` |
| **é»˜è®¤å€¼** | `'[]'::jsonb` | `'[]'::jsonb` âœ… ç›¸åŒ |
| **ä¸Šä¼ å‡½æ•°** | qiniu-upload | qiniu-upload âœ… ç›¸åŒ |
| **å‘½åè§„åˆ™** | {ç±»å‹}-{å§“å}-{æ—¶é—´æˆ³} | {ç±»å‹}-{è½¦ç‰Œ}-{æ—¶é—´æˆ³} âœ… ç±»ä¼¼ |

**è®¾è®¡å®Œå…¨ä¸€è‡´ï¼Œå¤ç”¨ç°æœ‰ä¸Šä¼ é€»è¾‘ï¼**

