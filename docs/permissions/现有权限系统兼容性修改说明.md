# ç°æœ‰æƒé™ç³»ç»Ÿå…¼å®¹æ€§ä¿®æ”¹è¯´æ˜

## ğŸ¯ é—®é¢˜åˆ†æ

### åŸå§‹é—®é¢˜
æƒé™é…ç½®ä¸­çš„èœå•æƒé™åˆ—è¡¨ä¸å®é™…èœå•ç»“æ„ä¸åŒæ­¥ï¼Œç¼ºå°‘"å¼€ç¥¨ç”³è¯·å•ç®¡ç†"å’Œ"ä»˜æ¬¾ç”³è¯·å•ç®¡ç†"ã€‚

### ç°æœ‰æƒé™ç³»ç»Ÿ
æ‚¨å·²ç»æ‹¥æœ‰å®Œæ•´çš„æƒé™ç®¡ç†ç³»ç»Ÿï¼š

1. **æ•°æ®åº“è¡¨ç»“æ„**:
   - `role_permission_templates` - è§’è‰²æƒé™æ¨¡æ¿è¡¨
   - `user_permissions` - ç”¨æˆ·æƒé™è¡¨

2. **æƒé™ç®¡ç†Hook**:
   - `useOptimizedPermissions` - ä¼˜åŒ–çš„æƒé™ç®¡ç†Hook
   - æ”¯æŒè§’è‰²æ¨¡æ¿å’Œç”¨æˆ·æƒé™ç®¡ç†
   - æ”¯æŒé¡¹ç›®çº§æƒé™æ§åˆ¶

3. **æƒé™é…ç½®**:
   - `DEFAULT_ROLE_PERMISSIONS` - é»˜è®¤è§’è‰²æƒé™é…ç½®
   - æ”¯æŒç®¡ç†å‘˜ã€è´¢åŠ¡ã€æ“ä½œå‘˜ã€åˆä½œæ–¹ã€æŸ¥çœ‹è€…è§’è‰²

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. ä¿æŒç°æœ‰æƒé™ç³»ç»Ÿä¸å˜

**ä¸åˆ›å»ºæ–°çš„æ•°æ®åº“è¡¨**ï¼Œè€Œæ˜¯åˆ©ç”¨ç°æœ‰çš„æƒé™ç³»ç»Ÿï¼š

- ç»§ç»­ä½¿ç”¨ `role_permission_templates` è¡¨
- ç»§ç»­ä½¿ç”¨ `user_permissions` è¡¨
- ç»§ç»­ä½¿ç”¨ `useOptimizedPermissions` Hook

### 2. åŠ¨æ€ç”Ÿæˆèœå•æƒé™é…ç½®

**æ–‡ä»¶**: `src/config/dynamicPermissions.ts`

**æ ¸å¿ƒåŠŸèƒ½**:
- ä»å®é™…èœå•ç»“æ„ç”Ÿæˆæƒé™é…ç½®
- ä¸ç°æœ‰æƒé™ç³»ç»Ÿå®Œå…¨å…¼å®¹
- ä¸éœ€è¦æ•°æ®åº“å­˜å‚¨èœå•æƒé™å®šä¹‰

### 3. æƒé™é…ç½®é¡µé¢æ›´æ–°

**æ–‡ä»¶**: `src/pages/Settings/PermissionManagement.tsx`

**ä¿®æ”¹å†…å®¹**:
- ä½¿ç”¨åŠ¨æ€ç”Ÿæˆçš„èœå•æƒé™é…ç½®
- ä¿æŒç°æœ‰çš„æƒé™ç®¡ç†é€»è¾‘
- ç§»é™¤ä¸å¿…è¦çš„æ•°æ®åº“è¯»å–

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. åŠ¨æ€æƒé™é…ç½®

```typescript
// ä»ç°æœ‰èœå•ç»“æ„ç”Ÿæˆæƒé™é…ç½®
export function generateMenuPermissions() {
  return menuItems.map(group => ({
    group: group.title,
    permissions: group.items.map(item => ({
      key: urlToPermissionKey[item.url] || item.url.replace('/', '').replace('/', '.'),
      label: item.title.replace('ğŸ“ ', ''),
      url: item.url
    }))
  }));
}
```

### 2. æƒé™é”®æ˜ å°„

**URLåˆ°æƒé™é”®çš„æ˜ å°„**:
```typescript
const urlToPermissionKey: Record<string, string> = {
  '/dashboard/transport': 'dashboard.transport',
  '/dashboard/financial': 'dashboard.financial',
  '/dashboard/project': 'dashboard.project',
  '/contracts': 'contracts.list',
  '/projects': 'maintenance.projects',
  '/drivers': 'maintenance.drivers',
  '/locations': 'maintenance.locations',
  '/locations-enhanced': 'maintenance.locations_enhanced',
  '/partners': 'maintenance.partners',
  '/business-entry': 'business.entry',
  '/scale-records': 'business.scale',
  '/invoice-request': 'business.invoice_request',
  '/payment-request': 'business.payment_request',
  '/finance/reconciliation': 'finance.reconciliation',
  '/finance/payment-invoice': 'finance.payment_invoice',
  '/invoice-request-management': 'finance.invoice_request_management',
  '/payment-requests-list': 'finance.payment_requests',
  '/data-maintenance/waybill': 'data_maintenance.waybill',
  '/data-maintenance/waybill-enhanced': 'data_maintenance.waybill_enhanced',
  '/settings/users': 'settings.users',
  '/settings/permissions': 'settings.permissions',
  '/settings/contract-permissions': 'settings.contract_permissions',
  '/settings/role-templates': 'settings.role_templates',
  '/settings/permission-management': 'settings.permission_management',
};
```

### 3. æƒé™ç®¡ç†é¡µé¢æ›´æ–°

**ç§»é™¤å¼‚æ­¥åŠ è½½**:
```typescript
// ä½¿ç”¨åŠ¨æ€ç”Ÿæˆçš„èœå•æƒé™é…ç½®
const menuPermissions = generateMenuPermissions();
```

**ä¿æŒç°æœ‰é€»è¾‘**:
- ç»§ç»­ä½¿ç”¨ `useOptimizedPermissions` Hook
- ç»§ç»­ä½¿ç”¨ç°æœ‰çš„æƒé™ä¿å­˜é€»è¾‘
- ç»§ç»­ä½¿ç”¨ç°æœ‰çš„è§’è‰²æ¨¡æ¿ç®¡ç†

## ğŸ“Š ä¿®æ”¹å¯¹æ¯”

### ä¿®æ”¹å‰
- ç¡¬ç¼–ç çš„èœå•æƒé™åˆ—è¡¨
- ä¸å®é™…èœå•ç»“æ„ä¸åŒæ­¥
- ç¼ºå°‘æ–°å¢çš„èœå•é¡¹

### ä¿®æ”¹å
- åŠ¨æ€ç”Ÿæˆçš„èœå•æƒé™åˆ—è¡¨
- ä¸å®é™…èœå•ç»“æ„å®Œå…¨åŒæ­¥
- è‡ªåŠ¨åŒ…å«æ‰€æœ‰èœå•é¡¹
- ä¸ç°æœ‰æƒé™ç³»ç»Ÿå®Œå…¨å…¼å®¹

## ğŸ¯ ä¼˜åŠ¿ç‰¹ç‚¹

### 1. å…¼å®¹æ€§
- å®Œå…¨å…¼å®¹ç°æœ‰æƒé™ç³»ç»Ÿ
- ä¸éœ€è¦ä¿®æ”¹æ•°æ®åº“ç»“æ„
- ä¸éœ€è¦ä¿®æ”¹ç°æœ‰æƒé™ç®¡ç†é€»è¾‘

### 2. åŒæ­¥æ€§
- èœå•ç»“æ„å˜æ›´æ—¶è‡ªåŠ¨åŒæ­¥
- æƒé™é…ç½®ä¸å®é™…èœå•ä¸€è‡´
- å‡å°‘ç»´æŠ¤æˆæœ¬

### 3. æ‰©å±•æ€§
- æ–°å¢èœå•é¡¹è‡ªåŠ¨åŒ…å«
- æ”¯æŒæƒé™é”®æ˜ å°„
- æ”¯æŒèœå•åˆ†ç»„å’Œæ’åº

## ğŸš€ éƒ¨ç½²è¯´æ˜

### 1. æ— éœ€æ•°æ®åº“è¿ç§»
- ä¸åˆ›å»ºæ–°çš„æ•°æ®åº“è¡¨
- ä¸ä¿®æ”¹ç°æœ‰æ•°æ®åº“ç»“æ„
- ç›´æ¥ä½¿ç”¨ç°æœ‰æƒé™ç³»ç»Ÿ

### 2. æ–‡ä»¶æ›´æ–°
- âœ… `src/config/dynamicPermissions.ts` - åŠ¨æ€æƒé™é…ç½®
- âœ… `src/pages/Settings/PermissionManagement.tsx` - æƒé™ç®¡ç†é¡µé¢
- âŒ åˆ é™¤ `supabase/migrations/20250116_initialize_menu_permissions.sql`

### 3. åŠŸèƒ½éªŒè¯
- éªŒè¯æƒé™é…ç½®é¡µé¢æ˜¾ç¤º
- éªŒè¯èœå•æƒé™åˆ—è¡¨å®Œæ•´æ€§
- éªŒè¯æƒé™é…ç½®ä¿å­˜åŠŸèƒ½
- éªŒè¯æƒé™æ§åˆ¶åŠŸèƒ½

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. æƒé™é”®ä¸€è‡´æ€§
- ç¡®ä¿æƒé™é”®ä¸ç°æœ‰ç³»ç»Ÿä¸€è‡´
- é¿å…æƒé™é”®å†²çª
- ä¿æŒå‘åå…¼å®¹æ€§

### 2. èœå•ç»“æ„åŒæ­¥
- èœå•ç»“æ„å˜æ›´æ—¶ï¼Œæƒé™é…ç½®è‡ªåŠ¨æ›´æ–°
- æ–°å¢èœå•é¡¹æ—¶ï¼Œéœ€è¦æ›´æ–°URLåˆ°æƒé™é”®çš„æ˜ å°„
- åˆ é™¤èœå•é¡¹æ—¶ï¼Œæƒé™é…ç½®è‡ªåŠ¨æ›´æ–°

### 3. ç°æœ‰æ•°æ®ä¿æŠ¤
- ä¸ä¿®æ”¹ç°æœ‰æƒé™æ•°æ®
- ä¸å½±å“ç°æœ‰ç”¨æˆ·æƒé™
- ä¿æŒç°æœ‰è§’è‰²æ¨¡æ¿

## ğŸ” æµ‹è¯•å»ºè®®

### 1. åŠŸèƒ½æµ‹è¯•
- æ£€æŸ¥æƒé™é…ç½®é¡µé¢æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
- éªŒè¯èœå•æƒé™åˆ—è¡¨æ˜¯å¦å®Œæ•´
- æµ‹è¯•æƒé™é…ç½®çš„ä¿å­˜å’ŒåŠ è½½

### 2. å…¼å®¹æ€§æµ‹è¯•
- éªŒè¯ç°æœ‰æƒé™åŠŸèƒ½æ­£å¸¸
- éªŒè¯è§’è‰²æ¨¡æ¿åŠŸèƒ½æ­£å¸¸
- éªŒè¯ç”¨æˆ·æƒé™åŠŸèƒ½æ­£å¸¸

### 3. åŒæ­¥æ€§æµ‹è¯•
- ä¿®æ”¹èœå•ç»“æ„ï¼ŒéªŒè¯æƒé™é…ç½®è‡ªåŠ¨æ›´æ–°
- æ–°å¢èœå•é¡¹ï¼ŒéªŒè¯æƒé™é…ç½®è‡ªåŠ¨åŒ…å«
- åˆ é™¤èœå•é¡¹ï¼ŒéªŒè¯æƒé™é…ç½®è‡ªåŠ¨æ›´æ–°

---

**ä¿®æ”¹çŠ¶æ€**: âœ… å·²å®Œæˆ  
**å…¼å®¹æ€§**: âœ… å®Œå…¨å…¼å®¹  
**æµ‹è¯•çŠ¶æ€**: â³ å¾…æµ‹è¯•  
**éƒ¨ç½²çŠ¶æ€**: â³ å¾…éƒ¨ç½²
