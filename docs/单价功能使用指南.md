# 单价功能使用指南

## 📖 功能介绍

运单管理系统新增了**单价自动计算功能**，您现在可以输入单价，系统会自动计算运费，减少手动计算错误。

---

## 🎯 使用场景

### 场景1：按吨位计费

**适合**：运费按固定单价计费的项目

**示例**：
- 单价：350 元/吨
- 装货：20 吨
- 卸货：19.8 吨
- 系统自动计算运费：6,930 元

### 场景2：特殊价格

**适合**：运费需要特殊计算或协商价格

**示例**：
- 不输入单价
- 直接输入运费：7,000 元

---

## 📱 操作步骤

### 方式1：自动计算模式（推荐）

#### 步骤1：输入单价

在"费用信息"组中，找到"**单价（元/吨）**"输入框：

```
┌─────────────────────────────────────────┐
│ 单价（元/吨）                            │
│ ┌─────────────────────────────────────┐│
│ │ 350                                 ││
│ └─────────────────────────────────────┘│
│ 💡 已输入单价，运费将自动计算            │
└─────────────────────────────────────────┘
```

**提示**：
- 输入后，界面会显示"自动计算模式"蓝色标签
- 运费输入框会变成灰色（只读状态）

#### 步骤2：输入重量

在"重量信息"组中输入装货和卸货重量：

```
装货重量(吨) *：20
卸货重量(吨)  ：19.8
```

#### 步骤3：查看自动计算结果

系统会自动显示：

```
┌─────────────────────────────────────────┐
│ 有效数量（吨）                           │
│ [ 19.800 ] (只读)                       │
│ 📦 按项目配置：取装货和卸货较小值         │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ 运费(元) * (自动计算)                    │
│ [ 6930.00 ] (只读，灰色背景)             │
│ 计算：350 × 19.800 = 6930                │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│       司机应收金额                       │
│       ¥7,030.00                         │
│   自动计算：运费 + 额外费                │
└─────────────────────────────────────────┘
```

#### 步骤4：保存运单

点击"保存"按钮，运单创建成功！

---

### 方式2：手动输入模式（传统）

#### 步骤1：不输入单价

保持"单价（元/吨）"输入框为空

```
┌─────────────────────────────────────────┐
│ 单价（元/吨）                            │
│ ┌─────────────────────────────────────┐│
│ │ （留空）                            ││
│ └─────────────────────────────────────┘│
│ 💡 未输入单价，请手动输入运费            │
└─────────────────────────────────────────┘
```

#### 步骤2：直接输入运费

在"运费(元)"输入框中输入金额：

```
┌─────────────────────────────────────────┐
│ 运费(元) *                               │
│ [ 7000 ] (可编辑，正常样式)              │
└─────────────────────────────────────────┘
```

#### 步骤3：保存运单

点击"保存"按钮，运单创建成功！

---

## 🔄 模式切换

### 从手动切换到自动

```
1. 输入框中输入单价
   ↓
2. 界面自动切换到"自动计算模式"
   - 显示蓝色标签
   - 运费输入框变为只读
   - 显示有效数量和计算公式
```

### 从自动切换到手动

```
1. 删除单价（清空输入框）
   ↓
2. 界面自动切换到"手动输入模式"
   - 蓝色标签消失
   - 运费输入框变为可编辑
   - 有效数量卡片消失
   - 保留之前计算的运费（可修改）
```

---

## 📊 项目配置说明

### 有效数量计算方式

不同项目可以配置不同的有效数量计算方式（在"项目管理-项目设置"中配置）：

| 配置选项 | 说明 | 示例 |
|---------|------|------|
| **装货数量和卸货数量取较小值** | 取两者中的较小值（默认） | 装货20吨，卸货19.8吨 → 19.8吨 |
| **取装货数量** | 始终使用装货重量 | 装货20吨，卸货19.8吨 → 20吨 |
| **取卸货数量** | 始终使用卸货重量 | 装货20吨，卸货19.8吨 → 19.8吨 |

**提示**：有效数量字段下方会显示当前项目的配置方式

---

## ❓ 常见问题

### Q1：为什么我的运费输入框是灰色的？

**A**：因为您输入了单价，系统自动切换到"自动计算模式"，运费由系统自动计算。

**解决方式**：
- 如果想手动输入运费，请删除（清空）单价输入框

### Q2：有效数量是如何计算的？

**A**：根据项目的配置自动计算。

**查看方式**：
- 在有效数量字段下方有提示，例如："📦 按项目配置：取装货和卸货较小值"
- 或在项目管理中查看项目设置

### Q3：编辑旧运单时，为什么没有单价？

**A**：旧运单创建时没有输入单价，默认为手动模式。

**操作**：
- 您可以补充单价，系统会自动计算新的运费
- 或保持手动模式不变

### Q4：单价和运费可以同时修改吗？

**A**：不可以。

**规则**：
- **有单价**：运费由系统自动计算（不可手动修改）
- **无单价**：运费需要手动输入

### Q5：修改单价后会影响已有数据吗？

**A**：只影响当前编辑的运单。

**说明**：
- 修改运单的单价，只重新计算该运单的运费
- 不影响其他运单
- 已付款或已开票的运单可以正常编辑单价

### Q6：单价是必填字段吗？

**A**：不是，单价是可选字段。

**使用建议**：
- 如果运费是按固定单价计算，建议输入单价（自动模式）
- 如果运费是特殊协商价格，可以不输入单价（手动模式）

---

## 💡 使用技巧

### 技巧1：快速录入

如果您的项目运费都是固定单价：

1. 在项目设置中配置好"有效数量计算方式"
2. 新增运单时，直接输入单价
3. 输入重量后，运费自动计算
4. 节省时间，减少错误

### 技巧2：特殊处理

如果某个运单需要特殊价格：

1. 不输入单价（或删除单价）
2. 手动输入运费金额
3. 灵活应对特殊情况

### 技巧3：批量录入

如果需要批量录入同一单价的运单：

1. 第一个运单输入单价
2. 后续运单复制单价
3. 只需修改重量，运费自动更新

---

## 📞 支持

如有问题或建议，请联系系统管理员。

---

**文档创建日期**：2025-11-20  
**文档版本**：1.0  
**适用系统版本**：v2.0+

