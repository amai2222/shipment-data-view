# æ•°æ®åº“å±‚çº§å…³ç³»å¤„ç†æ–¹æ¡ˆå¯¹æ¯”

## ğŸ“š ä¸»æµæ–¹æ¡ˆæ¦‚è¿°

åœ¨æ•°æ®åº“è®¾è®¡ä¸­ï¼Œå¤„ç†å±‚çº§å…³ç³»ï¼ˆæ ‘å½¢ç»“æ„/çˆ¶å­å…³ç³»ï¼‰æœ‰å››ç§ä¸»æµæ–¹æ¡ˆï¼š

1. **é‚»æ¥è¡¨æ¨¡å‹ï¼ˆAdjacency Listï¼‰** - æœ€å¸¸ç”¨
2. **è·¯å¾„æšä¸¾æ³•ï¼ˆMaterialized Pathï¼‰** - æ€§èƒ½ä¼˜åŒ–
3. **åµŒå¥—é›†åˆæ¨¡å‹ï¼ˆNested Setï¼‰** - å¤æ‚ä½†é«˜æ•ˆ
4. **é—­åŒ…è¡¨ï¼ˆClosure Tableï¼‰** - æœ€çµæ´»ä½†å ç”¨ç©ºé—´

---

## 1ï¸âƒ£ é‚»æ¥è¡¨æ¨¡å‹ï¼ˆAdjacency Listï¼‰

### åŸç†
æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨å…¶ç›´æ¥çˆ¶èŠ‚ç‚¹çš„IDï¼Œé€šè¿‡ `parent_id` å­—æ®µå»ºç«‹å…³ç³»ã€‚

### æ•°æ®ç»“æ„
```sql
CREATE TABLE partners (
    id UUID PRIMARY KEY,
    name TEXT,
    parent_partner_id UUID REFERENCES partners(id)  -- âœ… ç›´æ¥çˆ¶èŠ‚ç‚¹
);
```

### ä¼˜ç‚¹
- âœ… **ç®€å•ç›´è§‚**ï¼šæœ€å®¹æ˜“ç†è§£å’Œå®ç°
- âœ… **æ’å…¥/åˆ é™¤å¿«**ï¼šåªéœ€ä¿®æ”¹ä¸€æ¡è®°å½•
- âœ… **ç§»åŠ¨èŠ‚ç‚¹æ–¹ä¾¿**ï¼šåªéœ€æ›´æ–° `parent_id`
- âœ… **å­˜å‚¨ç©ºé—´å°**ï¼šæ¯ä¸ªèŠ‚ç‚¹åªå­˜å‚¨ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ID

### ç¼ºç‚¹
- âŒ **æŸ¥è¯¢æ‰€æœ‰ä¸‹çº§éœ€è¦é€’å½’**ï¼šå¿…é¡»ä½¿ç”¨ `WITH RECURSIVE`
- âŒ **æŸ¥è¯¢æ€§èƒ½å¯èƒ½è¾ƒæ…¢**ï¼šæ·±å±‚çº§æŸ¥è¯¢éœ€è¦å¤šæ¬¡é€’å½’
- âŒ **æ— æ³•ç›´æ¥è·å–å±‚çº§æ·±åº¦**ï¼šéœ€è¦é€’å½’è®¡ç®—

### é€‚ç”¨åœºæ™¯
- âœ… å±‚çº§å…³ç³»å˜åŒ–é¢‘ç¹
- âœ… å±‚çº§æ·±åº¦ä¸å›ºå®š
- âœ… éœ€è¦é¢‘ç¹æ’å…¥/åˆ é™¤èŠ‚ç‚¹
- âœ… **å¤§å¤šæ•°ä¼ä¸šåº”ç”¨çš„é¦–é€‰æ–¹æ¡ˆ**

### ä¸»æµåº”ç”¨æ¡ˆä¾‹
- **GitHub**ï¼šä»“åº“çš„ç»„ç»‡ç»“æ„
- **Slack**ï¼šå·¥ä½œåŒºçš„é¢‘é“å±‚çº§
- **Jira**ï¼šé¡¹ç›®çš„å±‚çº§ç»“æ„
- **å¤§å¤šæ•°ERPç³»ç»Ÿ**ï¼šéƒ¨é—¨ã€ç»„ç»‡æ¶æ„

### PostgreSQL å®ç°ç¤ºä¾‹
```sql
-- æŸ¥è¯¢æ‰€æœ‰ä¸‹çº§ï¼ˆé€’å½’ï¼‰
WITH RECURSIVE subordinates AS (
    -- èµ·ç‚¹ï¼šå½“å‰èŠ‚ç‚¹
    SELECT id, name, parent_partner_id, 0 as depth
    FROM partners
    WHERE id = 'å½“å‰èŠ‚ç‚¹ID'
    
    UNION ALL
    
    -- é€’å½’ï¼šæŸ¥æ‰¾æ‰€æœ‰å­èŠ‚ç‚¹
    SELECT p.id, p.name, p.parent_partner_id, s.depth + 1
    FROM partners p
    INNER JOIN subordinates s ON p.parent_partner_id = s.id
)
SELECT * FROM subordinates;
```

---

## 2ï¸âƒ£ è·¯å¾„æšä¸¾æ³•ï¼ˆMaterialized Pathï¼‰

### åŸç†
æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ä»æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„å®Œæ•´è·¯å¾„ï¼Œå¦‚ `/root/parent/child`ã€‚

### æ•°æ®ç»“æ„
```sql
CREATE TABLE partners (
    id UUID PRIMARY KEY,
    name TEXT,
    parent_partner_id UUID REFERENCES partners(id),
    hierarchy_path TEXT  -- âœ… å®Œæ•´è·¯å¾„ï¼š/uuid1/uuid2/uuid3
);
```

### ä¼˜ç‚¹
- âœ… **æŸ¥è¯¢æ‰€æœ‰ä¸‹çº§éå¸¸å¿«**ï¼š`WHERE hierarchy_path LIKE '/root/%'`
- âœ… **æŸ¥è¯¢æ‰€æœ‰ä¸Šçº§å¾ˆå¿«**ï¼šè§£æè·¯å¾„å³å¯
- âœ… **å¯ä»¥å¿«é€Ÿè·å–å±‚çº§æ·±åº¦**ï¼šè·¯å¾„ä¸­ `/` çš„æ•°é‡
- âœ… **ä¸éœ€è¦é€’å½’æŸ¥è¯¢**ï¼šç›´æ¥å­—ç¬¦ä¸²åŒ¹é…

### ç¼ºç‚¹
- âŒ **è·¯å¾„éœ€è¦ç»´æŠ¤**ï¼šæ’å…¥/ç§»åŠ¨èŠ‚ç‚¹æ—¶éœ€è¦æ›´æ–°æ‰€æœ‰å­èŠ‚ç‚¹çš„è·¯å¾„
- âŒ **è·¯å¾„å¯èƒ½å¾ˆé•¿**ï¼šæ·±å±‚çº§ç»“æ„è·¯å¾„ä¼šå¾ˆé•¿
- âŒ **æ›´æ–°æˆæœ¬é«˜**ï¼šç§»åŠ¨èŠ‚ç‚¹éœ€è¦æ›´æ–°æ‰€æœ‰åä»£

### é€‚ç”¨åœºæ™¯
- âœ… å±‚çº§å…³ç³»ç›¸å¯¹ç¨³å®š
- âœ… éœ€è¦é¢‘ç¹æŸ¥è¯¢æ‰€æœ‰ä¸‹çº§
- âœ… å±‚çº§æ·±åº¦æœ‰é™ï¼ˆå»ºè®®ä¸è¶…è¿‡10å±‚ï¼‰
- âœ… **è¯»å¤šå†™å°‘çš„åœºæ™¯**

### ä¸»æµåº”ç”¨æ¡ˆä¾‹
- **æ–‡ä»¶ç³»ç»Ÿ**ï¼šç›®å½•è·¯å¾„
- **URLè·¯ç”±**ï¼šç½‘ç«™URLå±‚çº§
- **åˆ†ç±»ç³»ç»Ÿ**ï¼šå•†å“åˆ†ç±»ã€æ–‡ç« åˆ†ç±»

### PostgreSQL å®ç°ç¤ºä¾‹
```sql
-- æŸ¥è¯¢æ‰€æœ‰ä¸‹çº§ï¼ˆæ— éœ€é€’å½’ï¼Œæ€§èƒ½æä½³ï¼‰
SELECT *
FROM partners
WHERE hierarchy_path LIKE '/root-id/%';

-- æŸ¥è¯¢æ‰€æœ‰ä¸Šçº§ï¼ˆè§£æè·¯å¾„ï¼‰
SELECT *
FROM partners
WHERE id = ANY(string_to_array(hierarchy_path, '/')::UUID[]);
```

---

## 3ï¸âƒ£ åµŒå¥—é›†åˆæ¨¡å‹ï¼ˆNested Setï¼‰

### åŸç†
æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ `left` å’Œ `right` ä¸¤ä¸ªæ•°å€¼ï¼Œæ‰€æœ‰å­èŠ‚ç‚¹çš„æ•°å€¼éƒ½åœ¨çˆ¶èŠ‚ç‚¹çš„èŒƒå›´å†…ã€‚

### æ•°æ®ç»“æ„
```sql
CREATE TABLE partners (
    id UUID PRIMARY KEY,
    name TEXT,
    lft INTEGER,  -- âœ… å·¦è¾¹ç•Œ
    rgt INTEGER   -- âœ… å³è¾¹ç•Œ
);
```

### ç¤ºä¾‹
```
        1 (1,10)
       / \
      2   3
     (2,5) (6,9)
     / \
    4   5
   (3,4) (5,5)
```

### ä¼˜ç‚¹
- âœ… **æŸ¥è¯¢æ‰€æœ‰ä¸‹çº§æå¿«**ï¼š`WHERE lft > parent.lft AND rgt < parent.rgt`
- âœ… **æŸ¥è¯¢æ‰€æœ‰ä¸Šçº§å¾ˆå¿«**ï¼šåå‘æŸ¥è¯¢
- âœ… **è®¡ç®—å­æ ‘å¤§å°å¾ˆå¿«**ï¼š`(rgt - lft - 1) / 2`
- âœ… **ä¸éœ€è¦é€’å½’æŸ¥è¯¢**

### ç¼ºç‚¹
- âŒ **æ’å…¥/åˆ é™¤/ç§»åŠ¨èŠ‚ç‚¹éå¸¸å¤æ‚**ï¼šéœ€è¦é‡æ–°è®¡ç®—æ‰€æœ‰å—å½±å“èŠ‚ç‚¹çš„å·¦å³å€¼
- âŒ **å®ç°å¤æ‚**ï¼šéœ€è¦ç»´æŠ¤å·¦å³å€¼çš„æ­£ç¡®æ€§
- âŒ **ä¸é€‚åˆé¢‘ç¹æ›´æ–°**ï¼šæ›´æ–°æˆæœ¬æé«˜

### é€‚ç”¨åœºæ™¯
- âœ… å±‚çº§å…³ç³»å‡ ä¹ä¸å˜
- âœ… éœ€è¦é¢‘ç¹æŸ¥è¯¢å­æ ‘
- âœ… è¯»å¤šå†™æå°‘
- âŒ **ä¸é€‚åˆå¤§å¤šæ•°ä¼ä¸šåº”ç”¨**

### ä¸»æµåº”ç”¨æ¡ˆä¾‹
- **è¯„è®ºç³»ç»Ÿ**ï¼šè¯„è®ºçš„åµŒå¥—ç»“æ„ï¼ˆå¦‚Redditï¼‰
- **èœå•ç³»ç»Ÿ**ï¼šç½‘ç«™å¯¼èˆªèœå•
- **åˆ†ç±»æ ‘**ï¼šå•†å“åˆ†ç±»ï¼ˆåªè¯»åœºæ™¯ï¼‰

---

## 4ï¸âƒ£ é—­åŒ…è¡¨ï¼ˆClosure Tableï¼‰

### åŸç†
å•ç‹¬åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œå­˜å‚¨æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´çš„ç¥–å…ˆ-åä»£å…³ç³»ï¼ˆåŒ…æ‹¬é—´æ¥å…³ç³»ï¼‰ã€‚

### æ•°æ®ç»“æ„
```sql
CREATE TABLE partners (
    id UUID PRIMARY KEY,
    name TEXT
);

CREATE TABLE partner_closure (
    ancestor_id UUID REFERENCES partners(id),   -- âœ… ç¥–å…ˆID
    descendant_id UUID REFERENCES partners(id), -- âœ… åä»£ID
    depth INTEGER,  -- âœ… å±‚çº§æ·±åº¦ï¼ˆ0=è‡ªå·±ï¼Œ1=ç›´æ¥å­èŠ‚ç‚¹ï¼Œ2=å­™å­èŠ‚ç‚¹...ï¼‰
    PRIMARY KEY (ancestor_id, descendant_id)
);
```

### ç¤ºä¾‹æ•°æ®
```
partner_closure:
ancestor_id | descendant_id | depth
------------|---------------|------
A           | A             | 0    (è‡ªå·±)
A           | B             | 1    (ç›´æ¥å­èŠ‚ç‚¹)
A           | C             | 1    (ç›´æ¥å­èŠ‚ç‚¹)
A           | D             | 2    (å­™å­èŠ‚ç‚¹)
B           | B             | 0    (è‡ªå·±)
B           | D             | 1    (ç›´æ¥å­èŠ‚ç‚¹)
```

### ä¼˜ç‚¹
- âœ… **æŸ¥è¯¢éå¸¸çµæ´»**ï¼šå¯ä»¥æŸ¥è¯¢ä»»æ„å±‚çº§å…³ç³»
- âœ… **æŸ¥è¯¢æ€§èƒ½å¥½**ï¼šç›´æ¥JOINï¼Œæ— éœ€é€’å½’
- âœ… **æ”¯æŒå¤æ‚æŸ¥è¯¢**ï¼šå¦‚"æŸ¥è¯¢æ‰€æœ‰3çº§ä»¥ä¸‹çš„å­èŠ‚ç‚¹"

### ç¼ºç‚¹
- âŒ **å­˜å‚¨ç©ºé—´å¤§**ï¼šéœ€è¦å­˜å‚¨æ‰€æœ‰èŠ‚ç‚¹å¯¹çš„å…³ç³»
- âŒ **æ’å…¥/åˆ é™¤å¤æ‚**ï¼šéœ€è¦ç»´æŠ¤æ‰€æœ‰å…³ç³»
- âŒ **æ›´æ–°æˆæœ¬é«˜**ï¼šç§»åŠ¨èŠ‚ç‚¹éœ€è¦æ›´æ–°å¤§é‡è®°å½•

### é€‚ç”¨åœºæ™¯
- âœ… éœ€è¦é¢‘ç¹æŸ¥è¯¢ä»»æ„å±‚çº§å…³ç³»
- âœ… å±‚çº§æ·±åº¦è¾ƒæµ…
- âœ… å­˜å‚¨ç©ºé—´å……è¶³
- âŒ **ä¸é€‚åˆå¤§è§„æ¨¡æ•°æ®**

### ä¸»æµåº”ç”¨æ¡ˆä¾‹
- **æƒé™ç³»ç»Ÿ**ï¼šè§’è‰²ç»§æ‰¿å…³ç³»
- **æ¨èç³»ç»Ÿ**ï¼šç”¨æˆ·å…³ç³»ç½‘ç»œ
- **ç¤¾äº¤ç½‘ç»œ**ï¼šå¥½å‹å…³ç³»ï¼ˆå°è§„æ¨¡ï¼‰

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”æ€»ç»“

| æ–¹æ¡ˆ | æŸ¥è¯¢ä¸‹çº§ | æ’å…¥/åˆ é™¤ | ç§»åŠ¨èŠ‚ç‚¹ | å­˜å‚¨ç©ºé—´ | å®ç°å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
|------|---------|----------|---------|---------|-----------|---------|
| **é‚»æ¥è¡¨** | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | **ä¼ä¸šåº”ç”¨é¦–é€‰** |
| **è·¯å¾„æšä¸¾** | â­â­â­â­â­ | â­â­â­ | â­â­ | â­â­â­â­ | â­â­â­â­ | è¯»å¤šå†™å°‘ |
| **åµŒå¥—é›†åˆ** | â­â­â­â­â­ | â­ | â­ | â­â­â­â­â­ | â­â­ | å‡ ä¹åªè¯» |
| **é—­åŒ…è¡¨** | â­â­â­â­â­ | â­â­ | â­ | â­â­ | â­â­â­ | å¤æ‚æŸ¥è¯¢ |

---

## ğŸ¯ ä¸»æµåº”ç”¨çš„é€‰æ‹©

### ä¼ä¸šåº”ç”¨ï¼ˆERPã€CRMã€OAç³»ç»Ÿï¼‰
**é¦–é€‰ï¼šé‚»æ¥è¡¨æ¨¡å‹**
- âœ… å±‚çº§å…³ç³»å˜åŒ–é¢‘ç¹ï¼ˆéƒ¨é—¨è°ƒæ•´ã€äººå‘˜è°ƒåŠ¨ï¼‰
- âœ… éœ€è¦çµæ´»çš„æ•°æ®æ“ä½œ
- âœ… å®ç°ç®€å•ï¼Œç»´æŠ¤æˆæœ¬ä½

**ä¼˜åŒ–ï¼šé‚»æ¥è¡¨ + è·¯å¾„æšä¸¾ï¼ˆæ··åˆæ–¹æ¡ˆï¼‰**
- ä½¿ç”¨ `parent_id` ä½œä¸ºä¸»è¦å…³ç³»
- ä½¿ç”¨ `hierarchy_path` ä½œä¸ºæŸ¥è¯¢ä¼˜åŒ–
- é€šè¿‡è§¦å‘å™¨è‡ªåŠ¨ç»´æŠ¤è·¯å¾„

### å†…å®¹ç®¡ç†ç³»ç»Ÿï¼ˆCMSï¼‰
**é¦–é€‰ï¼šè·¯å¾„æšä¸¾æ³•**
- âœ… åˆ†ç±»ç»“æ„ç›¸å¯¹ç¨³å®š
- âœ… éœ€è¦é¢‘ç¹æŸ¥è¯¢åˆ†ç±»æ ‘
- âœ… URLè·¯å¾„å¤©ç„¶å¯¹åº”å±‚çº§è·¯å¾„

### è¯„è®ºç³»ç»Ÿ
**é¦–é€‰ï¼šåµŒå¥—é›†åˆæ¨¡å‹**
- âœ… è¯„è®ºç»“æ„å‡ ä¹ä¸å˜
- âœ… éœ€è¦é¢‘ç¹æŸ¥è¯¢è¯„è®ºæ ‘
- âœ… è¯»å¤šå†™å°‘

### ç¤¾äº¤ç½‘ç»œ
**é¦–é€‰ï¼šå›¾æ•°æ®åº“ï¼ˆNeo4jï¼‰**
- âœ… å…³ç³»å¤æ‚å¤šæ ·
- âœ… éœ€è¦å¤æ‚çš„å…³ç³»æŸ¥è¯¢
- âœ… ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“éš¾ä»¥æ»¡è¶³

---

## ğŸ’¡ æˆ‘ä»¬çš„ç³»ç»Ÿæ¨èæ–¹æ¡ˆ

### å½“å‰å®ç°ï¼šé‚»æ¥è¡¨ + è·¯å¾„æšä¸¾ï¼ˆæ··åˆæ–¹æ¡ˆï¼‰

```sql
CREATE TABLE partners (
    id UUID PRIMARY KEY,
    name TEXT,
    parent_partner_id UUID REFERENCES partners(id),  -- âœ… ä¸»è¦å…³ç³»
    hierarchy_path TEXT,  -- âœ… æŸ¥è¯¢ä¼˜åŒ–
    hierarchy_depth INTEGER,  -- âœ… æ·±åº¦ç¼“å­˜
    is_root BOOLEAN  -- âœ… æ ¹èŠ‚ç‚¹æ ‡è®°
);
```

### ä¸ºä»€ä¹ˆé€‰æ‹©æ··åˆæ–¹æ¡ˆï¼Ÿ

1. **ä¸»è¦ä½¿ç”¨é‚»æ¥è¡¨**ï¼ˆ`parent_partner_id`ï¼‰
   - âœ… æ•°æ®æ“ä½œç®€å•
   - âœ… ç»´æŠ¤æˆæœ¬ä½
   - âœ… é€‚åˆé¢‘ç¹æ›´æ–°

2. **è·¯å¾„æšä¸¾ä½œä¸ºä¼˜åŒ–**ï¼ˆ`hierarchy_path`ï¼‰
   - âœ… æŸ¥è¯¢æ€§èƒ½æå‡
   - âœ… é€šè¿‡è§¦å‘å™¨è‡ªåŠ¨ç»´æŠ¤
   - âœ… å³ä½¿è·¯å¾„æœªç»´æŠ¤ï¼Œä¹Ÿèƒ½é€šè¿‡é€’å½’æŸ¥è¯¢å·¥ä½œ

3. **æŸ¥è¯¢ç­–ç•¥**
   - **ä¼˜å…ˆä½¿ç”¨ `hierarchy_path`**ï¼šå¦‚æœè·¯å¾„å­˜åœ¨ä¸”æ­£ç¡®
   - **é™çº§åˆ°é€’å½’æŸ¥è¯¢**ï¼šå¦‚æœè·¯å¾„ä¸å­˜åœ¨æˆ–é”™è¯¯
   - **ç¡®ä¿æ•°æ®ä¸€è‡´æ€§**ï¼š`parent_partner_id` æ˜¯å”¯ä¸€çœŸå®æ¥æº

### æœ€ä½³å®è·µ

```sql
-- âœ… æ¨èï¼šä½¿ç”¨é€’å½’æŸ¥è¯¢ï¼ˆåŸºäº parent_partner_idï¼‰
-- å³ä½¿ hierarchy_path æœªç»´æŠ¤ä¹Ÿèƒ½å·¥ä½œ
WITH RECURSIVE subordinates AS (
    SELECT id FROM partners WHERE id = 'å½“å‰èŠ‚ç‚¹ID'
    UNION ALL
    SELECT p.id
    FROM partners p
    INNER JOIN subordinates s ON p.parent_partner_id = s.id
)
SELECT * FROM subordinates;

-- âš¡ ä¼˜åŒ–ï¼šå¦‚æœ hierarchy_path å·²ç»´æŠ¤ï¼Œå¯ä»¥ä½¿ç”¨è·¯å¾„æŸ¥è¯¢
-- æ€§èƒ½æ›´å¥½ï¼Œä½†éœ€è¦ç¡®ä¿è·¯å¾„æ­£ç¡®
SELECT * FROM partners
WHERE hierarchy_path LIKE '/root-id/%';
```

---

## ğŸ”§ PostgreSQL é€’å½’æŸ¥è¯¢æœ€ä½³å®è·µ

### 1. é˜²æ­¢æ— é™å¾ªç¯
```sql
WITH RECURSIVE tree AS (
    SELECT id, parent_id, 0 as depth
    FROM partners WHERE id = 'root-id'
    
    UNION ALL
    
    SELECT p.id, p.parent_id, t.depth + 1
    FROM partners p
    INNER JOIN tree t ON p.parent_id = t.id
    WHERE t.depth < 100  -- âœ… é™åˆ¶æœ€å¤§æ·±åº¦
)
SELECT * FROM tree;
```

### 2. æ£€æµ‹å¾ªç¯å¼•ç”¨
```sql
WITH RECURSIVE tree AS (
    SELECT id, parent_id, ARRAY[id] as path
    FROM partners WHERE id = 'root-id'
    
    UNION ALL
    
    SELECT p.id, p.parent_id, t.path || p.id
    FROM partners p
    INNER JOIN tree t ON p.parent_id = t.id
    WHERE NOT (p.id = ANY(t.path))  -- âœ… æ£€æµ‹å¾ªç¯
)
SELECT * FROM tree;
```

### 3. æ€§èƒ½ä¼˜åŒ–
```sql
-- âœ… åˆ›å»ºç´¢å¼•
CREATE INDEX idx_partners_parent_id ON partners(parent_partner_id);
CREATE INDEX idx_partners_hierarchy_path ON partners(hierarchy_path);

-- âœ… é™åˆ¶æŸ¥è¯¢èŒƒå›´
WHERE partner_type = 'è´§ä¸»'  -- åªæŸ¥è¯¢ç‰¹å®šç±»å‹
AND is_active = true  -- åªæŸ¥è¯¢æ´»è·ƒèŠ‚ç‚¹
```

---

## ğŸ“š å‚è€ƒèµ„æº

1. **ã€ŠSQL Antipatternsã€‹** - Bill Karwin
   - è¯¦ç»†ä»‹ç»äº†å„ç§å±‚çº§å…³ç³»å¤„ç†æ–¹æ¡ˆ

2. **PostgreSQL å®˜æ–¹æ–‡æ¡£**
   - `WITH RECURSIVE` æŸ¥è¯¢è¯­æ³•
   - é€’å½’æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–

3. **ä¸»æµå¼€æºé¡¹ç›®**
   - **Django**ï¼šä½¿ç”¨é‚»æ¥è¡¨æ¨¡å‹
   - **Laravel**ï¼šä½¿ç”¨åµŒå¥—é›†åˆæ¨¡å‹ï¼ˆåŒ…ï¼š`kalnoy/nestedset`ï¼‰
   - **Rails**ï¼šä½¿ç”¨é—­åŒ…è¡¨ï¼ˆgemï¼š`closure_tree`ï¼‰

---

## âœ… æ€»ç»“

å¯¹äºæˆ‘ä»¬çš„è´§ä¸»å±‚çº§ç®¡ç†ç³»ç»Ÿï¼š

1. **ä¸»è¦æ–¹æ¡ˆ**ï¼šé‚»æ¥è¡¨æ¨¡å‹ï¼ˆ`parent_partner_id`ï¼‰
   - âœ… ç®€å•ã€çµæ´»ã€æ˜“ç»´æŠ¤
   - âœ… é€‚åˆé¢‘ç¹çš„æ•°æ®æ“ä½œ

2. **æ€§èƒ½ä¼˜åŒ–**ï¼šè·¯å¾„æšä¸¾ï¼ˆ`hierarchy_path`ï¼‰
   - âœ… æå‡æŸ¥è¯¢æ€§èƒ½
   - âœ… é€šè¿‡è§¦å‘å™¨è‡ªåŠ¨ç»´æŠ¤

3. **æŸ¥è¯¢ç­–ç•¥**ï¼š
   - âœ… ä¼˜å…ˆä½¿ç”¨é€’å½’æŸ¥è¯¢ï¼ˆåŸºäº `parent_partner_id`ï¼‰
   - âœ… å¦‚æœ `hierarchy_path` å·²ç»´æŠ¤ï¼Œå¯ä»¥ä½¿ç”¨è·¯å¾„æŸ¥è¯¢ä¼˜åŒ–
   - âœ… ç¡®ä¿å³ä½¿è·¯å¾„æœªç»´æŠ¤ï¼Œç³»ç»Ÿä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ

**è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¿®æ”¹æŸ¥è¯¢é€»è¾‘ï¼Œä½¿ç”¨ `parent_partner_id` é€’å½’æŸ¥è¯¢ï¼Œè€Œä¸æ˜¯ä¾èµ– `hierarchy_path`ï¼** ğŸ¯

