# ğŸ“± ç§»åŠ¨ç«¯ç™»å½•é€»è¾‘å®Œæ•´è¯´æ˜

**æ›´æ–°æ—¶é—´ï¼š** 2025-11-08  
**çŠ¶æ€ï¼š** âœ… æœ€æ–°ç‰ˆæœ¬

---

## ğŸ” ç™»å½•æµç¨‹æ¶æ„å›¾

```
ç”¨æˆ·æ‰“å¼€ç³»ç»Ÿ
    â†“
æ˜¾ç¤ºç™»å½•é¡µé¢ (Auth.tsx)
    â†“
è¾“å…¥è´¦å·å¯†ç  â†’ ç‚¹å‡»ç™»å½•
    â†“
Supabase è®¤è¯ (signInWithPassword)
    â†“
æˆåŠŸ â†’ è·å–ç”¨æˆ·ä¿¡æ¯
    â†“
ä» profiles è¡¨è·å–è§’è‰²
    â†“
Auth.tsx æ£€æµ‹è§’è‰²å’Œè®¾å¤‡ç±»å‹
    â†“
æ ¹æ®ã€è§’è‰²é¦–é¡µæ˜ å°„è¡¨ã€‘è·³è½¬
    â†“
ProtectedRoute æƒé™éªŒè¯
    â†“
âœ… æ˜¾ç¤ºç›®æ ‡é¡µé¢
```

---

## ğŸ‘¥ ä¸åŒè§’è‰²çš„ç™»å½•é€»è¾‘

### 1ï¸âƒ£ å¸æœº (driver)

**ç™»å½•åè·³è½¬ï¼š**
- ğŸ“± **ç§»åŠ¨ç«¯ï¼š** `/m/internal/my-expenses`ï¼ˆæˆ‘çš„è´¹ç”¨ç”³è¯·ï¼‰
- ğŸ–¥ï¸ **PCç«¯ï¼š** `/m/internal/my-expenses`ï¼ˆæš‚æ—¶ä¹Ÿç”¨ç§»åŠ¨ç«¯é¡µé¢ï¼‰

**å¯è®¿é—®çš„é¡µé¢ï¼š**
```
/m/internal/my-expenses      âœ… æˆ‘çš„è´¹ç”¨ç”³è¯·ï¼ˆé¦–é¡µï¼‰
/m/internal/quick-entry      âœ… å¿«é€Ÿå½•å•
/m/internal/driver-salary    âœ… æˆ‘çš„å·¥èµ„
/m/internal/my-vehicles      âœ… æˆ‘çš„è½¦è¾†
/m/internal/salary-records   âœ… å·¥èµ„è®°å½•
```

**æƒé™æ£€æŸ¥ï¼š**
- è§’è‰²è¦æ±‚ï¼š`role = 'driver'`
- æƒé™æ ‡è¯†ï¼š`internal.*`ï¼ˆå†…éƒ¨ç³»ç»Ÿæ”¾è¡Œï¼‰

**å…¸å‹ä½¿ç”¨åœºæ™¯ï¼š**
- ğŸ“ æäº¤è´¹ç”¨ç”³è¯·ï¼ˆåŠ æ²¹ã€åœè½¦ã€ç»´ä¿®ç­‰ï¼‰
- ğŸš› å¿«é€Ÿå½•å…¥è¿å•
- ğŸ’° æŸ¥çœ‹å·¥èµ„æ˜ç»†
- ğŸš— æŸ¥çœ‹è‡ªå·±çš„è½¦è¾†ä¿¡æ¯

---

### 2ï¸âƒ£ è½¦é˜Ÿé•¿ (fleet_manager)

**ç™»å½•åè·³è½¬ï¼š**
- ğŸ“± **ç§»åŠ¨ç«¯ï¼š** `/m/internal/fleet-dashboard`ï¼ˆè½¦é˜Ÿå·¥ä½œå°ï¼‰
- ğŸ–¥ï¸ **PCç«¯ï¼š** `/m/internal/fleet-dashboard`ï¼ˆæš‚æ—¶ä¹Ÿç”¨ç§»åŠ¨ç«¯ï¼‰æˆ– `/internal/vehicles`

**å¯è®¿é—®çš„é¡µé¢ï¼š**
```
/m/internal/fleet-dashboard        âœ… è½¦é˜Ÿå·¥ä½œå°ï¼ˆé¦–é¡µï¼‰
/m/internal/expense-review         âœ… è´¹ç”¨å®¡æ ¸
/m/internal/vehicles               âœ… è½¦è¾†ç®¡ç†
/m/internal/driver-route-config    âœ… å¸æœºçº¿è·¯é…ç½®
```

**æƒé™æ£€æŸ¥ï¼š**
- è§’è‰²è¦æ±‚ï¼š`role = 'fleet_manager'`
- æƒé™æ ‡è¯†ï¼š`internal.vehicles`, `internal.expense_review`

**å…¸å‹ä½¿ç”¨åœºæ™¯ï¼š**
- ğŸ“Š æŸ¥çœ‹è½¦é˜Ÿç»Ÿè®¡ï¼ˆè½¦è¾†æ•°ã€å¸æœºæ•°ã€å¾…åŠäº‹é¡¹ï¼‰
- âœ… å®¡æ ¸å¸æœºæäº¤çš„è´¹ç”¨ç”³è¯·
- ğŸš— ç®¡ç†è½¦è¾†æ¡£æ¡ˆå’Œåˆ†é…
- ğŸ›£ï¸ é…ç½®å¸æœºå¸¸è·‘çº¿è·¯

---

### 3ï¸âƒ£ è´§ä¸»/åˆä½œæ–¹ (partner)

**ç™»å½•åè·³è½¬ï¼š**
- ğŸ“± **ç§»åŠ¨ç«¯ï¼š** `/m/dashboard/shipper`ï¼ˆè´§ä¸»çœ‹æ¿ï¼‰
- ğŸ–¥ï¸ **PCç«¯ï¼š** `/dashboard/shipper`

**å¯è®¿é—®çš„é¡µé¢ï¼š**
```
/m/dashboard/shipper    âœ… è´§ä¸»çœ‹æ¿ï¼ˆé¦–é¡µï¼‰
å…¶ä»–æ•°æ®æŸ¥çœ‹é¡µé¢...
```

**æƒé™æ£€æŸ¥ï¼š**
- è§’è‰²è¦æ±‚ï¼š`role = 'partner'`
- æƒé™æ ‡è¯†ï¼š`dashboard.shipper`

**å…¸å‹ä½¿ç”¨åœºæ™¯ï¼š**
- ğŸ“Š æŸ¥çœ‹è‡ªå·±é¡¹ç›®çš„è¿è¾“æ•°æ®
- ğŸ“ˆ æŸ¥çœ‹å±‚çº§ç»Ÿè®¡
- ğŸ’° æŸ¥çœ‹è´¹ç”¨æ˜ç»†

---

### 4ï¸âƒ£ è´¢åŠ¡ (finance)

**ç™»å½•åè·³è½¬ï¼š**
- ğŸ“± **ç§»åŠ¨ç«¯ï¼š** `/m/dashboard/financial`ï¼ˆè´¢åŠ¡çœ‹æ¿ï¼‰
- ğŸ–¥ï¸ **PCç«¯ï¼š** `/dashboard/financial`

**å¯è®¿é—®çš„é¡µé¢ï¼š**
```
/m/dashboard/financial              âœ… è´¢åŠ¡çœ‹æ¿
/m/invoice-request-management       âœ… å¼€ç¥¨ç®¡ç†
/m/payment-requests-management      âœ… ä»˜æ¬¾ç®¡ç†
/m/audit/invoice                    âœ… å¼€ç¥¨å®¡æ ¸
/m/audit/payment                    âœ… ä»˜æ¬¾å®¡æ ¸
/m/finance/reconciliation           âœ… è¿è´¹å¯¹è´¦
```

**å…¸å‹ä½¿ç”¨åœºæ™¯ï¼š**
- ğŸ’° å®¡æ ¸å¼€ç¥¨å’Œä»˜æ¬¾ç”³è¯·
- ğŸ“Š æŸ¥çœ‹è´¢åŠ¡æŠ¥è¡¨
- ğŸ§¾ è¿è´¹å¯¹è´¦

---

### 5ï¸âƒ£ æ“ä½œå‘˜ (operator)

**ç™»å½•åè·³è½¬ï¼š**
- ğŸ“± **ç§»åŠ¨ç«¯ï¼š** `/m/business-entry`ï¼ˆè¿å•ç®¡ç†ï¼‰
- ğŸ–¥ï¸ **PCç«¯ï¼š** `/business-entry`

**å¯è®¿é—®çš„é¡µé¢ï¼š**
```
/m/business-entry        âœ… è¿å•ç®¡ç†
/m/scale-records         âœ… ç£…å•è®°å½•
/m/drivers               âœ… å¸æœºç®¡ç†
/m/locations             âœ… åœ°ç‚¹ç®¡ç†
```

**å…¸å‹ä½¿ç”¨åœºæ™¯ï¼š**
- ğŸ“ å½•å…¥è¿å•æ•°æ®
- âš–ï¸ ç®¡ç†ç£…å•è®°å½•
- ğŸ‘¥ ç»´æŠ¤å¸æœºä¿¡æ¯

---

### 6ï¸âƒ£ ç®¡ç†å‘˜ (admin)

**ç™»å½•åè·³è½¬ï¼š**
- ğŸ“± **ç§»åŠ¨ç«¯ï¼š** `/m/`ï¼ˆè¿è¾“æ¦‚è§ˆï¼‰
- ğŸ–¥ï¸ **PCç«¯ï¼š** `/dashboard/transport`

**å¯è®¿é—®çš„é¡µé¢ï¼š**
```
âœ… æ‰€æœ‰é¡µé¢ï¼ˆæ‹¥æœ‰å…¨éƒ¨æƒé™ï¼‰
```

**å…¸å‹ä½¿ç”¨åœºæ™¯ï¼š**
- ğŸ‘‘ ç³»ç»Ÿç®¡ç†å’Œé…ç½®
- ğŸ‘¥ ç”¨æˆ·å’Œæƒé™ç®¡ç†
- ğŸ“Š æŸ¥çœ‹æ‰€æœ‰æ•°æ®

---

### 7ï¸âƒ£ ä¸šåŠ¡ (business)

**ç™»å½•åè·³è½¬ï¼š**
- ğŸ“± **ç§»åŠ¨ç«¯ï¼š** `/m/`ï¼ˆè¿è¾“æ¦‚è§ˆï¼‰
- ğŸ–¥ï¸ **PCç«¯ï¼š** `/`ï¼ˆé»˜è®¤é¦–é¡µï¼‰

---

### 8ï¸âƒ£ æŸ¥çœ‹è€… (viewer)

**ç™»å½•åè·³è½¬ï¼š**
- ğŸ“± **ç§»åŠ¨ç«¯ï¼š** `/m/`ï¼ˆè¿è¾“æ¦‚è§ˆï¼‰
- ğŸ–¥ï¸ **PCç«¯ï¼š** `/`ï¼ˆé»˜è®¤é¦–é¡µï¼‰

**æƒé™ï¼š** åªè¯»æƒé™

---

## ğŸ”„ ç™»å½•æµç¨‹ä»£ç è¯¦è§£

### æ ¸å¿ƒä»£ç ä½ç½®

| æ–‡ä»¶ | ä½œç”¨ | å…³é”®ä»£ç  |
|------|------|----------|
| **Auth.tsx** | ç™»å½•é¡µé¢ | ç¬¬29-84è¡Œ - è§’è‰²é¦–é¡µæ˜ å°„ |
| **RoleBasedRedirect.tsx** | æ ¹è·¯ç”±é‡å®šå‘ | ç¬¬11-46è¡Œ - è§’è‰²è·³è½¬é€»è¾‘ |
| **ProtectedRoute.tsx** | æƒé™æ£€æŸ¥ | ç¬¬1-144è¡Œ - è·¯ç”±ä¿æŠ¤ |
| **AuthContext.tsx** | è®¤è¯çŠ¶æ€ç®¡ç† | å®Œæ•´æ–‡ä»¶ - ç”¨æˆ·çŠ¶æ€ |

---

## ğŸ“Š è§’è‰²é¦–é¡µæ˜ å°„è¡¨ï¼ˆå®Œæ•´ç‰ˆï¼‰

```typescript
const roleHomePage = {
  // å†…éƒ¨ç®¡ç†è§’è‰²
  driver: {
    pc: '/m/internal/my-expenses',
    mobile: '/m/internal/my-expenses'
  },
  fleet_manager: {
    pc: '/m/internal/fleet-dashboard',
    mobile: '/m/internal/fleet-dashboard'
  },
  
  // ä¸šåŠ¡è§’è‰²
  partner: {
    pc: '/dashboard/shipper',
    mobile: '/m/dashboard/shipper'
  },
  finance: {
    pc: '/dashboard/financial',
    mobile: '/m/dashboard/financial'
  },
  operator: {
    pc: '/business-entry',
    mobile: '/m/business-entry'
  },
  
  // ç³»ç»Ÿè§’è‰²
  admin: {
    pc: '/dashboard/transport',
    mobile: '/m/'
  },
  business: {
    pc: '/',
    mobile: '/m/'
  },
  viewer: {
    pc: '/',
    mobile: '/m/'
  }
};
```

---

## ğŸ›¡ï¸ æƒé™æ£€æŸ¥æœºåˆ¶

### å†…éƒ¨ç®¡ç†ç³»ç»Ÿç‰¹æ®Šå¤„ç†

**ä»£ç ä½ç½®ï¼š** `ProtectedRoute.tsx` ç¬¬42-46è¡Œ

```typescript
// âœ… ç‰¹æ®Šå¤„ç†ï¼šå†…éƒ¨è½¦è¾†ç®¡ç†è·¯å¾„ /m/internal/* æ”¾è¡Œ
if (location.pathname.startsWith('/m/internal/')) {
  // åªæ£€æŸ¥è§’è‰²ï¼Œä¸æ£€æŸ¥æ•°æ®åº“æƒé™
  // å› ä¸ºè¿™æ˜¯æ–°ç³»ç»Ÿï¼Œå¯èƒ½è¿˜æ²¡åœ¨ menu_config ä¸­å®Œå…¨é…ç½®
  return children;
}
```

**åŸå› ï¼š**
- å†…éƒ¨ç®¡ç†ç³»ç»Ÿæ˜¯æ–°åŠŸèƒ½ï¼ˆ2025-11åˆ›å»ºï¼‰
- å¯èƒ½è¿˜æ²¡åœ¨ `menu_config` è¡¨ä¸­å®Œå…¨é…ç½®
- æ‰€ä»¥åªæ£€æŸ¥è§’è‰²ï¼Œä¸æ£€æŸ¥æ•°æ®åº“æƒé™

---

## ğŸ¯ å®é™…ç™»å½•ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå¸æœºç™»å½•

```
1. è¾“å…¥è´¦å·: driver@example.com
2. è¾“å…¥å¯†ç : ******
3. ç‚¹å‡»ç™»å½•

â†“ Supabase è®¤è¯
â†“ ä» profiles è·å– role='driver'
â†“ Auth.tsx æ£€æµ‹ï¼šisMobile() = true
â†“ æŸ¥æ‰¾æ˜ å°„è¡¨ï¼šroleHomePage['driver'].mobile
â†“ è·³è½¬åˆ°ï¼š/m/internal/my-expenses

âœ… æ˜¾ç¤º"æˆ‘çš„è´¹ç”¨ç”³è¯·"é¡µé¢
```

---

### ç¤ºä¾‹2ï¼šè½¦é˜Ÿé•¿ç™»å½•ï¼ˆç§»åŠ¨ç«¯ï¼‰

```
1. è¾“å…¥è´¦å·: manager@example.com
2. è¾“å…¥å¯†ç : ******
3. ç‚¹å‡»ç™»å½•

â†“ Supabase è®¤è¯
â†“ ä» profiles è·å– role='fleet_manager'
â†“ Auth.tsx æ£€æµ‹ï¼šisMobile() = true
â†“ æŸ¥æ‰¾æ˜ å°„è¡¨ï¼šroleHomePage['fleet_manager'].mobile
â†“ è·³è½¬åˆ°ï¼š/m/internal/fleet-dashboard

âœ… æ˜¾ç¤º"è½¦é˜Ÿå·¥ä½œå°"é¡µé¢
```

**è½¦é˜Ÿå·¥ä½œå°æ˜¾ç¤ºï¼š**
- ğŸ“Š è½¦è¾†ç»Ÿè®¡ï¼ˆæ€»æ•°ã€æ´»è·ƒã€ç»´ä¿®ä¸­ï¼‰
- ğŸ‘¥ å¸æœºç»Ÿè®¡ï¼ˆæ€»æ•°ã€æ´»è·ƒï¼‰
- ğŸ“ å¾…å®¡æ ¸è´¹ç”¨ç”³è¯·æ•°
- ğŸš— å¾…å®¡æ ¸æ¢è½¦ç”³è¯·æ•°
- â° å³å°†åˆ°æœŸè¯ä»¶æ•°
- ğŸ“ˆ æœ¬æœˆè¿å•æ•°

---

### ç¤ºä¾‹3ï¼šè´§ä¸»ç™»å½•ï¼ˆç§»åŠ¨ç«¯ï¼‰

```
1. è¾“å…¥è´¦å·: partner@example.com
2. è¾“å…¥å¯†ç : ******
3. ç‚¹å‡»ç™»å½•

â†“ Supabase è®¤è¯
â†“ ä» profiles è·å– role='partner'
â†“ Auth.tsx æ£€æµ‹ï¼šisMobile() = true
â†“ æŸ¥æ‰¾æ˜ å°„è¡¨ï¼šroleHomePage['partner'].mobile
â†“ è·³è½¬åˆ°ï¼š/m/dashboard/shipper

âœ… æ˜¾ç¤º"è´§ä¸»çœ‹æ¿"é¡µé¢
```

---

## ğŸ” è®¾å¤‡æ£€æµ‹é€»è¾‘

**ä»£ç ä½ç½®ï¼š** `src/utils/device.ts`

```typescript
export function isMobile(): boolean {
  // æ£€æµ‹ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²
  const ua = navigator.userAgent.toLowerCase();
  
  return /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(ua);
}
```

**åˆ¤æ–­æ ‡å‡†ï¼š**
- âœ… Android è®¾å¤‡
- âœ… iOS è®¾å¤‡ï¼ˆiPhone/iPadï¼‰
- âœ… å…¶ä»–ç§»åŠ¨è®¾å¤‡

---

## ğŸš¨ æƒé™ä¸è¶³çš„å¤„ç†

### åœºæ™¯1ï¼šè§’è‰²åŒ¹é…ä½†æ— æƒé™

**æµç¨‹ï¼š**
```
ç”¨æˆ·ç™»å½•æˆåŠŸ
  â†“
è·³è½¬åˆ°ç›®æ ‡é¡µé¢
  â†“
ProtectedRoute æ£€æŸ¥æƒé™
  â†“
âŒ æƒé™ä¸è¶³
  â†“
æ˜¾ç¤º"è®¿é—®è¢«æ‹’ç»"é¡µé¢ï¼ˆå†…åµŒåœ¨é¡µé¢ä¸­ï¼‰
```

**ç”¨æˆ·çœ‹åˆ°ï¼š**
- ğŸš« è®¿é—®è¢«æ‹’ç»
- ğŸ“ éœ€è¦çš„æƒé™æ ‡è¯†
- ğŸ”˜ é€€å‡ºç™»å½•æŒ‰é’®
- â†©ï¸ è¿”å›ä¸Šä¸€é¡µæŒ‰é’®

---

### åœºæ™¯2ï¼šå®Œå…¨æ— æƒé™

**æµç¨‹ï¼š**
```
ç”¨æˆ·è§’è‰²æœªåŒ¹é…
  â†“
è·³è½¬åˆ° /unauthorized
  â†“
æ˜¾ç¤ºç‹¬ç«‹çš„æ— æƒé™é¡µé¢
```

**ç”¨æˆ·çœ‹åˆ°ï¼š**
- ğŸš« è®¿é—®è¢«æ‹’ç»
- ğŸ‘¤ å½“å‰ç”¨æˆ·ä¿¡æ¯
- ğŸ  è¿”å›é¦–é¡µæŒ‰é’®
- â†©ï¸ è¿”å›ä¸Šä¸€é¡µæŒ‰é’®
- ğŸšª é€€å‡ºç™»å½•æŒ‰é’®

---

## ğŸ“‹ è§’è‰²åŠŸèƒ½å¯¹ç…§è¡¨

| è§’è‰² | é¦–é¡µ | æ ¸å¿ƒåŠŸèƒ½ | ç§»åŠ¨ç«¯ | PCç«¯ |
|------|------|----------|--------|------|
| **å¸æœº** | æˆ‘çš„è´¹ç”¨ç”³è¯· | å½•å•ã€è´¹ç”¨ã€å·¥èµ„ | âœ… ä¸»è¦ | âš ï¸ ä»…æ˜¾ç¤ºç§»åŠ¨ç«¯ |
| **è½¦é˜Ÿé•¿** | è½¦é˜Ÿå·¥ä½œå° | å®¡æ ¸ã€ç®¡ç†è½¦è¾† | âœ… ä¸»è¦ | âœ… æœ‰PCç«¯é¡µé¢ |
| **è´§ä¸»** | è´§ä¸»çœ‹æ¿ | æŸ¥çœ‹æ•°æ® | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| **è´¢åŠ¡** | è´¢åŠ¡çœ‹æ¿ | å¼€ç¥¨ã€ä»˜æ¬¾ | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| **æ“ä½œå‘˜** | è¿å•ç®¡ç† | å½•å…¥æ•°æ® | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| **ç®¡ç†å‘˜** | è¿è¾“æ¦‚è§ˆ | å…¨éƒ¨åŠŸèƒ½ | âœ… æ”¯æŒ | âœ… ä¸»è¦ |
| **ä¸šåŠ¡** | è¿è¾“æ¦‚è§ˆ | ä¸šåŠ¡ç®¡ç† | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| **æŸ¥çœ‹è€…** | è¿è¾“æ¦‚è§ˆ | åªè¯» | âœ… æ”¯æŒ | âœ… æ”¯æŒ |

---

## ğŸ’» æ ¸å¿ƒä»£ç è§£æ

### Auth.tsx - ç™»å½•åè‡ªåŠ¨è·³è½¬ï¼ˆç¬¬29-84è¡Œï¼‰

```typescript
// å¦‚æœå·²ç»ç™»å½•ï¼Œæ ¹æ®è§’è‰²é‡å®šå‘
if (user && profile) {
  console.log('ç”¨æˆ·å·²ç™»å½•ï¼Œè§’è‰²:', profile.role);
  
  // è§’è‰²é¦–é¡µæ˜ å°„è¡¨
  const roleHomePage = {
    partner: {
      pc: '/dashboard/shipper',
      mobile: '/m/dashboard/shipper'
    },
    fleet_manager: {
      pc: '/m/internal/fleet-dashboard',
      mobile: '/m/internal/fleet-dashboard'
    },
    driver: {
      pc: '/m/internal/my-expenses',
      mobile: '/m/internal/my-expenses'
    },
    finance: {
      pc: '/dashboard/financial',
      mobile: '/m/dashboard/financial'
    },
    operator: {
      pc: '/business-entry',
      mobile: '/m/business-entry'
    }
  };
  
  // è·å–ç›®æ ‡è·¯å¾„
  const defaultHome = roleHomePage[profile.role];
  if (defaultHome) {
    const targetPath = isMobile() ? defaultHome.mobile : defaultHome.pc;
    return <Navigate to={targetPath} replace />;
  }
  
  // å…¶ä»–è§’è‰²ä½¿ç”¨é»˜è®¤è·³è½¬
  const from = location.state?.from?.pathname || '/';
  return <Navigate to={from} replace />;
}
```

---

### ProtectedRoute.tsx - æƒé™æ£€æŸ¥

```typescript
// å†…éƒ¨ç®¡ç†ç³»ç»Ÿç‰¹æ®Šå¤„ç†
if (location.pathname.startsWith('/m/internal/')) {
  // åªæ£€æŸ¥è§’è‰²ï¼Œæ”¾è¡Œå†…éƒ¨ç®¡ç†è·¯å¾„
  return children;
}

// å…¶ä»–è·¯å¾„éœ€è¦æ£€æŸ¥æ•°æ®åº“æƒé™
if (requiredPermission && !hasPageAccess(requiredPermission)) {
  // æ˜¾ç¤º"è®¿é—®è¢«æ‹’ç»"ç•Œé¢
  return <AccessDeniedUI />;
}
```

---

## ğŸ”§ è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ç™»å½•æ—¥å¿—

**æŒ‰ F12 æ‰“å¼€æ§åˆ¶å°ï¼Œç™»å½•æ—¶ä¼šçœ‹åˆ°ï¼š**

```javascript
Auth.tsx - ç”¨æˆ·å·²ç™»å½•ï¼Œå‡†å¤‡è·³è½¬
  è§’è‰²: driver
  æ˜¯å¦ç§»åŠ¨ç«¯: true
  è·³è½¬è·¯å¾„: /m/internal/my-expenses
  å®Œæ•´æ˜ å°„: {"pc":"/m/internal/my-expenses","mobile":"/m/internal/my-expenses"}
```

### æ£€æŸ¥æƒé™é—®é¢˜

```sql
-- æŸ¥è¯¢ç”¨æˆ·è§’è‰²
SELECT 
    u.email,
    p.username,
    p.full_name,
    p.role
FROM auth.users u
LEFT JOIN profiles p ON u.id = p.id
WHERE u.email = 'YOUR_EMAIL';

-- æŸ¥è¯¢ç”¨æˆ·æƒé™
SELECT * FROM user_permissions 
WHERE user_id = 'USER_ID';
```

---

## âš ï¸ å¸¸è§é—®é¢˜ FAQ

### Q1: å¸æœºç™»å½•åæ˜¾ç¤º404ï¼Ÿ

**åŸå› ï¼š** `/m/internal/my-expenses` è·¯ç”±æœªé…ç½®

**è§£å†³ï¼š** âœ… å·²åœ¨ App.tsx ä¸­é…ç½®

---

### Q2: è½¦é˜Ÿé•¿ç™»å½•åæ˜¾ç¤ºæ— æƒé™ï¼Ÿ

**åŸå› ï¼š** æƒé™æ£€æŸ¥è¿‡äºä¸¥æ ¼

**è§£å†³ï¼š** âœ… å·²åœ¨ ProtectedRoute ä¸­å¯¹ `/m/internal/*` æ”¾è¡Œ

---

### Q3: ç™»å½•åè·³è½¬åˆ°é”™è¯¯çš„é¡µé¢ï¼Ÿ

**åŸå› ï¼š** è§’è‰²æ˜ å°„è¡¨é…ç½®é”™è¯¯

**æ£€æŸ¥ï¼š** Auth.tsx ç¬¬37-58è¡Œçš„ `roleHomePage` æ˜ å°„

---

### Q4: ç§»åŠ¨ç«¯å’ŒPCç«¯è·³è½¬ä¸ä¸€è‡´ï¼Ÿ

**åŸå› ï¼š** `isMobile()` æ£€æµ‹å¯èƒ½ä¸å‡†ç¡®

**è°ƒè¯•ï¼š**
```javascript
console.log('æ˜¯å¦ç§»åŠ¨ç«¯:', isMobile());
console.log('User Agent:', navigator.userAgent);
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. è§’è‰²å‘½åè§„èŒƒ

âœ… **ä½¿ç”¨çš„è§’è‰²ï¼š**
- `driver` - å¸æœº
- `fleet_manager` - è½¦é˜Ÿé•¿
- `partner` - è´§ä¸»
- `finance` - è´¢åŠ¡
- `operator` - æ“ä½œå‘˜
- `admin` - ç®¡ç†å‘˜
- `business` - ä¸šåŠ¡
- `viewer` - æŸ¥çœ‹è€…

### 2. è·¯ç”±å‘½åè§„èŒƒ

âœ… **å†…éƒ¨ç®¡ç†ç³»ç»Ÿï¼š**
- `/m/internal/*` - ç§»åŠ¨ç«¯å†…éƒ¨ç®¡ç†
- `/internal/*` - PCç«¯å†…éƒ¨ç®¡ç†

âœ… **ä¸šåŠ¡ç³»ç»Ÿï¼š**
- `/m/*` - ç§»åŠ¨ç«¯ä¸šåŠ¡é¡µé¢
- `/*` - PCç«¯ä¸šåŠ¡é¡µé¢

### 3. æƒé™æ ‡è¯†è§„èŒƒ

âœ… **æ ¼å¼ï¼š** `æ¨¡å—.åŠŸèƒ½`

ç¤ºä¾‹ï¼š
- `dashboard.transport` - è¿è¾“çœ‹æ¿
- `internal.my_expenses` - æˆ‘çš„è´¹ç”¨
- `internal.expense_review` - è´¹ç”¨å®¡æ ¸

---

## ğŸ“± ç§»åŠ¨ç«¯èœå•ç»“æ„

### å¸æœºç«¯èœå•

```
å†…éƒ¨è½¦è¾†ç®¡ç†
  â”œâ”€ æˆ‘çš„è´¹ç”¨ç”³è¯· â­ é¦–é¡µ
  â”œâ”€ å½•å…¥è¿å•
  â”œâ”€ æˆ‘çš„å·¥èµ„
  â”œâ”€ æˆ‘çš„è½¦è¾†
  â””â”€ å·¥èµ„è®°å½•
```

### è½¦é˜Ÿé•¿ç«¯èœå•

```
å†…éƒ¨è½¦è¾†ç®¡ç†
  â”œâ”€ è½¦é˜Ÿå·¥ä½œå° â­ é¦–é¡µ
  â”œâ”€ è½¦è¾†ç®¡ç†
  â”œâ”€ è´¹ç”¨å®¡æ ¸
  â””â”€ å¸æœºçº¿è·¯é…ç½®
```

---

## ğŸ‰ æ€»ç»“

### ç™»å½•é€»è¾‘ç‰¹ç‚¹

1. âœ… **æ™ºèƒ½è·³è½¬** - æ ¹æ®è§’è‰²è‡ªåŠ¨è·³è½¬åˆ°å¯¹åº”é¦–é¡µ
2. âœ… **è®¾å¤‡é€‚é…** - è‡ªåŠ¨æ£€æµ‹ç§»åŠ¨ç«¯/PCç«¯
3. âœ… **æƒé™ä¿æŠ¤** - å¤šå±‚æƒé™éªŒè¯
4. âœ… **å‹å¥½æç¤º** - æ— æƒé™æ—¶æ˜¾ç¤ºå‹å¥½ç•Œé¢
5. âœ… **è°ƒè¯•å‹å¥½** - å®Œæ•´çš„æ§åˆ¶å°æ—¥å¿—

### è§’è‰²ä½“ç³»

- **8ä¸ªè§’è‰²** å„æœ‰ä¸“å±é¦–é¡µ
- **2å¥—ç•Œé¢** ç§»åŠ¨ç«¯å’ŒPCç«¯
- **å¤šå±‚æƒé™** è§’è‰²+èœå•+åŠŸèƒ½+æ“ä½œ

---

**æ–‡æ¡£æ›´æ–°æ—¶é—´ï¼š** 2025-11-08  
**æ–‡æ¡£çŠ¶æ€ï¼š** âœ… æœ€æ–°ä¸”å®Œæ•´

---

éœ€è¦æˆ‘è¿›ä¸€æ­¥è¯´æ˜æŸä¸ªç‰¹å®šè§’è‰²çš„ç™»å½•æµç¨‹å—ï¼ŸğŸ˜Š

