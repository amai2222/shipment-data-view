# 合同管理权限体系说明

## 📋 权限体系概述

合同管理权限体系采用多层级、细粒度的权限控制，确保不同角色用户只能访问和操作其权限范围内的合同功能。

## 🎯 权限分类

### 1. 菜单权限 (Menu Permissions)

#### 基础访问权限
- **`contracts.list`** - 合同列表
  - 可以查看合同列表页面
  - 可以使用搜索和筛选功能

#### 数据操作权限
- **`contracts.create`** - 新增合同
  - 可以创建新合同
  - 可以填写合同基本信息

- **`contracts.edit`** - 编辑合同
  - 可以修改现有合同信息
  - 可以更新合同状态

- **`contracts.delete`** - 删除合同
  - 可以删除合同记录
  - 可以批量删除合同

#### 文件管理权限
- **`contracts.files`** - 文件管理
  - 可以上传合同文件
  - 可以下载合同文件
  - 可以删除合同文件

#### 高级功能权限
- **`contracts.permissions`** - 权限管理
  - 可以管理合同访问权限
  - 可以设置用户/角色权限

- **`contracts.audit`** - 审计日志
  - 可以查看合同操作日志
  - 可以追踪合同变更历史

- **`contracts.reminders`** - 提醒管理
  - 可以设置合同到期提醒
  - 可以管理提醒规则

- **`contracts.tags`** - 标签管理
  - 可以创建和管理合同标签
  - 可以设置标签分类

- **`contracts.numbering`** - 编号管理
  - 可以管理合同编号规则
  - 可以设置自动编号

### 2. 功能权限 (Function Permissions)

#### 基础操作权限
- **`contract.view`** - 查看合同
  - 可以查看合同列表和基本信息
  - 可以查看合同详情

- **`contract.create`** - 新增合同
  - 可以创建新合同
  - 可以填写合同表单

- **`contract.edit`** - 编辑合同
  - 可以修改合同信息
  - 可以更新合同状态

- **`contract.delete`** - 删除合同
  - 可以删除合同记录
  - 可以批量删除操作

- **`contract.archive`** - 归档合同
  - 可以将合同归档
  - 可以管理归档状态

#### 文件操作权限
- **`contract.files_upload`** - 上传文件
  - 可以上传合同文件
  - 可以上传附件

- **`contract.files_download`** - 下载文件
  - 可以下载合同文件
  - 可以下载附件

- **`contract.files_delete`** - 删除文件
  - 可以删除合同文件
  - 可以删除附件

#### 高级管理权限
- **`contract.permissions_manage`** - 权限管理
  - 可以管理合同访问权限
  - 可以设置用户/角色权限
  - 可以管理部门权限

- **`contract.audit_logs`** - 审计日志
  - 可以查看合同操作日志
  - 可以追踪合同变更历史
  - 可以导出审计报告

- **`contract.reminders`** - 提醒管理
  - 可以设置合同到期提醒
  - 可以管理提醒规则
  - 可以发送提醒通知

- **`contract.tags`** - 标签管理
  - 可以创建和管理合同标签
  - 可以设置标签分类
  - 可以批量应用标签

- **`contract.numbering`** - 编号管理
  - 可以管理合同编号规则
  - 可以设置自动编号
  - 可以自定义编号格式

#### 特殊权限
- **`contract.sensitive_fields`** - 敏感信息
  - 可以查看/编辑敏感字段（金额、条款等）
  - 可以访问机密合同信息

- **`contract.export`** - 导出合同
  - 可以导出合同数据
  - 可以生成合同报告

## 👥 角色权限分配

### 系统管理员 (admin)
**权限范围：** 所有权限
- ✅ 所有菜单权限
- ✅ 所有功能权限
- ✅ 权限管理
- ✅ 系统配置

### 财务人员 (finance)
**权限范围：** 财务相关 + 查看权限
- ✅ 合同列表查看
- ✅ 文件下载
- ✅ 审计日志查看
- ✅ 敏感信息查看
- ✅ 合同导出
- ❌ 新增/编辑/删除合同
- ❌ 权限管理

### 业务人员 (business)
**权限范围：** 业务操作 + 基础管理
- ✅ 合同列表查看
- ✅ 新增/编辑合同
- ✅ 文件上传/下载
- ✅ 提醒管理
- ✅ 标签管理
- ✅ 合同导出
- ❌ 删除合同
- ❌ 权限管理
- ❌ 审计日志

### 操作员 (operator)
**权限范围：** 基础操作
- ✅ 合同列表查看
- ✅ 文件下载
- ❌ 新增/编辑/删除合同
- ❌ 权限管理
- ❌ 高级功能

### 查看者 (viewer)
**权限范围：** 只读权限
- ✅ 合同列表查看
- ✅ 文件下载
- ❌ 所有修改操作
- ❌ 权限管理
- ❌ 高级功能

## 🔒 权限控制实现

### 1. 前端权限控制
```typescript
// 检查菜单权限
const hasMenuAccess = (menuKey: string) => {
  return userPermissions.menu_permissions.includes(menuKey);
};

// 检查功能权限
const hasFunctionPermission = (functionKey: string) => {
  return userPermissions.function_permissions.includes(functionKey);
};

// 检查敏感信息权限
const canViewSensitiveFields = () => {
  return hasFunctionPermission('contract.sensitive_fields');
};
```

### 2. 组件级权限控制
```typescript
// 按钮权限控制
{hasFunctionPermission('contract.create') && (
  <Button onClick={handleCreate}>新增合同</Button>
)}

// 字段权限控制
{canViewSensitiveFields() ? (
  <Input value={contract.amount} />
) : (
  <Input value="***" disabled />
)}
```

### 3. 路由权限控制
```typescript
// 路由守卫
const ContractManagementRoute = () => {
  if (!hasMenuAccess('contracts.list')) {
    return <Navigate to="/unauthorized" />;
  }
  return <ContractManagement />;
};
```

## 📊 权限矩阵表

| 功能 | 管理员 | 财务 | 业务 | 操作员 | 查看者 |
|------|--------|------|------|--------|--------|
| 查看合同列表 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 新增合同 | ✅ | ❌ | ✅ | ❌ | ❌ |
| 编辑合同 | ✅ | ❌ | ✅ | ❌ | ❌ |
| 删除合同 | ✅ | ❌ | ❌ | ❌ | ❌ |
| 上传文件 | ✅ | ❌ | ✅ | ❌ | ❌ |
| 下载文件 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 删除文件 | ✅ | ❌ | ❌ | ❌ | ❌ |
| 权限管理 | ✅ | ❌ | ❌ | ❌ | ❌ |
| 审计日志 | ✅ | ✅ | ❌ | ❌ | ❌ |
| 提醒管理 | ✅ | ❌ | ✅ | ❌ | ❌ |
| 标签管理 | ✅ | ❌ | ✅ | ❌ | ❌ |
| 编号管理 | ✅ | ❌ | ❌ | ❌ | ❌ |
| 敏感信息 | ✅ | ✅ | ❌ | ❌ | ❌ |
| 导出合同 | ✅ | ✅ | ✅ | ❌ | ❌ |

## 🛡️ 安全考虑

### 1. 数据安全
- 敏感信息字段需要特殊权限才能查看
- 合同文件下载需要权限验证
- 审计日志记录所有操作

### 2. 操作安全
- 删除操作需要二次确认
- 批量操作需要特殊权限
- 权限变更需要管理员确认

### 3. 访问控制
- 基于角色的访问控制 (RBAC)
- 细粒度的功能权限控制
- 动态权限验证

## 🔄 权限管理流程

### 1. 权限分配
1. 管理员在权限管理页面设置用户权限
2. 系统验证权限配置的有效性
3. 权限变更立即生效

### 2. 权限验证
1. 用户访问功能时检查权限
2. 前端和后端双重验证
3. 权限不足时显示友好提示

### 3. 权限审计
1. 记录所有权限变更操作
2. 定期审查权限配置
3. 生成权限使用报告

## 📝 使用说明

### 1. 管理员操作
- 在"设置 > 权限管理"中配置用户权限
- 可以批量设置角色权限
- 可以查看权限使用情况

### 2. 用户操作
- 根据权限显示相应的功能按钮
- 权限不足时显示提示信息
- 可以查看自己的权限范围

### 3. 权限申请
- 用户可以向管理员申请权限
- 管理员可以审批权限申请
- 系统记录权限申请历史

这个权限体系确保了合同管理的安全性和灵活性，不同角色用户只能访问其职责范围内的功能，同时为管理员提供了完整的权限控制能力。
