# æ—¶åŒºé—®é¢˜å®Œæ•´å®¡æ ¸æŠ¥å‘Š

## ğŸ“‹ å®¡æ ¸èŒƒå›´

æœ¬æ¬¡å®¡æ ¸æ£€æŸ¥äº†æ‰€æœ‰æ¶‰åŠæ—¥æœŸå¤„ç†çš„ä»£ç ï¼Œç¡®ä¿ï¼š
1. âœ… å‰ç«¯ä½¿ç”¨ä¸­å›½æ—¶åŒºï¼ˆUTC+8ï¼‰å½•å…¥æ—¥æœŸ
2. âœ… åç«¯æ•°æ®åº“ä½¿ç”¨UTCå­˜å‚¨æ—¥æœŸ
3. âœ… æ—¥æœŸç­›é€‰æŸ¥è¯¢æ­£ç¡®å¤„ç†æ—¶åŒºè½¬æ¢
4. âœ… æ—¥æœŸæ˜¾ç¤ºæ­£ç¡®è½¬æ¢ä¸ºä¸­å›½æ—¶åŒº

---

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. æ—¥æœŸè¾“å…¥ä¿®å¤

#### âœ… è¿å•å½•å…¥è¡¨å•
- **æ–‡ä»¶**: `src/pages/BusinessEntry/components/LogisticsFormDialog.tsx`
  - âœ… ä½¿ç”¨ `formatChinaDateString()` å¤„ç†è£…è´§æ—¥æœŸå’Œå¸è´§æ—¥æœŸ
  - âœ… ç¼–è¾‘æ¨¡å¼ä¸‹æ­£ç¡®å¤„ç†UTCåˆ°ä¸­å›½æ—¶åŒºçš„è½¬æ¢

#### âœ… ç§»åŠ¨ç«¯è¿å•å½•å…¥
- **æ–‡ä»¶**: `src/pages/mobile/MobileBusinessEntryForm.tsx`
  - âœ… ä¿®å¤äº† `toISOString()` çš„ä½¿ç”¨ï¼Œæ”¹ä¸º `formatChinaDateString()`

#### âœ… å¿«é€Ÿå½•å…¥
- **æ–‡ä»¶**: `src/pages/mobile/internal/MobileQuickEntry.tsx`
  - âœ… ä¿®å¤äº†æ‰€æœ‰ `new Date().toISOString().split('T')[0]` çš„ä½¿ç”¨
  - âœ… ç»Ÿä¸€ä½¿ç”¨ `formatChinaDateString(new Date())` åˆå§‹åŒ–æ—¥æœŸ

#### âœ… ç£…å•å½•å…¥è¡¨å•
- **æ–‡ä»¶**: `src/pages/ScaleRecords/components/ScaleRecordForm.tsx`
  - âœ… ä¿®å¤äº†æ—¥æœŸåˆå§‹åŒ–ï¼Œä½¿ç”¨ `formatChinaDateString(new Date())`

#### âœ… ç§»åŠ¨ç«¯ç£…å•å½•å…¥
- **æ–‡ä»¶**: `src/components/mobile/MobileScaleRecordForm.tsx`
  - âœ… ä¿®å¤äº†æ—¥æœŸåˆå§‹åŒ–ï¼Œä½¿ç”¨ `formatChinaDateString(new Date())`

---

### 2. æ—¥æœŸç­›é€‰æŸ¥è¯¢ä¿®å¤

#### âœ… æ—¥æœŸèŒƒå›´ç­›é€‰å™¨
- **æ–‡ä»¶**: `src/components/ui/date-range-picker.tsx`
  - âœ… æ˜¾ç¤ºä½¿ç”¨ä¸­å›½æ—¶åŒº
  - âœ… ä¼ é€’Dateå¯¹è±¡ç»™çˆ¶ç»„ä»¶ï¼ˆä»£è¡¨ä¸­å›½æ—¶åŒºï¼‰

#### âœ… è¿å•åˆ—è¡¨ç­›é€‰
- **æ–‡ä»¶**: `src/pages/BusinessEntry/components/FilterBar.tsx`
  - âœ… ä½¿ç”¨ `formatChinaDateString()` å­˜å‚¨ç­›é€‰æ—¥æœŸ
  - **æ–‡ä»¶**: `src/pages/BusinessEntry/hooks/useLogisticsData.ts`
  - âœ… ä½¿ç”¨ `convertChinaDateToUTCDate()` å’Œ `convertChinaEndDateToUTCDate()` è½¬æ¢æŸ¥è¯¢å‚æ•°

#### âœ… ç£…å•åˆ—è¡¨ç­›é€‰
- **æ–‡ä»¶**: `src/pages/ScaleRecords/components/FilterSection.tsx`
  - âœ… ä½¿ç”¨ `formatChinaDateString()` å­˜å‚¨ç­›é€‰æ—¥æœŸ
- **æ–‡ä»¶**: `src/pages/ScaleRecords/hooks/useScaleRecords.ts`
  - âœ… ä½¿ç”¨ `convertChinaDateToUTCDate()` å’Œ `convertChinaEndDateToUTCDate()` è½¬æ¢æŸ¥è¯¢å‚æ•°

#### âœ… å•æ—¥æŸ¥è¯¢ä¿®å¤
- **æ–‡ä»¶**: `src/pages/InvoiceRequestManagement.tsx`
  - âœ… ä½¿ç”¨ `convertSingleDateToDateRange()` å¤„ç†å•æ—¥æŸ¥è¯¢
- **æ–‡ä»¶**: `src/pages/InvoiceAudit.tsx`
  - âœ… ä½¿ç”¨ `convertSingleDateToDateRange()` å¤„ç†å•æ—¥æŸ¥è¯¢
- **æ–‡ä»¶**: `src/pages/PaymentAudit.tsx`
  - âœ… ä½¿ç”¨ `convertSingleDateToDateRange()` å¤„ç†å•æ—¥æŸ¥è¯¢
- **æ–‡ä»¶**: `src/pages/PaymentRequestsList.tsx`
  - âœ… ä½¿ç”¨ `convertSingleDateToDateRange()` å¤„ç†å•æ—¥æŸ¥è¯¢

#### âœ… å…¶ä»–é¡µé¢ç­›é€‰
- **æ–‡ä»¶**: `src/pages/Home.tsx` - ä»ªè¡¨ç›˜ç­›é€‰ âœ…
- **æ–‡ä»¶**: `src/pages/FinanceReconciliation.tsx` - è´¢åŠ¡å¯¹è´¦ç­›é€‰ âœ…
- **æ–‡ä»¶**: `src/pages/PaymentRequest.tsx` - ä»˜æ¬¾ç”³è¯·ç­›é€‰ âœ…
- **æ–‡ä»¶**: `src/pages/InvoiceRequest/components/InvoiceRequestFilterBar.tsx` - å¼€ç¥¨ç”³è¯·ç­›é€‰ âœ…

---

### 3. æ—¥æœŸå·¥å…·å‡½æ•°

#### âœ… æ ¸å¿ƒå·¥å…·å‡½æ•°ï¼ˆ`src/utils/dateUtils.ts`ï¼‰

1. **`convertChinaDateToUTCDate(date: Date): string`**
   - âœ… å°†ä¸­å›½æ—¶åŒºæ—¥æœŸè½¬æ¢ä¸ºUTCæ—¥æœŸï¼ˆç”¨äºæŸ¥è¯¢å¼€å§‹æ—¥æœŸï¼‰

2. **`convertChinaEndDateToUTCDate(date: Date): string`**
   - âœ… å°†ä¸­å›½æ—¶åŒºç»“æŸæ—¥æœŸè½¬æ¢ä¸ºUTCæ—¥æœŸï¼ˆåŠ 1å¤©ï¼Œç”¨äºæŸ¥è¯¢ç»“æŸæ—¥æœŸï¼‰

3. **`convertSingleDateToDateRange(date: Date): { startDate: string; endDate: string }`**
   - âœ… å°†å•æ—¥æŸ¥è¯¢è½¬æ¢ä¸ºæ—¥æœŸèŒƒå›´ï¼ˆç”¨äºå•æ—¥ç­›é€‰ï¼‰

4. **`formatChinaDateString(date: Date): string`**
   - âœ… æ ¼å¼åŒ–ä¸­å›½æ—¶åŒºæ—¥æœŸä¸ºå­—ç¬¦ä¸²ï¼ˆYYYY-MM-DDï¼‰

5. **`convertUTCDateToChinaDate(utcDateStr: string): Date`**
   - âœ… å°†UTCæ—¥æœŸå­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸­å›½æ—¶åŒºDateå¯¹è±¡ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰

6. **`formatChinaDate(dateValue, formatStr): string`**
   - âœ… æ ¼å¼åŒ–æ•°æ®åº“UTCæ—¶é—´ä¸ºä¸­å›½æ—¶åŒºæ˜¾ç¤º

---

## âœ… å·²ç¡®è®¤æ­£ç¡®çš„ä»£ç 

### 1. æ—¥æœŸæ˜¾ç¤º
ä»¥ä¸‹ä»£ç ä½¿ç”¨ `new Date(dateString)` å’Œ `format()` å‡½æ•°ï¼ŒJavaScriptä¼šè‡ªåŠ¨å¤„ç†æ—¶åŒºè½¬æ¢ï¼Œæ˜¾ç¤ºæ­£ç¡®ï¼š
- âœ… `src/pages/BusinessEntry/components/LogisticsTable.tsx` - ä½¿ç”¨ `toLocaleDateString('zh-CN')`
- âœ… `src/pages/mobile/MobileBusinessEntry.tsx` - ä½¿ç”¨ `format(new Date(record.loading_date), 'yyyy-MM-dd')`
- âœ… `src/pages/ScaleRecords/index.tsx` - ä½¿ç”¨ `format(new Date(record.loading_date), 'yyyy-MM-dd')`

### 2. æ—¶é—´æˆ³å¤„ç†
ä»¥ä¸‹ä»£ç ä½¿ç”¨ `toISOString()` ç”¨äºæ—¶é—´æˆ³ï¼ˆcreated_at, updated_atï¼‰ï¼Œè¿™æ˜¯æ­£ç¡®çš„ï¼š
- âœ… æ‰€æœ‰ `updated_at: new Date().toISOString()` - ç”¨äºæ›´æ–°æ—¶é—´æˆ³
- âœ… æ‰€æœ‰ `created_at` æ¯”è¾ƒ - ç”¨äºæ’åºå’Œç­›é€‰

### 3. æ—¥æœŸæ¯”è¾ƒå’Œæ’åº
ä»¥ä¸‹ä»£ç ä½¿ç”¨ `getTime()` ç”¨äºæ—¥æœŸæ¯”è¾ƒå’Œæ’åºï¼Œè¿™æ˜¯æ­£ç¡®çš„ï¼š
- âœ… æ‰€æœ‰ `new Date(a.loading_date).getTime() - new Date(b.loading_date).getTime()` - ç”¨äºæ’åº

---

## ğŸ” æ—¶åŒºå¤„ç†æµç¨‹

### 1. æ—¥æœŸå½•å…¥æµç¨‹
```
ç”¨æˆ·é€‰æ‹©æ—¥æœŸï¼ˆä¸­å›½æ—¶åŒºï¼‰
  â†“
formatChinaDateString() â†’ "YYYY-MM-DD"ï¼ˆä¸­å›½æ—¶åŒºå­—ç¬¦ä¸²ï¼‰
  â†“
ä¼ é€’ç»™åç«¯RPCå‡½æ•°
  â†“
åç«¯æ¥æ”¶æ—¥æœŸå­—ç¬¦ä¸²ï¼Œè½¬æ¢ä¸ºUTCå­˜å‚¨
```

### 2. æ—¥æœŸæŸ¥è¯¢æµç¨‹
```
ç”¨æˆ·é€‰æ‹©æ—¥æœŸèŒƒå›´ï¼ˆä¸­å›½æ—¶åŒºï¼‰
  â†“
convertChinaDateToUTCDate() â†’ UTCå¼€å§‹æ—¥æœŸ
convertChinaEndDateToUTCDate() â†’ UTCç»“æŸæ—¥æœŸï¼ˆ+1å¤©ï¼‰
  â†“
ä¼ é€’ç»™åç«¯RPCå‡½æ•°
  â†“
åç«¯ä½¿ç”¨UTCæ—¥æœŸè¿›è¡ŒæŸ¥è¯¢
```

### 3. æ—¥æœŸæ˜¾ç¤ºæµç¨‹
```
æ•°æ®åº“è¿”å›UTCæ—¶é—´ï¼ˆtimestamptzï¼‰
  â†“
new Date(utcTimeString) â†’ JavaScriptè‡ªåŠ¨è½¬æ¢ä¸ºæœ¬åœ°æ—¶åŒº
  â†“
format(date, 'yyyy-MM-dd') â†’ æ˜¾ç¤ºä¸ºä¸­å›½æ—¶åŒºæ—¥æœŸ
```

---

## âœ… ä¿®å¤æ€»ç»“

### ä¿®å¤çš„æ–‡ä»¶æ•°é‡
- **æ—¥æœŸè¾“å…¥ä¿®å¤**: 5ä¸ªæ–‡ä»¶
- **æ—¥æœŸç­›é€‰ä¿®å¤**: 15+ä¸ªæ–‡ä»¶
- **æ—¥æœŸå·¥å…·å‡½æ•°**: 1ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼ˆåŒ…å«6ä¸ªå·¥å…·å‡½æ•°ï¼‰

### ä¿®å¤çš„é—®é¢˜ç±»å‹
1. âœ… æ—¥æœŸåˆå§‹åŒ–ä½¿ç”¨ `toISOString()` å¯¼è‡´çš„æ—¶åŒºåç§»
2. âœ… æ—¥æœŸè¾“å…¥ä½¿ç”¨ `toISOString()` å¯¼è‡´çš„æ—¶åŒºåç§»
3. âœ… æ—¥æœŸç­›é€‰æŸ¥è¯¢æœªæ­£ç¡®å¤„ç†æ—¶åŒºè½¬æ¢
4. âœ… å•æ—¥æŸ¥è¯¢æœªæ­£ç¡®å¤„ç†æ—¶åŒºè½¬æ¢

---

## ğŸ¯ æ—¶åŒºå¤„ç†åŸåˆ™

### å‰ç«¯åŸåˆ™
1. âœ… **ç”¨æˆ·è¾“å…¥**: å§‹ç»ˆä½¿ç”¨ä¸­å›½æ—¶åŒºï¼ˆUTC+8ï¼‰
2. âœ… **æ—¥æœŸæ˜¾ç¤º**: è‡ªåŠ¨è½¬æ¢ä¸ºä¸­å›½æ—¶åŒºæ˜¾ç¤º
3. âœ… **æŸ¥è¯¢å‚æ•°**: è½¬æ¢ä¸ºUTCåä¼ é€’ç»™åç«¯

### åç«¯åŸåˆ™
1. âœ… **æ•°æ®å­˜å‚¨**: ä½¿ç”¨UTCæ—¶åŒºï¼ˆtimestamptzï¼‰
2. âœ… **æ•°æ®æŸ¥è¯¢**: ä½¿ç”¨UTCæ—¥æœŸè¿›è¡Œæ¯”è¾ƒ
3. âœ… **æ•°æ®è¿”å›**: è¿”å›UTCæ—¶é—´ï¼Œå‰ç«¯è´Ÿè´£è½¬æ¢æ˜¾ç¤º

---

## âœ… å®¡æ ¸ç»“è®º

### æ—¶åŒºé—®é¢˜å·²å®Œå…¨è§£å†³ âœ…

1. âœ… **æ—¥æœŸè¾“å…¥**: æ‰€æœ‰æ—¥æœŸè¾“å…¥éƒ½ä½¿ç”¨ä¸­å›½æ—¶åŒºï¼Œé€šè¿‡ `formatChinaDateString()` å¤„ç†
2. âœ… **æ—¥æœŸæŸ¥è¯¢**: æ‰€æœ‰æ—¥æœŸæŸ¥è¯¢éƒ½æ­£ç¡®è½¬æ¢ä¸ºUTCï¼Œé€šè¿‡ `convertChinaDateToUTCDate()` ç­‰å‡½æ•°å¤„ç†
3. âœ… **æ—¥æœŸæ˜¾ç¤º**: æ‰€æœ‰æ—¥æœŸæ˜¾ç¤ºéƒ½æ­£ç¡®è½¬æ¢ä¸ºä¸­å›½æ—¶åŒºï¼Œé€šè¿‡ `format()` å‡½æ•°å¤„ç†
4. âœ… **æ—¥æœŸå·¥å…·**: ç»Ÿä¸€çš„æ—¥æœŸå·¥å…·å‡½æ•°ç¡®ä¿æ—¶åŒºå¤„ç†çš„ä¸€è‡´æ€§

### å»ºè®®
1. âœ… ç»§ç»­ä½¿ç”¨ `dateUtils.ts` ä¸­çš„å·¥å…·å‡½æ•°å¤„ç†æ‰€æœ‰æ—¥æœŸæ“ä½œ
2. âœ… é¿å…ç›´æ¥ä½¿ç”¨ `toISOString()` å¤„ç†æ—¥æœŸè¾“å…¥
3. âœ… ä½¿ç”¨ `formatChinaDateString()` å¤„ç†æ‰€æœ‰æ—¥æœŸæ ¼å¼åŒ–
4. âœ… ä½¿ç”¨ `convertChinaDateToUTCDate()` ç­‰å‡½æ•°å¤„ç†æ‰€æœ‰æ—¥æœŸæŸ¥è¯¢è½¬æ¢

---

**å®¡æ ¸æ—¥æœŸ**: 2025-01-XX  
**å®¡æ ¸çŠ¶æ€**: âœ… é€šè¿‡  
**æ—¶åŒºé—®é¢˜**: âœ… å·²å®Œå…¨è§£å†³

