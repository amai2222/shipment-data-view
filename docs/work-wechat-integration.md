# 企业微信集成使用指南

## 功能概述

本系统已成功集成企业微信，提供以下功能：

1. **企业微信登录** - 用户可以通过企业微信直接登录系统
2. **付款申请审批** - 支持通过企业微信审批流程处理付款申请

## 配置信息

系统已配置以下企业微信参数：
- **企业ID**: ww074db5e6770417d9
- **应用ID**: 1000002
- **应用Secret**: 已安全存储在后端

## 使用方法

### 1. 企业微信登录

#### 在企业微信中使用：
1. 在企业微信中打开应用
2. 系统会自动检测企业微信环境
3. 点击"企业微信授权登录"按钮
4. 完成授权后自动登录系统

#### 在浏览器中使用：
1. 访问登录页面
2. 选择"企业微信"标签页
3. 点击"在企业微信中打开"跳转到企业微信

### 2. 付款申请审批

#### 提交审批：
1. 在付款申请列表中找到状态为"待审批"的申请单
2. 点击"企业微信审批"按钮
3. 确认申请信息无误后点击"提交企业微信审批"
4. 系统会自动在企业微信中创建审批单

#### 审批流程：
1. 审批人会在企业微信中收到审批通知
2. 审批人可以查看详细的付款信息
3. 审批完成后，系统会自动更新申请单状态

## 技术实现

### 后端Edge Functions
- `work-wechat-auth`: 处理企业微信用户认证
- `work-wechat-approval`: 处理审批申请的提交和回调

### 数据库扩展
- `profiles`表新增企业微信用户字段
- `payment_requests`表新增审批相关字段

### 前端组件
- `WorkWechatAuth`: 企业微信登录组件
- `PaymentApproval`: 付款审批组件

## 注意事项

1. **首次使用**: 用户首次通过企业微信登录时，系统会自动创建账户
2. **权限管理**: 新用户默认角色为"viewer"，需要管理员手动调整权限
3. **审批模板**: 需要在企业微信管理后台配置相应的审批模板
4. **回调地址**: 确保企业微信应用的回调地址设置正确

## 故障排除

### 常见问题：

1. **无法登录**
   - 检查是否在企业微信环境中
   - 确认企业微信应用配置正确

2. **审批提交失败**
   - 检查用户是否已绑定企业微信账号
   - 确认企业微信应用权限设置

3. **审批状态不更新**
   - 检查审批回调地址设置
   - 查看后端日志确认回调是否正常接收

## 联系支持

如遇到技术问题，请联系系统管理员或查看相关日志文件。