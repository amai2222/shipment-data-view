# 🚀 项目管理合作方选择优化 - 快速指南

## ✨ 新功能

在项目管理添加合作链路选择合作方时，现在支持：

### 1. 按类型分类 🏷️
- 🏢 **货主**：支持层级树展示
- 👥 **合作商**：普通列表展示
- 🏦 **资方**：普通列表展示
- 🏠 **本公司**：普通列表展示

### 2. 货主层级树 🌳
- ✅ 可视化展示层级关系
- ✅ 展开/折叠子节点
- ✅ 一键全部展开/折叠
- ✅ 根节点标记
- ✅ 清晰的缩进显示

---

## 📸 使用演示

### 界面预览

```
┌─────────────────────────────────────────┐
│ 请选择合作方                            │
└─────────────────────────────────────────┘
              ↓ 点击后
┌─────────────────────────────────────────┐
│ [货主 15] [合作商 8] [资方 3] [本公司 1] │ ← 标签切换
├─────────────────────────────────────────┤
│              全部展开 | 全部折叠         │ ← 快捷操作
│                                         │
│ ▼ 🏢 中粮集团 (5.20%) [根]              │ ← 可展开
│    ▶ 🏢 中粮北京 (5.20%)               │ ← 可展开
│    ▼ 🏢 中粮上海 (5.70%)               │ ← 已展开
│       🏢 中粮浦东 (5.70%)              │ ← 子节点
│                                         │
│ ▶ 🏢 邯郸集团 (9.00%) [根]              │ ← 可展开
│                                         │
└─────────────────────────────────────────┘
```

---

## 🎯 使用步骤

### 步骤 1：进入项目管理

1. 打开系统
2. 点击 **项目管理** 菜单
3. 点击 **+ 新建项目** 或编辑现有项目

### 步骤 2：添加合作链路

1. 滚动到"合作链路配置"区域
2. 点击 **添加链路** 按钮
3. 输入链路名称（如："默认链路"）
4. 选择计费模式（计吨/计车/计方）

### 步骤 3：选择合作方 ⭐

#### A. 选择货主（树型结构）

1. 点击 **添加合作方** 按钮
2. 打开合作方选择器
3. **货主** 标签默认选中
4. 查看层级树结构：
   - 点击 ▶ 展开子节点
   - 点击 ▼ 折叠子节点
   - 使用"全部展开"查看完整层级
5. 点击合作方名称进行选择
6. 选中项会显示蓝色高亮

#### B. 选择其他类型（列表）

1. 点击 **合作商/资方/本公司** 标签
2. 浏览列表
3. 点击合作方名称进行选择
4. 选中项会显示蓝色高亮

### 步骤 4：配置合作方参数

选择合作方后，配置：
- **级别**：数字（1, 2, 3...）
- **计算方式**：税点或利润
- **税点/利润值**：具体数值

### 步骤 5：保存项目

点击 **保存** 按钮完成配置

---

## 💡 使用技巧

### 技巧 1：快速查找货主
1. 点击"全部展开"查看所有货主
2. 根据层级关系找到目标货主
3. 选择后点击"全部折叠"收起

### 技巧 2：查看数量统计
标签上的数字显示每种类型的合作方数量：
- 货主 (15) - 有 15 个货主
- 合作商 (8) - 有 8 个合作商
- ...

### 技巧 3：识别根节点
- 货主类型会显示 [根] 标记
- 根节点表示最顶层的货主，没有上级

### 技巧 4：理解层级关系
- 缩进表示层级深度
- 每层缩进 20px
- 子节点在父节点下方
- 展开/折叠控制可见性

---

## 🎨 界面元素说明

### 类型标签
```
🏢 货主 (15)    👥 合作商 (8)    🏦 资方 (3)    🏠 本公司 (1)
```
- **图标**：区分类型
- **数字**：该类型的合作方数量
- **高亮**：当前选中的标签

### 货主树节点
```
▶/▼ 🏢 合作方名称 (5.20%) [根]
```
- **▶/▼**：展开/折叠按钮
- **🏢**：货主图标
- **名称**：合作方名称
- **(5.20%)**：默认税点
- **[根]**：根节点标记

### 普通列表项
```
👥 合作方名称 (6.00%)
```
- **👥**：类型图标
- **名称**：合作方名称
- **(6.00%)**：默认税点

### 快捷操作
```
全部展开 | 全部折叠
```
- **全部展开**：展开所有有子节点的货主
- **全部折叠**：折叠所有货主

---

## 📊 示例场景

### 场景 1：添加货主链路

**需求**：添加"中粮集团 → 中粮北京"链路

**操作**：
1. 点击"货主"标签
2. 点击"全部展开"
3. 找到"中粮集团"并展开
4. 找到"中粮北京"
5. 依次选择添加到链路

### 场景 2：添加合作商

**需求**：添加合作商"山西晋丰"

**操作**：
1. 点击"合作商"标签
2. 在列表中找到"山西晋丰"
3. 点击选择

### 场景 3：混合链路

**需求**：货主 → 合作商 → 资方

**操作**：
1. 第一层：货主标签 → 选择货主
2. 第二层：合作商标签 → 选择合作商
3. 第三层：资方标签 → 选择资方

---

## ❓ 常见问题

### Q1: 找不到某个合作方？

**A**: 检查是否选择了正确的类型标签。例如，合作商不会显示在货主标签中。

### Q2: 货主树看不到子节点？

**A**: 点击节点左侧的 ▶ 展开按钮，或点击"全部展开"。

### Q3: 怎么知道哪个是根节点？

**A**: 根节点会显示灰色的 [根] 标记。

### Q4: 能不能搜索合作方？

**A**: 当前版本暂不支持搜索，后续版本会添加。可以使用"全部展开"快速浏览所有货主。

### Q5: 某个类型显示数量为 0？

**A**: 说明数据库中没有该类型的合作方，可以在合作方管理页面添加。

### Q6: 税点信息从哪里来？

**A**: 显示的是合作方的默认税点，在添加后可以在链路配置中修改。

---

## 🔧 调试提示

如果遇到问题：

1. **刷新页面**：F5 或 Ctrl+F5
2. **检查数据**：确保合作方有 `partner_type` 字段
3. **查看控制台**：F12 打开开发者工具查看错误
4. **清除缓存**：Ctrl+Shift+Delete 清除浏览器缓存

---

## 📝 技术要求

### 数据库字段要求

合作方表必须包含：
- ✅ `partner_type` - 类型字段
- ✅ `parent_partner_id` - 上级 ID（货主）
- ✅ `hierarchy_path` - 层级路径（货主）
- ✅ `hierarchy_depth` - 层级深度（货主）
- ✅ `is_root` - 是否根节点（货主）

如果缺少这些字段，请执行数据库迁移：
- `20250122_add_partner_type.sql`
- `20250121_add_partner_unlimited_hierarchy.sql`

---

## ✨ 优势总结

### 优化前 ❌
- 所有合作方混在一起
- 找不到特定类型
- 看不到层级关系
- 长列表难以浏览

### 优化后 ✅
- 按类型清晰分类
- 标签快速切换
- 层级关系可视化
- 树型结构易浏览
- 数量统计一目了然

---

## 🎉 开始使用！

1. 打开项目管理
2. 新建或编辑项目
3. 添加合作链路
4. 体验新的合作方选择器

有任何问题欢迎反馈！😊

