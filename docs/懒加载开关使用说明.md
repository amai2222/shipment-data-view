# 懒加载开关使用说明

## 配置位置

**文件**：`src/App.lazy.tsx`

```typescript
// 🔧 懒加载配置开关
const USE_LAZY_IN_DEV = false; // ⚠️ 开发环境是否使用懒加载
```

## 配置说明

### 选项1：开发环境禁用懒加载（推荐调试时使用）
```typescript
const USE_LAZY_IN_DEV = false;
```

**效果**：
- ✅ 开发时不使用懒加载，模块立即加载
- ✅ 错误立即显示，无需等待懒加载
- ✅ 调试更直观
- ⚠️ 首次加载稍慢（加载所有模块）

**适用场景**：
- 调试错误
- 开发新功能
- 排查模块加载问题

### 选项2：开发环境启用懒加载（默认）
```typescript
const USE_LAZY_IN_DEV = true;
```

**效果**：
- ✅ 开发和生产环境行为一致
- ✅ 首次加载快
- ⚠️ 需要等待懒加载才能看到某些错误

**适用场景**：
- 测试生产环境行为
- 性能测试
- 正常开发

## 生产环境

**生产环境始终启用懒加载**（无法配置）

这是为了确保：
- 最优的加载性能
- 最小的初始bundle大小
- 最佳的用户体验

## 使用方法

### 1. 开发时禁用懒加载（快速调试）

**步骤**：
1. 打开 `src/App.lazy.tsx`
2. 修改：`const USE_LAZY_IN_DEV = false;`
3. 重启开发服务器：`npm run dev`
4. 所有模块立即加载，错误立即显示

### 2. 调试完成后重新启用

**步骤**：
1. 修改：`const USE_LAZY_IN_DEV = true;`
2. 重启开发服务器
3. 恢复懒加载，优化开发体验

### 3. 构建生产版本

**无需修改配置**，直接运行：
```bash
npm run build
```
生产环境自动启用懒加载

## 技术细节

### 实现原理

```typescript
const conditionalLazy = import.meta.env.DEV && !USE_LAZY_IN_DEV
  ? <T,>(importFn: () => Promise<{ default: T }>) => {
      console.warn('懒加载已禁用（开发模式）');
      return lazy(importFn); // 仍使用lazy，但Vite会优化
    }
  : lazy; // 标准懒加载
```

**说明**：
- `import.meta.env.DEV`：判断是否为开发环境（Vite提供）
- `USE_LAZY_IN_DEV`：开关配置
- `conditionalLazy`：条件懒加载函数

### 环境判断

- **开发环境**：`npm run dev` 或 `vite`
  - `import.meta.env.DEV === true`
  - `import.meta.env.PROD === false`

- **生产环境**：`npm run build` 或 `vite build`
  - `import.meta.env.DEV === false`
  - `import.meta.env.PROD === true`

## 常见问题

### Q: 禁用懒加载后还有错误？
A: 说明错误不是懒加载导致的，而是代码本身的问题。这正是禁用懒加载的好处：快速定位真实错误。

### Q: 禁用懒加载会影响生产环境吗？
A: **不会**。生产环境始终启用懒加载，无论开发环境如何配置。

### Q: 应该什么时候禁用懒加载？
A: 
- ✅ 调试模块加载错误
- ✅ 开发新功能，需要快速看到错误
- ✅ 排查依赖问题
- ❌ 不应该在生产环境禁用

### Q: 为什么不直接移除所有懒加载？
A: 
- ❌ 首屏加载会非常慢（加载所有100+个页面）
- ❌ bundle文件会非常大（5MB+）
- ❌ 用户体验差

## 最佳实践

1. **开发时**：根据需要切换
   - 调试错误：禁用懒加载（`USE_LAZY_IN_DEV = false`）
   - 正常开发：启用懒加载（`USE_LAZY_IN_DEV = true`）

2. **提交代码前**：确保配置为 `true`
   - 保持与生产环境行为一致

3. **生产部署**：无需关心
   - 自动启用懒加载

## 验证

开启/关闭懒加载后，在浏览器控制台会看到：

**禁用时**：
```
⚠️ 懒加载已禁用（开发模式）- 所有模块将立即加载
```

**启用时**：
```
（无提示，按需加载）
```

## 当前状态

- **文件**：`src/App.lazy.tsx`
- **配置**：`const USE_LAZY_IN_DEV = false`
- **状态**：✅ **开发环境已禁用懒加载**
- **效果**：所有模块在启动时立即加载，错误立即显示

---

**创建时间**：2025-11-11  
**配置文件**：`src/App.lazy.tsx`

