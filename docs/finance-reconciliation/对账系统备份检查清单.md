# å¯¹è´¦ç³»ç»Ÿå¤‡ä»½æ£€æŸ¥æ¸…å•

## ğŸ“‹ å¤‡ä»½æ¦‚è¿°

å¯¹è´¦ç³»ç»Ÿçš„æ•°æ®ä¸»è¦å­˜å‚¨åœ¨ `logistics_partner_costs` è¡¨ä¸­ï¼Œé€šè¿‡æ–°å¢å­—æ®µå®ç°ã€‚éœ€è¦ç¡®ä¿å¤‡ä»½åŒ…å«è¿™äº›å­—æ®µã€‚

## âœ… å·²åŒ…å«åœ¨å¤‡ä»½ä¸­çš„è¡¨

### 1. `logistics_partner_costs`ï¼ˆè¿å•æˆæœ¬è¡¨ï¼‰

**çŠ¶æ€**ï¼šâœ… **å·²åŒ…å«åœ¨å¤‡ä»½åˆ—è¡¨ä¸­**

**å¯¹è´¦ç›¸å…³å­—æ®µ**ï¼š
- `reconciliation_status` - å¯¹è´¦çŠ¶æ€
- `reconciliation_date` - å¯¹è´¦æ—¥æœŸ
- `reconciliation_by` - å¯¹è´¦æ“ä½œäºº
- `reconciliation_notes` - å¯¹è´¦å¤‡æ³¨

**å¤‡ä»½ä½ç½®**ï¼š`src/pages/Settings/SystemBackup.tsx` ç¬¬34è¡Œ

```typescript
logistics_partner_costs: true,  // âœ… å·²åŒ…å«
```

**è¯´æ˜**ï¼šå¯¹è´¦æ•°æ®æ˜¯ `logistics_partner_costs` è¡¨çš„å­—æ®µï¼Œå¤‡ä»½è¯¥è¡¨æ—¶ä¼šè‡ªåŠ¨åŒ…å«æ‰€æœ‰å¯¹è´¦ä¿¡æ¯ã€‚

---

## âš ï¸ å¯èƒ½ç¼ºå¤±çš„è¡¨ï¼ˆéœ€è¦æ£€æŸ¥ï¼‰

### 1. `partner_balance`ï¼ˆè´§ä¸»ä½™é¢è¡¨ï¼‰

**çŠ¶æ€**ï¼šâŒ **æœªåŒ…å«åœ¨å¤‡ä»½åˆ—è¡¨ä¸­**

**é‡è¦æ€§**ï¼šâ­â­â­â­ï¼ˆé‡è¦ï¼‰

**è¯´æ˜**ï¼šå­˜å‚¨è´§ä¸»è´¦æˆ·ä½™é¢ï¼Œä¸å¯¹è´¦ç³»ç»Ÿç›¸å…³ï¼ˆè´¢åŠ¡æ•°æ®ï¼‰ã€‚

**å»ºè®®**ï¼šæ·»åŠ åˆ°å¤‡ä»½åˆ—è¡¨

---

### 2. `partner_balance_transactions`ï¼ˆè´§ä¸»ä½™é¢æµæ°´è¡¨ï¼‰

**çŠ¶æ€**ï¼šâŒ **æœªåŒ…å«åœ¨å¤‡ä»½åˆ—è¡¨ä¸­**

**é‡è¦æ€§**ï¼šâ­â­â­â­ï¼ˆé‡è¦ï¼‰

**è¯´æ˜**ï¼šå­˜å‚¨è´§ä¸»ä½™é¢äº¤æ˜“æµæ°´ï¼ŒåŒ…æ‹¬æ”¶æ¬¾ã€æ‰£æ¬¾ç­‰è®°å½•ã€‚

**å»ºè®®**ï¼šæ·»åŠ åˆ°å¤‡ä»½åˆ—è¡¨

---

### 3. `invoice_receipt_records`ï¼ˆæ”¶æ¬¾è®°å½•è¡¨ï¼‰

**çŠ¶æ€**ï¼šâŒ **æœªåŒ…å«åœ¨å¤‡ä»½åˆ—è¡¨ä¸­**

**é‡è¦æ€§**ï¼šâ­â­â­â­ï¼ˆé‡è¦ï¼‰

**è¯´æ˜**ï¼šå­˜å‚¨è´¢åŠ¡æ”¶æ¬¾è®°å½•ï¼Œä¸å¯¹è´¦ç³»ç»Ÿç›¸å…³ã€‚

**å»ºè®®**ï¼šæ·»åŠ åˆ°å¤‡ä»½åˆ—è¡¨

---

### 4. `scale_records`ï¼ˆç£…å•è®°å½•è¡¨ï¼‰

**çŠ¶æ€**ï¼šâŒ **æœªåŒ…å«åœ¨å¤‡ä»½åˆ—è¡¨ä¸­**

**é‡è¦æ€§**ï¼šâ­â­â­ï¼ˆä¸­ç­‰ï¼‰

**è¯´æ˜**ï¼šç£…å•ç®¡ç†æ•°æ®ï¼Œä¸šåŠ¡ç›¸å…³ã€‚

**å»ºè®®**ï¼šæ·»åŠ åˆ°å¤‡ä»½åˆ—è¡¨

---

## ğŸ“Š å®Œæ•´å¤‡ä»½è¡¨æ¸…å•

### å½“å‰å¤‡ä»½åˆ—è¡¨ï¼ˆSystemBackup.tsxï¼‰

#### âœ… å·²åŒ…å«çš„è¡¨

**æ ¸å¿ƒä¸šåŠ¡è¡¨**ï¼š
- âœ… `logistics_records` - è¿å•è®°å½•
- âœ… `logistics_partner_costs` - è¿å•æˆæœ¬ï¼ˆ**åŒ…å«å¯¹è´¦å­—æ®µ**ï¼‰

**å†…éƒ¨è½¦è¾†ç®¡ç†ç³»ç»Ÿ**ï¼š
- âœ… `internal_drivers` - å†…éƒ¨å¸æœº
- âœ… `internal_vehicles` - å†…éƒ¨è½¦è¾†
- âœ… `internal_driver_vehicle_relations` - å¸æœºè½¦è¾†å…³ç³»
- âœ… `fleet_manager_projects` - è½¦é˜Ÿé•¿é¡¹ç›®
- âœ… `fleet_manager_favorite_routes` - å¸¸ç”¨çº¿è·¯
- âœ… `fleet_manager_favorite_route_drivers` - çº¿è·¯åˆ†é…
- âœ… `dispatch_orders` - æ´¾å•
- âœ… `internal_driver_expense_applications` - å¸æœºè´¹ç”¨ç”³è¯·
- âœ… `internal_vehicle_change_applications` - è½¦è¾†å˜æ›´ç”³è¯·

**é¡¹ç›®å’Œåˆä½œæ–¹**ï¼š
- âœ… `projects` - é¡¹ç›®ä¿¡æ¯
- âœ… `partners` - åˆä½œæ–¹ä¿¡æ¯
- âœ… `project_partners` - é¡¹ç›®åˆä½œæ–¹é…ç½®
- âœ… `partner_chains` - åˆä½œé“¾è·¯

**è´¢åŠ¡æ•°æ®**ï¼š
- âœ… `payment_requests` - ä»˜æ¬¾ç”³è¯·
- âœ… `invoice_requests` - å¼€ç¥¨ç”³è¯·
- âœ… `payment_records` - ä»˜æ¬¾è®°å½•
- âœ… `invoice_records` - å¼€ç¥¨è®°å½•

**åŸºç¡€æ•°æ®**ï¼š
- âœ… `drivers` - å¸æœº
- âœ… `locations` - åœ°ç‚¹

**ç”¨æˆ·å’Œæƒé™**ï¼š
- âœ… `profiles` - ç”¨æˆ·ä¿¡æ¯
- âœ… `user_permissions` - ç”¨æˆ·æƒé™
- âœ… `role_permission_templates` - è§’è‰²æ¨¡æ¿

**èœå•é…ç½®**ï¼š
- âœ… `menu_config` - èœå•é…ç½®

**åˆåŒ**ï¼š
- âš ï¸ `contracts` - åˆåŒä¿¡æ¯ï¼ˆé»˜è®¤ä¸å¤‡ä»½ï¼‰

---

#### âŒ ç¼ºå¤±çš„è¡¨

**è´¢åŠ¡ç›¸å…³**ï¼š
- âŒ `partner_balance` - è´§ä¸»ä½™é¢è¡¨
- âŒ `partner_balance_transactions` - è´§ä¸»ä½™é¢æµæ°´è¡¨
- âŒ `invoice_receipt_records` - æ”¶æ¬¾è®°å½•è¡¨

**ä¸šåŠ¡ç›¸å…³**ï¼š
- âŒ `scale_records` - ç£…å•è®°å½•è¡¨

**å…¶ä»–**ï¼š
- âŒ `notifications` - é€šçŸ¥è¡¨
- âŒ `operation_logs` - æ“ä½œæ—¥å¿—è¡¨
- âŒ `permission_audit_logs` - æƒé™å®¡è®¡æ—¥å¿—è¡¨
- âŒ `saved_searches` - ä¿å­˜çš„æœç´¢è¡¨

---

## ğŸ”§ å»ºè®®æ›´æ–°å¤‡ä»½é…ç½®

### éœ€è¦æ·»åŠ çš„è¡¨

```typescript
// åœ¨ SystemBackup.tsx çš„ selectedTables ä¸­æ·»åŠ ï¼š

// è´¢åŠ¡æ•°æ®ï¼ˆæ–°å¢ï¼‰
partner_balance: true,                    // è´§ä¸»ä½™é¢è¡¨
partner_balance_transactions: true,       // è´§ä¸»ä½™é¢æµæ°´è¡¨
invoice_receipt_records: true,             // æ”¶æ¬¾è®°å½•è¡¨

// ä¸šåŠ¡æ•°æ®ï¼ˆæ–°å¢ï¼‰
scale_records: true,                       // ç£…å•è®°å½•è¡¨

// ç³»ç»Ÿæ•°æ®ï¼ˆå¯é€‰ï¼‰
notifications: false,                      // é€šçŸ¥è¡¨ï¼ˆå¯é€‰ï¼‰
operation_logs: false,                     // æ“ä½œæ—¥å¿—è¡¨ï¼ˆå¯é€‰ï¼‰
permission_audit_logs: false,             // æƒé™å®¡è®¡æ—¥å¿—è¡¨ï¼ˆå¯é€‰ï¼‰
saved_searches: false,                     // ä¿å­˜çš„æœç´¢è¡¨ï¼ˆå¯é€‰ï¼‰
```

---

## ğŸ“ å¯¹è´¦ç³»ç»Ÿå¤‡ä»½éªŒè¯

### éªŒè¯å¯¹è´¦æ•°æ®æ˜¯å¦å·²å¤‡ä»½

1. **æ‰§è¡Œå¤‡ä»½**ï¼š
   - è®¿é—®"è®¾ç½®" â†’ "ç³»ç»Ÿå¤‡ä»½"
   - é€‰æ‹©"ä»…ä¸šåŠ¡æ•°æ®"æˆ–"å…¨éƒ¨æ•°æ®"
   - ä¸‹è½½ JSON æˆ– SQL å¤‡ä»½

2. **æ£€æŸ¥å¤‡ä»½æ–‡ä»¶**ï¼š
   ```json
   {
     "tables": {
       "logistics_partner_costs": {
         "data": [
           {
             "id": "...",
             "reconciliation_status": "Reconciled",  // âœ… å¯¹è´¦çŠ¶æ€
             "reconciliation_date": "2025-11-16...", // âœ… å¯¹è´¦æ—¥æœŸ
             "reconciliation_by": "...",             // âœ… å¯¹è´¦æ“ä½œäºº
             "reconciliation_notes": "..."           // âœ… å¯¹è´¦å¤‡æ³¨
           }
         ]
       }
     }
   }
   ```

3. **éªŒè¯å­—æ®µ**ï¼š
   - ç¡®è®¤å¤‡ä»½æ•°æ®ä¸­åŒ…å« `reconciliation_status`
   - ç¡®è®¤å¤‡ä»½æ•°æ®ä¸­åŒ…å« `reconciliation_date`
   - ç¡®è®¤å¤‡ä»½æ•°æ®ä¸­åŒ…å« `reconciliation_by`
   - ç¡®è®¤å¤‡ä»½æ•°æ®ä¸­åŒ…å« `reconciliation_notes`

---

## âœ… æ€»ç»“

### å¯¹è´¦ç³»ç»Ÿå¤‡ä»½çŠ¶æ€

| é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| **å¯¹è´¦å­—æ®µ** | âœ… å·²åŒ…å« | `logistics_partner_costs` è¡¨å·²åŒ…å«åœ¨å¤‡ä»½ä¸­ï¼Œå¯¹è´¦å­—æ®µä¼šè‡ªåŠ¨å¤‡ä»½ |
| **å¯¹è´¦å‡½æ•°** | âš ï¸ éœ€å•ç‹¬å¤‡ä»½ | å‡½æ•°å®šä¹‰éœ€è¦å•ç‹¬å¤‡ä»½ï¼ˆä½¿ç”¨ `pg_dump --schema-only`ï¼‰ |
| **è´§ä¸»ä½™é¢** | âŒ æœªåŒ…å« | `partner_balance` å’Œ `partner_balance_transactions` æœªåŒ…å« |
| **æ”¶æ¬¾è®°å½•** | âŒ æœªåŒ…å« | `invoice_receipt_records` æœªåŒ…å« |
| **ç£…å•è®°å½•** | âŒ æœªåŒ…å« | `scale_records` æœªåŒ…å« |

### å»ºè®®æ“ä½œ

1. **ç«‹å³æ·»åŠ ç¼ºå¤±çš„è¡¨åˆ°å¤‡ä»½åˆ—è¡¨**ï¼š
   - `partner_balance`
   - `partner_balance_transactions`
   - `invoice_receipt_records`
   - `scale_records`

2. **å®šæœŸå¤‡ä»½å‡½æ•°å®šä¹‰**ï¼š
   ```bash
   # å¤‡ä»½æ‰€æœ‰å‡½æ•°
   pg_dump -h your-host -U your-user -d your-database \
     --schema-only --include-functions \
     -f backup_functions_$(date +%Y%m%d).sql
   ```

3. **éªŒè¯å¤‡ä»½å®Œæ•´æ€§**ï¼š
   - å®šæœŸæ£€æŸ¥å¤‡ä»½æ–‡ä»¶
   - æµ‹è¯•æ¢å¤æµç¨‹
   - ç¡®è®¤å¯¹è´¦æ•°æ®å®Œæ•´

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2025-11-16  
**æœ€åæ›´æ–°**ï¼š2025-11-16

