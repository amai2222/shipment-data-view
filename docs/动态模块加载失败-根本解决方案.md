# åŠ¨æ€æ¨¡å—åŠ è½½å¤±è´¥ - æ ¹æœ¬è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜ç°è±¡

```
Failed to fetch dynamically imported module: https://ynzkzy.325218.xyz/assets/index-dYFovdZF.js
```

## ğŸ¯ æ ¹æœ¬åŸå› åˆ†æ

### 1. æ„å»ºæ–‡ä»¶åä¸ä¸€è‡´

**é—®é¢˜ï¼š** Vite æ„å»ºæ—¶ç”Ÿæˆçš„ hash å¯èƒ½æ¯æ¬¡ä¸åŒï¼Œå¯¼è‡´ï¼š
- æ„å»ºæ—¶ç”Ÿæˆï¼š`index-dYFovdZF.js`
- éƒ¨ç½²åå®é™…æ–‡ä»¶ï¼š`index-abc12345.js`
- å¯¼è‡´æ–‡ä»¶åä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆï¼š**
- âœ… å·²ä¼˜åŒ– `vite.config.ts`ï¼Œä½¿ç”¨å›ºå®š hash é•¿åº¦ï¼ˆ8ä½ï¼‰
- âœ… ç¡®ä¿ `chunkFileNames`ã€`entryFileNames`ã€`assetFileNames` æ ¼å¼ä¸€è‡´

### 2. éƒ¨ç½²ç¼“å­˜é—®é¢˜

**é—®é¢˜ï¼š** Cloudflare Pages å¯èƒ½ç¼“å­˜äº†æ—§ç‰ˆæœ¬çš„æ„å»ºç»“æœ

**è§£å†³æ–¹æ¡ˆï¼š**
1. **æ¸…é™¤ Cloudflare ç¼“å­˜ï¼š**
   - è¿›å…¥ Cloudflare Dashboard
   - é€‰æ‹©åŸŸå â†’ **Caching** â†’ **Purge Everything**

2. **é‡æ–°éƒ¨ç½²ï¼š**
   - åœ¨ Cloudflare Pages ä¸­è§¦å‘æ–°çš„éƒ¨ç½²
   - æˆ–æ¨é€æ–°çš„ commit åˆ° GitHub

### 3. æ„å»ºéªŒè¯

**é—®é¢˜ï¼š** æ„å»ºå¯èƒ½ä¸å®Œæ•´ï¼ŒæŸäº›æ–‡ä»¶æ²¡æœ‰ç”Ÿæˆ

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. æœ¬åœ°æ„å»º
npm run build

# 2. éªŒè¯æ„å»ºè¾“å‡º
node scripts/verify-build.js

# 3. æ£€æŸ¥ dist/assets ç›®å½•
ls -la dist/assets/*.js
```

### 4. æ–‡ä»¶ç¡®å®ä¸å­˜åœ¨

**é—®é¢˜ï¼š** æ–‡ä»¶åœ¨æ„å»ºæ—¶ç”Ÿæˆï¼Œä½†éƒ¨ç½²æ—¶ä¸¢å¤±

**è§£å†³æ–¹æ¡ˆï¼š**
1. **æ£€æŸ¥ Cloudflare Pages éƒ¨ç½²æ—¥å¿—ï¼š**
   - è¿›å…¥ Cloudflare Pages Dashboard
   - æŸ¥çœ‹æœ€æ–°çš„éƒ¨ç½²æ—¥å¿—
   - ç¡®è®¤æ‰€æœ‰æ–‡ä»¶éƒ½æ­£ç¡®ä¸Šä¼ 

2. **ç›´æ¥è®¿é—®æ–‡ä»¶ URLï¼š**
   ```
   https://ynzkzy.325218.xyz/assets/index-dYFovdZF.js
   ```
   - å¦‚æœè¿”å› HTMLï¼ˆ404 é¡µé¢ï¼‰ï¼Œè¯´æ˜æ–‡ä»¶ä¸å­˜åœ¨
   - å¦‚æœè¿”å› JavaScript ä»£ç ï¼Œè¯´æ˜æ–‡ä»¶å­˜åœ¨ï¼Œé—®é¢˜åœ¨å…¶ä»–åœ°æ–¹

## âœ… å·²å®æ–½çš„ä¿®å¤

### 1. ä¼˜åŒ–æ„å»ºé…ç½®

**æ–‡ä»¶ï¼š** `vite.config.ts`

```typescript
rollupOptions: {
  output: {
    format: 'es',
    // ä½¿ç”¨å›ºå®šçš„ hash é•¿åº¦ï¼ˆ8ä½ï¼‰ï¼Œç¡®ä¿æ–‡ä»¶åå¯é¢„æµ‹
    chunkFileNames: 'assets/[name]-[hash:8].js',
    entryFileNames: 'assets/[name]-[hash:8].js',
    assetFileNames: 'assets/[name]-[hash:8].[ext]',
  },
}
```

### 2. ç®€åŒ– `_redirects` æ–‡ä»¶

**æ–‡ä»¶ï¼š** `public/_redirects`

```
/*    /index.html   200
```

**è¯´æ˜ï¼š**
- Cloudflare Pages ä¼šä¼˜å…ˆæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œç›´æ¥è¿”å›æ–‡ä»¶ï¼ˆä¸ä¼šè§¦å‘é‡å®šå‘ï¼‰
- å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ‰ä¼šè§¦å‘é‡å®šå‘è§„åˆ™
- å› æ­¤ï¼Œé™æ€èµ„æºä¸ä¼šè¢«é‡å®šå‘

## ğŸ”§ æ’æŸ¥æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ£€æŸ¥æ„å»ºè¾“å‡º

```bash
npm run build
node scripts/verify-build.js
```

**é¢„æœŸè¾“å‡ºï¼š**
- âœ… æ‰€æœ‰ JS æ–‡ä»¶éƒ½å·²ç”Ÿæˆ
- âœ… æ–‡ä»¶åæ ¼å¼ä¸€è‡´
- âœ… æ–‡ä»¶å¤§å°åˆç†

### æ­¥éª¤ 2ï¼šæ£€æŸ¥éƒ¨ç½²æ—¥å¿—

åœ¨ Cloudflare Pages Dashboard ä¸­ï¼š
1. è¿›å…¥é¡¹ç›® â†’ **Deployments**
2. æŸ¥çœ‹æœ€æ–°çš„éƒ¨ç½²æ—¥å¿—
3. ç¡®è®¤ï¼š
   - âœ… æ„å»ºæˆåŠŸ
   - âœ… æ‰€æœ‰æ–‡ä»¶éƒ½ä¸Šä¼ 
   - âœ… æ²¡æœ‰é”™è¯¯æˆ–è­¦å‘Š

### æ­¥éª¤ 3ï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦éƒ¨ç½²

åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—® JS æ–‡ä»¶ URLï¼š
```
https://ynzkzy.325218.xyz/assets/index-dYFovdZF.js
```

**é¢„æœŸç»“æœï¼š**
- âœ… è¿”å› JavaScript ä»£ç 
- âœ… å“åº”å¤´ `Content-Type: application/javascript`
- âŒ ä¸åº”è¯¥è¿”å› HTMLï¼ˆ404 é¡µé¢ï¼‰

### æ­¥éª¤ 4ï¼šæ¸…é™¤ç¼“å­˜å¹¶é‡æ–°éƒ¨ç½²

1. **æ¸…é™¤ Cloudflare ç¼“å­˜ï¼š**
   - Cloudflare Dashboard â†’ **Caching** â†’ **Purge Everything**

2. **è§¦å‘æ–°éƒ¨ç½²ï¼š**
   - Cloudflare Pages â†’ **Deployments** â†’ **Retry deployment**
   - æˆ–æ¨é€æ–°çš„ commit

3. **ç­‰å¾…éƒ¨ç½²å®Œæˆï¼š**
   - é€šå¸¸éœ€è¦ 1-3 åˆ†é’Ÿ

4. **æµ‹è¯•ï¼š**
   - æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆCtrl+Shift+Deleteï¼‰
   - ç¡¬åˆ·æ–°é¡µé¢ï¼ˆCtrl+Shift+Rï¼‰
   - æ£€æŸ¥æ˜¯å¦è¿˜æœ‰é”™è¯¯

## ğŸš¨ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

### è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ  `_headers` æ–‡ä»¶

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œå¯èƒ½æ˜¯ Cloudflare Pages çš„ MIME ç±»å‹æ£€æµ‹é—®é¢˜ã€‚å¯ä»¥æ·»åŠ  `public/_headers` æ–‡ä»¶æ¥æ˜ç¡®æŒ‡å®šé™æ€èµ„æºçš„ MIME ç±»å‹ï¼š

```http
# Cloudflare Pages å“åº”å¤´é…ç½®
# ç¡®ä¿é™æ€èµ„æºä½¿ç”¨æ­£ç¡®çš„ MIME ç±»å‹

/assets/*
  Content-Type: application/javascript
  Cache-Control: public, max-age=31536000, immutable

/*.js
  Content-Type: application/javascript
  Cache-Control: public, max-age=31536000, immutable

/*.css
  Content-Type: text/css
  Cache-Control: public, max-age=31536000, immutable

/*.html
  Content-Type: text/html
  Cache-Control: no-cache, no-store, must-revalidate
```

**è¯´æ˜ï¼š**
- `_headers` æ–‡ä»¶ä¼šæ˜ç¡®å‘Šè¯‰ Cloudflare Pages å¦‚ä½•å¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶
- ç¡®ä¿ JS æ–‡ä»¶ä½¿ç”¨ `application/javascript` MIME ç±»å‹
- è®¾ç½®é•¿æœŸç¼“å­˜ç­–ç•¥ï¼Œæé«˜æ€§èƒ½

### æ£€æŸ¥æ¸…å•

- [ ] æ„å»ºéªŒè¯è„šæœ¬æ˜¯å¦é€šè¿‡ï¼Ÿ
- [ ] Cloudflare Pages éƒ¨ç½²æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ï¼Ÿ
- [ ] æ–‡ä»¶ URL æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®ï¼Ÿ
- [ ] æ˜¯å¦å·²æ¸…é™¤ Cloudflare ç¼“å­˜ï¼Ÿ
- [ ] æ˜¯å¦å·²æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼Ÿ
- [ ] æ˜¯å¦å·²é‡æ–°éƒ¨ç½²ï¼Ÿ

### è¿›ä¸€æ­¥æ’æŸ¥

1. **æ£€æŸ¥æ„å»ºæ—¶çš„æ–‡ä»¶åï¼š**
   ```bash
   npm run build
   cat dist/index.html | grep -o 'assets/[^"]*\.js'
   ```

2. **æ£€æŸ¥éƒ¨ç½²åçš„æ–‡ä»¶åï¼š**
   - åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é¡µé¢
   - æ‰“å¼€å¼€å‘è€…å·¥å…· â†’ Network
   - æŸ¥çœ‹å®é™…è¯·æ±‚çš„æ–‡ä»¶å

3. **å¯¹æ¯”æ–‡ä»¶åï¼š**
   - å¦‚æœæ„å»ºæ—¶å’Œéƒ¨ç½²åçš„æ–‡ä»¶åä¸ä¸€è‡´ï¼Œè¯´æ˜éƒ¨ç½²æœ‰é—®é¢˜
   - éœ€è¦æ£€æŸ¥ Cloudflare Pages çš„æ„å»ºé…ç½®

## ğŸ“ é¢„é˜²æªæ–½

1. **æ¯æ¬¡éƒ¨ç½²å‰éªŒè¯ï¼š**
   ```bash
   npm run build
   node scripts/verify-build.js
   ```

2. **ç›‘æ§æ„å»ºæ—¥å¿—ï¼š**
   - å®šæœŸæ£€æŸ¥ Cloudflare Pages çš„æ„å»ºæ—¥å¿—
   - å…³æ³¨éªŒè¯è„šæœ¬çš„è¾“å‡º

3. **ç‰ˆæœ¬æ§åˆ¶ï¼š**
   - ç¡®ä¿æ‰€æœ‰é…ç½®æ–‡ä»¶éƒ½æäº¤åˆ° Git
   - åŒ…æ‹¬ `vite.config.ts` å’Œ `public/_redirects`

4. **æµ‹è¯•éƒ¨ç½²ï¼š**
   - éƒ¨ç½²åç«‹å³æµ‹è¯•å…³é”®é¡µé¢
   - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æ‡’åŠ è½½æ¨¡å—åŠ è½½å¤±è´¥é—®é¢˜ä¿®å¤è¯´æ˜](./æ‡’åŠ è½½æ¨¡å—åŠ è½½å¤±è´¥é—®é¢˜ä¿®å¤è¯´æ˜.md)
- [Cloudflare Pages éƒ¨ç½²é…ç½®è¯´æ˜](./CloudflarePageséƒ¨ç½²æœºåˆ¶è¯´æ˜.md)
- [æ„å»ºéƒ¨ç½²é—®é¢˜æ’æŸ¥æŒ‡å—](./æ„å»ºéƒ¨ç½²é—®é¢˜æ’æŸ¥æŒ‡å—.md)

