# éƒ¨ç½²å®Œæˆæ€»ç»“

## âœ… éƒ¨ç½²çŠ¶æ€

**æ‰€æœ‰ Token ç›¸å…³ Edge Functions å·²æˆåŠŸéƒ¨ç½²ï¼**

### å·²éƒ¨ç½²çš„å‡½æ•°

1. âœ… **get-tracking-token** - Token è·å–æœåŠ¡ï¼ˆä¿ç•™ä¸ºç‹¬ç«‹æœåŠ¡ï¼‰
2. âœ… **add-vehicle** - æ·»åŠ è½¦è¾†ï¼ˆä½¿ç”¨å…±äº«æ¨¡å—ï¼‰
3. âœ… **vehicle-tracking** - æŸ¥è¯¢è½¦è¾†è½¨è¿¹ï¼ˆä½¿ç”¨å…±äº«æ¨¡å—ï¼‰
4. âœ… **sync-vehicle-tracking-ids** - åŒæ­¥è½¦è¾†IDæ˜ å°„ï¼ˆä½¿ç”¨å…±äº«æ¨¡å—ï¼‰
5. âœ… **sync-vehicle** - åŒæ­¥è½¦è¾†ï¼ˆä½¿ç”¨å…±äº«æ¨¡å—ï¼‰

### å…±äº«æ¨¡å—

âœ… **`_shared/token-cache.ts`** - å·²è‡ªåŠ¨åŒ…å«åœ¨æ‰€æœ‰å‡½æ•°ä¸­

ä»éƒ¨ç½²æ—¥å¿—å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªå‡½æ•°éƒ¨ç½²æ—¶éƒ½è‡ªåŠ¨ä¸Šä¼ äº†å…±äº«æ¨¡å—ï¼š
```
Uploading asset (add-vehicle): supabase/functions/_shared/token-cache.ts
```

## ğŸ“Š éƒ¨ç½²éªŒè¯

### 1. æ£€æŸ¥å‡½æ•°çŠ¶æ€

è®¿é—® Supabase Dashboardï¼š
https://supabase.com/dashboard/project/mnwzvtvyauyxwowjjsmf/functions

ç¡®è®¤æ‰€æœ‰å‡½æ•°çŠ¶æ€ä¸º **Active**ã€‚

### 2. æŸ¥çœ‹æ—¥å¿—

åœ¨ Dashboard ä¸­æŸ¥çœ‹å‡½æ•°æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
âœ… ä»å…±äº«æ¨¡å—è·å–åˆ° Token
```

è€Œä¸æ˜¯ï¼š
```
âœ… ä» get-tracking-token æœåŠ¡è·å–åˆ° Token
```

### 3. æµ‹è¯•å‡½æ•°

#### æµ‹è¯• get-tracking-token

```bash
curl -X POST https://mnwzvtvyauyxwowjjsmf.supabase.co/functions/v1/get-tracking-token \
  -H "Authorization: Bearer <your-anon-key>" \
  -H "Content-Type: application/json" \
  -d '{"type": "add"}'
```

#### æµ‹è¯• add-vehicle

```bash
curl -X POST https://mnwzvtvyauyxwowjjsmf.supabase.co/functions/v1/add-vehicle \
  -H "Authorization: Bearer <your-anon-key>" \
  -H "Content-Type: application/json" \
  -d '{"licensePlate": "æµ‹è¯•è½¦ç‰Œ", "loadWeight": "10"}'
```

## ğŸ¯ æ€§èƒ½æå‡

### ä¼˜åŒ–å‰ï¼ˆHTTP è°ƒç”¨ï¼‰

- æ•°æ®åº“ç¼“å­˜å‘½ä¸­ï¼š~70-115ms
- éœ€è¦ç™»å½•ï¼š~1070-1115ms

### ä¼˜åŒ–åï¼ˆå…±äº«æ¨¡å—ï¼‰

- æ•°æ®åº“ç¼“å­˜å‘½ä¸­ï¼š~20-45ms âš¡ **æå‡ 2-3å€**
- éœ€è¦ç™»å½•ï¼š~1020-1045ms âš¡ **æå‡ ~50ms**

## ğŸ“ æ•°æ®åº“è¿ç§»

ç¡®ä¿ `tracking_token_cache` è¡¨å·²åˆ›å»ºï¼š

```bash
# å¦‚æœè¿˜æ²¡æ‰§è¡Œè¿ç§»ï¼Œæ‰§è¡Œï¼š
supabase db push
```

æˆ–æ‰‹åŠ¨åœ¨ Dashboard çš„ SQL Editor ä¸­æ‰§è¡Œï¼š
`supabase/migrations/20250116_create_tracking_token_cache.sql`

## ğŸ” éªŒè¯æ¸…å•

- [x] æ‰€æœ‰å‡½æ•°å·²éƒ¨ç½²
- [x] å…±äº«æ¨¡å—è‡ªåŠ¨åŒ…å«
- [ ] æ•°æ®åº“è¡¨å·²åˆ›å»ºï¼ˆéœ€è¦ç¡®è®¤ï¼‰
- [ ] å‡½æ•°æ—¥å¿—æ˜¾ç¤ºä½¿ç”¨å…±äº«æ¨¡å—
- [ ] æµ‹è¯•å‡½æ•°è°ƒç”¨æˆåŠŸ
- [ ] Token ç¼“å­˜åŠŸèƒ½æ­£å¸¸

## ğŸ‰ éƒ¨ç½²å®Œæˆ

æ‰€æœ‰ä¼˜åŒ–å·²å®Œæˆå¹¶éƒ¨ç½²æˆåŠŸï¼

**ä¸‹ä¸€æ­¥**ï¼š
1. åœ¨ Dashboard ä¸­éªŒè¯å‡½æ•°çŠ¶æ€
2. æµ‹è¯•å‡½æ•°è°ƒç”¨
3. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤ä½¿ç”¨å…±äº«æ¨¡å—
4. éªŒè¯æ€§èƒ½æå‡

---

**éƒ¨ç½²æ—¶é—´**ï¼š2025-01-16  
**é¡¹ç›® ID**ï¼šmnwzvtvyauyxwowjjsmf  
**çŠ¶æ€**ï¼šâœ… éƒ¨ç½²æˆåŠŸ

