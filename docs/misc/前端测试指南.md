# 开票申请页面测试指南

## 🧪 测试步骤

### 1. 执行SQL修复
在Supabase SQL编辑器中执行：
- `final_invoice_rpc_fix.sql` - 修复RPC函数
- `test_invoice_complete.sql` - 测试数据

### 2. 前端测试
1. **打开浏览器开发者工具**
   - 按 F12 或右键选择"检查"
   - 切换到 "Console" 标签页

2. **刷新开票申请页面**
   - 访问开票申请页面
   - 观察控制台输出

3. **检查控制台调试信息**
   应该看到以下信息：
   ```
   开票申请RPC返回数据: {count: X, records: [...], partner_invoiceables: [...]}
   第一条记录: {id: "...", auto_number: "...", partner_costs: [...]}
   第一条记录的partner_costs: [...]
   partner_invoiceables: [...]
   从partner_invoiceables获取合作方: [...]
   partnerIds: [...]
   allPartners: [...]
   displayedPartners结果: [...]
   ```

### 3. 验证结果
检查以下内容：

#### ✅ 运单显示
- [ ] 页面显示运单列表
- [ ] 运单数量正确
- [ ] 运单信息完整（运单号、项目、司机、路线等）

#### ✅ 合作方列显示
- [ ] 表格头部显示合作方列标题
- [ ] 合作方列显示合作方名称和级别
- [ ] 有合作方数据的运单显示金额
- [ ] 没有合作方数据的运单显示"-"

#### ✅ 合计行显示
- [ ] 合计行显示总金额
- [ ] 各合作方列显示对应总金额

### 4. 对比测试
1. **打开付款申请页面**
2. **对比两个页面的显示效果**
3. **确认开票申请页面与付款申请页面显示一致**

## 🔍 问题排查

### 如果运单不显示
1. 检查控制台是否有错误信息
2. 检查RPC函数是否执行成功
3. 检查筛选条件是否正确

### 如果合作方列不显示
1. 检查 `partner_invoiceables` 是否为空
2. 检查 `allPartners` 是否加载
3. 检查 `displayedPartners结果` 是否为空

### 如果合作方金额不显示
1. 检查 `partner_costs` 数组是否有数据
2. 检查 `payable_amount` 字段是否有值
3. 检查前端显示逻辑是否正确

## 📋 测试检查清单

- [ ] SQL函数执行成功
- [ ] 页面加载无错误
- [ ] 运单列表显示
- [ ] 合作方列显示
- [ ] 合作方金额显示
- [ ] 合计行显示
- [ ] 与付款申请页面对比一致
- [ ] 控制台调试信息正常
