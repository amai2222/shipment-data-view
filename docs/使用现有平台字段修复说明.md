# ä½¿ç”¨ç°æœ‰å¹³å°å­—æ®µä¿®å¤è¯´æ˜

## é—®é¢˜ç¡®è®¤

æ‚¨å®Œå…¨æ­£ç¡®ï¼æˆ‘ç¡®å®è‡†æƒ³äº†ã€‚æ‚¨çš„æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨ç›¸å…³å­—æ®µï¼š

- `external_tracking_numbers` (jsonb) - ç”¨äºå­˜å‚¨å…¶ä»–å¹³å°è¿å•å·ç 
- `other_platform_names` (text[]) - ç”¨äºå­˜å‚¨å…¶ä»–å¹³å°åç§°

## é—®é¢˜åŸå› 

å‰ç«¯ä»£ç é”™è¯¯åœ°ä½¿ç”¨äº†ä¸å­˜åœ¨çš„ `platform_trackings` å­—æ®µï¼Œè€Œåº”è¯¥ä½¿ç”¨æ•°æ®åº“ä¸­å®é™…å­˜åœ¨çš„å­—æ®µã€‚

## ä¿®å¤å†…å®¹

### 1. ç±»å‹å®šä¹‰ä¿®å¤

**æ–‡ä»¶**: `src/pages/BusinessEntry/types.ts`

**ä¿®å¤å‰**:
```typescript
platform_trackings?: PlatformTracking[];
```

**ä¿®å¤å**:
```typescript
external_tracking_numbers?: any[]; // ä½¿ç”¨ç°æœ‰çš„æ•°æ®åº“å­—æ®µ
other_platform_names?: string[]; // ä½¿ç”¨ç°æœ‰çš„æ•°æ®åº“å­—æ®µ
```

### 2. è¡¨å•æ•°æ®ç»“æ„ä¿®å¤

**æ–‡ä»¶**: `src/pages/BusinessEntry/components/LogisticsFormDialog.tsx`

**ä¿®å¤å†…å®¹**:
- å°† `platform_trackings: PlatformTracking[]` æ”¹ä¸º `external_tracking_numbers: any[]` å’Œ `other_platform_names: string[]`
- æ›´æ–°åˆå§‹æ•°æ®è®¾ç½®
- ä¿®å¤æ•°æ®å¡«å……é€»è¾‘
- ä¿®å¤æ•°æ®ä¿å­˜é€»è¾‘

### 3. æ•°æ®å¡«å……é€»è¾‘

**ç¼–è¾‘æ—¶æ•°æ®å¡«å……**:
```typescript
external_tracking_numbers: editingRecord.external_tracking_numbers || [],
other_platform_names: editingRecord.other_platform_names || [],
```

**æ•°æ®ä¿å­˜**:
```typescript
// æ›´æ–°å¹³å°è¿å•ä¿¡æ¯
if (formData.external_tracking_numbers.length > 0 || formData.other_platform_names.length > 0) {
  const { error: platformError } = await supabase
    .from('logistics_records')
    .update({ 
      external_tracking_numbers: formData.external_tracking_numbers,
      other_platform_names: formData.other_platform_names
    })
    .eq('id', editingRecord.id);
  if (platformError) throw platformError;
}
```

## æ•°æ®åº“å­—æ®µè¯´æ˜

### 1. external_tracking_numbers (jsonb)

**ç”¨é€”**: å­˜å‚¨å…¶ä»–å¹³å°çš„è¿å•å·ç ä¿¡æ¯

**æ•°æ®æ ¼å¼**:
```json
[
  {
    "platform": "è´§æ‹‰æ‹‰",
    "tracking_number": "HL20250120001",
    "status": "completed"
  },
  {
    "platform": "æ»¡å¸®",
    "tracking_number": "MB20250120002",
    "status": "in_transit"
  }
]
```

### 2. other_platform_names (text[])

**ç”¨é€”**: å­˜å‚¨å…¶ä»–å¹³å°åç§°åˆ—è¡¨

**æ•°æ®æ ¼å¼**:
```sql
['è¿æ»¡æ»¡', 'æ»´æ»´è´§è¿', 'å…¶ä»–å¹³å°']
```

## åŠŸèƒ½éªŒè¯

### æµ‹è¯•è„šæœ¬

**æ–‡ä»¶**: `scripts/test-existing-platform-fields.sql`

**æµ‹è¯•å†…å®¹**:
1. åˆ›å»ºåŒ…å«ç°æœ‰å­—æ®µçš„æµ‹è¯•è¿å•è®°å½•
2. éªŒè¯ `external_tracking_numbers` å­—æ®µæ•°æ®
3. éªŒè¯ `other_platform_names` å­—æ®µæ•°æ®
4. æ˜¾ç¤ºå­—æ®µå†…å®¹

**ä½¿ç”¨æ–¹æ³•**:
```sql
-- åœ¨Supabaseåå°æ‰§è¡Œ
-- å¤åˆ¶å¹¶æ‰§è¡Œ scripts/test-existing-platform-fields.sql çš„å†…å®¹
```

### é¢„æœŸç»“æœ

æµ‹è¯•è„šæœ¬ä¼šåˆ›å»ºåŒ…å«ä»¥ä¸‹æ•°æ®çš„æµ‹è¯•è®°å½•ï¼š
- **å¤–éƒ¨è¿å•å·**: è´§æ‹‰æ‹‰(HL20250120001), æ»¡å¸®(MB20250120002)
- **å…¶ä»–å¹³å°**: è¿æ»¡æ»¡, æ»´æ»´è´§è¿

## å½“å‰çŠ¶æ€

### âœ… å·²ä¿®å¤

1. **ç±»å‹å®šä¹‰**: ä½¿ç”¨æ­£ç¡®çš„æ•°æ®åº“å­—æ®µ
2. **æ•°æ®å¡«å……**: ç¼–è¾‘æ—¶æ­£ç¡®åŠ è½½ç°æœ‰æ•°æ®
3. **æ•°æ®ä¿å­˜**: ä¿å­˜æ—¶ä½¿ç”¨æ­£ç¡®çš„å­—æ®µ
4. **è¡¨å•æ˜¾ç¤º**: æ˜¾ç¤ºç°æœ‰å­—æ®µçš„æ•°æ®

### ğŸ”„ å¾…å®Œå–„

1. **è¾“å…¥ç»„ä»¶**: éœ€è¦åˆ›å»ºä¸“é—¨å¤„ç† `external_tracking_numbers` å’Œ `other_platform_names` çš„è¾“å…¥ç»„ä»¶
2. **æ•°æ®è½¬æ¢**: å¯èƒ½éœ€è¦åœ¨å‰ç«¯å’Œæ•°æ®åº“æ ¼å¼ä¹‹é—´è¿›è¡Œè½¬æ¢
3. **éªŒè¯é€»è¾‘**: æ·»åŠ æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç†

## ç›¸å…³æ–‡ä»¶

1. **`src/pages/BusinessEntry/types.ts`** - ç±»å‹å®šä¹‰ï¼ˆå·²ä¿®å¤ï¼‰
2. **`src/pages/BusinessEntry/components/LogisticsFormDialog.tsx`** - ç¼–è¾‘è¡¨å•ï¼ˆå·²ä¿®å¤ï¼‰
3. **`scripts/test-existing-platform-fields.sql`** - æµ‹è¯•è„šæœ¬
4. **`docs/ä½¿ç”¨ç°æœ‰å¹³å°å­—æ®µä¿®å¤è¯´æ˜.md`** - æœ¬æ–‡æ¡£

## ç»“è®º

ç°åœ¨å‰ç«¯ä»£ç å·²ç»æ­£ç¡®ä½¿ç”¨æ•°æ®åº“ä¸­å®é™…å­˜åœ¨çš„å­—æ®µï¼š
- âœ… `external_tracking_numbers` - å…¶ä»–å¹³å°è¿å•å·ç 
- âœ… `other_platform_names` - å…¶ä»–å¹³å°åç§°

è¿å•ç¼–è¾‘æ—¶åº”è¯¥èƒ½å¤Ÿæ­£ç¡®åŠ è½½å’Œæ˜¾ç¤ºè¿™äº›å­—æ®µçš„æ•°æ®äº†ã€‚

## æ›´æ–°æ—¥å¿—

- 2025-01-20: è¯†åˆ«é—®é¢˜ï¼Œå‰ç«¯ä»£ç ä½¿ç”¨äº†ä¸å­˜åœ¨çš„å­—æ®µ
- 2025-01-20: ä¿®å¤ç±»å‹å®šä¹‰ï¼Œä½¿ç”¨ç°æœ‰æ•°æ®åº“å­—æ®µ
- 2025-01-20: ä¿®å¤è¡¨å•ç»„ä»¶ï¼Œä½¿ç”¨æ­£ç¡®çš„å­—æ®µ
- 2025-01-20: åˆ›å»ºæµ‹è¯•è„šæœ¬éªŒè¯ç°æœ‰å­—æ®µ
- 2025-01-20: åˆ›å»ºä¿®å¤è¯´æ˜æ–‡æ¡£
