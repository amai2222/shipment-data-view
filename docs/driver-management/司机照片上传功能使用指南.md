# 司机照片上传功能使用指南

## 📋 功能概述

司机管理页面现已支持上传司机证件照片，包括：
- 📇 **身份证**（最多2张：正反面）
- 🚗 **驾驶证**（最多2张：正副页）
- 📜 **从业资格证**（最多2张：正反面）

**完成时间**: 2025年10月9日  
**状态**: ✅ 已完成

---

## 🎯 功能特性

### 1. 多证件支持
- ✅ 身份证照片（正反面）
- ✅ 驾驶证照片（正副页）
- ✅ 从业资格证照片（正反面）

### 2. 多张照片支持
- 每种证件最多上传2张照片
- 支持批量选择和上传
- 自动限制上传数量

### 3. 七牛云存储
- 照片上传到七牛云
- 存储在 `driver` 目录下
- 自动生成文件名：`证件类型-司机姓名-车牌号-时间戳-序号.扩展名`

### 4. 照片管理
- 预览已上传的照片
- 删除不需要的照片
- 查看大图

---

## 🚀 使用方法

### 1. 新增司机并上传照片

**步骤：**
1. 点击"新增司机"按钮
2. 切换到"基本信息"标签页
3. 填写司机姓名、车牌号、电话等基本信息
4. 切换到"证件照片"标签页
5. 选择证件类型（身份证/驾驶证/从业资格证）
6. 点击"选择照片"按钮
7. 选择要上传的照片文件
8. 点击"上传 X 张照片"按钮
9. 等待上传完成
10. 点击"保存司机信息"按钮

### 2. 编辑司机并管理照片

**步骤：**
1. 在司机列表中点击"编辑"按钮
2. 切换到"证件照片"标签页
3. 查看已上传的照片
4. 可以添加新照片或删除现有照片
5. 点击"更新司机信息"保存更改

### 3. 查看照片

**方式1：悬停查看**
- 鼠标悬停在照片上
- 显示"查看"和"删除"按钮

**方式2：点击预览**
- 点击照片
- 在对话框中查看大图
- 点击对话框外部关闭

### 4. 删除照片

**步骤：**
1. 鼠标悬停在要删除的照片上
2. 点击右上角的"X"按钮
3. 照片立即删除
4. 记得点击"更新司机信息"保存更改

---

## 📸 照片要求

### 文件格式
- ✅ 支持：JPG、JPEG、PNG、GIF、WEBP
- ❌ 不支持：PDF、DOC等非图片格式

### 文件大小
- 建议：每张照片 < 5MB
- 系统会显示文件大小
- 过大的文件可能上传较慢

### 照片质量
- 建议：清晰可见
- 建议：正面拍摄
- 建议：光线充足

---

## 🗂️ 数据库结构

### drivers表新增字段

```sql
-- 身份证照片URL数组
id_card_photos jsonb DEFAULT '[]'::jsonb

-- 驾驶证照片URL数组
driver_license_photos jsonb DEFAULT '[]'::jsonb

-- 从业资格证照片URL数组
qualification_certificate_photos jsonb DEFAULT '[]'::jsonb
```

### 数据格式

```json
{
  "id_card_photos": [
    "https://cdn.example.com/driver/身份证-张三-京A12345-1696800000000-1.jpg",
    "https://cdn.example.com/driver/身份证-张三-京A12345-1696800000000-2.jpg"
  ],
  "driver_license_photos": [
    "https://cdn.example.com/driver/驾驶证-张三-京A12345-1696800000000-1.jpg"
  ],
  "qualification_certificate_photos": []
}
```

---

## 💡 使用技巧

### 1. 批量上传
- 可以一次选择多张照片
- 系统会自动检查数量限制
- 超出限制会提示错误

### 2. 文件命名
- 系统自动生成文件名
- 包含证件类型、司机姓名、车牌号、时间戳
- 便于管理和查找

### 3. 先保存基本信息
- 建议先填写司机姓名和车牌号
- 再上传照片（文件名会更准确）
- 最后保存所有信息

### 4. 照片管理
- 可以随时添加或删除照片
- 照片URL存储在数据库中
- 实际文件存储在七牛云

---

## ⚠️ 注意事项

### 1. 上传限制
- 每种证件最多2张照片
- 超出限制无法继续上传
- 需要先删除现有照片

### 2. 网络要求
- 需要稳定的网络连接
- 上传大文件可能需要较长时间
- 上传失败会显示错误提示

### 3. 数据保存
- 照片上传后需要点击"保存"按钮
- 否则照片URL不会保存到数据库
- 关闭对话框前请确认已保存

### 4. 照片删除
- 删除照片只是从数据库中移除URL
- 七牛云上的文件不会自动删除
- 如需清理，请联系管理员

---

## 🔧 技术实现

### 1. 上传流程

```typescript
// 1. 选择文件
handleFileSelect(type, event)

// 2. 验证文件
- 检查文件类型（只允许图片）
- 检查数量限制
- 添加到待上传列表

// 3. 上传到七牛云
uploadToQiniu(type)
- 读取文件为Base64
- 调用七牛云上传函数
- 传入projectName: 'driver'

// 4. 更新数据库
- 保存照片URL到对应字段
- 更新司机信息
```

### 2. 文件命名规则

```
格式: {证件类型}-{司机姓名}-{车牌号}-{时间戳}-{序号}.{扩展名}

示例:
身份证-张三-京A12345-1696800000000-1.jpg
驾驶证-李四-沪B67890-1696800000000-1.png
从业资格证-王五-粤C11111-1696800000000-2.jpg
```

### 3. 七牛云配置

```typescript
{
  files: [{
    fileName: originalFileName,
    fileData: base64Data
  }],
  namingParams: {
    projectName: 'driver',  // 上传到driver目录
    customName: customFileName
  }
}
```

---

## 📊 界面说明

### 对话框布局

```
┌─────────────────────────────────────┐
│  [🚗] 编辑司机/新增司机             │
├─────────────────────────────────────┤
│  [基本信息] [📷 证件照片]          │
├─────────────────────────────────────┤
│                                     │
│  证件照片标签页内容：               │
│  ┌───────────┬───────────┬───────┐ │
│  │ 身份证    │ 驾驶证    │从业证 │ │
│  │ [选择照片]│[选择照片] │[选择] │ │
│  │ 0/2       │ 0/2       │ 0/2   │ │
│  └───────────┴───────────┴───────┘ │
│                                     │
│  [关闭] [保存司机信息]              │
└─────────────────────────────────────┘
```

### 照片卡片

```
┌─────────────────────────────┐
│  📷 身份证        [0/2]     │
│  [选择照片]                 │
├─────────────────────────────┤
│  已上传照片:                │
│  ┌──────┐ ┌──────┐         │
│  │ 照片1│ │ 照片2│         │
│  │  [X] │ │  [X] │         │
│  │  [👁]│ │  [👁]│         │
│  └──────┘ └──────┘         │
│                             │
│  待上传照片:                │
│  📄 image1.jpg [X]         │
│  📄 image2.jpg [X]         │
│  [上传 2 张照片]            │
└─────────────────────────────┘
```

---

## 🐛 常见问题

### Q1: 为什么只能上传图片？
**A**: 为了确保照片质量和系统兼容性，只支持图片格式（JPG、PNG等）。

### Q2: 为什么每种证件只能上传2张？
**A**: 大多数证件都是正反面或正副页，2张足够。如需更多，请联系管理员。

### Q3: 上传失败怎么办？
**A**: 
- 检查网络连接
- 检查文件大小
- 检查文件格式
- 查看错误提示信息

### Q4: 照片可以修改吗？
**A**: 可以。编辑司机时，可以删除旧照片并上传新照片。

### Q5: 照片会占用多少空间？
**A**: 照片存储在七牛云，不占用数据库空间。数据库只存储照片URL。

---

## 📝 最佳实践

### 1. 照片拍摄
- 使用清晰的相机或扫描仪
- 确保证件信息可见
- 避免反光和模糊

### 2. 文件管理
- 先整理好照片文件
- 按证件类型分类
- 统一命名便于识别

### 3. 上传顺序
1. 先填写基本信息（姓名、车牌）
2. 再上传照片（文件名更准确）
3. 最后保存所有信息

### 4. 数据维护
- 定期检查照片完整性
- 及时更新过期证件照片
- 删除不需要的照片

---

## 🎉 总结

司机照片上传功能提供了：

✅ **完整的证件管理** - 身份证、驾驶证、从业资格证  
✅ **便捷的上传体验** - 批量选择、一键上传  
✅ **专业的照片管理** - 预览、删除、大图查看  
✅ **可靠的云存储** - 七牛云存储，安全稳定  
✅ **清晰的界面设计** - 标签页布局，操作直观  

这些功能让司机档案管理更加完善和专业！

---

**功能版本**: v1.0.0  
**发布日期**: 2025年10月9日  
**状态**: ✅ 已完成
