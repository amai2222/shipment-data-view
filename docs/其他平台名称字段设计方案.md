# å…¶ä»–å¹³å°åç§°å­—æ®µè®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ éœ€æ±‚åˆ†æ

### 1. **ä¸šåŠ¡éœ€æ±‚**
- åœ¨ `logistics_records` è¡¨ä¸­æ·»åŠ å­—æ®µè®°å½•**å…¶ä»–å¹³å°åç§°**
- æ”¯æŒå•ä¸ªæˆ–å¤šä¸ªå¹³å°åç§°
- ä¸ç°æœ‰çš„ `external_tracking_numbers` å­—æ®µé…åˆä½¿ç”¨
- ç®€å•ç›´æ¥çš„å®ç°æ–¹å¼

### 2. **å­—æ®µè®¾è®¡é€‰é¡¹**

#### é€‰é¡¹ä¸€ï¼šå•ä¸ªå¹³å°åç§°å­—æ®µ
```sql
ALTER TABLE public.logistics_records 
ADD COLUMN other_platform_name TEXT;
```

#### é€‰é¡¹äºŒï¼šå¤šä¸ªå¹³å°åç§°å­—æ®µï¼ˆæ¨èï¼‰
```sql
ALTER TABLE public.logistics_records 
ADD COLUMN other_platform_names TEXT[] DEFAULT '{}';
```

#### é€‰é¡¹ä¸‰ï¼šJSONå­—æ®µï¼ˆæœ€çµæ´»ï¼‰
```sql
ALTER TABLE public.logistics_records 
ADD COLUMN other_platform_info JSONB DEFAULT '[]'::jsonb;
```

## ğŸ¯ æ¨èæ–¹æ¡ˆï¼šTEXTæ•°ç»„å­—æ®µ

### 1. **ä¼˜åŠ¿**
- ç®€å•æ˜“ç”¨
- æ”¯æŒå¤šä¸ªå¹³å°åç§°
- æŸ¥è¯¢æ€§èƒ½å¥½
- ä¸PostgreSQLæ•°ç»„åŠŸèƒ½å®Œç¾é…åˆ

### 2. **æ•°æ®ç»“æ„**
```sql
-- ç¤ºä¾‹æ•°æ®
other_platform_names: ['è´§æ‹‰æ‹‰', 'æ»¡å¸®', 'è¿æ»¡æ»¡']
other_platform_names: ['æ»´æ»´è´§è¿']
other_platform_names: []  -- ç©ºæ•°ç»„è¡¨ç¤ºæ— å…¶ä»–å¹³å°
```

### 3. **æŸ¥è¯¢ç¤ºä¾‹**
```sql
-- æŸ¥è¯¢åŒ…å«ç‰¹å®šå¹³å°çš„è¿å•
SELECT * FROM logistics_records 
WHERE 'è´§æ‹‰æ‹‰' = ANY(other_platform_names);

-- æŸ¥è¯¢åŒ…å«å¤šä¸ªå¹³å°çš„è¿å•
SELECT * FROM logistics_records 
WHERE other_platform_names && ARRAY['è´§æ‹‰æ‹‰', 'æ»¡å¸®'];

-- æŸ¥è¯¢æœ‰å…¶ä»–å¹³å°çš„è¿å•
SELECT * FROM logistics_records 
WHERE array_length(other_platform_names, 1) > 0;
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### 1. **å­—æ®µå®šä¹‰**
```sql
-- æ·»åŠ å…¶ä»–å¹³å°åç§°å­—æ®µ
ALTER TABLE public.logistics_records 
ADD COLUMN other_platform_names TEXT[] DEFAULT '{}';

-- æ·»åŠ å­—æ®µæ³¨é‡Š
COMMENT ON COLUMN public.logistics_records.other_platform_names IS 'å…¶ä»–å¹³å°åç§°æ•°ç»„ï¼Œè®°å½•è¯¥è¿å•æ¶‰åŠçš„å…¶ä»–ç‰©æµå¹³å°';

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_logistics_records_other_platform_names 
ON public.logistics_records USING GIN (other_platform_names);
```

### 2. **å¸¸ç”¨æŸ¥è¯¢å‡½æ•°**
```sql
-- æ ¹æ®å¹³å°åç§°æŸ¥è¯¢è¿å•
CREATE OR REPLACE FUNCTION public.get_logistics_records_by_platform(
  p_platform_name TEXT
)
RETURNS TABLE (
  id UUID,
  auto_number TEXT,
  project_name TEXT,
  other_platform_names TEXT[]
)
LANGUAGE plpgsql
AS $$
BEGIN
  RETURN QUERY
  SELECT 
    lr.id,
    lr.auto_number,
    lr.project_name,
    lr.other_platform_names
  FROM public.logistics_records lr
  WHERE p_platform_name = ANY(lr.other_platform_names);
END;
$$;

-- è·å–æ‰€æœ‰ä½¿ç”¨è¿‡çš„å¹³å°åç§°
CREATE OR REPLACE FUNCTION public.get_all_used_platforms()
RETURNS TABLE (
  platform_name TEXT,
  usage_count BIGINT
)
LANGUAGE plpgsql
AS $$
BEGIN
  RETURN QUERY
  SELECT 
    platform_name,
    COUNT(*) as usage_count
  FROM (
    SELECT unnest(other_platform_names) as platform_name
    FROM public.logistics_records
    WHERE other_platform_names IS NOT NULL
    AND array_length(other_platform_names, 1) > 0
  ) t
  GROUP BY platform_name
  ORDER BY usage_count DESC;
END;
$$;
```

## ğŸ¨ å‰ç«¯ç•Œé¢è®¾è®¡

### 1. **è¿å•è¡¨å•ä¸­çš„å¹³å°åç§°è¾“å…¥**

```tsx
// å…¶ä»–å¹³å°åç§°è¾“å…¥ç»„ä»¶
<div className="space-y-2">
  <Label>å…¶ä»–å¹³å°åç§°</Label>
  <div className="space-y-2">
    {otherPlatformNames.map((platform, index) => (
      <div key={index} className="flex gap-2">
        <Input
          value={platform}
          onChange={(e) => updatePlatformName(index, e.target.value)}
          placeholder="è¾“å…¥å¹³å°åç§°"
        />
        <Button
          type="button"
          variant="ghost"
          size="sm"
          onClick={() => removePlatformName(index)}
        >
          <Trash2 className="h-4 w-4" />
        </Button>
      </div>
    ))}
    <Button
      type="button"
      variant="outline"
      size="sm"
      onClick={addPlatformName}
    >
      <Plus className="mr-2 h-4 w-4" />
      æ·»åŠ å¹³å°
    </Button>
  </div>
</div>
```

### 2. **è¿å•åˆ—è¡¨ä¸­çš„æ˜¾ç¤º**

```tsx
// åœ¨è¿å•åˆ—è¡¨ä¸­æ˜¾ç¤ºå…¶ä»–å¹³å°åç§°
<TableCell>
  <div>
    <div className="font-medium">{record.auto_number}</div>
    {record.other_platform_names && record.other_platform_names.length > 0 && (
      <div className="text-sm text-muted-foreground mt-1">
        {record.other_platform_names.map((platform, index) => (
          <Badge key={index} variant="secondary" className="mr-1 text-xs">
            {platform}
          </Badge>
        ))}
      </div>
    )}
  </div>
</TableCell>
```

### 3. **è¿å•è¯¦æƒ…ä¸­çš„å±•ç¤º**

```tsx
// è¿å•è¯¦æƒ…ä¸­çš„å…¶ä»–å¹³å°ä¿¡æ¯
{record.other_platform_names && record.other_platform_names.length > 0 && (
  <Card>
    <CardHeader>
      <CardTitle className="flex items-center gap-2">
        <ExternalLink className="h-5 w-5" />
        å…¶ä»–å¹³å°
      </CardTitle>
    </CardHeader>
    <CardContent>
      <div className="flex flex-wrap gap-2">
        {record.other_platform_names.map((platform, index) => (
          <Badge key={index} variant="outline" className="text-sm">
            {platform}
          </Badge>
        ))}
      </div>
    </CardContent>
  </Card>
)}
```

## ğŸ”§ å®æ–½æ­¥éª¤

### 1. **æ•°æ®åº“æ›´æ–°**
```sql
-- æ·»åŠ å­—æ®µ
ALTER TABLE public.logistics_records 
ADD COLUMN other_platform_names TEXT[] DEFAULT '{}';

-- æ·»åŠ æ³¨é‡Š
COMMENT ON COLUMN public.logistics_records.other_platform_names IS 'å…¶ä»–å¹³å°åç§°æ•°ç»„';

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_logistics_records_other_platform_names 
ON public.logistics_records USING GIN (other_platform_names);

-- åˆ›å»ºæŸ¥è¯¢å‡½æ•°
CREATE OR REPLACE FUNCTION public.get_logistics_records_by_platform(TEXT)
RETURNS TABLE (id UUID, auto_number TEXT, project_name TEXT, other_platform_names TEXT[])
LANGUAGE plpgsql AS $$
BEGIN
  RETURN QUERY
  SELECT lr.id, lr.auto_number, lr.project_name, lr.other_platform_names
  FROM public.logistics_records lr
  WHERE p_platform_name = ANY(lr.other_platform_names);
END;
$$;
```

### 2. **å‰ç«¯æ›´æ–°**
- åœ¨è¿å•è¡¨å•ä¸­æ·»åŠ å¹³å°åç§°è¾“å…¥ç»„ä»¶
- åœ¨è¿å•åˆ—è¡¨å’Œè¯¦æƒ…ä¸­æ˜¾ç¤ºå¹³å°åç§°
- æ›´æ–°TypeScriptç±»å‹å®šä¹‰

### 3. **ç±»å‹å®šä¹‰æ›´æ–°**
```typescript
// æ›´æ–°LogisticsRecordæ¥å£
export interface LogisticsRecord {
  // ... ç°æœ‰å­—æ®µ
  other_platform_names?: string[]; // å…¶ä»–å¹³å°åç§°æ•°ç»„
}
```

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### 1. **æ·»åŠ å¹³å°åç§°**
```typescript
// åœ¨è¿å•è¡¨å•ä¸­
const [otherPlatformNames, setOtherPlatformNames] = useState<string[]>([]);

const addPlatformName = () => {
  setOtherPlatformNames([...otherPlatformNames, '']);
};

const updatePlatformName = (index: number, value: string) => {
  const newPlatforms = [...otherPlatformNames];
  newPlatforms[index] = value;
  setOtherPlatformNames(newPlatforms);
};
```

### 2. **ä¿å­˜è¿å•**
```typescript
// ä¿å­˜è¿å•æ—¶åŒ…å«å¹³å°åç§°
const saveLogisticsRecord = async (formData: any) => {
  const recordData = {
    ...formData,
    other_platform_names: otherPlatformNames.filter(name => name.trim() !== '')
  };
  
  await supabase
    .from('logistics_records')
    .insert(recordData);
};
```

### 3. **æŸ¥è¯¢è¿å•**
```sql
-- æŸ¥è¯¢åŒ…å«"è´§æ‹‰æ‹‰"çš„è¿å•
SELECT * FROM get_logistics_records_by_platform('è´§æ‹‰æ‹‰');

-- æŸ¥è¯¢æ‰€æœ‰ä½¿ç”¨è¿‡çš„å¹³å°
SELECT * FROM get_all_used_platforms();
```

## ğŸ¯ ä¼˜åŠ¿

### 1. **ç®€å•æ˜“ç”¨**
- ç›´æ¥æ·»åŠ å­—æ®µï¼Œæ— éœ€å¤æ‚è¡¨ç»“æ„
- ä½¿ç”¨PostgreSQLåŸç”Ÿæ•°ç»„åŠŸèƒ½
- æŸ¥è¯¢æ€§èƒ½ä¼˜ç§€

### 2. **çµæ´»æ‰©å±•**
- æ”¯æŒä»»æ„æ•°é‡çš„å¹³å°åç§°
- å¯ä»¥éšæ—¶æ·»åŠ æˆ–åˆ é™¤å¹³å°
- ä¸ç°æœ‰åŠŸèƒ½å®Œç¾é…åˆ

### 3. **æ•°æ®ä¸€è‡´æ€§**
- ä½¿ç”¨æ•°ç»„ç¡®ä¿æ•°æ®æ ¼å¼ç»Ÿä¸€
- æ”¯æŒç©ºæ•°ç»„è¡¨ç¤ºæ— å…¶ä»–å¹³å°
- ä¾¿äºæ•°æ®éªŒè¯å’Œæ¸…ç†

è¿™ä¸ªæ–¹æ¡ˆç®€å•ç›´æ¥ï¼Œå®Œå…¨æ»¡è¶³æ‚¨è®°å½•å…¶ä»–å¹³å°åç§°çš„éœ€æ±‚ï¼
