# 🚀 修复项目编辑错误 - 快速指南

## 问题：编辑项目、添加合作链路失败

**错误代码**：`A2804` - effective_quantity_type 类型转换错误

---

## ⚡ 快速修复（3步完成）

### 第1步：复制修复脚本
打开文件：`supabase/migrations/20251027_fix_effective_quantity_type_cast.sql`

### 第2步：执行脚本
1. 登录 [Supabase Dashboard](https://app.supabase.com)
2. 选择你的项目
3. 点击左侧菜单 **SQL Editor**
4. 点击 **New Query**
5. 复制粘贴 `20251027_fix_effective_quantity_type_cast.sql` 的全部内容
6. 点击 **Run** 或按 `Ctrl+Enter`

### 第3步：验证修复
1. 刷新项目管理页面
2. 点击编辑任意项目
3. 修改或添加合作链路
4. 点击保存
5. ✅ 应该成功保存，不再报错！

---

## 📋 执行脚本的内容预览

```sql
-- 1. 确保枚举类型存在 ✓
CREATE TYPE effective_quantity_type AS ENUM (...)

-- 2. 确保字段存在 ✓
ALTER TABLE projects ADD COLUMN effective_quantity_type ...

-- 3. 修复 RPC 函数 ✓
CREATE OR REPLACE FUNCTION update_project_chains_incremental(...)
  -- 添加显式类型转换
  effective_quantity_type = (p_project_data->>'effective_quantity_type')::public.effective_quantity_type
```

---

## ❓ 如果还是失败怎么办？

### 检查1：确认脚本执行成功
在 SQL Editor 执行：
```sql
-- 应该返回 3 行（min_value, loading, unloading）
SELECT enumlabel FROM pg_enum 
WHERE enumtypid = 'effective_quantity_type'::regtype;
```

### 检查2：查看错误日志
1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签
3. 重新尝试保存项目
4. 查看详细错误信息

### 检查3：清除浏览器缓存
有时需要清除缓存和刷新页面：
```
Ctrl + Shift + R  （强制刷新）
```

---

## 📞 需要帮助？

如果执行后仍有问题，请提供：
1. Supabase SQL Editor 的执行结果截图
2. 浏览器控制台的错误信息
3. 项目编辑时的操作步骤

---

## 🎯 相关问题

### Q1：这个修复会影响现有数据吗？
**A**：不会。只是修复函数的类型转换，不修改任何现有数据。

### Q2：需要重启服务吗？
**A**：不需要。执行脚本后立即生效。

### Q3：其他功能会受影响吗？
**A**：不会。只修复项目编辑功能，其他功能不受影响。

---

## ✅ 完成！

修复完成后，你可以正常：
- ✅ 编辑项目信息
- ✅ 添加合作链路
- ✅ 修改合作链路
- ✅ 配置合作方

如有任何问题，请随时联系！🎉

