# å‡½æ•°åå†²çªä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

åœ¨åº”ç”¨å¼€ç¥¨ç”³è¯·é«˜çº§ç­›é€‰è¿ç§»æ–‡ä»¶æ—¶ï¼Œå‡ºç°å‡½æ•°åå†²çªé”™è¯¯ï¼š

```
ERROR: 42725: function name "public.get_invoice_request_data" is not unique
HINT: Specify the argument list to select the function unambiguously.
```

## ğŸ” é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨åŒåçš„`get_invoice_request_data`å‡½æ•°ï¼Œä½†å‚æ•°ç­¾åä¸åŒï¼š
- **æ—§å‡½æ•°**: 7ä¸ªå‚æ•° (uuid, date, date, uuid, text[], integer, integer)
- **æ–°å‡½æ•°**: 12ä¸ªå‚æ•° (å¢åŠ äº†5ä¸ªé«˜çº§ç­›é€‰å‚æ•°)

PostgreSQLæ— æ³•ç¡®å®šè¦æ›¿æ¢å“ªä¸ªå‡½æ•°ï¼Œå› ä¸ºå‡½æ•°é‡è½½éœ€è¦æ˜ç¡®çš„å‚æ•°ç±»å‹ã€‚

### å…·ä½“é—®é¢˜
1. **å‡½æ•°é‡è½½å†²çª**: åŒåå‡½æ•°ä½†å‚æ•°ä¸åŒ
2. **å‚æ•°ç­¾åä¸æ˜ç¡®**: CREATE OR REPLACEæ— æ³•ç¡®å®šç›®æ ‡å‡½æ•°
3. **è¿ç§»å¤±è´¥**: æ— æ³•åˆ›å»ºæ–°å‡½æ•°

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. æ˜ç¡®åˆ é™¤æ—§å‡½æ•°

**ä¿®å¤å‰**:
```sql
CREATE OR REPLACE FUNCTION public.get_invoice_request_data(
    -- å‚æ•°åˆ—è¡¨
)
```

**ä¿®å¤å**:
```sql
-- å…ˆåˆ é™¤æ—§å‡½æ•°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
DROP FUNCTION IF EXISTS public.get_invoice_request_data(uuid, date, date, uuid, text[], integer, integer);

-- åˆ›å»ºæ–°çš„get_invoice_request_dataå‡½æ•°ï¼Œæ·»åŠ é«˜çº§ç­›é€‰å‚æ•°
CREATE OR REPLACE FUNCTION public.get_invoice_request_data(
    -- å‚æ•°åˆ—è¡¨
)
```

### 2. å‚æ•°ç­¾åå¯¹æ¯”

**æ—§å‡½æ•°å‚æ•°**:
```sql
get_invoice_request_data(
    p_project_id uuid,
    p_start_date date,
    p_end_date date,
    p_partner_id uuid,
    p_invoice_status_array text[],
    p_page_size integer,
    p_page_number integer
)
```

**æ–°å‡½æ•°å‚æ•°**:
```sql
get_invoice_request_data(
    p_project_id uuid,
    p_start_date date,
    p_end_date date,
    p_partner_id uuid,
    p_invoice_status_array text[],
    p_page_size integer,
    p_page_number integer,
    -- æ–°å¢é«˜çº§ç­›é€‰å‚æ•°
    p_waybill_numbers text,
    p_driver_name text,
    p_license_plate text,
    p_driver_phone text,
    p_driver_receivable text
)
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### å‡½æ•°é‡è½½è§„åˆ™

PostgreSQLæ”¯æŒå‡½æ•°é‡è½½ï¼Œä½†éœ€è¦æ˜ç¡®çš„å‚æ•°ç±»å‹æ¥åŒºåˆ†ï¼š

1. **å‚æ•°æ•°é‡ä¸åŒ**: 7ä¸ªå‚æ•° vs 12ä¸ªå‚æ•°
2. **å‚æ•°ç±»å‹ä¸åŒ**: æ–°å¢5ä¸ªtextç±»å‹å‚æ•°
3. **å‡½æ•°åç›¸åŒ**: ä½†å‚æ•°ç­¾åä¸åŒ

### åˆ é™¤ç­–ç•¥

**ç²¾ç¡®åˆ é™¤**:
```sql
DROP FUNCTION IF EXISTS public.get_invoice_request_data(uuid, date, date, uuid, text[], integer, integer);
```

**å‚æ•°ç±»å‹é¡ºåº**:
1. `uuid` - p_project_id
2. `date` - p_start_date  
3. `date` - p_end_date
4. `uuid` - p_partner_id
5. `text[]` - p_invoice_status_array
6. `integer` - p_page_size
7. `integer` - p_page_number

## ğŸ“‹ ä¿®å¤æ¸…å•

### è¿ç§»æ–‡ä»¶ä¿®æ”¹
- [x] æ·»åŠ DROP FUNCTIONè¯­å¥
- [x] æŒ‡å®šç²¾ç¡®çš„å‚æ•°ç±»å‹
- [x] ä½¿ç”¨IF EXISTSé¿å…é”™è¯¯
- [x] ä¿æŒå‘åå…¼å®¹æ€§

### å‡½æ•°åˆ›å»º
- [x] åˆ›å»ºæ–°å‡½æ•°ï¼ˆ12ä¸ªå‚æ•°ï¼‰
- [x] ä¿æŒåŸæœ‰åŠŸèƒ½
- [x] æ·»åŠ é«˜çº§ç­›é€‰åŠŸèƒ½
- [x] æ›´æ–°å‡½æ•°æ³¨é‡Š

## ğŸ¯ ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- âŒ å‡½æ•°åå†²çªé”™è¯¯
- âŒ æ— æ³•åˆ›å»ºæ–°å‡½æ•°
- âŒ è¿ç§»å¤±è´¥
- âŒ é«˜çº§ç­›é€‰åŠŸèƒ½ä¸å¯ç”¨

### ä¿®å¤å
- âœ… æˆåŠŸåˆ é™¤æ—§å‡½æ•°
- âœ… æˆåŠŸåˆ›å»ºæ–°å‡½æ•°
- âœ… è¿ç§»æˆåŠŸ
- âœ… é«˜çº§ç­›é€‰åŠŸèƒ½æ­£å¸¸
- âœ… å‘åå…¼å®¹

## ğŸš€ éƒ¨ç½²è¯´æ˜

### è¿ç§»æ‰§è¡Œé¡ºåº
1. **åˆ é™¤æ—§å‡½æ•°**: ä½¿ç”¨ç²¾ç¡®çš„å‚æ•°ç±»å‹
2. **åˆ›å»ºæ–°å‡½æ•°**: åŒ…å«æ‰€æœ‰å‚æ•°
3. **éªŒè¯åŠŸèƒ½**: ç¡®ä¿æ–°å‡½æ•°æ­£å¸¸å·¥ä½œ

### é£é™©æ§åˆ¶
- **IF EXISTS**: é¿å…åˆ é™¤ä¸å­˜åœ¨çš„å‡½æ•°æ—¶æŠ¥é”™
- **å‚æ•°ç²¾ç¡®**: åªåˆ é™¤ç‰¹å®šç­¾åçš„å‡½æ•°
- **åŠŸèƒ½ä¿æŒ**: æ–°å‡½æ•°åŒ…å«æ‰€æœ‰åŸæœ‰åŠŸèƒ½

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å‚æ•°é¡ºåº**: DROP FUNCTIONå¿…é¡»æŒ‰ç…§æ­£ç¡®çš„å‚æ•°ç±»å‹é¡ºåº
2. **å‘åå…¼å®¹**: æ–°å‡½æ•°åŒ…å«æ‰€æœ‰åŸæœ‰å‚æ•°
3. **åŠŸèƒ½éªŒè¯**: ç¡®ä¿æ–°å‡½æ•°åŠŸèƒ½æ­£å¸¸
4. **æ€§èƒ½æµ‹è¯•**: æµ‹è¯•æ–°å‡½æ•°çš„æ€§èƒ½

## ğŸ” æµ‹è¯•å»ºè®®

1. **åŸºæœ¬åŠŸèƒ½**: æµ‹è¯•åŸæœ‰ç­›é€‰åŠŸèƒ½
2. **é«˜çº§åŠŸèƒ½**: æµ‹è¯•æ–°å¢çš„é«˜çº§ç­›é€‰åŠŸèƒ½
3. **å‚æ•°å…¼å®¹**: æµ‹è¯•åªä¼ åŸæœ‰å‚æ•°çš„æƒ…å†µ
4. **æ€§èƒ½å¯¹æ¯”**: å¯¹æ¯”æ–°æ—§å‡½æ•°çš„æ€§èƒ½
5. **é”™è¯¯å¤„ç†**: æµ‹è¯•å„ç§é”™è¯¯æƒ…å†µ

---

**ä¿®å¤æ—¶é—´**: 2025-01-16  
**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: â³ å¾…æµ‹è¯•  
**éƒ¨ç½²çŠ¶æ€**: â³ å¾…éƒ¨ç½²
