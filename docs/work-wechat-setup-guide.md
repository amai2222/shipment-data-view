# 企业微信后台配置指南

## 前置条件
- 企业微信管理员权限
- 企业ID: `ww074db5e6770417d9`
- 应用AgentId: `1000002`
- 应用域名: `zkzy.325218.xyz`

## 1. 创建企业微信应用

### 1.1 登录企业微信管理后台
1. 访问 [企业微信管理后台](https://work.weixin.qq.com)
2. 使用管理员账号登录

### 1.2 创建自建应用
1. 在左侧菜单中选择「应用管理」
2. 点击「自建」标签页
3. 点击「创建应用」按钮
4. 填写以下信息：
   - **应用名称**: 运输管理系统
   - **应用介绍**: 物流运输业务管理平台
   - **应用logo**: 上传合适的应用图标
5. 选择「可见范围」：选择需要使用此应用的部门和成员
6. 点击「创建应用」

## 2. 配置应用参数

### 2.1 获取应用信息
创建应用后，在应用详情页面可以看到：
- **AgentId**: `1000002` (已配置)
- **Secret**: `ZF33pb5E47OjVfDQT_o2SRY-hj-7syme4kmV9h-9JOM` (已配置)

### 2.2 设置可信域名
1. 在应用详情页面，找到「企业可信IP」区域
2. 点击「设置可信域名」
3. 在弹出的对话框中：
   - **可作为应用OAuth2.0网页授权功能的回调域名**: 输入 `zkzy.325218.xyz`
   - **可调用JS-SDK 跳转小程序的可信域名**: 留空（因为不使用JS-SDK）
4. 点击「确定」

### 2.3 设置网页授权
1. 在应用详情页面，找到「网页授权及JS-SDK」区域
2. 点击「设置授权回调域」
3. 输入域名: `zkzy.325218.xyz`
4. 下载域名验证文件并上传到网站根目录
5. 点击「保存」

## 3. 配置企业微信审批

### 3.1 创建审批模板
1. 在企业微信管理后台，选择「应用与小程序」→「审批」
2. 点击「新建审批模板」
3. 选择「自定义模板」
4. 配置模板信息：
   - **模板名称**: 付款申请审批
   - **模板说明**: 用于物流运输费用付款申请
   - **流程设置**: 
     - 发起人：申请部门成员
     - 审批人：财务负责人
     - 抄送人：相关领导

### 3.2 设置审批字段
添加以下审批字段：
1. **申请单号** (文本)
2. **付款金额** (数字)
3. **申请说明** (多行文本)
4. **运单数量** (数字)
5. **申请日期** (日期)

### 3.3 启用审批模板
1. 完成配置后点击「保存并启用」
2. 记录模板ID，用于后续API调用

## 4. 设置企业微信通讯录

### 4.1 部门管理
1. 在企业微信管理后台，选择「通讯录」
2. 创建以下部门结构：
   ```
   总公司
   ├── 业务部
   ├── 财务部
   └── 运营部
   ```

### 4.2 成员管理
1. 为每个部门添加相应成员
2. 确保成员信息完整：
   - 姓名
   - 手机号
   - 邮箱（重要：用于系统登录）
   - 部门

## 5. 应用权限配置

### 5.1 设置应用权限
在应用详情页面，配置以下权限：
- **成员信息权限**: 
  - ✅ 访问通讯录
  - ✅ 成员敏感信息
- **应用权限**:
  - ✅ 发送消息到群聊
  - ✅ 管理企业号应用

### 5.2 配置接收消息
1. 在应用详情页面，找到「接收消息」区域
2. 设置回调URL: `https://zkzy.325218.xyz/api/work-wechat-callback`
3. 设置Token和EncodingAESKey（系统会自动生成）

## 6. 测试配置

### 6.1 验证域名配置
1. 在企业微信客户端中搜索应用
2. 点击应用图标
3. 确认可以正常打开网页：`https://zkzy.325218.xyz`

### 6.2 测试登录流程
1. 在企业微信中打开应用
2. 系统应该自动检测企业微信环境
3. 点击「企业微信授权登录」
4. 完成OAuth授权流程
5. 确认能够成功登录系统

### 6.3 测试审批流程
1. 在系统中创建付款申请
2. 点击「企业微信审批」
3. 确认审批单能够在企业微信中正常显示
4. 完成审批后确认系统状态同步

## 7. 常见问题排查

### 7.1 无法打开应用
- 检查可信域名是否正确配置
- 确认域名验证文件是否存在
- 检查应用可见范围设置

### 7.2 登录失败
- 检查Secret是否正确配置
- 确认用户在应用可见范围内
- 检查网络连接和防火墙设置

### 7.3 审批不显示
- 确认审批模板已启用
- 检查审批权限配置
- 验证API调用参数

## 8. 安全建议

### 8.1 权限最小化
- 只给必要的成员开通应用权限
- 定期审查应用使用情况
- 及时撤销离职员工权限

### 8.2 数据保护
- 定期更换Secret密钥
- 监控API调用日志
- 设置合理的审批流程

## 9. 联系支持

如遇到技术问题，请联系：
- 技术支持邮箱：support@company.com
- 企业微信技术支持：[企业微信开发文档](https://developers.work.weixin.qq.com/)

---

配置完成后，用户就可以在企业微信中直接打开应用进行登录和业务操作了。