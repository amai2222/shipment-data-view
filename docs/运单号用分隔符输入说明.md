# 运单号用分隔符输入说明

## 功能说明

在外部运单号输入界面中，支持同一平台的多个运单号用 `|` 分隔输入。

## 使用方式

### 输入格式
- **平台名称**：输入平台名称，如 `货拉拉`
- **运单号**：输入运单号，多个用 `|` 分隔，如 `HL123456|HL789012|HL345678`

### 示例
```
平台名称: [货拉拉]    运单号: [HL123456|HL789012|HL345678]     [X]
平台名称: [满帮]      运单号: [MB789012|MB456789]             [X]
平台名称: [运满满]    运单号: [YM123456]                      [X]
```

## 数据处理逻辑

### 输入时处理
1. 用户输入：平台名称 + 运单号（用|分隔）
2. 系统拆分：将运单号按|分割成数组
3. 生成记录：为每个运单号生成独立的记录

### 示例转换
**输入**：
- 平台名称：`货拉拉`
- 运单号：`HL123456|HL789012|HL345678`

**转换后**：
```json
[
  {"platform": "货拉拉", "tracking_number": "HL123456", "status": "pending", "created_at": "..."},
  {"platform": "货拉拉", "tracking_number": "HL789012", "status": "pending", "created_at": "..."},
  {"platform": "货拉拉", "tracking_number": "HL345678", "status": "pending", "created_at": "..."}
]
```

### 编辑时处理
1. 系统读取：从数据库读取所有运单号记录
2. 按平台分组：将同一平台的运单号合并
3. 界面显示：在运单号输入框中用|分隔显示

### 示例转换
**数据库记录**：
```json
[
  {"platform": "货拉拉", "tracking_number": "HL123456"},
  {"platform": "货拉拉", "tracking_number": "HL789012"},
  {"platform": "货拉拉", "tracking_number": "HL345678"},
  {"platform": "满帮", "tracking_number": "MB789012"}
]
```

**界面显示**：
```
平台名称: [货拉拉]    运单号: [HL123456|HL789012|HL345678]     [X]
平台名称: [满帮]      运单号: [MB789012]                      [X]
```

## 技术实现

### 核心代码
```typescript
// 输入时：拆分运单号
const trackingNumbers = item.tracking_number.split('|').map(tn => tn.trim()).filter(Boolean);

trackingNumbers.forEach(trackingNumber => {
  externalTrackingNumbers.push({
    platform: item.platform,
    tracking_number: trackingNumber,
    status: 'pending',
    created_at: new Date().toISOString()
  });
});

// 编辑时：合并运单号
const groupedByPlatform: { [key: string]: string[] } = {};
editingRecord.external_tracking_numbers.forEach((item: any) => {
  if (item.platform && item.tracking_number) {
    if (!groupedByPlatform[item.platform]) {
      groupedByPlatform[item.platform] = [];
    }
    groupedByPlatform[item.platform].push(item.tracking_number);
  }
});

return Object.entries(groupedByPlatform).map(([platform, trackingNumbers]) => ({
  platform,
  tracking_number: trackingNumbers.join('|'),
  status: 'pending',
  created_at: new Date().toISOString()
}));
```

## 优势

1. **输入效率**：同一平台的多个运单号可以一次性输入
2. **界面简洁**：避免为每个运单号创建单独的行
3. **数据完整**：每个运单号在数据库中都有独立记录
4. **编辑友好**：编辑时自动合并同一平台的运单号显示

## 注意事项

1. **分隔符**：使用 `|` 作为分隔符，不要使用其他符号
2. **空格处理**：系统会自动去除运单号前后的空格
3. **空值过滤**：空的运单号会被自动过滤
4. **平台名称**：每个平台名称对应一行输入

## 更新日志

- 2025-01-20: 实现运单号用|分隔输入功能
- 2025-01-20: 添加编辑时运单号合并显示逻辑
- 2025-01-20: 完善数据处理和转换逻辑
- 2025-01-20: 更新UI提示文字
