# 开票申请功能备份清单

## 需要备份的核心文件

### 1. 前端页面文件
- `src/pages/InvoiceRequest.tsx` - 开票申请页面
- `src/pages/InvoiceRequestManagement.tsx` - 开票申请单管理页面（桌面版）
- `src/pages/mobile/MobileInvoiceRequestManagement.tsx` - 开票申请单管理页面（移动版）
- `src/pages/InvoiceRequest/components/InvoiceRequestFilterBar.tsx` - 开票申请筛选组件

### 2. 数据库迁移文件
- `supabase/migrations/20250816_fix_invoice_request_function_overload.sql` - 开票申请核心功能
- `supabase/migrations/20250116_add_invoice_payment_status_to_logistics_records.sql` - 运单状态字段
- `supabase/migrations/20250116_fix_invoice_status_constraint.sql` - 开票状态约束
- `supabase/migrations/20250116_create_logistics_deletion_triggers.sql` - 运单删除触发器
- `supabase/migrations/20250116_safe_add_invoice_payment_status.sql` - 安全添加状态字段
- `supabase/migrations/20250116_fix_logistics_records_view.sql` - 运单视图修复

### 3. 权限配置文件
- `src/config/permissions.ts` - 权限配置（包含开票申请权限）
- `src/config/permissionsNew.ts` - 新权限配置
- `src/pages/Settings/PermissionManagement.tsx` - 权限管理页面

### 4. 路由和菜单配置
- `src/App.tsx` - 路由配置
- `src/components/AppSidebar.tsx` - 侧边栏菜单配置

### 5. 类型定义文件
- `src/types/index.ts` - 类型定义（包含开票申请相关类型）

## 恢复步骤

### 1. 回滚后恢复前端文件
```bash
# 恢复开票申请页面
git checkout backup-invoice-features -- src/pages/InvoiceRequest.tsx
git checkout backup-invoice-features -- src/pages/InvoiceRequestManagement.tsx
git checkout backup-invoice-features -- src/pages/mobile/MobileInvoiceRequestManagement.tsx
git checkout backup-invoice-features -- src/pages/InvoiceRequest/components/InvoiceRequestFilterBar.tsx
```

### 2. 恢复数据库迁移
```bash
# 恢复数据库迁移文件
git checkout backup-invoice-features -- supabase/migrations/20250816_fix_invoice_request_function_overload.sql
git checkout backup-invoice-features -- supabase/migrations/20250116_add_invoice_payment_status_to_logistics_records.sql
git checkout backup-invoice-features -- supabase/migrations/20250116_fix_invoice_status_constraint.sql
git checkout backup-invoice-features -- supabase/migrations/20250116_create_logistics_deletion_triggers.sql
git checkout backup-invoice-features -- supabase/migrations/20250116_safe_add_invoice_payment_status.sql
git checkout backup-invoice-features -- supabase/migrations/20250116_fix_logistics_records_view.sql
```

### 3. 恢复权限配置
```bash
# 恢复权限配置
git checkout backup-invoice-features -- src/config/permissions.ts
git checkout backup-invoice-features -- src/config/permissionsNew.ts
git checkout backup-invoice-features -- src/pages/Settings/PermissionManagement.tsx
```

### 4. 恢复路由和菜单
```bash
# 恢复路由和菜单配置
git checkout backup-invoice-features -- src/App.tsx
git checkout backup-invoice-features -- src/components/AppSidebar.tsx
```

### 5. 恢复类型定义
```bash
# 恢复类型定义
git checkout backup-invoice-features -- src/types/index.ts
```

## 注意事项

1. **数据库迁移顺序**: 确保按正确顺序执行数据库迁移
2. **权限配置**: 恢复后需要重新配置用户权限
3. **路由测试**: 恢复后需要测试所有路由是否正常工作
4. **功能测试**: 恢复后需要测试开票申请和开票申请单管理功能

## 回滚命令

```bash
# 回滚到指定提交（请根据实际需要选择提交）
git reset --hard <commit-hash>

# 或者回滚到指定提交但保留工作区更改
git reset --soft <commit-hash>
```
