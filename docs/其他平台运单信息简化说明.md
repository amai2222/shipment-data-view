# 其他平台运单信息简化说明

## 修改内容

### 1. 简化输入逻辑
- **原来**：复杂的动态添加/删除界面，需要分别输入平台名称和运单号
- **现在**：简单的文本输入框，使用 `|` 分隔

### 2. 字段格式
- **其他平台名称**：`货拉拉|满帮|运满满`
- **其他平台运单号**：`货拉拉|HL123456|满帮|MB789012|运满满|YM345678`

### 3. 数据库存储格式
- **other_platform_names**：`TEXT[]` 数组，如 `['货拉拉', '满帮', '运满满']`
- **external_tracking_numbers**：`JSONB` 数组，如：
  ```json
  [
    {"platform": "货拉拉", "tracking_number": "HL123456", "status": "pending", "created_at": "2025-01-20T..."},
    {"platform": "满帮", "tracking_number": "MB789012", "status": "pending", "created_at": "2025-01-20T..."}
  ]
  ```

## 修改的文件

### 1. `src/pages/BusinessEntry/components/LogisticsFormDialog.tsx`
- **FormData 接口**：简化平台字段为字符串类型
- **数据加载**：将数据库格式转换为输入格式
- **数据提交**：将输入格式转换为数据库格式
- **UI界面**：简化为两个文本输入框

### 2. `src/components/WaybillDetailDialog.tsx`
- **新增其他平台信息展示**：在费用信息后添加平台信息展示
- **平台名称**：以 Badge 形式展示
- **运单号**：以卡片形式展示，包含平台名称、运单号和状态

## 使用说明

### 新增/编辑运单
1. **其他平台名称**：输入 `货拉拉|满帮|运满满`
2. **其他平台运单号**：输入 `货拉拉|HL123456|满帮|MB789012|运满满|YM345678`
3. 系统会自动解析并存储到数据库

### 运单详情查看
- 在运单详情页面会显示其他平台信息
- 平台名称以标签形式展示
- 运单号以卡片形式展示，包含状态信息

## 数据转换逻辑

### 输入 → 数据库
```typescript
// 其他平台名称
const otherPlatformNames = formData.other_platform_names 
  ? formData.other_platform_names.split('|').filter(Boolean)
  : [];

// 外部运单号
const externalTrackingNumbers = formData.other_platform_waybills
  ? formData.other_platform_waybills.split('|').map(item => {
      const [platform, trackingNumber] = item.split('|');
      return { 
        platform: platform || '', 
        tracking_number: trackingNumber || '', 
        status: 'pending', 
        created_at: new Date().toISOString() 
      };
    }).filter(item => item.platform && item.tracking_number)
  : [];
```

### 数据库 → 显示
```typescript
// 编辑时加载数据
other_platform_names: Array.isArray(editingRecord.other_platform_names) 
  ? editingRecord.other_platform_names.join('|') 
  : (editingRecord.other_platform_names || ''),

other_platform_waybills: Array.isArray(editingRecord.external_tracking_numbers) 
  ? editingRecord.external_tracking_numbers.map((item: any) => `${item.platform}|${item.tracking_number}`).join('|')
  : '',
```

## 优势

1. **简化操作**：用户只需输入文本，不需要复杂的界面操作
2. **数据一致性**：确保平台名称和运单号一一对应
3. **易于理解**：使用 `|` 分隔符，格式清晰
4. **完整展示**：运单详情页面完整展示所有平台信息
5. **数据库兼容**：完全符合现有数据库结构

## 注意事项

1. **必填验证**：如果填写了平台名称，必须填写对应的运单号
2. **格式要求**：严格按照 `平台名称|运单号` 的格式输入
3. **分隔符**：使用 `|` 作为分隔符，不要使用其他符号
4. **数据完整性**：系统会自动过滤空值和无效数据

## 更新日志

- 2025-01-20: 简化其他平台运单信息输入逻辑
- 2025-01-20: 更新表单数据处理逻辑
- 2025-01-20: 添加运单详情页面平台信息展示
- 2025-01-20: 完善数据转换和验证逻辑
