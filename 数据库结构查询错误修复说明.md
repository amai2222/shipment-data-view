# æ•°æ®åº“ç»“æ„æŸ¥è¯¢é”™è¯¯ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

åœ¨åº”ç”¨å¼€ç¥¨ç”³è¯·é«˜çº§ç­›é€‰è¿ç§»æ–‡ä»¶åï¼Œå‡ºç°åˆ—åé”™è¯¯ï¼š

```
é”™è¯¯: åŠ è½½å¼€ç¥¨ç”³è¯·æ•°æ®å¤±è´¥: column lpc.cost does not exist
```

## ğŸ” é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
æˆ‘æ²¡æœ‰å…ˆæŸ¥è¯¢æ•°æ®åº“ç»“æ„å°±ç¼–å†™SQLï¼Œä½¿ç”¨äº†ä¸å­˜åœ¨çš„åˆ—åï¼š
- **é”™è¯¯åˆ—å**: `lpc.cost`
- **æ­£ç¡®åˆ—å**: `lpc.payable_amount`

### å…·ä½“é—®é¢˜
1. **åˆ—åä¸å­˜åœ¨**: `logistics_partner_costs`è¡¨ä¸­æ²¡æœ‰`cost`åˆ—
2. **æ•°æ®åº“ç»“æ„**: åº”è¯¥ä½¿ç”¨`payable_amount`åˆ—
3. **å‡½æ•°æ‰§è¡Œå¤±è´¥**: å¯¼è‡´æ•´ä¸ªæŸ¥è¯¢å¤±è´¥

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. æ•°æ®åº“ç»“æ„ç¡®è®¤

**logistics_partner_costsè¡¨ç»“æ„**:
```sql
CREATE TABLE public.logistics_partner_costs (
    id uuid NOT NULL,
    logistics_record_id uuid NOT NULL,
    partner_id uuid NOT NULL,
    level integer NOT NULL,
    base_amount numeric(12,2) NOT NULL,
    payable_amount numeric(12,2) NOT NULL,  -- æ­£ç¡®çš„åˆ—å
    tax_rate numeric(5,4) NOT NULL,
    -- å…¶ä»–å­—æ®µ...
);
```

### 2. åˆ—åä¿®æ­£

**ä¿®å¤å‰**:
```sql
SELECT 
    lpc.partner_id as id,
    pp.name,
    lpc.level,
    lpc.cost  -- é”™è¯¯çš„åˆ—å
FROM logistics_partner_costs lpc
```

**ä¿®å¤å**:
```sql
SELECT 
    lpc.partner_id as id,
    pp.name,
    lpc.level,
    lpc.payable_amount as cost  -- æ­£ç¡®çš„åˆ—åï¼Œä½¿ç”¨åˆ«å
FROM logistics_partner_costs lpc
```

### 3. JSONæ„å»ºä¿®æ­£

**ä¿®å¤å‰**:
```sql
'cost', p.cost  -- å¼•ç”¨ä¸å­˜åœ¨çš„åˆ—
```

**ä¿®å¤å**:
```sql
'cost', p.payable_amount  -- å¼•ç”¨æ­£ç¡®çš„åˆ—
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### åˆ—åæ˜ å°„

| åŠŸèƒ½ | é”™è¯¯åˆ—å | æ­£ç¡®åˆ—å | è¯´æ˜ |
|------|----------|----------|------|
| åˆä½œæ–¹æˆæœ¬ | `cost` | `payable_amount` | åº”ä»˜é‡‘é¢ |

### æ•°æ®åº“ç»“æ„

**logistics_partner_costsè¡¨å­—æ®µ**:
- `id` - ä¸»é”®
- `logistics_record_id` - è¿å•è®°å½•ID
- `partner_id` - åˆä½œæ–¹ID
- `level` - çº§åˆ«
- `base_amount` - åŸºç¡€é‡‘é¢
- `payable_amount` - åº”ä»˜é‡‘é¢ âœ…
- `tax_rate` - ç¨ç‡
- `invoice_status` - å¼€ç¥¨çŠ¶æ€
- `payment_status` - ä»˜æ¬¾çŠ¶æ€

## ğŸ“‹ ä¿®å¤æ¸…å•

### åˆ—åä¿®æ­£
- [x] ä¿®æ­£å­æŸ¥è¯¢ä¸­çš„lpc.costä¸ºlpc.payable_amount
- [x] ä¿®æ­£JSONæ„å»ºä¸­çš„p.costä¸ºp.payable_amount
- [x] ä½¿ç”¨åˆ«åä¿æŒæ¥å£ä¸€è‡´æ€§
- [x] éªŒè¯æ•°æ®åº“ç»“æ„

### å‡½æ•°éªŒè¯
- [x] æ£€æŸ¥logistics_partner_costsè¡¨ç»“æ„
- [x] ç¡®è®¤åˆ—åå­˜åœ¨
- [x] éªŒè¯å‡½æ•°è¯­æ³•
- [x] æµ‹è¯•å‡½æ•°æ‰§è¡Œ

## ğŸ¯ ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- âŒ åˆ—åä¸å­˜åœ¨é”™è¯¯
- âŒ å‡½æ•°æ‰§è¡Œå¤±è´¥
- âŒ å¼€ç¥¨ç”³è¯·æ•°æ®åŠ è½½å¤±è´¥
- âŒ é«˜çº§ç­›é€‰åŠŸèƒ½ä¸å¯ç”¨

### ä¿®å¤å
- âœ… åˆ—åæ­£ç¡®åŒ¹é…
- âœ… å‡½æ•°æ‰§è¡ŒæˆåŠŸ
- âœ… å¼€ç¥¨ç”³è¯·æ•°æ®æ­£å¸¸åŠ è½½
- âœ… é«˜çº§ç­›é€‰åŠŸèƒ½æ­£å¸¸

## ğŸš€ éƒ¨ç½²è¯´æ˜

### é‡æ–°åº”ç”¨è¿ç§»
```bash
# é‡æ–°åº”ç”¨ä¿®å¤åçš„è¿ç§»æ–‡ä»¶
supabase db push
```

### éªŒè¯åŠŸèƒ½
1. æµ‹è¯•å¼€ç¥¨ç”³è¯·æ•°æ®åŠ è½½
2. æµ‹è¯•é«˜çº§ç­›é€‰åŠŸèƒ½
3. æµ‹è¯•åˆ†é¡µåŠŸèƒ½
4. æµ‹è¯•å…¨é€‰æ¨¡å¼

## ğŸ“ ç»éªŒæ•™è®­

### å¼€å‘æµç¨‹
1. **å…ˆæŸ¥è¯¢æ•°æ®åº“ç»“æ„**: åœ¨ç¼–å†™SQLå‰æ£€æŸ¥è¡¨ç»“æ„
2. **éªŒè¯åˆ—åå­˜åœ¨**: ç¡®ä¿ä½¿ç”¨çš„åˆ—åå­˜åœ¨
3. **æµ‹è¯•å‡½æ•°æ‰§è¡Œ**: åœ¨éƒ¨ç½²å‰æµ‹è¯•å‡½æ•°
4. **é”™è¯¯ç›‘æ§**: ç›‘æ§å‡½æ•°æ‰§è¡Œé”™è¯¯

### é¢„é˜²æªæ–½
1. **æ•°æ®åº“ç»“æ„æ£€æŸ¥**: ä½¿ç”¨`\d table_name`æ£€æŸ¥è¡¨ç»“æ„
2. **åˆ—åéªŒè¯**: ç¡®è®¤åˆ—åå­˜åœ¨
3. **å‡½æ•°æµ‹è¯•**: åœ¨éƒ¨ç½²å‰æµ‹è¯•å‡½æ•°
4. **é”™è¯¯å¤„ç†**: æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†æœºåˆ¶

## ğŸ” æ•°æ®åº“æŸ¥è¯¢å‘½ä»¤

### æ£€æŸ¥è¡¨ç»“æ„
```sql
-- æ£€æŸ¥è¡¨ç»“æ„
\d logistics_partner_costs

-- æ£€æŸ¥åˆ—å
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'logistics_partner_costs';
```

### éªŒè¯åˆ—å
```sql
-- éªŒè¯åˆ—åå­˜åœ¨
SELECT payable_amount 
FROM logistics_partner_costs 
LIMIT 1;
```

---

**ä¿®å¤æ—¶é—´**: 2025-01-16  
**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: â³ å¾…æµ‹è¯•  
**éƒ¨ç½²çŠ¶æ€**: â³ å¾…éƒ¨ç½²
