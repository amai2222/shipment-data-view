# 移动端优化快速入门

> 5分钟快速上手移动端优化组件

## 🚀 快速开始

### 第一步: 引入样式

样式已自动引入到 `src/index.css` 中,无需额外配置。

### 第二步: 选择你需要的功能

## 📱 常见场景

### 场景1: 创建一个移动端列表页

```tsx
import { EnhancedMobileLayout } from '@/components/mobile/EnhancedMobileLayout';
import { MobileOptimizedList } from '@/components/mobile/MobileOptimizedList';
import { MobileCard } from '@/components/mobile/MobileCard';

function MyListPage() {
  const [data, setData] = useState([]);

  return (
    <EnhancedMobileLayout title="列表">
      <MobileOptimizedList
        items={data}
        renderItem={(item) => (
          <MobileCard onClick={() => handleClick(item)}>
            <h3>{item.title}</h3>
            <p>{item.description}</p>
          </MobileCard>
        )}
        keyExtractor={(item) => item.id}
        onRefresh={async () => {
          const newData = await fetchData();
          setData(newData);
        }}
        onLoadMore={async () => {
          const moreData = await fetchMore();
          setData([...data, ...moreData]);
        }}
        hasMore={true}
        enablePullToRefresh
        enableInfiniteScroll
      />
    </EnhancedMobileLayout>
  );
}
```

### 场景2: 创建一个移动端表单页

```tsx
import { EnhancedMobileLayout } from '@/components/mobile/EnhancedMobileLayout';
import { MobileFormCard, MobileFormField } from '@/components/mobile/MobileFormField';
import { MobileButton } from '@/components/mobile/MobileTouchable';

function MyFormPage() {
  const [name, setName] = useState('');
  const [phone, setPhone] = useState('');

  return (
    <EnhancedMobileLayout title="表单">
      <MobileFormCard title="基本信息">
        <MobileFormField
          label="姓名"
          value={name}
          onChange={setName}
          type="text"
          required
        />
        
        <MobileFormField
          label="手机号"
          value={phone}
          onChange={setPhone}
          type="tel"
          required
        />

        <MobileButton
          onClick={handleSubmit}
          variant="primary"
          className="w-full mt-4"
        >
          提交
        </MobileButton>
      </MobileFormCard>
    </EnhancedMobileLayout>
  );
}
```

### 场景3: 添加下拉刷新

```tsx
import { MobilePullToRefresh } from '@/components/mobile/MobilePullToRefresh';

function MyPage() {
  return (
    <MobilePullToRefresh 
      onRefresh={async () => {
        await refetchData();
      }}
    >
      <YourContent />
    </MobilePullToRefresh>
  );
}
```

### 场景4: 添加加载状态

```tsx
import { MobileSkeletonLoader } from '@/components/mobile/MobileSkeletonLoader';

function MyPage() {
  const { data, isLoading } = useQuery();

  if (isLoading) {
    return <MobileSkeletonLoader count={5} type="card" />;
  }

  return <YourContent data={data} />;
}
```

### 场景5: 添加空状态

```tsx
import { NoDataState, ErrorState } from '@/components/mobile/MobileEmptyState';

function MyList() {
  if (isError) {
    return <ErrorState onRetry={refetch} />;
  }

  if (data.length === 0) {
    return <NoDataState onRefresh={refetch} />;
  }

  return <List data={data} />;
}
```

### 场景6: 添加触觉反馈

```tsx
import { triggerHaptic } from '@/utils/mobile';
import { MobileButton } from '@/components/mobile/MobileTouchable';

function MyButton() {
  const handleClick = () => {
    triggerHaptic('light'); // 轻触反馈
    // 执行操作
  };

  return (
    <MobileButton 
      onClick={handleClick}
      hapticFeedback // 自动触觉反馈
    >
      点击我
    </MobileButton>
  );
}
```

### 场景7: 添加滑动操作

```tsx
import { MobileSwipeableCard } from '@/components/mobile/MobileSwipeableCard';
import { Edit, Trash } from 'lucide-react';

function MyListItem({ item }) {
  return (
    <MobileSwipeableCard
      rightActions={[
        {
          icon: Edit,
          label: '编辑',
          onClick: () => handleEdit(item)
        },
        {
          icon: Trash,
          label: '删除',
          onClick: () => handleDelete(item),
          variant: 'destructive'
        }
      ]}
    >
      <div className="p-4">
        <h3>{item.title}</h3>
      </div>
    </MobileSwipeableCard>
  );
}
```

## 🎯 最常用的5个组件

### 1. EnhancedMobileLayout
移动端页面布局容器,自带导航栏、离线检测、网络提示。

```tsx
<EnhancedMobileLayout title="页面标题">
  <YourContent />
</EnhancedMobileLayout>
```

### 2. MobileOptimizedList
优化的列表组件,集成下拉刷新、无限滚动、虚拟列表。

```tsx
<MobileOptimizedList
  items={data}
  renderItem={(item) => <ItemCard {...item} />}
  keyExtractor={(item) => item.id}
  onRefresh={refetch}
  onLoadMore={loadMore}
/>
```

### 3. MobileFormField
移动端表单字段,自动优化输入体验。

```tsx
<MobileFormField
  label="姓名"
  value={name}
  onChange={setName}
  type="text"
  required
/>
```

### 4. MobileSkeletonLoader
骨架屏加载组件,提升感知性能。

```tsx
{isLoading && <MobileSkeletonLoader count={5} type="card" />}
```

### 5. MobileButton / MobileTouchable
触摸优化按钮,自动触觉反馈。

```tsx
<MobileButton onClick={handleClick} variant="primary">
  确认
</MobileButton>
```

## 📦 完整示例模板

复制这个模板快速开始:

```tsx
import React, { useState, useEffect } from 'react';
import { EnhancedMobileLayout } from '@/components/mobile/EnhancedMobileLayout';
import { MobileOptimizedList } from '@/components/mobile/MobileOptimizedList';
import { MobileCard } from '@/components/mobile/MobileCard';
import { MobileSkeletonLoader } from '@/components/mobile/MobileSkeletonLoader';
import { NoDataState, ErrorState } from '@/components/mobile/MobileEmptyState';
import { MobileFAB } from '@/components/mobile/MobileBottomNav';
import { Plus } from 'lucide-react';
import { useNavigate } from 'react-router-dom';

export default function TemplateMobilePage() {
  const [data, setData] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(false);
  const [hasMore, setHasMore] = useState(true);
  const navigate = useNavigate();

  const loadData = async (isRefresh = false) => {
    try {
      setLoading(true);
      setError(false);
      
      // 替换为你的API调用
      const response = await fetch('/api/data');
      const newData = await response.json();
      
      setData(isRefresh ? newData : [...data, ...newData]);
      setHasMore(newData.length > 0);
    } catch (err) {
      setError(true);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadData(true);
  }, []);

  if (loading && data.length === 0) {
    return (
      <EnhancedMobileLayout title="加载中">
        <MobileSkeletonLoader count={5} type="card" />
      </EnhancedMobileLayout>
    );
  }

  if (error && data.length === 0) {
    return (
      <EnhancedMobileLayout title="错误">
        <ErrorState onRetry={() => loadData(true)} />
      </EnhancedMobileLayout>
    );
  }

  if (data.length === 0) {
    return (
      <EnhancedMobileLayout title="暂无数据">
        <NoDataState onRefresh={() => loadData(true)} />
      </EnhancedMobileLayout>
    );
  }

  return (
    <EnhancedMobileLayout title="列表页">
      <MobileOptimizedList
        items={data}
        renderItem={(item) => (
          <MobileCard
            onClick={() => navigate(`/m/detail/${item.id}`)}
            onEdit={() => navigate(`/m/edit/${item.id}`)}
            onDelete={() => handleDelete(item.id)}
          >
            <div className="p-4">
              <h3 className="font-semibold mb-2">{item.title}</h3>
              <p className="text-sm text-muted-foreground">{item.description}</p>
            </div>
          </MobileCard>
        )}
        keyExtractor={(item) => item.id}
        onRefresh={() => loadData(true)}
        onLoadMore={() => loadData(false)}
        hasMore={hasMore}
        enablePullToRefresh
        enableInfiniteScroll
        useVirtualList={data.length > 50}
      />

      <MobileFAB
        icon={Plus}
        label="新建"
        onClick={() => navigate('/m/create')}
        position="bottom-right"
        variant="primary"
      />
    </EnhancedMobileLayout>
  );
}
```

## 🛠️ 常用工具函数

```tsx
import {
  triggerHaptic,      // 触觉反馈
  copyToClipboard,    // 复制
  shareContent,       // 分享
  callPhone,          // 拨打电话
  sendSMS,            // 发送短信
  scrollToTop,        // 滚动到顶部
  compressImage       // 压缩图片
} from '@/utils/mobile';

// 使用示例
triggerHaptic('light');
await copyToClipboard('复制内容');
await shareContent({ title: '标题', url: 'https://...' });
callPhone('13800138000');
```

## 📚 更多资源

- [完整指南](./移动端优化指南.md) - 详细文档
- [示例页面](./src/pages/mobile/MobileOptimizationDemo.tsx) - 交互演示
- [总结报告](./移动端优化完成总结.md) - 优化成果

## 💡 小贴士

1. **性能**: 列表超过50项时自动启用虚拟滚动
2. **输入**: 输入框字体保持16px以上,防止iOS自动缩放
3. **触摸**: 按钮最小尺寸44x44px,符合触摸规范
4. **安全区域**: 组件自动适配刘海屏安全区域
5. **网络**: 自动检测离线和慢速网络状态

## 🎉 开始使用

选择一个场景,复制代码,替换数据源,立即开始!

有问题?查看[完整指南](./移动端优化指南.md)获取详细说明。

