# æ€§èƒ½é—®é¢˜å¿«é€Ÿè¯Šæ–­æŒ‡å—

å½“é¡µé¢å˜æ…¢æ—¶ï¼ŒæŒ‰æ­¤æ¸…å•å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ã€‚

---

## ğŸ” å¿«é€Ÿè¯Šæ–­æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆ5ç§’ï¼‰

```
æŒ‰ F12 â†’ åˆ‡æ¢åˆ° Network æ ‡ç­¾ â†’ åˆ·æ–°é¡µé¢
```

**è§‚å¯Ÿ**:
- ğŸ”´ å¦‚æœçœ‹åˆ°å¾ˆå¤šç›¸åŒçš„è¯·æ±‚ â†’ **ç¼“å­˜é—®é¢˜**
- ğŸ”´ å¦‚æœçœ‹åˆ°è¯·æ±‚æ—¶é—´å¾ˆé•¿ â†’ **æ•°æ®åº“/ç´¢å¼•é—®é¢˜**
- ğŸ”´ å¦‚æœçœ‹åˆ°è¯·æ±‚å¾ˆå¤šæ¬¡ â†’ **N+1æŸ¥è¯¢é—®é¢˜**

---

### ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥æ§åˆ¶å°ï¼ˆ10ç§’ï¼‰

```
F12 â†’ Consoleæ ‡ç­¾
```

**æŸ¥æ‰¾**:
- ğŸ”´ çº¢è‰²é”™è¯¯ â†’ **ä»£ç é”™è¯¯**
- ğŸŸ¡ é»„è‰²è­¦å‘Š â†’ **æ€§èƒ½è­¦å‘Š**
- å¤§é‡æ—¥å¿—è¾“å‡º â†’ **è°ƒè¯•æ—¥å¿—è¿‡å¤š**

---

### ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨React DevToolsï¼ˆ15ç§’ï¼‰

```
å®‰è£… React Developer Tools
â†’ Componentsæ ‡ç­¾ â†’ Profiler
â†’ ç‚¹å‡»å½•åˆ¶æŒ‰é’® â†’ æ“ä½œé¡µé¢ â†’ åœæ­¢å½•åˆ¶
```

**è§‚å¯Ÿ**:
- ğŸ”´ é¢‘ç¹é‡æ–°æ¸²æŸ“çš„ç»„ä»¶ â†’ **æ¸²æŸ“ä¼˜åŒ–é—®é¢˜**
- ğŸ”´ æ¸²æŸ“æ—¶é—´é•¿çš„ç»„ä»¶ â†’ **æ€§èƒ½ç“¶é¢ˆ**

---

## ğŸ¯ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: é¡µé¢åŠ è½½æ…¢ï¼ˆé¦–æ¬¡ï¼‰â±ï¸

**ç—‡çŠ¶**: é¦–æ¬¡æ‰“å¼€é¡µé¢éœ€è¦2-5ç§’

**è¯Šæ–­**:
```
Networkæ ‡ç­¾ â†’ æŸ¥çœ‹è¯·æ±‚æ•°é‡å’Œæ—¶é—´
```

**å¯èƒ½åŸå› **:
- ğŸ”´ æ•°æ®åº“æŸ¥è¯¢æ…¢ï¼ˆç¼ºå°‘ç´¢å¼•ï¼‰
- ğŸ”´ æŸ¥è¯¢çš„æ•°æ®é‡å¤ªå¤§
- ğŸ”´ ç½‘ç»œå»¶è¿Ÿ

**è§£å†³æ–¹æ¡ˆ**:
1. âœ… **æ‰§è¡Œæ•°æ®åº“ç´¢å¼•**
   ```bash
   supabase/migrations/add_performance_indexes.sql
   ```

2. âœ… **ä¼˜åŒ–æŸ¥è¯¢å­—æ®µ**
   ```typescript
   // âŒ æŸ¥è¯¢æ‰€æœ‰å­—æ®µ
   .select('*')
   
   // âœ… åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
   .select('id, name, status')
   ```

3. âœ… **æ·»åŠ åˆ†é¡µ**
   ```typescript
   .range(0, 50) // åªåŠ è½½å‰50æ¡
   ```

---

### é—®é¢˜2: äºŒæ¬¡è®¿é—®è¿˜æ˜¯æ…¢ï¼ˆç¼“å­˜é—®é¢˜ï¼‰ğŸ’¾

**ç—‡çŠ¶**: åˆ·æ–°æˆ–åˆ‡æ¢å›é¡µé¢ï¼Œæ¯æ¬¡éƒ½å¾ˆæ…¢

**è¯Šæ–­**:
```typescript
// æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†React Query
const { data } = useQuery(...)  // âœ… æœ‰ç¼“å­˜
const [data, setData] = useState(...) // âŒ æ— ç¼“å­˜
```

**è§£å†³æ–¹æ¡ˆ**:
âœ… **ä½¿ç”¨React Query**
```typescript
const { data } = useQuery({
  queryKey: ['key'],
  queryFn: fetchData,
  staleTime: 2 * 60 * 1000,  // 2åˆ†é’Ÿç¼“å­˜
  cacheTime: 10 * 60 * 1000, // 10åˆ†é’Ÿä¿ç•™
});
```

---

### é—®é¢˜3: æ“ä½œåé¡µé¢å¡é¡¿ï¼ˆé‡å¤åŠ è½½ï¼‰ğŸ”„

**ç—‡çŠ¶**: åˆ›å»º/åˆ é™¤/æ›´æ–°åï¼Œé¡µé¢å¡ä½1-2ç§’

**è¯Šæ–­**:
```typescript
// æ£€æŸ¥æ“ä½œåçš„ä»£ç 
const handleCreate = async () => {
  await create();
  await loadData(); // ğŸ”´ é—®é¢˜ï¼šé‡æ–°åŠ è½½æ‰€æœ‰æ•°æ®
};
```

**è§£å†³æ–¹æ¡ˆ**:
âœ… **ä½¿ç”¨æ™ºèƒ½ç¼“å­˜åˆ·æ–°**
```typescript
const queryClient = useQueryClient();

const handleCreate = async () => {
  await create();
  // âœ… åªåˆ·æ–°ç¼“å­˜ï¼Œä¸é˜»å¡æ“ä½œ
  await queryClient.invalidateQueries({ queryKey: ['data'] });
};
```

---

### é—®é¢˜4: é¡µé¢é¢‘ç¹é‡æ–°æ¸²æŸ“ï¼ˆç»„ä»¶ä¼˜åŒ–ï¼‰ğŸ”

**ç—‡çŠ¶**: é¡µé¢é—ªçƒï¼Œæ€§èƒ½å·¥å…·æ˜¾ç¤ºé¢‘ç¹æ¸²æŸ“

**è¯Šæ–­**:
```typescript
// æ£€æŸ¥æ˜¯å¦æœ‰æ¯æ¬¡éƒ½é‡æ–°è®¡ç®—çš„é€»è¾‘
const filtered = items.filter(...); // ğŸ”´ æ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œ
```

**è§£å†³æ–¹æ¡ˆ**:
âœ… **ä½¿ç”¨useMemoç¼“å­˜è®¡ç®—ç»“æœ**
```typescript
const filtered = useMemo(() => {
  return items.filter(...);
}, [items, filterCondition]);
```

âœ… **ä½¿ç”¨useCallbackç¼“å­˜å‡½æ•°**
```typescript
const handleClick = useCallback(() => {
  // å¤„ç†é€»è¾‘
}, [dependencies]);
```

---

### é—®é¢˜5: N+1æ•°æ®åº“æŸ¥è¯¢ğŸ”¢

**ç—‡çŠ¶**: Networkæ ‡ç­¾æ˜¾ç¤ºå¤§é‡ç›¸ä¼¼çš„æ•°æ®åº“è¯·æ±‚

**è¯Šæ–­**:
```typescript
// ğŸ”´ é—®é¢˜æ¨¡å¼
for (const item of items) {
  const detail = await fetchDetail(item.id);
}
```

**è§£å†³æ–¹æ¡ˆ**:
âœ… **ä½¿ç”¨æ‰¹é‡æŸ¥è¯¢**
```typescript
const ids = items.map(item => item.id);
const allDetails = await supabase
  .from('table')
  .select('*')
  .in('id', ids);

// åœ¨å†…å­˜ä¸­åˆ†ç»„
const detailsMap = new Map();
allDetails.forEach(detail => {
  detailsMap.set(detail.id, detail);
});
```

---

## ğŸ› ï¸ æ€§èƒ½ä¼˜åŒ–å·¥å…·ç®±

### å·¥å…·1: æ€§èƒ½æµ‹é‡
```typescript
import { measureAsync } from '@/utils/performanceUtils';

await measureAsync('åŠ è½½é¡¹ç›®', async () => {
  return await loadProjects();
});
// è¾“å‡º: [Performance] åŠ è½½é¡¹ç›®: 234.56ms
```

### å·¥å…·2: React Query DevTools
```typescript
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';

<ReactQueryDevtools initialIsOpen={false} />
```

### å·¥å…·3: Chrome Performance
```
F12 â†’ Performanceæ ‡ç­¾ â†’ å½•åˆ¶ â†’ æ“ä½œ â†’ åœæ­¢
```

---

## ğŸ“Š æ€§èƒ½åŸºå‡†å‚è€ƒ

### å¯æ¥å—çš„æ€§èƒ½æŒ‡æ ‡

| æ“ä½œ | å¯æ¥å— | è‰¯å¥½ | ä¼˜ç§€ |
|------|--------|------|------|
| é¦–é¡µåŠ è½½ | <2s | <1s | <0.5s |
| åˆ—è¡¨é¡µé¢ | <1.5s | <0.8s | <0.3s |
| è¯¦æƒ…é¡µé¢ | <1s | <0.5s | <0.2s |
| è¡¨å•æäº¤ | <2s | <1s | <0.5s |
| çŠ¶æ€æ›´æ–° | <1s | <0.5s | <0.2s |

### å½“å‰ä¼˜åŒ–åçš„æ€§èƒ½

| é¡µé¢/æ“ä½œ | å®é™…æ€§èƒ½ | è¯„çº§ |
|----------|---------|------|
| é¡¹ç›®ç®¡ç†é¦–æ¬¡åŠ è½½ | ~500ms | â­â­â­â­ è‰¯å¥½ |
| é¡¹ç›®ç®¡ç†äºŒæ¬¡è®¿é—® | 0ms | â­â­â­â­â­ ä¼˜ç§€ |
| åˆ›å»ºé¡¹ç›® | ~200ms | â­â­â­â­â­ ä¼˜ç§€ |
| åˆ é™¤é¡¹ç›® | ~150ms | â­â­â­â­â­ ä¼˜ç§€ |
| æ›´æ–°çŠ¶æ€ | ~100ms | â­â­â­â­â­ ä¼˜ç§€ |

---

## ğŸš¨ æ€§èƒ½é—®é¢˜æ£€æŸ¥æ¸…å•

é‡åˆ°æ€§èƒ½é—®é¢˜æ—¶ï¼Œä¾æ¬¡æ£€æŸ¥ï¼š

- [ ] æ˜¯å¦ä½¿ç”¨äº†React Queryç¼“å­˜ï¼Ÿ
- [ ] æ˜¯å¦æœ‰N+1æŸ¥è¯¢é—®é¢˜ï¼Ÿ
- [ ] æ•°æ®åº“æ˜¯å¦æ·»åŠ äº†ç´¢å¼•ï¼Ÿ
- [ ] æ˜¯å¦æœ‰ä¸å¿…è¦çš„é‡å¤æ¸²æŸ“ï¼Ÿ
- [ ] æ˜¯å¦æ¯æ¬¡æ“ä½œéƒ½é‡æ–°åŠ è½½æ‰€æœ‰æ•°æ®ï¼Ÿ
- [ ] Networkè¯·æ±‚æ˜¯å¦è¿‡å¤šï¼Ÿ
- [ ] æ˜¯å¦æœ‰console.logå½±å“æ€§èƒ½ï¼Ÿ
- [ ] æ˜¯å¦æœ‰å¤§é‡æ•°æ®æœªåˆ†é¡µï¼Ÿ

---

## ğŸ¯ å¿«é€Ÿä¿®å¤æ¨¡æ¿

### æ¨¡æ¿1: æ·»åŠ React Queryç¼“å­˜
```typescript
// æ›¿æ¢è¿™ç§æ¨¡å¼ï¼š
const [data, setData] = useState([]);
const loadData = async () => {
  const result = await fetch();
  setData(result);
};
useEffect(() => { loadData(); }, []);

// æ”¹ä¸ºï¼š
const { data = [] } = useQuery({
  queryKey: ['data-key'],
  queryFn: fetchData,
  staleTime: 2 * 60 * 1000,
});
```

### æ¨¡æ¿2: æ™ºèƒ½åˆ·æ–°
```typescript
// æ›¿æ¢è¿™ç§æ¨¡å¼ï¼š
const handleSave = async () => {
  await save();
  await loadAllData(); // âŒ é‡æ–°åŠ è½½
};

// æ”¹ä¸ºï¼š
const queryClient = useQueryClient();
const handleSave = async () => {
  await save();
  await queryClient.invalidateQueries({ queryKey: ['data-key'] }); // âœ… æ™ºèƒ½åˆ·æ–°
};
```

### æ¨¡æ¿3: æ‰¹é‡æŸ¥è¯¢
```typescript
// æ›¿æ¢è¿™ç§æ¨¡å¼ï¼š
for (const item of items) {
  const detail = await fetch(item.id); // âŒ N+1
}

// æ”¹ä¸ºï¼š
const ids = items.map(item => item.id);
const allDetails = await fetchBatch(ids); // âœ… æ‰¹é‡
```

---

## ğŸ“ å¦‚æœè¿˜æ˜¯æ…¢ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ

### è”ç³»æ–¹å¼
1. æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š[ä»£ç ä¼˜åŒ–å®æ–½æŠ¥å‘Š.md](./ä»£ç ä¼˜åŒ–å®æ–½æŠ¥å‘Š.md)
2. æ‰§è¡Œæ•°æ®åº“ç´¢å¼•ï¼š[add_performance_indexes.sql](./supabase/migrations/add_performance_indexes.sql)
3. ä½¿ç”¨æ€§èƒ½å·¥å…·ï¼š[performanceUtils.ts](./src/utils/performanceUtils.ts)

---

## âœ¨ æ€»ç»“

- ğŸ¯ **å¿«é€Ÿè¯Šæ–­**: F12 â†’ Network â†’ è§‚å¯Ÿè¯·æ±‚
- ğŸ”§ **å¿«é€Ÿä¿®å¤**: æ·»åŠ React Queryç¼“å­˜
- ğŸ“Š **éªŒè¯æ•ˆæœ**: æµ‹è¯•åŠ è½½æ—¶é—´å’Œè¯·æ±‚æ¬¡æ•°
- ğŸ“š **å‚è€ƒæ–‡æ¡£**: æŸ¥çœ‹ç›¸å…³ä¼˜åŒ–æŒ‡å—

**å¤§å¤šæ•°æ€§èƒ½é—®é¢˜éƒ½å¯ä»¥é€šè¿‡React Queryç¼“å­˜è§£å†³ï¼**

---

*è¯Šæ–­æŒ‡å— | 2025å¹´1æœˆ8æ—¥*

